
作者：禅与计算机程序设计艺术                    

# 1.简介
  

## 概念、特点及功能介绍
Windows Active Directory (AD) 是微软公司开发的一套基于 Windows NT 的目录服务系统，它主要用于存储用户信息、计算机信息和其他网络资源的信息。其中域名控制器 (Domain Controller, DC)，负责维护网络中的各种资源信息；而企业中其他服务器上的应用服务器也可以通过目录协议进行通信，获取必要的信息，并提供网络资源给用户访问。

### AD的特点
1. 集中式服务管理：AD被设计成一个集中式、中心化的目录服务，所有的信息都存放在一个中央位置，管理员可以轻松管理整个网络中所有对象的属性和配置。

2. 分层次的结构：AD组织在各个层级之间存在着不同类型的链接关系，包括全局组、本地组和通用组等。全局组可以跨多个域，而且每个域都有自己的根目录;本地组只能在其所属域内有效，而通用组则可以在任意域间共享使用。

3. 灵活的数据模型：AD支持多种数据类型，例如字符串、整数、日期时间、布尔值、对象GUID等，还可定义自定义属性类型。AD提供丰富的控件，方便管理人员配置复杂的权限和访问控制策略。

4. 自动复制和更新：AD采用分布式数据库技术，使得每台服务器都保存一份完整的目录信息。当用户或应用程序修改了AD中的某个对象时，其它服务器上的相应对象会立即得到更新，确保数据的一致性。

5. 支持多种身份认证机制：AD支持多种身份验证方法，如Kerberos、NTLM、数字签名、智能卡、动态密码等，管理员可以根据需要选择适合的验证方式。

6. 兼容各种网络硬件和操作系统：AD可以运行于各种类型的网络硬件和操作系统上，例如服务器、路由器、防火墙、VPN设备等，并且具有较好的可靠性和安全性。

### AD的功能
- 用户、计算机帐号管理：提供对用户和计算机帐户的创建、修改、删除、启用和禁用等管理功能。
- 组和用户权限分配：通过向组和用户分配权限，可以实现细粒度的用户访问控制。
- 账户锁定和解锁：可以将不再使用或者需要暂时禁用的账户设置为锁定状态，再次激活后才能正常使用。
- 目录服务查询和搜索：提供简单、高效、直观的查询和搜索功能，包括通过用户、计算机、组、域等进行搜索。
- 打印服务管理：可以通过AD实现打印机的管理和打印作业的打印，并且可以控制打印权限。
- 远程桌面服务管理：可以实现对远程桌面的管理和授权。
- DNS管理：可以通过AD实现DNS记录的管理和授权。
- 策略管理：提供了针对AD对象的策略管理功能，如限制登录时间、创建保留的用户名和组等。
- 脚本和工具：AD提供了许多脚本和工具，可以用来完成诸如备份、导入导出、监控和报告等任务。
# 2.核心概念术语说明
## 组
组（Group）是指在Active Directory中用来管理用户、计算机账号以及其他资源的容器。组的主要特征是由成员组成，成员可以是用户、计算机账号或者其他组。组拥有者可以管理组的成员，可以设置组的权限以及限制某些用户、计算机账号的访问权限。

**注意**：一般情况下，建议不要直接把用户添加到组中，应使用单独的用户和组对象，否则可能出现权限不足的问题。

### 全局组
全局组（Global Group）是指全局范围内的一个群组，所有的域都能够看到这个组。在域中建立全局组的名称前缀为“Global”或“Builtin”。

### 本地组
本地组（Local Group）是指只在自己所在的域中有效的一个群组。在域中建立本地组的名称前缀为“CN=”或“OU=”。

### 通用组
通用组（Universal Group）是指每个域内都可以使用的组，它的成员可以是用户、计算机账号或者其他组。在域中建立通用组的名称前缀为“CN=”或“OU=”，且名称不以“CN=”或“OU=”开头。

## 属性
属性（Attribute）是描述对象的特定信息，例如名字、电话号码、邮件地址等。属性在AD中以键值对形式表示，每一个对象都有一组可供使用的属性。

**注意**：属性的命名规范应该符合标准，避免出现歧义。

## 对象类别
AD中的对象分为三种基本类型：用户、计算机账号和组。

### 用户
用户（User）是一种对象，通常是一个具有个人能力的人，比如学生、员工、职员等。每个用户都有一个唯一的标识符和一组相关的属性，这些属性可以帮助管理员实现不同的访问控制需求。用户可以属于一个或多个组，并可以利用组的特性来实现更精细的权限控制。

### 计算机账号
计算机账号（Computer Account）是指通过网络连接到网络资源的计算机。每个计算机账号都有一个唯一的标识符和一组相关的属性。计算机账号也可与一个或多个组关联，并利用组的特性来实现更精细的权限控制。

### 组
组（Group）是用来管理用户、计算机账号和其他资源的容器。组的成员可以是用户、计算机账号或者其他组。组拥有者可以管理组的成员，可以设置组的权限以及限制某些用户、计算机账号的访问权限。

## 域
域（Domain）是AD中最重要的概念之一，它是网络的逻辑隔离单元，每个域对应于一个独立的Windows系统，里面包含着不同的用户、计算机账号和其他资源。域中有不同的目录树（DN路径），域名（FQDN）和安全证书。域之间可以互相信任，这意味着域中的用户可以访问另一个域中的用户，但是反过来却不能行。

## OU
OU（Organizational Unit）是AD中的组织单位。一个域可以包含多个OU，每个OU又可以包含多个子OU和组。OU用于构建一套复杂的树型结构，它能够很好地满足各种管理需求，从而帮助管理员管理复杂的目录结构。

## GPO
GPO（Group Policy Object）是AD中用于实现组策略的对象。GPO可以指定组策略设置，为组和用户提供统一的管理。GPO可以应用于域、组织单位或是个人用户，并且可以根据需要进行配置。

# 3.核心算法原理和具体操作步骤以及数学公式讲解
## 添加和删除域
要想创建一个新的AD域，首先要创建一个目录林根域。接下来，在目标域控制器上安装AD DS服务，配置相应的DNS解析，然后就能成功创建域。

如果想要删除一个已有的域，首先要确保该域没有任何依赖项，如域内的用户、组、打印机、文件共享等。之后，在该域的第一个域控制器上启动“Active Directory Domain Services Configuration”的命令行工具，输入命令“dcpromo /unattend”启动域删除过程。

## 创建组
新建组的方法有两种：

1. 通过右键菜单新建组。这种方式可以在树视图中创建一个新节点。

2. 通过“新建组向导”新建组。这种方式是在一个表格中生成属性并应用到一个新的对象上。

打开“新建组向导”的方式是依次点击“开始”菜单->“所有程序”->“管理工具”->“Active Directory Users and Computers”。双击左侧的“组”，进入“新建组向导”界面。

在新建组向导界面中，需填写“组名”、“注释”、“安全范围”。点击“下一步”开始填写组属性。

“组类型”中有“通用组”、“本地组”和“全局组”三个选项，根据实际情况选取。“通用组”允许组成员跨越不同域，“本地组”仅限于本地域，“全局组”可以跨域使用。

“组作用域”用来设置组成员所在的域，“域本地组”或“全局组”会将组所在的域设为空，那么组内成员就只有本地域用户。

“组策略”用来指定组的组策略，“无”或“确定”选项。

最后点击“创建”按钮创建新组。

## 删除组
删除组的方法有两种：

1. 在“活动目录用户和计算机”中删除组。这种方式可以在树视图中选中需要删除的组，然后右键选择“删除”。

2. 使用“Active Directory 管理中心”中的“组”功能删除组。这种方式是在主窗口中选中需要删除的组，然后点击“删除”按钮。

“删除组”向导提示您确认是否删除选中的组，确认后便开始执行删除操作。

## 修改组
修改组的方法有两种：

1. 在“活动目录用户和计算机”中修改组。这种方式可以在树视图中选中需要修改的组，然后右键选择“属性”。

2. 使用“Active Directory 管理中心”中的“组”功能修改组。这种方式是在主窗口中选中需要修改的组，然后点击“编辑”按钮。

点击“属性”或“编辑”按钮将打开“属性”窗口。在“常规”选项卡中可以修改组名、注释和安全范围等信息。

在“成员”选项卡中可以查看组成员，并添加/删除组成员。在“成员身份”列表中可以查看组成员对应的域/林信息。

## 配置组策略
组策略可以帮助管理员管理组策略对象，为组提供一系列的策略设置。组策略中有很多设置选项，但大体上分为以下几类：

- 用户权限：允许或拒绝组成员登录、创建/删除用户和计算机帐号。
- 计算机配置：指定组成员可以使用哪些驱动器、安装的软件、屏幕保护程序等。
- 安全选项：配置组成员的桌面保护程序、windows防火墙、防病毒软件、事件日志大小等。
- 系统控件：指定组成员可以使用的系统设置，例如颜色主题、任务栏图标排列顺序、显示桌面背景图片等。

可以通过“组策略对象编辑器”（gpedit.msc）来配置组策略。

## 设置组权限
设置组权限的过程如下：

1. 创建一个新的组，或在现有的组中新建权限。

2. 在“组策略”->“计算机配置”->“Windows 设置”->“安全设置”->“本地策略”->“用户 Rights Assignment”中配置权限。

   选择一个权限模板（如，“允许登录终端服务”），选择作用域（如，“本组成员及之后的成员”），再选择“追加”或“允许”权限。勾选“将此权限继承给子 OU 和通用组成员”。

3. 将新的权限设置生效。

权限配置完成后，就可以将组成员加入到组中，并且他们将被赋予相应的权限。

## 查找组成员
查找组成员的方法有两种：

1. 从命令行查找组成员。这种方式需要使用ADSI Edit工具。在命令提示符处输入以下命令：

   dsquery user -name *groupName* -filter "(|(primaryGroupID=xx)(memberof=cn=xx,ou=xx,dc=xx))"

2. 使用“Active Directory 管理中心”中的“搜索”功能查找组成员。这种方式是在主窗口的“导航”窗格中点击“搜索”，然后选择“对象类型”为“组成员”即可。

## 查看组属性
查看组属性的方法有两种：

1. 从命令行查看组属性。这种方式需要使用ADSI Edit工具。在命令提示符处输入以下命令：

   dsquery group -name *groupName* -attr *attributesList*

2. 使用“Active Directory 管理中心”中的“组”功能查看组属性。这种方式是在主窗口中选中需要查看的组，然后点击“属性”按钮。

点击“属性”按钮将打开“属性”窗口。在“常规”选项卡中可以查看组名、注释和安全范围等信息。

在“成员”选项卡中可以查看组成员，并添加/删除组成员。在“成员身份”列表中可以查看组成员对应的域/林信息。

## 定位组位置
定位组位置的方法有两种：

1. 从命令行定位组位置。这种方式需要使用ADSI Edit工具。在命令提示符处输入以下命令：

   dsquery group -name *groupName* -scope base -showdefrel

2. 使用“Active Directory 管理中心”中的“组”功能定位组位置。这种方式是在主窗口中选中需要查看的组，然后点击“浏览”按钮。

点击“浏览”按钮将打开“组浏览”窗口，显示该组在域结构中的位置。