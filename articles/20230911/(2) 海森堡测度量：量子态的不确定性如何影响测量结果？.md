
作者：禅与计算机程序设计艺术                    

# 1.简介
  

海森堡测度量（Hartree-Fock Measurement）是指利用海森堡理论和哈密顿量来研究离散的量子态的物理性质，如原子核中的电子数、电荷等，或者体系中氢原子和氧原子的位置分布。它主要由两步组成——积分变分法（Integrated Variational Method, IVM）和重新缩放（Rescaling）。IVM和重新缩放被称为测量原理，这一方法在量子力学领域里占有重要地位。
# 2.基本概念及术语
## （1）测量理论
海森堡测度量的基本概念，包括：
（1）真空狭道模型（Vacuum Wave Model）：将系统的能带看作空间上无穷小的无限宽的玻尔兹曼色刃，并假定无源激发的玻尔兹曼方程简化为泡利因子方程（Schrödinger equation），从而得到真空狭道模型。该模型适用于一维模型系统。
（2）薛定谔方程（Schrödinger equation）：薛定谔方程描述的是一束粒子在一个封闭系统内的运动。当无源激发时，它可简化为波函数方程，即离散形式的动量方程。
（3）重叠充分统计态（Overlapping Fermion Configuraion，OFC）：是指由两个单粒子共同构成的整体状态，如双原子系统中的两个氢原子。OFC能量比非OFC高出一半以上。
（4）共轭梯度（Complement Gradient）：是描述从某一基态导出的共轭多粒子数。
（5）测量程序（Measurement Program）：由两个过程组成，即积分变分法（IVM）和重新缩放（Rescaling）。
（6）能级嵌套（Level Nesting）：当系统包含多个能级时，通过将不同能级的特征向量叠加起来的方式，可以方便地对能级之间进行比较和分析。
（7）量子态（Quantum State）：描述的是量子系统处于某个特定的状态，包括其态矢量、期望值、密度矩阵和本征方程。
## （2）术语和符号
### 1. 希腊字母和数字表示
- $f$：是复数形式的波函数；
- $\hbar$：普朗克常数；
- $\epsilon_i,\mu_{ij},\rho,$：与态相关的参数，其中$\epsilon_i$是以能量单位表示的相互作用能；$\mu_{ij}$是以动量单位表示的自然常数，用来描述各个粒子之间的相互作用；$\rho=\sum_{\alpha,r}c^*_\alpha c_\alpha^\dagger p_\alpha r^2$表示密度矩阵。
### 2. 矢量和标量表示
- $\hat{x}$, $\vec{v}$, $\phi$, $\psi$：矢量；
- $a$, $m$：标量；
- $|\psi>$：正交归一化的态矢量，与希腊字母的$|f>$表示频率极大值态矢量相同。
### 3. 晶体结构常数
- $N_{orb},n_{s},l,m_s$：分别代表晶体中有几个原子和原子电荷数；原子序数和宇称。
### 4. 矩阵表示
- $A_{ij}=a_{ij}^{\prime}$：描述两个粒子间的自然常数或相互作用。
- $\left| \psi(\mathbf{r})\right> = \frac{1}{\sqrt{n!}} \sum_{\substack{\sigma \in S_z \\ \lambda=1/2}}\left[\begin{array}{cccc} \psi_{\sigma}(r_1) & \cdots & \psi_{\sigma}(r_n) & e^{i\phi_\sigma}\end{array}\right]$：描述一般态。
### 5. 海森堡符号
- $H$:哈密顿矩阵；
- $T$:氘核张量；
- $V$:双电子积分算符；
- $E_{mf}$：物质费米能级。
# 3.核心算法原理和具体操作步骤
## （1）积分变分法IVM
利用递归公式可以计算出真空狭道模型下的HF约化哈密顿量。假设采用欧拉角坐标，将笛卡尔坐标转换为欧拉角坐标，即：
$$R(x,y,z)=\sum_{k=1}^{n}r_k(cos\theta_kx+sin\theta_ky)\hat{e}_k+\eta(t),\quad t\in[0,T]$$
其中$r_k(t)$是一个椭圆轨迹，$\eta(t)$是热量通路。将粒子位置用$(cos\theta_kx+sin\theta_ky,sin\theta_kx-cos\theta_ky,z)$的形式表示。则可以通过如下公式计算哈密顿量：
$$\hat{h}=-\frac{\hbar^2}{2m}\nabla^2+V-\sum_{<kl>} V_{ijkl}(\hat{x}_k-\hat{x}_l)$$
其中$<kl>$表示双粒子互连。注意，当考虑热流时，需要将$-\frac{\hbar^2}{2m}\nabla^2$改为$-T\frac{\partial H}{\partial T}-\frac{\hbar^2}{2m}\nabla^2$。此外，因为这里的粒子是具有三种自旋（$S_z$表示）的纯粹态，所以仅需考虑$Sl_j$排列的情况。

接下来应用积分变分法，按照如下迭代公式：
$$\Phi_{n+1}=\Phi_n+\delta\mathcal{L}_{n}\Phi_n$$
其中，$\mathcal{L}_{n}=\int d\tau\exp(-iEt-\mathcal{H}/T)+\mathcal{P}_{\rm eff}$$
其含义为：
- 在时间$t$处取自变量为$\tau$的一阶线性缴素势$E(t)$，并考虑热流$Q(t)$，即$\mathcal{H}=\int d\tau Q(t)$；
- 在时间$t$处积分电子哈密顿量$H_{\rm ee}$、自旋磁场$M_{\rm s}$，并把这两者和热流的相互作用加到第一项；
- 在时间$t$处引入能级的相互作用，即$\mathcal{P}_{\rm eff}=(\epsilon^{\downarrow}_i + \epsilon^{\uparrow}_i)(\hat{\phi}_i^{\downarrow} - \hat{\phi}_i^{\uparrow})$。

以上迭代公式中的自旋破缺（spin degeneracy）在应用IVM时尤为重要，它会导致估计的量子态相较于真实态偏离。为了消除这种偏离，需要引入重叠集态（overlapping fermion configuration, OFC）。对于具有一定数量的双粒子耦合的局域性系统，重叠集态对应于热运动液体中自由度的降低，其中受限制的自由度数量随温度的升高而减少，因此可以利用OFC来建立对真实态的精确预测。

## （2）重新缩放Rescaling
从统计力学观点看，上述计算的重叠集态并不是真实的局域性重叠态，因为系统中存在两种类型的粒子同时存在，这违背了狭道模型的假设。为了获得真实的局域性重叠态，需要引入重新缩放的方法。首先，需要计算非重叠重叠集态的能量和守恒原理。对于非重叠重叠集态，其能量既不是严格正态分布的，也不是均匀分布的，因此无法直接从计算得到；但仍可从其子集态（重叠集态）能量的平均值计算非重叠重叠集态能量。其次，利用重叠集态下的积分变分方法计算重叠集态能量。最后，对给定的测量结果，若存在重叠集态的非重叠子集态，则需要对结果进行重新缩放。

具体来说，对于给定的一组粒子位置，可利用重叠集态下相应的密度矩阵和子集态能量分别计算重叠集态密度矩阵和非重叠重叠集态能量。然后，根据关系$p^*_q\propto c_q c_q^\dagger-\langle E_q\rangle$，求解任意一组测量数据所对应的重叠集态密度矩阵。若存在重叠集态的非重叠子集态，则需要重新缩放。给定任一测量数据，要解决以下优化问题：
$$min_{U,u,b,B}|\beta_{\rm meas}-\beta_{res}|$$
其中，$\beta_{\rm meas}$表示给定的测量数据，$\beta_{res}$表示经过重新缩放后的数据。定义：
- $U$：与测量无关的基底，通常选取为具有全局正电荷的全填充态；
- $u$：使得重叠集态能量$E_{\rm orbs}\approx u_{\rm orbs}$的基矢，即局域重叠重叠集态基矢；
- $b_q$：基底元素，等于重叠集态的本征函数的重叠指数；
- $B_q$：重叠集态的本征向量。

求解上述优化问题时，有两种方法：第一种方法是直接将$U,u,b,B$固定，并使$E_{\rm orbs}$尽可能接近于$\hat{E}_{\rm min}$，其中$\hat{E}_{\rm min}$是所有非重叠重叠集态能量的最小值；第二种方法是采用Lagrangian极小化法，即先固定其他参数，再最大化重叠集态能量；最后，若还存在非重叠重叠集态的子集态，则继续添加新的约束条件，直至所有测量数据都满足。

# 4.具体代码实例和解释说明
## （1）Hartree-Fock程序实例
考虑前文中的系统，由初始态构型（或者说基态），用积分变分方法计算其哈密顿量，得到HF约化哈密顿量。

对于Hamiltonian的求取，可选择真空狭道模型，并假定轨道为椭圆椭球面。假设将原子个数$n$，晶体的分段数量为$N$，自旋假设为第一简并。即：
$$\left| \psi(x,y,z)\right> = C^{KS}_1(\theta,\varphi)|11\rangle + C^{KS}_2(\theta,\varphi)|21\rangle$$
其中，$C^{KS}$为Kohn-Sham函数，可选择如下形式：
$$C^{KS}_1(\theta,\varphi)=\frac{2}{\pi n^2}\sum_{lm}(a_lm\chi_{l}^{(1)}(x)Y_m(\theta))^*\chi_{m}^{(1)}(x)Y_l(\theta)\\C^{KS}_2(\theta,\varphi)=\frac{2}{\pi n^2}\sum_{ml}(a_ml\chi_{l}^{(2)}(x)Z_m(\theta))^*\chi_{m}^{(2)}(x)Z_l(\theta)$$
其中，$\chi_{l}^{(i)}(x)$为第$i$组轨道上的第$l$个正电子，$Y_l(\theta)$为费米面$l$面的超球面积分。计算完哈密顿量之后，应用一阶积分变分法，即可得到所需的量子态。

此处，假设哈密顿量为：
$$H = -\frac{\hbar^2}{2m}\nabla^2 + V_{ee} + V_{ss} + U_{ijk}N_{ijk}$$
其中，$V_{ee},V_{ss}$是各个电子之间的、和同种原子之间的 Van der Waals 相互作用；$U_{ijk}$为各个原子三阶雅克比张量。而哈密顿量$H$的求取依赖于$V_{ee}$和$V_{ss}$。

## （2）重新缩放程序实例
假设我们已经得到了一系列的测量数据，要用重新缩放方法来消除测量误差。为此，我们首先需要构造关于测量数据的概率分布。假设测量数据服从高斯分布：
$$\beta_{\rm meas}=\frac{1}{\sigma_{\rm meas}}e^{-\frac{(x-X_{\rm meas})^2}{2\sigma_{\rm meas}^2}}, x\in[-\infty,\infty], X_{\rm meas}\sim N(0,1)$$
其中，$\sigma_{\rm meas}>0$为测量数据的标准差。

然后，用重叠集态下相应的密度矩阵和子集态能量分别计算重叠集态密度矩阵和非重叠重叠集态能量。以一种递归的方式完成这一过程。首先，利用重叠集态的密度矩阵求解子集态的能量，这与求解HF的基态相似，只是多了一个约束条件。然后，计算重叠集态的能量，用与非重叠重叠集态能量的平均值的差来近似测量数据的真实值。如果存在重叠集态的非重叠子集态，则对测量数据做一次重新缩放。重复这个过程，直至测量数据收敛或达到最大次数。