
作者：禅与计算机程序设计艺术                    

# 1.简介
  

SAE（安全认证加密）和ECC（椭圆曲线加密）是两种主流的无线通信加密方法，其主要目的是为了保障无线网络通信数据的机密性、完整性和可用性。在本篇文章中，我们将对SAE和ECC两个加密机制进行概述并阐述它们的优缺点，最后通过实验验证SAE和ECC在安全通信方面的应用。
## 1.1 什么是SAE？
SAE（Security Authentication Encryption），中文名为安全认证加密，它是一种开放标准，由国际标准化组织IEEE发布，用于实现基于无线局域网(WLAN)的安全通信。其主要特征有：
- 数据认证: SAE 提供了数据完整性校验的功能，可以验证数据是否发生变化、丢失或被篡改。该功能依赖于公钥密码体制，保证了数据机密性。
- 对称密钥协商: SAE 使用 Diffie-Hellman key exchange (DHKE) 协议建立一个共享密钥，用于加密数据传输过程中的对称密钥。该协议可以确保通信双方都知道同一个密钥，从而使通信安全得以确保。
- 消息认证码: SAE 可以采用消息认证码(MAC)的方式，对传输的数据包进行完整性校验，以防止数据包被篡改或者损坏。MAC 算法需要配合密钥使用，确保数据可靠地传输。
- 加密质量: SAE 的密钥交换协议 DHKE 和 MAC 算法都是公开的，任何第三方都可以检查它们的安全性。另外，SAE 提供了多种加密方案，包括 AES、RSA、ECC 等。用户可以根据自己的需求选择适合的加密算法，保证数据传输的安全。
## 1.2 为什么要用SAE？
SAE 可解决以下六个问题：
- 数据完整性: SAE 支持数据完整性校验，可以验证数据是否发生变化、丢失或被篡改。此外还可以通过密钥或 MAC 进行更高级的数据完整性校验。
- 数据机密性: SAE 通过 DHKE 协议建立一个共享密钥，保证通信双方都知道同一个密钥，从而使通信数据安全得以确保。
- 身份认证: SAE 可以采用不同的方式对通信双方进行身份认证，比如数字证书、临时 ID 或密码。同时还可以利用相互信任的认证中心进行认证。
- 数据可用性: SAE 在数据传输过程中采用 MAC 算法，确保数据可靠地传输。因此，即便在网络传输过程中出现意外情况，也可以保证通信的正常运行。
- 隐私保护: SAE 的消息认证码功能可以有效保护通信双方的隐私信息，因为只有通信双方才能计算得到 MAC 值。另外，用户也可以选择保密性更强的加密算法。
- 抗攻击能力: SAE 的标准协议采用安全的公钥密码体制，并且有众多的审核检测机制可以确保安全性。
## 1.3 SAE 和其他加密技术有何不同？
SAE 是一种新型的加密技术，它与传统的加密技术有着较大的不同。传统的加密技术一般采用非对称密钥加密，如 RSA，但这种加密机制存在暴力破解、中间人攻击等问题。而且，由于密钥生成过程依赖于随机数，导致密钥泄露问题比较突出。另一方面，SAE 采用对称密钥加密，可以保证通信的机密性。另外，SAE 还提供了数据完整性校验和身份认证等功能，这些功能对于数据安全非常重要。
综上所述，SAE 更适合作为无线网络通信的加密技术，并具有很多优越性。
# 2.基本概念术语说明
## 2.1 密码学相关术语
### 2.1.1 分组密码
分组密码是指将明文（或称为 plaintext）划分为大小相同的块（称为 block），然后再将每个块分别加密成密文（或称为 ciphertext）。分组密码的特点是处理单元之间无需同步就能够独立工作，从而使得整个过程加密速度较快。例如 DES、AES、Camellia、SM4、RC5 等都是分组密码。
### 2.1.2 密钥
加密过程的关键就是密钥。任何加密系统都要求一个秘密的“钥匙”，这个钥匙在使用之前必须经过双方协商确立。最常用的密钥类型是对称密钥，也就是两端都知道的密钥，其中一端用作加密，另一端用作解密；还有公钥和私钥，用来实现非对称加密。公钥可以任意向他人公开，但私钥只能由拥有者掌握，不能向他人透露。
### 2.1.3 椭圆曲线加密
椭圆曲线加密（Elliptic Curve Cryptography, ECC）是一种基于离散对数的公钥加密算法，它可以在一定时间内完成加解密运算，且运算速度比其他算法快。目前最常用的椭圆曲线加密算法有 ElGamal、ECDH、EdDSA 等。
### 2.1.4 伪随机数生成器
PRNG（Pseudo Random Number Generator，伪随机数生成器）是一种算法，它产生符合统计规律的伪随机数序列，可用于加密领域的各种密码学应用，例如数据加密、数字签名、安全随机数生成。目前最常用的 PRNG 算法有 SHA-256、SHA-3、Blake2、HMAC_DRBG 等。
## 2.2 SAE 和 ECC 加密机制
### 2.2.1 SAE
SAE（Security Authentication Encryption）是一种开放标准，由 IEEE 标准化组织发布，用于实现基于无线局域网(WLAN)的安全通信。SAE 规范定义了三层架构模型：物理层、数据链路层、网络层。其流程如下图所示：

1. 物理层：物理层负责传输原始数据，不包含任何加密功能。

2. 数据链路层：数据链路层负责将物理层上接收到的原始数据按定长包装成数据帧，然后发送到远端节点。SAE 使用 IEEE 802.11 协议进行数据传输，每一个数据帧都带有 SAE 头部。SAE 头部包含着消息认证码（MAC）值和密钥标识符（Key Identifier，KI），作为对数据帧内容进行认证、鉴别和保护的依据。

3. 网络层：网络层负责将数据帧发送至目标节点，并接收返回的数据。SAE 要求 WLAN 必须支持 DHCP（动态主机配置协议）功能，以便为每个接入点分配唯一的密钥。DHCP 是一种基于 UDP/IP 协议的服务，它的作用是在本地网络自动分配 IP 地址和子网掩码等参数。当接入点接收到数据帧时，会检验 KI 是否匹配，如果匹配则通过 MAC 算法验证数据完整性。如果成功，则接收到的数据帧的内容才会解密并传递给上层应用。
### 2.2.2 ECC
ECC（Elliptic Curve Cryptography）是一种基于椭圆曲线的公钥加密算法。它的基本思想是，把大整数分解成多个小整数之和，这样做的好处是增加了难度，阻止了暴力破解。椭圆曲线加密算法基于离散对数问题，通过椭圆曲线上的一个点乘和倍乘运算，实现加密、解密和签名等操作。
# 3.核心算法原理和具体操作步骤以及数学公式讲解
## 3.1 数据认证
### 3.1.1 HMAC-SHA-256
SAE 使用 HMAC（Hash-based Message Authentication Code，基于哈希的消息认证码）和 SHA-256 摘要算法进行数据认证。HMAC 是利用哈希函数对称加密算法的一种扩展方法，用于提供信息的完整性和真实性认证。HMAC 以密钥和消息为输入，生成固定长度的值作为消息认证码。HMAC 由 RFC 2104、FIPS PUB 198-1、RFC 4231 三个 RFC 文档定义。
### 3.1.2 MAC-SHA-256
SAE 使用 MAC-SHA-256（Message Authentication Code with SHA-256）算法对数据帧进行认证。MAC 算法利用共享密钥对报文进行加密并生成摘要，然后再和报文一起发送。接收方收到报文后可以计算 MAC 值，然后和接收到的报文一起进行比较，如果一致，那么就可以确定数据是完整的。由于 MAC 只能保证报文的完整性，不能确定报文的真实性，因此无法抵御重放攻击。
## 3.2 对称密钥协商
### 3.2.1 Diffie-Hellman Key Exchange Protocol
SAE 使用 Diffie-Hellman key exchange protocol (DHKE)，它是一个密钥交换协议。Diffie-Hellman 加密演算用于建立对称密钥。为了建立共享密钥，参与双方首先要选取素数 p 和一些与 p 互质的整数 a 和 b 。然后，双方各自计算生成一串私钥 x 和 y ，然后用公式 y = g^x mod p 生成共同的公钥 g^y mod p 。最后，双方共享各自的公钥，然后使用公钥进行加密，即可得到各自的共享密钥。
DHKE 协议的实现中，参与方各自生成一个秘密整数 a 并发送给对方，然后双方根据公式计算出一个共享公钥 A=g^a mod p 。双方各自又各自生成一个秘密整数 b 并发送给对方，然后双方根据公式计算出一个共享公钥 B=g^b mod p 。双方同时生成一个共享秘密密钥 K=(B)^a mod p 。因此，可以说，DHKE 是单向协议，它只使用了一对公钥和私钥。
### 3.2.2 Shared Secret Derivation Function (SSDF)
SAE 中采用了 SSDF（Shared Secret Derivation Function），它是一个密钥派生函数。SSDF 利用参与方各自的共享秘密密钥及 DHKE 过程中生成的一串随机数，根据特定协议规则生成最终的共享密钥。SSDF 的过程如下图所示：
SSDF 可以有效避免中间人攻击，因为它不会暴露参与方的共享秘密密钥。另外，SSDF 的计算速度也很快，因此可以在实际环境下进行部署。
## 3.3 消息认证码
### 3.3.1 MAC-SHA-256 Algorithm
SAE 使用 MAC-SHA-256 算法对数据帧进行认证。MAC 算法利用共享密钥对报文进行加密并生成摘要，然后再和报文一起发送。接收方收到报文后可以计算 MAC 值，然后和接收到的报文一起进行比较，如果一致，那么就可以确定数据是完整的。由于 MAC 只能保证报文的完整性，不能确定报文的真实性，因此无法抵御重放攻击。
### 3.3.2 SAE message format
SAE 使用 IEEE 802.11 的 DataFrame 格式封装数据帧，并且在数据帧的头部添加 SAE 头部。SAE 头部包含着消息认证码（MAC）值和密钥标识符（Key Identifier，KI），作为对数据帧内容进行认证、鉴别和保护的依据。SAE 头部结构如下图所示：
## 3.4 ECDSA 签名
### 3.4.1 Digital Signature Standard (DSS)
ECDSA（Elliptic Curve Digital Signature Algorithm）是一种基于椭圆曲线的数字签名算法。它利用椭圆曲线上的一个点乘和倍乘运算，实现签名和验证两个操作。ECDSA 不仅能提供数字签名，还能提供椭圆曲线加密。具体来说，ECDSA 用一个私钥 sk 和椭圆曲线 E(Fp) 上的公钥 Q=(Qx,Qy) 生成签名 signature =(r,s)。私钥 sk 和公钥 Q 可以互换。
### 3.4.2 Signing Procedure
签名过程如下图所示：
1. 首先，客户端（sender）选择一个随机数 k 作为签名密钥，用 kA 拿到椭圆曲线 E(Fp) 上的一个随机点 R，记为 Q=kR 。然后，客户端计算消息 m 的 Hash 值 H(m) 作为待签名数据。
2. 然后，客户端用私钥 sk 计算签名密钥 s=(H(m)+ka*Q)/k，其中 + 表示椭圆曲线点加法，* 表示椭圆曲线点乘。
3. 最后，客户端将公钥 Q 、签名 r、签名 s 以及消息 m 一起发送给服务器。
4. 服务器使用公钥 Q 来验证签名。首先，服务器计算 Hash 值为 H'(m')，其中 m' 为接收到的消息 m，并和发送方发来的签名中的 Hash 值 H(m) 比较。如果两者不一致，则说明签名不正确。否则，服务器计算另一半签名密钥 w=(-H(m)+kb*R)/kb，其中 - 表示椭圆曲线点减法。
5. 如果验证成功，服务器就知道消息是来源于客户端的。