
作者：禅与计算机程序设计艺术                    

# 1.简介
  

在许多关系数据库管理系统(RDBMS)中，事务（transaction）是一个不可分割的工作单位，它包括对数据库所作的更新操作，这些更新操作要么全都执行成功，要么全都执行失败。事务处理的特性决定了其重要性及其应用场景广泛。本文将详细介绍MySQL数据库事务隔离级别及它们的特点、配置方法、以及使用场景。


# 2.基本概念术语说明
## 2.1 概念介绍
事务（Transaction）是指逻辑上的一组操作，组成一个完整的业务处理单元，其执行的结果必须是使得数据从一个一致性状态变到另一个一致性状态。如果组成事务的各个操作全都成功完成，则认为事务成功，否则认为事务失败。事务具有4个属性：原子性（Atomicity）、一致性（Consistency）、隔离性（Isolation）、持久性（Durability）。

- **原子性**
事务是一个不可分割的工作单位，事务中包括的诸操作要么全部被执行，要么全部不执行。事务的原子性确保动作按原子方式执行，不允许分割。在分布式环境下，事务可以在不同的数据库节点上进行，每个节点的数据都是一致的。

- **一致性**
事务必须是使数据库从一个一致性状态变到另一个一致性状态。一致性是指数据库中的数据从一个一致状态转化为另一个一致状态。一致性保证了事务处理结束后，所有数据都保持一致状态。

- **隔离性**
隔离性是指两个或多个并发事务之间相互独立，不会因为交叉执行而导致数据的不一致性。隔离性可防止多个事务并发执行时由于交叉执行而导致数据的不一致性。隔离性通常通过锁和其它机制实现。

- **持久性**
持续性也称永久性（Permanence），指一个事务一旦提交，则其所做的修改就应该永久保存下来。即使系统崩溃， committed 的事务也应该存在，而 uncommitted 的事务也应该回滚。

## 2.2 隔离级别

为了解决脏读、幻读等并发访问带来的问题，数据库系统提供了多种隔离级别，也就是当多个事务并发执行的时候，数据库可以采用不同的隔离策略来避免事务之间的互相干扰。数据库提供的隔离级别如下：

1. Serializable (串行化)

   最高的隔离级别，完全依靠数据库的锁机制，确保同一时间只有一个事务执行，其他事务必须等待当前事务执行完毕，才能继续执行。Oracle、SQL Server等多数支持Serializable隔离级别的数据库系统都以严格的方式来处理并发事务，读写提交等并发控制的方法，保证事务的一致性，但是性能较差。

2. Repeatable Read (可重复读)

   在Repeatable Read隔离级别中，事务开始前会获取快照（Snapshot），基于这个快照再对该事务进行所有读取操作，直到提交事务才释放快照，因此，同一事务的两次读取操作看到的数据可能不同，这是因为在第一次读取数据时，事务并没有获得快照，所以可能读到旧的数据。但在之后提交事务时，才会刷新快照，所以可重复读保证事务读取的一致性。

3. Read Committed (读已提交)

   只要事务的先决条件得到满足就可以执行，无需等待其他事务提交，是最低的隔离级别，隔离性最小，发生脏读、不可重复读、虚读现象的几率最低。

4. Read Uncommitted (读未提交)

   会出现幻读、不可重复读、脏读的问题，其隔离性较低。可能会导致数据丢失或查询出的结果不准确。但是比其他两种隔离级别好一些，适用于OLTP（On-Line Transaction Processing）系统。

5.  Default Isolation Level in MySQL (MySQL默认隔离级别)

    在MySQL中，除非显式指定，否则InnoDB存储引擎将采用REPEATABLE READ隔离级别。这种隔离级别保证同一事物的查询返回同样的记录，除非使用了相关语句（例如SELECT... LOCK IN SHARE MODE 或 SELECT... FOR UPDATE）。

6. 隔离级别的切换

   可以通过SET TRANSACTION命令来设置事务隔离级别。例如，以下语句用来设置事务隔离级别为REPEATABLE READ：
   
      SET SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ;
   
   以前的MyISAM引擎也支持REPEATABLE READ隔离级别，但MyISAM已经不再维护，建议改用InnoDB。
   
## 2.3 InnoDB与TokuDB的区别

InnoDB是MySQL默认的存储引擎，TokuDB是另一种嵌入式键值存储引擎。TokuDB除了支持MySQL协议外，还支持一个额外特性：聚集索引（clustered index）。InnoDB和TokuDB都支持事务处理，但是TokuDB引入了聚集索引，它能够更有效地定位数据并提升插入性能。

TokuDB支持索引数据类型：字符串、整数、浮点数、字节数组、日期时间、布尔型。它的API和语法与MySQL兼容。TokuDB还支持各种优化手段，如：压缩表、缓存预读、异步IO、B+-Tree索引、快速排序索引、内存映射表、零拷贝、事务日志和MVCC。

另外，TokuDB支持对热点数据集的内存缓存，并且也能够平衡主线程和辅助线程之间的负载。另外，TokuDB支持在线迁移，不需要关闭正在使用的服务，即可将部分数据从MySQL移动至TokuDB。