
作者：禅与计算机程序设计艺术                    

# 1.简介
  

MySQL是一个开源关系型数据库管理系统，它支持多种类型的数据存储，包括关系数据表、JSON文档、空间数据（GIS）。在创建表时可以指定表的排序规则，这就决定了数据的存放和查询方式。本文将详细介绍两种常用的MySQL排序规则。
# 2.1 MyISAM默认排序规则
MyISAM是MySQL中的一种存储引擎，它提供轻量级索引功能。默认情况下，当没有显式定义排序规则时，MyISAM会使用内部排序规则。该规则并不复杂，但效果不佳。对于整数类字段，它会按从小到大的顺序进行排序；对于字符串类字段，则会按字典序排序，即按照词典中字符的先后顺序进行排列。如果需要排序字段相同的数据，则无法区分不同的值。如下所示：
```sql
CREATE TABLE t(a INT, b VARCHAR(5));

INSERT INTO t VALUES (1,'abc'), (2,'def');
SELECT * FROM t ORDER BY a; # 结果: (1,'abc') (2,'def')
SELECT * FROM t ORDER BY b; # 结果: (2,'def') (1,'abc')
```
# 2.2 InnoDB默认排序规则
InnoDB是另一个MySQL的存储引擎，它提供外键约束，事务支持，回滚等高级特性。它的内部排序规则则比MyISAM更加复杂。它首先根据主键进行排序，然后再按照普通索引列进行排序。主键列只能有一个，因此对主键排序速度最快。其次，InnoDB根据数据页上的记录指针来确定记录的相对位置。每张InnoDB表都有个聚集索引，它是唯一标识一行的主键值。InnoDB存储引擎将具有相同值的行紧密地存储在一起。如下所示：
```sql
CREATE TABLE t(a INT PRIMARY KEY, b VARCHAR(5), INDEX idx_b (b));

INSERT INTO t VALUES (1,'abc'), (2,'def'), (3,'def'), (4,'ghi');
SELECT * FROM t WHERE b = 'def' ORDER BY a; # 结果: (2,'def') (3,'def')
```
上面的例子中，在建表时指定了主键`a`，因此用主键来排序速度最快；在插入数据时也同时指定了索引`idx_b`，因此用索引来排序第二快。但是，由于索引可能存在覆盖，导致数据存在交叉，因此对数据进行排序时还需考虑另外的因素。举个例子，假设两个索引都是`(a,b)`，其中有`(1,'abc')`和`(2,'def')`这样的数据存在于两个索引节点中，那么应该按照哪个索引来排序呢？按照`a`排序，还是按照`b`排序呢？InnoDB存储引擎根据第一个不是空的索引列来判断优先排序顺序。如果第一个索引列是主键，则按照主键排序；否则按照第一个索引列排序。因此，对于相同的值，InnoDB存储引擎可能会优先选择主键作为第一排序依据。总结来说，InnoDB的排序规则既考虑了主键排序和索引排序，也考虑了相同值情况下的排序。所以，在设计InnoDB表时，要充分利用索引，同时注意避免重复值出现在同一个索引节点中。
# 3.实践总结
一般情况下，应用开发者不需要关心数据库的排序规则，除非遇到一些特定场景，比如数据分析或者与其他数据库做数据同步等。但作为数据库管理员或DBA，有必要了解数据库默认的排序规则，这对提升数据库性能、优化SQL语句执行效率非常重要。所以，理解排序规则至关重要。