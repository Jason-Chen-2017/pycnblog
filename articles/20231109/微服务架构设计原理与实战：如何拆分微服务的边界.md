                 

# 1.背景介绍


## 概述
在微服务架构模式流行之时，很多公司开始探索这种架构模式的应用。然而，如何拆分微服务，如何划分子系统等，仍然是个难题。
通常，拆分微服务的方式有以下三种：
- 按业务领域：将微服务拆分成多个子服务，每个子服务负责特定的业务功能；
- 根据业务架构图进行拆分：根据业务架构图，结合实际情况，识别出微服务之间的关系，然后再按照这些关系拆分微服务；
- 以业务能力拆分：通过定义业务能力，对特定的业务功能进行细化，再将其拆分为一个独立的服务。
以上方式都可以用于拆分微服务，但它们往往存在各自的优缺点。下面，我们就以最常用的方式——按业务领域为例，来介绍一下如何拆分微服务。
## 业务拆分
### 业务范围
假设某公司的业务涉及到订单、商品管理和库存管理三个方面，因此，这些方面需要分别建立相应的子服务。如图所示，子服务之间存在依赖关系和数据交互。
其中，订单服务负责处理订单的相关事务，包括创建订单、支付订单等；商品管理服务负责管理产品的信息，包括添加、修改、下架、上架等；库存管理服务负责记录商品库存信息，并提供库存查询、补货等服务。
### 服务拆分
为了实现业务拆分，我们首先需要对业务边界进行划分。为了便于理解，我们用字母表示子服务，数字表示服务内的实体。如表所示，我们将订单服务拆分为两个子服务：A、B，分别对应订单的创建与支付。同时，商品管理服务、库存管理服务也分别抽象为四个子服务：C、D、E、F。
| 服务名称 | 子服务名称 | 实体编号 |
| :-----: | :------: | ------: |
|   A     |    创建   |     1   |
|   B     |   支付    |     1   |
|   C     |  添加产品  |     1   |
|   D     | 修改产品信息 |     1   |
|   E     | 下架商品 |     1   |
|   F     | 上架商品 |     1   |
|   G     |    查询   |     2   |
|   H     |   补货    |     2   |
从上表可以看出，A、B、C、D、E、F五个子服务共享同一个实体编号1，G、H两子服务共享同一个实体编号2。也就是说，不同子服务之间实体的数据互相隔离，实现了子服务之间的松耦合。此外，由于每个子服务只能通过API接口与其他子服务通信，所以不存在直接访问底层数据库数据的情况。这样做，既提高了子服务的独立性，又能减少整个系统的耦合程度。
另外，我们还应该考虑到服务的容量问题。例如，假设子服务A只负责订单的创建，则订单的支付可能由子服务B负责。另一种解决方案是将订单支付服务拆分到订单管理子服务中，这样的话，订单管理子服务的负担就会比较重。但是，如果支付服务发生故障，可能会导致订单的延迟。因此，综合考虑，选择上面两种拆分方式的折中方案，比如对于订单服务，可以先拆分为两个子服务A、B，A负责订单的创建，B负责订单的支付；而对于商品管理服务、库存管理服务，可以将其中的管理动作放入统一的管理子服务中。