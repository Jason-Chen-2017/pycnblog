
作者：禅与计算机程序设计艺术                    

# 1.背景介绍


随着互联网的迅速发展，越来越多的人已经开始利用互联网进行各种各样的业务活动。越来越多的公司也开始积极拥抱这一新兴领域，在网站、APP、微信小程序等开放平台上提供服务。同时，随之而来的安全问题也越来越突出。如何保障平台用户的数据和应用的安全是一个非常重要的问题。

2017年11月份，国际互联网络安全中心（CISCN）发布了“Web Application Exploits and Defenses”报告，其中提到“越来越多的攻击者正在尝试利用 Web 应用程序漏洞来破坏用户数据和系统”。而针对此类漏洞攻击，有一个著名的防御策略就是“随机化请求参数”。即通过对请求的参数进行随机化，使得恶意攻击者无法预测或猜测到最终的请求结果。但是，由于这种方式依赖于伪随机数生成器的不准确性，使得随机化算法不能完全解决这个问题。另一种方法就是采用“会话管理”，将相同用户的所有请求绑定在一起，并记录下每个请求的信息，这样就可以检测出重复请求。但由于会话管理需要服务器端的支持，成本较高。

基于以上原因，目前来说，最安全有效的方法就是结合两种方法，即“随机化请求参数”和“会话管理”。为了让开发者能够更加方便地实现这两种方法，由 OpenResty 提供的 ngx_lua 插件 ngresty-session 提供了一种简易的方式来管理用户的会话状态。因此，相信随着 OpenResty 在互联网服务中的广泛应用，对安全的防范也会逐渐进步。

在实际应用中，当用户访问一个需要登录权限的页面时，他们首先要输入用户名密码，然后提交。这时候服务器收到的请求信息中就包括了用户名、密码等敏感信息。如果这些信息没有经过特殊处理，恶意攻击者就可以通过获取到这些信息来进行各种各样的攻击，如垃圾邮件发送、钓鱼网站欺骗等。为了防止这种攻击，服务器可以采用“随机化请求参数”的方法，对用户名、密码等参数进行加密，这样攻击者就无法轻易获取到明文信息。另外，还可以通过会话管理机制来记录用户的会话信息，并且可以设置超时时间，防止用户长时间不活跃。这两者结合起来共同构成了一个比较好的安全方案，即“随机化请求参数”+“会话管理”。

但是，有的时候，这种安全策略可能会遇到一些问题。比如，某些情况下，用户可能会打开多个浏览器窗口或者不同的设备来访问平台，这时候就会产生多个会话。对于这种情况，服务器就无法区分哪个请求属于哪个用户，也就无法判断是否可以重用之前的会话，只能重新验证用户。为了解决这个问题，OpenResty 提供了一个叫做 LuaSec 的第三方库，它提供了一种签名和加密算法，用来帮助开发者对请求进行签名和加密，从而保证请求的安全传输。另外，也可以通过其他手段来降低被爬虫、黑客等攻击的风险，如验证码、防火墙等。

总体而言，Web 平台安全的主要问题还是需要开发者对其架构和运维做深入的了解，才能更好地规避和防范攻击。而结合“随机化请求参数”和“会话管理”两个技术，OpenResty 和 ngx_lua 将会成为构建更安全的 Web 平台的利器。