
作者：禅与计算机程序设计艺术                    

# 1.简介
  

Microsoft Azure Active Directory(Azure AD)是一个基于云的多租户目录和身份管理服务，它可以帮助用户在一个中心位置进行协调管理，其提供的安全和授权工具可以帮助企业组织保护应用程序、数据、人员和设备。Microsoft Azure AD支持用户使用自己的用户名密码或联合身份（例如，通过联合单点登录）登录到公司网络内的所有应用和资源上。此外，Microsoft Azure AD还支持使用联合标识和本地账户对外部用户提供统一身份验证，即使这些外部用户没有自己的 Azure AD 帐户。但是，如果希望使用自己的域名而不是 Microsoft 提供的预定义域名，那么就需要将该域名加入 Azure AD 的自定义域名列表中，这样才能实现用户从自己的域或子域通过 SSO 登录到 Azure AD 中的应用程序和资源。本文将详细介绍Microsoft Azure Active Directory的自定义域加入及验证功能，并着重阐述如何有效防止钓鱼攻击。
# 2.自定义域相关概念术语
## 2.1 什么是域？
域（Domain）是由互相认识的计算机系统组成的集合，它们共享相同的网络地址空间，可以用来识别系统。每个域都有一个域名，用来区分不同的计算机系统，如“example.com”。通常情况下，计算机会被分配一个IP地址，但在域中不同计算机之间只能通过域名来通信。
## 2.2 为什么要使用域？
域的出现主要是为了解决以下两个主要问题：
1. 分散化问题 - 域提供了一种管理复杂环境的有效方法，将业务按业务单元划分为独立的域，然后再将域链接起来，实现互相通信。
2. 访问控制 - 域可以细化各个系统的权限管理，为每个系统赋予不同的职责，增强了安全性。
## 2.3 用户主体名称与UPN
用户主体名称（User Principal Name，UPN）是Windows系统中的一个术语，用于表示用户登录到计算机时的凭据。UPN一般由用户名、域名组成，格式为username@domainname。例如，John Smith的UPN可能是jsmith@example.com。
## 2.4 什么是Federated Identity（联合标识）？
联合身份（Federated Identity）是指托管在本地服务器上的资源或应用与联合身份提供者建立的连接，联合身份提供者可以提供单点登录（SSO），这样就可以在多个应用和服务之间无缝地对用户进行身份验证和授权。联合身份提供者可以使用各种协议如SAML和OpenID Connect，使得用户可以在不同应用和服务之间自由切换，而不需要重复输入密码。联合身份的优点是可以让用户在不记住任何密码的情况下登录到所有受信任的应用和服务中，同时也保证了数据的安全性和隐私性。
# 3.Microsoft Azure Active Directory的自定义域加入与验证
Microsoft Azure AD支持用户使用自己的用户名密码或联合身份（例如，通过联合单点登录）登录到公司网络内的所有应用和资源上。为了能够使用自己的域名或子域名对资源进行访问，Azure AD提供了一个自定义域名的加入选项。自定义域加入后，用户即可在自己的域或子域下注册新账号或登录到已有账号，无需输入密码即可访问这些资源。其中，加入Azure AD的自定义域的过程称作自定义域加入，添加域名的过程称作自定义域验证。
## 3.1 自定义域加入
如果想要将自己的域名加入Azure AD的自定义域列表中，需要按照如下步骤进行操作：

1. 在Azure门户中，选择“Active Directory” > “自定义域名”，然后点击“+ 添加自定义域”。
2. 在“添加自定义域”窗口中，输入所需的域名，然后点击“添加”。
3. 在“example.com”页面，输入域名管理员的信息，然后点击“保存并验证”。
4. Azure AD会向指定的域名发送一封电子邮件，要求用户验证其所有权。用户需要打开电子邮件中提供的链接，完成域名验证。
5. 当域名成功验证后，就可以使用Azure AD登录到自己的域下的资源上了。

## 3.2 自定义域验证
Azure AD支持两种类型的域名验证：
- TXT记录验证：TXT记录是在DNS记录中存储域名解析的过程，用于验证域名所有权，或者证明某个站点拥有相应的网址。Azure AD使用DNS TXT记录来验证自定义域的所有权。
- DNS文件上传验证：通过DNS文件上传的方法来验证域名的所有权。Azure AD将生成一个包含DNS记录的文件，然后要求客户将该文件传给域名持有方，并在该域名管理平台上添加DNS记录。

## 3.3 自定义域加入注意事项
Azure AD的自定义域加入功能包括以下几个方面：

1. 使用自己的域或子域时，无需输入密码即可登录到资源。
2. 可以限制只有特定人员才能在Azure AD中创建新的用户。
3. 可将同一域的用户和组加入资源，从而实现共用访问和集中管理。
4. 无法修改或删除已加入域的用户或组，因此可确保数据安全。
5. 如果用户不想使用自己的域或子域的身份进行身份验证，仍然可以使用联合单点登录（SSO）。