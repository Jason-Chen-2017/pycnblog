
作者：禅与计算机程序设计艺术                    

# 1.简介
  

深度学习的经典网络之一——VGG、GoogLeNet、ResNet等都是基于特征金字塔(FPN)结构进行高效特征提取的，比如VGG16、GoogLeNet在分类任务中都采用了多尺度特征图(即不同尺度的卷积输出)，这种结构也被称为“全卷积网络”(FCN)。如此之好，为何没有人用这种结构做检测或者分割呢？直到2017年，Facebook AI Research提出了一个叫作Feature Pyramid Networks(FPN)的模型，其提出的模型构建方式使得检测和分割等相关任务可以借助深层次特征实现更加精准的分割和定位。本文主要对FPN进行详细的阐述及应用场景的介绍。

FPN的关键点在于对特征金字塔(backbone feature pyramid)的建立，首先它将多个不同感受野的特征图按照不同尺度划分成不同的金字塔层，然后通过不同尺度的金字塔层和上一级的金字塔层，得到不同尺度的特征图，最终再将不同尺度的特征图融合起来进行预测。FPN模型的优点是能够有效解决不同感受野大小的问题，且不论输入图片大小如何，都可以进行高效的特征提取。因此，在许多应用场景下，可以用FPN替代各种深度学习模型的早期阶段的特征提取模块。
# 2.基本概念术语
## 2.1 图像金字塔（Image Pyramids）
图像金字塔是指一种特征提取技术，由不同尺寸的图像组成一个金字塔形状，从最底层开始逐步向上抽象，最后得到同样大小的图像作为结果。如下图所示，一张原始图像会生成一系列不同尺寸的图像，并按大小顺序排列。原始图像作为金字塔的底层，逐层上升，得到不同尺度的图像；这些图像逐级上采样，其中的信息融合起来形成新的图像，并作为下一级的特征图。最终，上采样完毕后，整个图像就可以作为整体的特征图进行分析或处理。

## 2.2 深度金字塔（Depth Pyramids）
深度金字塔与图像金字塔非常类似，但它的顶部不是直接对应于原始图像，而是对应于深度估计网络的输出。不同的是，深度金字塔由高精度深度估计网络(high accuracy depth estimation network)产生，并且可以是多种网络结构，例如CNNs，Unet，或Residual networks。深度金字塔的作用就是将不同大小的深度估计网络输出按照同样的尺度进行统一。比如，用预训练好的Resnet-18网络得到6种不同大小的深度估计，就可以生成一个大小为6的深度金字塔。在每一层上，深度金字塔就像图像金字塔一样，按层级分层，并逐层上采样。每一层都会产生相应的深度信息，并逐层融合起来，形成一个大的深度图。如下图所示，深度金字塔由不同大小的深度信息组成，在不同层级之间进行上下游信息的交互，最终生成一个更加全面的深度信息。


## 2.3 多尺度特征金字塔（Multi-Scale Feature Pyramid）
多尺度特征金字塔是由不同层次的特征图组成的一个金字塔形状，该金字塔的不同层次对应于不同尺度的图像，且层次之间相互独立。在FPN模型中，不同层次的特征图按不同尺度划分成金字塔层，并对不同层次之间的特征进行融合，这样就生成了具有不同尺度特征的多尺度特征金字塔。如下图所示，多尺度特征金字塔由不同尺度的特征图组成，每一层又由不同尺度的特征组成，层内的特征间通过不同尺度的卷积进行融合，产生具有更广泛语义的特征图。