
作者：禅与计算机程序设计艺术                    

# 1.背景介绍


在现代Web前端应用中，组件化设计模式越来越流行，作为前端技术的基石之一，React成为目前最热门的框架。对于React来说，组件是一个独立且可复用的UI构件，它可以方便地被其他组件组合、嵌套并管理数据。虽然React提供了许多便利的功能，但也存在一些缺点，比如组件间通信复杂，导致性能问题等。为了解决这些问题，React将事件处理分成了三个阶段——捕获、目标、冒泡阶段。本文主要探讨React事件处理机制。
# 2.核心概念与联系
## 2.1.事件类型及其分类
React中存在两种事件类型：SyntheticEvent和合成事件。SyntheticEvent是浏览器原生事件的一个包装器对象，它的属性及方法几乎完全和浏览器自带的事件保持一致，但是有以下两方面的不同：

1. 支持跨浏览器。SyntheticEvent实现了一个跨浏览器的层，它会把不同浏览器之间的差异隐藏起来，让开发者只需要关注于事件的行为。

2. 提供了合成事件接口。React中有很多内置的合成事件处理函数，它们会处理浏览器的兼容性问题，开发者无需关心底层实现逻辑。

SyntheticEvent有以下几种分类：
- 按键事件：KeyboardEvent；
- 滚动事件：WheelEvent；
- 鼠标事件：MouseEvent（包括三种类型：click、mouseover、mouseout）；
- 表单事件：FocusEvent、ChangeEvent、InputEvent、SubmitEvent、KeyboardEvent；
- 触摸事件：TouchEvent；
- 拖放事件：DragEvent；
- 浏览器事件：SyntheticEvent；
- 自定义事件：CustomEvent。

## 2.2.事件处理顺序
React的事件处理顺序可以总结如下：

1. 当某个元素接收到一个事件时，首先查找是否有该事件注册的回调函数，如果有则执行相应回调函数；
2. 如果没有对应的回调函数，则遍历该元素的所有父节点，从第一个父节点开始逐个往上进行查找，直到找到注册了该事件的回调函数为止，如果有的话就执行这个回调函数。
3. 如果还没找到匹配的回调函数，则继续往上寻找，直到文档根节点，仍然找不到注册的回调函数，则忽略此次事件。

React实现的事件处理流程图如下：

## 2.3.捕获阶段与冒泡阶段
React将事件处理分成了捕获阶段和冒泡阶段。

捕获阶段是指从window节点向下传播，也就是先从document.body节点开始向下传递，遇到注册的事件监听器就截住并执行，然后再继续向下传播，如此循环，直到事件源节点。注意这里描述的是事件的捕获过程，因此事件处理函数执行顺序为先进后出。

冒泡阶段则是相反的过程，事件开始从事件源节点开始向上传递，遇到注册的事件监听器就截住并执行，然后再继续向上传递，直到window节点。注意这里描述的是事件的冒泡过程，因此事件处理函数执行顺序为先进先出。

## 2.4.事件池与事件对象共享
React采用事件池技术，即将所有创建过的事件保存在一个事件池中，当需要触发一个事件时，就从事件池中获取事件对象，而不是每次都创建一个新的事件对象。这样做可以提高性能，因为每一次触发事件时都会创建一对新的事件池和事件对象，而实际上大部分时间都是重复使用的。但是，这也造成了一定的问题，就是React不能轻易地获取某一个特定的事件对象，只能通过DOM API来获取。所以，这就需要我们在代码编写中注意区别获取事件的方式。

另外，React提供的SyntheticEvent只是一种对浏览器原生事件对象的包装，并不是真正意义上的事件对象，所以也无法访问任何和事件相关的方法或属性。所以，我们可以通过addEventListener()方法添加一个事件监听器来获取真正的事件对象。当然，也可以自己封装自己的事件对象，这样就可以直接调用事件对象的任意属性和方法。