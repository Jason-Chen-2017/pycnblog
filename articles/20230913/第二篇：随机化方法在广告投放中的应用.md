
作者：禅与计算机程序设计艺术                    

# 1.简介
  

随着互联网、移动互联网、物联网等新型的互联网技术的不断进步，以及广告、营销等领域的飞速发展，有效投放广告变得越来越难。传统的展示方式已经无法满足广告主对成本、效益及效果的要求，为此，广告主们倾向于寻找新的方式来提高广告效果。其中一种方式就是基于群体信息进行细分、分层、定性、定量分析并实施精准的个性化定制化广告投放。群体信息的获取、处理、分析、利用以及推送，已成为广告技术领域的一项重要研究方向。群体信息的收集、存储和处理在线广告（OLAD）中占据了极其重要的作用。如今，基于群体信息的群访营销技术也在蓬勃发展，比如微信朋友圈的“拜年”营销活动、抖音的舆情分享、头条、知乎、百度贴吧等平台的行为数据驱动的内容创作，通过群体的共同参与及观看，提升用户参与感、转化率、留存率，实现广告价值的最大化。广告投放过程中的随机化在群体化广告投放中起到至关重要的作用。一般而言，广告中的随机化主要包括以下几种方法：

1．分层定向：通过将目标群体划分为不同的层次或分组，分别给予不同的广告投放方式；
2．等概率分派：将每个人都有相同的机会被展示广告；
3．以人为本：通过算法或者模型预测用户的购买决策，以提升广告投放的精准性和效果；
4．连续曝光：通过在系统设定的时间段内，按照固定的频率或速度播放广告，实现广告的持续激励；
5．时间窗定向：设置时间限制，只有在规定的时间段内才能播放广告；
6．强烈偏好定向：根据用户所具备的某些特质偏好进行定向投放，如年龄、性别、兴趣爱好等；
7．统计调查模型：对广告效果进行建模、评估，结合市场数据及用户反馈，调整投放策略和效果参数。
这些方法虽然在不同场景下都有所用武之地，但都不能完全解决广告主对群体信息进行精准定向的问题。如何充分利用群体信息，提升广告投放效果？这一问题值得探讨。
# 2.基础概念及术语
## 2.1 群体信息及其运用
群体信息指的是来自群体特征、行为习惯和消费能力等多方面的信息，它与单个人的信息不同。通过对群体信息的分析和整合，可以有效揭示群体的总体特征、个体差异，从而更好地满足广告需求。群体信息的获取、存储、处理、分析、挖掘和应用属于广告数据分析的重要组成部分。
### 2.1.1 群体信息分类
根据信息的真实、可靠、完整程度、相关性及时效性，群体信息可以分为三类：
1. 个人信息：主要由个体提供的信息，如姓名、年龄、性别、联系方式、居住地址等；
2. 社会信息：主要由群体成员共享的信息，如职业、所在行业、家庭背景、语言习惯等；
3. 群体行为信息：主要由群体成员在群体中的表现及互动产生的信息，如社交网络、观影记录、阅读轨迹、游戏数据等。
### 2.1.2 群体信息获取
群体信息的获取可以从如下途径获得：
1. 直接观察：通过面对面接触、聊天、讨论等方式，了解群体的基本情况、活动情况、消费习惯、生活习惯等；
2. 通过记录：通过群体成员私密交流、日记、日志等方式，采集群体的心里话、感受、经验、行为习惯等信息；
3. 实时监控：通过手机摄像头、微波炉、手环等设备采集群体的人脸识别数据、行为数据、消费习惯等信息；
4. 数据采集：通过大数据计算、机器学习、深度学习等技术，对海量用户数据进行挖掘、分析和处理，提取有效的群体信息。
### 2.1.3 群体信息存储与处理
群体信息一般需要长期存储、处理才能形成可用于分析的结构化数据。一般情况下，群体信息存储分为三个阶段：
1. 原始数据采集：由原始数据采集阶段，即从各个渠道获取到的个人信息、社会信息及群体行为信息。对于个人信息来说，通常会通过手动填写、收集、登记的方式获取，而对于群体行为信息来说，则可以通过反复监视、跟踪、记录的方式获取；
2. 结构化存储：结构化存储阶段，即将原始数据转换为结构化的数据，方便后续的分析处理。通常采用关系型数据库或NoSQL数据库存储；
3. 分析处理：分析处理阶段，即基于群体信息进行统计、分析、挖掘、推荐等工作。这通常包括数据清洗、数据合并、数据归纳、数据分析等。
### 2.1.4 群体信息分析与挖掘
群体信息的分析与挖掘一般分为如下几个阶段：
1. 主题发现：基于群体的各个维度信息，能够自动发现、提取出重要的主题和主题之间的关系；
2. 潜在因子挖掘：潜在因子是在行为习惯、品味偏好、消费习惯等信息影响消费者决策的背景变量。通过挖掘潜在因子，可以帮助广告主更好的把握消费者群体特点，提升广告效果；
3. 群体因子挖掘：群体因子是在各种实际场景下的群体特征、行为习惯等信息影响消费者决策的主导变量。通过挖掘群体因子，可以帮助广告主更好的为群体提供符合群体特征的个性化广告，提升广告效果；
4. 个性化推荐：通过优化广告投放效果，将广告内容、媒体投放等细节与用户群体的各项特征、喜好相匹配，形成个性化的推荐结果，提升广告效果。
## 2.2 随机化方法
随机化是广告主为了更好地控制广告投放效果和满足客户群体偏好而使用的一种技术。简单来说，随机化就是通过对不同人群的定向投放，使其收到的广告具有一定的随机性，达到平衡性、差异性和多样性的目的。与以往的筛选性营销不同，随机化是一种更加务实有效的方法。由于随机化的设计具有高度的不确定性，因此能够快速、精确地达到很好的广告效果。随机化方法广泛应用于广告市场，如广告主选择不同人的性别、年龄、兴趣、消费能力、地域等作为目标群体，再根据个人不同属性的不同，制定相应的广告投放策略，为最终的广告效果提供有效支撑。
## 2.3 随机化方法在群体广告投放中的应用
### 2.3.1 分层定向
分层定向，是通过对目标群体进行不同层级的分割，给予不同的广告投放方式，以实现群体化广告投放。一般而言，分层定向的有效性主要来源于以下两个方面：
- 市场细分：不同层级的群体之间存在着较大的差异性，不同层级的广告对该群体更有利；
- 广告价值传递：不同层级的群体之间的广告价值存在着不同，对不同层级的群体的广告投放具有重要意义。
除以上两种考虑外，分层定向还可以进一步考虑到其他因素，如用户生命周期、广告位置、阅读方向等。例如，针对青少年用户的广告投放，可以提供更多的兴趣刺激、课外学习资源、阅读材料等，从而提高青少年受众的消费能力。针对老年人群的广告投放，则可以考虑到健康、亲情等生活因素，为老年人群提供健康养生的服务。对于女性用户群的广告投放，则可以考虑到她们对自己的身体、择偶、育儿等需求，为她们提供优质的服务。
### 2.3.2 等概率分派
等概率分派，顾名思义，就是所有人等可能地被分配到广告投放的各个环节中。这种方式简单粗暴、容易操作，但往往效果不佳。举例来说，如果所有人都被随机分到每一次广告投放的不同位置上，那其实没有任何区别，所有的人都会看到同样的广告。因此，在广告投放中，尽量不要出现严重的偏向性，避免让极小部分的用户被广告误导。另外，在这部分广告上应该注明“为各位**免费**试用”，并配上欧盟认证标识。
### 2.3.3 以人为本
以人为本，是指通过数字分析算法或者模型，预测用户的购买决策、定价策略等，为广告主提供更加精准的定向广告投放。基于群体信息的广告投放，可以为广告主提供更好的管理、优化、效果分析等支持。以人为本的算法可以将广告投放的历史记录、搜索行为、购买决策等数据输入模型中，预测用户是否会购买该商品、是否要购买的价格以及购买的时机。以人为本的模型能够更准确、更直观地洞察到群体的偏好、行为习惯、消费能力等，从而为广告主提供更加合适、精准的广告投放。
### 2.3.4 连续曝光
连续曝光，是通过系统设置的时间段内，按照固定的频率或速度播放广告，来增加广告的持续激励。适用的场景包括电视节目、视频、电影等，能有效增加用户的满意度和互动度。另外，通过设置转盘抽奖功能，还能促进用户的互动、参与感，提升广告转化率。
### 2.3.5 时间窗定向
时间窗定向，即设置一定时间范围内，只对特定人群投放广告，实现定向留存。这是广告策略的一种常用手段，是以群体为单位的一种保护策略。在APP、游戏、网页端，当用户登录、浏览等触发条件被满足时，系统会根据设置的时间段，进行临时或永久性的广告屏蔽或弹窗投放。例如，仅对9月1日至9月30日期间的返校高峰期开放广告，才能保证用户在返校后的正常流畅访问及留存率。
### 2.3.6 强烈偏好定向
强烈偏好定向，即根据用户的某些特质偏好进行定向投放，如年龄、性别、兴趣爱好等。这是随机化的一个重要扩展，因为群体中普遍存在着某些共性特征，如同性恋、外向、孤独等，这些特征也是广告主希望关注的群体特征。强烈偏好定向能够更好地满足客户群体的个性化需求，增强广告的吸引力和效果。另外，强烈偏好定向的另一个优点在于能够捕获人群的个人身份和气质，更加贴近群体的文化特点，提高广告投放效果。
### 2.3.7 统计调查模型
统计调查模型，是通过对广告效果进行建模、评估，结合市场数据及用户反馈，调整投放策略和效果参数，提升广告效果的一种随机化方法。与以往的实验设计方法不同，统计调查模型是一种更科学、更有效的方法，能够更好地理解用户群体的真正需求、反映用户的真实收益，提供更科学的个性化方案。统计调查模型可以更好地解读群体特征、用户群的消费行为习惯、购买意愿等，通过动态调整广告投放方式，提升广告效果。
## 2.4 示例：微信群助手——拜年祝福自动回复
微信群助手是一个微信公众号，帮助群管理员及群成员管理微信群。群成员每到12月31日，都可以发送“拜年祝福”关键词，群助手会自动回复“新年快乐！”、“加油！”等诸多祝福语。但是，群助手还有一些局限性，比如不能自定义祝福语；群管理员每到12月31日只能发送一条消息；群内人数太多，无法回复每个人的祝福语。这时，我们可以使用随机化技术来解决这个问题。
### 2.4.1 方法
为了解决微信群助手每天12月31日只能发送一条祝福消息的问题，我们可以设置多个祝福文本，然后随机选取一个给每个群成员回复。
### 2.4.2 工程实现
我们可以将这个功能实现为一个定时任务脚本，定时执行，每天零点检测一下当前的日期是否为12月31日，如果是的话，就从库中随机选取一个祝福文本，发给对应群的所有成员。
#### 2.4.2.1 安装依赖包
首先，安装依赖包：
```python
pip install pymongo random_word
```
#### 2.4.2.2 配置文件
配置文件可以根据实际情况修改。

config.py:

```python
import os
from dotenv import load_dotenv

load_dotenv()


class Config(object):
    DEBUG = False

    MONGODB_URL = os.getenv('MONGODB_URL','mongodb://localhost/wechat')


class DevelopmentConfig(Config):
    DEVELOPMENT = True
    DEBUG = True


class TestingConfig(Config):
    TESTING = True


class ProductionConfig(Config):
    pass
```


.env 文件可以保存一些敏感信息，如数据库连接字符串等。

#### 2.4.2.3 模块编写
main.py:

```python
from apscheduler.schedulers.blocking import BlockingScheduler
from apscheduler.triggers.cron import CronTrigger
from bson.objectid import ObjectId
import config
from datetime import date
import logging
import random_word as rw

logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(name)s - %(levelname)s - %(message)s')

logger = logging.getLogger(__name__)

def send_greetings():
    logger.info("Start sending greetings")

    client = config.get_db()
    collection = client['wechat']['groups']
    
    today = str(date.today())
    groups = list(collection.find({'greeting': {'$exists': True}, 
                                   'last_sent': {'$ne': today}}))
    if not groups:
        return

    for group in groups:
        try:
            text = rw.RandomWords().get_random_words(count=1)[0]
            message = {
                "type": "text",
                "content": f"【拜年祝福】\n{text}"
            }

            token = config.WECHAT_TOKEN
            chat_id = group['_id'].binary[:16].hex()
            url = f"http://api.telegram.org/bot{token}/sendMessage?chat_id={chat_id}&parse_mode=Markdown&text={text}&disable_web_page_preview=true"
            
            requests.post(url)

            collection.update_one({'_id': ObjectId(group['_id'])},
                                  {"$set": {'last_sent': today}})
        except Exception as e:
            logger.error(f"Failed to send greeting to {group['_id']}: {e}")
            
    logger.info("End sending greetings")


if __name__ == '__main__':
    scheduler = BlockingScheduler()
    trigger = CronTrigger(hour='0', minute='0', second='0')
    scheduler.add_job(send_greetings, trigger)
    scheduler.start()
```

#### 2.4.2.4 测试
最后，我们可以测试一下这个功能。运行 main.py 脚本，定时任务脚本就会启动，每天零点，脚本就会检查数据库中是否有过去12月31日还没有发送拜年祝福的群组，如果有，就随机选取一句祝福文本，发送给每个群的所有成员。
