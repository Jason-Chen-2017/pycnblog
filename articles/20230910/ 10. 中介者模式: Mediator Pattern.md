
作者：禅与计算机程序设计艺术                    

# 1.简介
  

在面向对象编程（Object-Oriented Programming）中，中介者模式（Mediator pattern）是用来降低多个类或对象之间的通信复杂性，一个中介对象（Mediator object）通常知道各个参与对象（Colleague objects），并通过它来进行消息交流，所以各个参与对象只需要关注自己的行为即可，不需要依赖其他的参与对象，从而使系统更加松耦合。这种模式有以下优点：

1. 模型简单化：中介者模式将多对多关系转变成一对多关系，减少了类与类之间紧密耦合的程度，使得模型的复杂度降低；
2. 系统扩展性强：在系统扩展时，只需增加新的中介者类即可；
3. 简化对象间的通信：由于各个参与对象的行为不再相互依赖，因此对象之间的通信也变得更加容易；
4. 屏蔽细节变化：由于中介者统一处理所有信息的交流，因此对于细节的改变不会影响到其他的类。

中介者模式用于帮助对象之间的通信，主要用于以下场景：

1. 对象之间存在复杂的引用关系，产生高度耦合，系统难以维护；
2. 想要一个集中的调度者来控制不同对象之间的交互；
3. 想要简化对象之间的通信结构。

# 2.背景介绍
## 2.1 应用背景
中介者模式（Mediator pattern）被用在许多设计模式中，如MVC、MVP、Observer等。举例来说，我们可以把微信的即时通讯软件中的好友列表当做例子。点击好友列表中的某个联系人时，微信客户端会打开聊天窗口，并且在内部创建一个ChatMediator来负责双方对话的协调。这个中介者对象可以订阅多个联系人的状态更新通知，比如某个联系人上线、发送消息等。这样一来，无论聊天页面的用户点击的是哪个联系人，都可以通过ChatMediator订阅通知，得到该联系人的实时状态，来展示最新的消息。

在实际的业务开发中，中介者模式可用于如下场景：

1. 用户登录/退出、购物车、支付等系统功能模块之间的通信；
2. 订单系统、库存系统、售后系统、物流系统等业务流程之间的通信；
3. 同事间的工作分配、团队管理等任务分发机制；
4. 订餐系统、租车系统、咨询系统、评论系统等信息沟通协作平台；
5. 游戏中的游戏服务器、聊天室、战斗系统、地图等组件之间的通信；
6. 在线视频网站中的评论、点赞、弹幕、聊天室、计费等功能模块之间的通信；
7. 以太坊钱包、交易所、节点网络、P2P网络等系统的通信；
8. ……

## 2.2 中介者模式特点
### （1）中介者模式类图

- `Mediator`抽象中介者类，定义了所有同事对象（ConcreteColleague）之间的接口方法。
- `ConcreteMediator`具体中介者类，实现抽象中介者类的接口方法，从不同同事对象接收消息、转发消息，并按照一定策略执行消息传递。
- `Colleague` 抽象同事类，声明自身行为的相关方法。
- `ConcreteColleague` 具体同事类，实现抽象同事类的相关方法，同时维持和其他同事的引用关系，并接收由中介者对象转发过来的消息，并进行相应的处理。

### （2）中介者模式角色分析
- **中介者（Mediator）**：也叫调停者或者协调者，他负责了解并实现所有同事的对象之间的交互行为。根据要求，中介者可以做出适当的动作，将某些消息转发给其他同事，或者在必要的时候请求其他同事协助。
- **同事（Colleague）**：也叫参与者，是中介者与其它对象之间的中间层，具有自己的逻辑和职责范围。中介者之外的其他对象都可以视为同事。同事对象必须知道自己与中介者对象之间的联系，但是他们并不知道其他的同事对象的存在。

### （3）中介者模式适应场景
- 当对象之间存在复杂的引用关系，产生高度耦合，系统难以维护时。可以使用中介者模式来弱化那些依赖于同事对象直接通信的紧耦合关系。通过引入中介者对象来封装系统的交互行为，使得同事对象之间的交互关系变得松散，从而实现系统的可维护性和扩展性。
- 如果想有一个集中的调度者来控制不同对象之间的交互，可以使用中介者模式来实现。中介者对象可以在系统的不同部分之间协调工作，管理子系统之间的通信，简化系统的复杂性。
- 如果想要简化对象之间的通信结构，则可以使用中介者模式。通过引入中介者对象，能够把复杂的通信关系封装起来，简化各个同事对象的通信，同时降低它们之间的耦合度。