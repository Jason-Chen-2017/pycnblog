
作者：禅与计算机程序设计艺术                    

# 1.简介
  

在MySQL数据库中，慢查询（Slow Query）指的是响应时间超过预设阈值的SQL语句或查询请求。对于运行缓慢或者耗时较长的SQL语句，可以通过修改MySQL的配置文件my.cnf中的两个参数来设置慢查询的阈值，即long_query_time和long_query_rows。

## 1.1 配置文件 my.cnf 的位置
MySQL的配置文件一般存储在/etc/my.cnf目录下，也可以根据安装时的配置信息查看。另外，还有一个配置文件mysqld.cnf，它也存储在/etc/mysql目录下。但是，建议只修改mysqld.cnf文件，而不修改my.cnf文件。

## 1.2 修改参数的语法
MySQL的慢查询相关的参数都可以在配置文件中设置，按照如下语法进行修改：
```
[section]
variable = value
```
其中，section表示配置文件中的某个区块（如[mysqld]、[client]），variable表示参数名，value表示参数的值。下面是一个例子：
```
[mysqld]
long_query_time = 3 # 表示设置慢查询阈值为3秒
long_query_rows = 100000 # 表示设置每页的最大返回结果集条目数为100000条
```

## 1.3 参数含义
- long_query_time：指定慢查询的阈值，单位为秒。如果一个SQL语句的执行时间超过了这个阈值，则会被记录到慢查询日志中。默认情况下，该值为10秒。
- long_query_log：启用慢查询日志功能。值为ON表示开启慢查询日志，值为OFF表示关闭慢查询日志。默认为关闭状态。
- slow_query_log_file：指定慢查询日志文件的路径及名称。如果没有指定文件名，则按日期生成一个新的日志文件，并覆盖掉旧的日志文件。日志文件默认保存在data目录下。
- log-queries-not-using-indexes：当设置为ON时，仅记录查询语句中涉及不适用索引的情况。
- performance_schema：当设置为ON时，启用performance_schema，用于监视性能数据。
- thread_stack：指定每个线程栈大小。
- thread_cache_size：指定连接缓存的大小。默认情况下，该值为50个连接，最小值是4。

## 1.4 慎重设置参数值
调整参数值需要小心谨慎，因为设置过大的阈值可能会造成大量的资源消耗，甚至导致数据库宕机。因此，在调整参数前，最好先对系统进行测试，找出合适的阈值。一般推荐将long_query_time的阈值设置成1秒左右，将long_query_rows的阈值设置成1万以下。此外，可以使用mysqladmin命令或者phpMyAdmin工具修改参数值。

## 1.5 注意事项
- 在测试环境上，不要设置太小的阈值，以免影响正常业务；
- 在生产环境上，应适当调高慢查询的阈值，以便发现并处理运行缓慢的查询；
- 通过设置慢日志记录，可以方便地收集、分析和优化数据库性能瓶颈，提升系统的整体效率；
- 如果发现慢查询的问题难以解决，则应考虑采用分布式数据库或分库分表的方式，提高查询的并行度；
- 使用其他的数据库管理工具，比如Navicat等，可以设置相应的慢查询阈值，并获取相应的慢查询日志信息。