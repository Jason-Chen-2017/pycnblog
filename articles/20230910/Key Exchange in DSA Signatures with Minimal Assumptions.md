
作者：禅与计算机程序设计艺术                    

# 1.简介
  

Digital Signature Algorithm (DSA) 是一种数字签名算法，用于建立公钥加密系统中的签名机制。DSA 的安全性依赖于数学上的难题——离散对数的困难程度。在 DSA 中，两个参与方共享一个大的质数 $p$ 和一个不重复的基数 $q$ ，并选择一组生成元 $\{g_i\}_{i=1}^{\lfloor \frac{p-1}{q} \rfloor}$ 。其中 $p$ 是公开的，$q$ 是私密的，而 $\{g_i\}_{i=1}^{\lfloor \frac{p-1}{q} \rfloor}$ 不仅是公开的，而且对于大型的 $p$，可能需要 $10^7$ 级别的计算。为了防止攻击者通过枚举 $p$ 来猜测私钥，DSA 使用了一系列参数选择策略来保证 $q$ 和 $\{g_i\}_{i=1}^{\lfloor \frac{p-1}{q} \rfloor}$ 足够难以预测。因此，为了能够保护系统安全，研究人员和工程师们正在探索更加可靠、更加有效的 DSA 参数选择方法。本文将着重分析三种基于最小化假设（minimal assumptions）的 DSA 参数选择策略。
# 2.基本概念和术语
## 2.1 RSA 公钥密码体制
RSA 是一个公钥密码体制，它的关键特性是它在信息交换过程中采用了分治的处理方法。首先，由两个随机选取的质数 $p$ 和 $q$ 生成两个大素数 $n=pq$ 和 $\varphi(n)=pq-p-q+1$ 。然后，选择一个整数 $e$ 满足条件 $1< e < \varphi(n)$ ，且 $\gcd(e,\varphi(n)) = 1$ ，即 $e$ 和 $\varphi(n)$ 不互质。同时，选取另外一个整数 $d$ 满足条件 $ed \equiv 1 (\textrm{mod}\ \varphi(n))$ 。这样，就得到了一对密钥 $(n,e),(n,d)$ 。

公钥 $K=(n,e)$ 对外公开；私钥 $k=\varphi(n), d$ 对外隐藏。另一方接收到公钥后，可以用它加密数据，但是无法解密；只有用私钥才能解密。实际上，利用公钥加密的信息只能通过私钥才能还原，也就是说，只有拥有私钥的人才能够对信息进行解密。这一过程的目的是为了避免信息泄露或者被篡改。RSA 提供了一种快速加密的方法，可以在短时间内完成对数据的加密，并将其传输给接收端。

## 2.2 Diffie-Hellman 密钥交换协议
Diffie-Hellman 密钥交换协议是一种双向通讯的公钥密码体制，由两方 $A$ 和 $B$ 各自选择一个奇数 $p$, $a$, $b$ ，然后计算它们的公共密钥：
$$K_{AB}=a^{b}\ b^{a}$$ 

这个密钥对两方都是开放的，没有任何保密措施。但是由于 $a$ 和 $b$ 可能很容易因素库中其他人的私钥计算出来，所以一般情况下不能直接使用。要进行通信，A 和 B 需要分别计算出自己的私钥 $x$ 和公钥 $X$ ：
$$x_A=a^{\prime}, X_A=a^{\prime} b^{a}, x_B=b^{\prime}, X_B=b^{\prime} a^{b}$$ 

然后两方交换公钥，通过计算得出共享密钥：
$$K_{BA}=(X_B)^x=(X_B)^{(b^{\prime})^(a^{\prime}(b^{(-1)}))} =(b^{\prime})^{ab^{\prime}}$$ 

最终，两个方都获得了一个相同的密钥 $K_{AB}=K_{BA}$ 。由于 $a$ 和 $b$ 可能因素库中其他人的私钥计算出来，所以密钥交换只能确保两方的双向通讯安全，而不能完全防止中间人攻击。

## 2.3 DSA 签名方案
DSA 签名方案也属于 RSA 密码体系，不同之处在于，DSA 没有选取 $p$ 和 $\{g_i\}_{i=1}^{\lfloor \frac{p-1}{q} \rfloor}$ ，而是采用椭圆曲线，其关键属性是容易求点乘积和模运算，但难以构造离散对数难题。相比于椭圆曲线，RSA 有更好的加密性能，但相对来说，椭圆曲线的性能并不是很重要。

DSA 在生成签名时，需先选择一个随机数 $k$ ，然后根据公钥 $(y, g)$ 计算出椭圆曲线上点 $r=gk^-1(\textrm{mod}\ p)$ 。随后，将消息 $M$ 通过 $h(M)$ 转换为 $Z_p$ 空间中，并对 $Z_p$ 中的点坐标取模得到 $z=h(M)k(\textrm{mod}\ n)$ ，最后得到签名 $S=(r,s)$ ，其中 $s=r^{-1} z(\textrm{mod}\ q)$ 。其中，$h$ 函数是一类哈希函数，用于将任意长度的数据转换成 $Z_p$ 空间中的一点。

在验证签名时，只需验证签名是否满足 $0\leq s\leq q-1$ 以及 $0\leq r\leq n-1$ ，并计算 $w=s^{-1}(\textrm{mod}\ q)$ ，然后计算出 $u_1=zw(\textrm{mod}\ q)$ ， $u_2=rw(\textrm{mod}\ q)$ ，再根据 $K=(p,q,g)$ ，计算出椭圆曲线上点 $Q=g^u_1 k^u_2(\textrm{mod}\ p)$ 。若点 $Q$ 和公钥对应的点 $R=gy$ 一致，则认为签名有效。

## 2.4 Miller-Rabin 素性测试
Miller-Rabin 素性测试是一种确定某个数是否为素数的方法。该方法通过反复试验几次判断一个数是否为合数，结果可以使得错误率降低至 $1/4$ 。具体来说，该方法从 $a$ 出发，计算 $a^d(\textrm{mod}\ n)$ ，如果结果恰好等于 $1$ 或 $-1$ ，那么 $n$ 一定是合数；否则，继续递归地检查 $(d-1)/2$ 是否能够整除 $a^d(\textrm{mod}\ n)$ 。

当 $p$ 为质数时，显然可以直接通过素性测试。当 $p$ 为合数时，Miller-Rabin 算法会检测出 $p$ 。如果 $p$ 具有某些特殊特征，比如 $p-1=2^kq$ ，则可以通过启发式的方法来缩小范围，减少计算量。

## 2.5 基于最小化假设的 DSA 参数选择策略
综合以上内容，DSA 可以理解为如下联合体：$(p,q,g)\times K=(y,g)$. 如果 $p$ 和 $q$ 足够大，且 $N=pq$ 为强大的素数，那么就可以利用已知的素数定理 $p\overline{q}\overline{N}+\overline{p}\overline{q}\overline{N}=\overline{N}$ 来算出 $y$ 。此时，DSA 可以方便地实现各种通信应用，如加密通信等。

但是，对于强大的素数 $N$ ，找到对应的 $p$ 和 $q$ 非常困难，原因在于：

1. 对于强大的素数 $N$ ，存在一个小于或等于 $N$ 的数 $f(N)$ ，使得 $N=pq$ 的所有 $q$ （包括 $q$ 本身）均小于 $f(N)$ 。换言之，$N$ 一定可以被分解为若干质数的积，并保证每个质数的指数都足够小。然而，对于某些特定值 $N$ ，有可能存在比 $f(N)$ 更大的质数，使得 $N=pq$ 的所有 $q$ 都大于 $f(N)$ 。

2. 当 $p$ 和 $q$ 均足够大时，可以通过合适的设置方法（如埃拉托斯特尼筛法）来枚举出所有的 $p$ 和 $q$ 。然而，$p$ 和 $q$ 的大小和组合有严格的限制，存在更多的约束条件，因此枚举这些值是不可行的。

3. 当 $N$ 取正整数时，$N$ 可以很容易的计算出 $p$ 和 $q$ 。但是，对于负整数 $N$ ，很难界定 $p$ 和 $q$ 的范围，因为负整数的定义域太广泛，只能尝试猜测值。然而，如果猜测值过于粗糙，可能会导致 $p$ 和 $q$ 的大小不匹配，从而导致验证失败。

为了解决上述问题，基于假设的 DSA 参数选择方法应运而生。基于假设的 DSA 方法不需要对 $N$ 求解，而是根据一定的假设（比如 $p$ 和 $q$ 之间有大的差异），然后选择合适的 $p$ 和 $q$ ，进而推导出相应的公钥和私钥。基于假设的 DSA 能够兼顾枚举困难和效率，为密钥交换提供可靠的安全方案。

### 2.5.1 DSA 的标准（Standard）参数选择
DSA 的标准参数选择方法依赖于以下假设：

1. $p$ 和 $q$ 之间存在很大的差异，如 $\log_2(q)>2$ 。
2. $p$ 和 $q$ 都是质数。
3. $\sqrt[3]{p}-\sqrt[3]{\pi}<10^{-15}$ ，即 $\sqrt[3]{p}>\sqrt[3]{\pi}$ 。
4. $\lambda(N)=\log_2(|Z_p|+|Z_\infty|)$ 最大，其中 $|Z_p|$ 表示 $Z_p$ 中有多少个元素，$|Z_\infty|=2^{\lambda(N)-1}$ 。

这种参数选择方法的优点是简单易懂，适合于一般用途。缺点是要求较高的计算能力，并且不能保证所选择的参数质量。

### 2.5.2 宽松假设的参数选择
基于宽松假设的参数选择方法相对于标准方法增加了一个假设：

假设 $p$ 是一个素数，$q$ 大于 $p$ ，$N=pq$ ，$\lambda(N)=\log_2(|Z_p|+|Z_\infty|)$ 最大。

宽松假设的优点是计算量较低，速度快，适合实践应用；缺点是无法做出严格证明，也不能完整验证所选择的参数质量。例如，它不能排除 $N$ 的合数，并可能误导用户认为所选择的 $p$ 和 $q$ 符合标准方法的条件。

### 2.5.3 非强假设的参数选择
基于非强假设的参数选择方法对第四个假设作了修改：

假设 $p$ 是一个素数，$q$ 大于 $p$ ，$N=pq$ ，$\lambda(N)<\min(k_1,\dots,k_l)$ ，其中 $k_1,\dots,k_l$ 是已知的整数，$\forall i,(p-1)=2^j+\cdots+2^{l-i} \equiv m_i(\textrm{mod}\ 2)$ 。

非强假设的优点是允许一些非平凡情况，适合于极端场景下的用途；缺点是复杂度高，仍然不能保证所选择的参数质量。