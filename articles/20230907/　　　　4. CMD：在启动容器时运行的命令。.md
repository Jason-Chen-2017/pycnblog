
作者：禅与计算机程序设计艺术                    

# 1.简介
  

## 1.1 命令行（Command Line）及其相关概念
CMD（Command Line）是指通过计算机界面的文本输入及输出方式，以字符形式输入指令或命令，并获得反馈信息的方式，是用户直接和操作系统内核进行交互的一种方式。它提供了对操作系统功能及各种资源的访问权限，可实现对系统配置、管理、控制、备份等方面的高效率、灵活性。
## 1.2 Docker容器
Docker是一个开源的应用容器引擎，让开发者可以打包他们的应用以及依赖项到一个轻量级、可移植的容器中，然后发布到任何流行的Linux或Windows机器上，也可以实现虚拟化。由于隔离的特性，使得Docker能够提供面向服务的架构，从而支持复杂的多层应用程序的部署。Docker基于Go语言实现，具有自己的命令行接口（CLI）。
## 1.3 使用Dockerfile定义容器
Dockerfile用来构建镜像，使用简单的语法定义了创建镜像所需的环境变量、操作系统层次结构、软件安装、配置和入口点等，是Docker最核心的组件之一。Dockerfile包含两部分内容，基础镜像和定制指令。基础镜像就是指使用哪个镜像作为父镜像，如果没有指定，则默认使用官方提供的alpine镜像。定制指令用于告诉docker怎么构建这个镜像。以下是一个Dockerfile示例:

```
FROM alpine:latest
RUN apk add nginx
COPY index.html /usr/share/nginx/html/index.html
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

这个Dockerfile会基于alpine:latest创建一个新的镜像，并安装nginx服务，复制index.html文件到指定的目录下，还将容器的80端口映射到主机的80端口。最后，运行nginx的命令，开启nginx的守护进程模式，即运行后不会阻塞终端。当使用该Dockerfile构建镜像时，只需要执行`docker build -t myimage.`即可。`-t`参数指定了镜像名。`.`表示当前工作目录。
## 1.4 在容器启动时运行命令
Dockerfile中的CMD指令可以设置容器在启动时默认运行的命令。例如，上面Dockerfile中的CMD命令指定了容器启动时运行nginx。但这仅限于Dockerfile定义的容器。若要在启动容器时运行其他命令，比如bash、python等，就需要增加一条`docker run`的参数`--entrypoint`。举例如下：

```
$ docker run --name mynginx -d -p 80:80 myimage
```

这条命令启动了一个名为mynginx的容器，并将其80端口映射到了主机的80端口，同时运行了myimage镜像。由于Dockerfile中已经有了CMD命令，因此这里不需要再额外添加。在这种情况下，需要通过`--entrypoint`参数来指定运行的命令。

```
$ docker run --name mynginx -d \
  --entrypoint "/bin/sh" myimage \
  -c "echo 'Hello World' > /usr/share/nginx/html/index.html" && sleep 2 && curl http://localhost
```

这条命令启动了一个名为mynginx的容器，并指定了它的入口点为`/bin/sh`，这意味着在启动容器时，不会运行默认的nginx命令，而是直接进入`sh`命令行界面。然后，使用`-c`参数执行了一个shell脚本，将“Hello World”写入了`index.html`文件中。脚本执行完成后，睡眠2秒钟，然后使用curl命令访问容器的80端口，查看是否存在“Hello World”。