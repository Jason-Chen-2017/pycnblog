
作者：禅与计算机程序设计艺术                    

# 1.简介
  

## 什么是MySQL触发器？
MySQL触发器（Trigger）是一个数据库里用来响应数据的变动自动执行的一段 SQL 语句，触发器的作用类似于函数或存储过程，可以对数据进行预设操作。

## 为什么要用触发器？
触发器可以让用户在数据库内设置各种事件的监听与回调，从而可以实现对数据的实时跟踪、自动化更新或拦截数据库操作。通过触发器，可以实现：

1. 数据校验：触发器可以监控特定的数据表，并根据触发条件判断是否应该更新、删除或者插入数据。比如，当一条记录被添加到某个表中时，可以在触发器里检查该记录的内容是否符合要求；当用户修改了某字段的值时，可以通过触发器进行相应的操作。

2. 数据完整性：触发器可以检测和维护表之间的关系完整性。比如，当删除一条记录时，可在另一个表中删除相关联的记录，保证数据的一致性。

3. 权限控制：触发器可以帮助管理员控制对数据的访问权限。当用户试图执行某些操作时，可以通过触发器进行权限验证。

4. 多表操作：触发器可以将多个表连接在一起，形成一个逻辑上的单个表。当对这个表中的数据进行操作时，会同步影响其他表。

5. 消息通知：通过触发器，可以向指定的人发送消息提醒，例如数据表中的某条记录被修改、插入或删除。

## 使用触发器需要注意什么？
1. 性能损耗：每个触发器都需要额外的开销，可能会影响整个数据库的性能。因此，最好只在必要时才使用触发器，而且要充分利用好它们的功能。

2. 操作限制：触发器的操作范围受限于触发器定义的表。也就是说，只能对其所在表上的数据进行操作，不能跨表操作。另外，对于一些高级特性，如事务支持等，也可能受到限制。

3. 冗余数据：在创建触发器时，务必确保其不会造成冗余数据。例如，不要同时创建两个触发器，其中一个用于清空一个表，另一个用于备份另一个表的数据。如果存在冗余数据，很容易导致不可预测的结果。

4. 不可信任用户：为了防止攻击者利用触发器执行恶意代码，建议仅授予DBA级别的权限给触发器的拥有者。另外，还应监视触发器是否执行过度频繁，以避免对系统性能产生负面影响。

# 2.基本概念术语说明
## DDL触发器
DDL触发器（Data Definition Language Trigger）用于在数据库对象创建、修改、删除时执行一系列的SQL命令，常用的包括：`CREATE TABLE`，`ALTER TABLE`，`DROP TABLE`。

## DML触发器
DML触发器（Data Manipulation Language Trigger）用于在数据库表记录发生变化时自动执行一系列的SQL命令，常用的包括：`INSERT`，`UPDATE`，`DELETE`。

## 触发器类型
触发器类型主要有两种：`行级触发器`、`语句级触发器`。

### 行级触发器
行级触发器是在每一行数据被修改的时候触发的触发器，其特点就是每行数据变化都会被触发一次，并且由于其位于行记录上，因此效率比较高。

### 语句级触发器
语句级触发器是在整个SQL语句被执行完成后触发的触发器，其特点是只会被执行一次，但是由于其位于SQL语句上，因此执行效率低下。通常来说，语句级触发器不太常用。

## 触发器激活条件
触发器的激活条件是指触发器在满足一定条件的时候才会被激活，其常用的触发条件有如下几种：

1. INSERT: 在新纪录插入表中时激活触发器
2. UPDATE: 在已有纪录被更新时激活触发器
3. DELETE: 在已有纪录被删除时激活触发器
4. TRUNCATE: 在表被TRUNCATE操作时激活触发器
5. CREATE: 在表被创建时激活触发器
6. ALTER: 在表结构被改变时激活触发器
7. DROP: 在表被删除时激活触发器

## 执行顺序
触发器的执行顺序决定了它在多次触发之间先后的执行顺序。实际运行过程中，触发器按照触发条件、触发顺序及程序设计的先后顺序依次执行。常用的执行顺序有以下几种：

1. 默认顺序：即使没有明确地指定优先级，同一类型的触发器在触发时也是默认执行的先后顺序
2. 先进先出顺序：这种方式是指先触发的触发器先被执行，后触发的触发器最后执行
3. 后进先出顺序：这种方式是指后触发的触发器先被执行，先触发的触发器最后执行