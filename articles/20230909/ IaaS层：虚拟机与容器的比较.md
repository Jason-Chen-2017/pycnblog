
作者：禅与计算机程序设计艺术                    

# 1.简介
  

云计算的IaaS（基础设施即服务）层通常包括虚拟化、网络、存储等基础资源管理功能，以及软件部署、自动运维、监控管理等管理工具。在此之上，IaaS还提供了一些平台级服务，如弹性伸缩、备份、高可用、安全等。随着容器技术的流行，云计算的IaaS也开始提供基于容器技术的服务，比如Docker Machine或Kubernetes等。那么，两者之间有什么不同呢？本文将详细阐述两者之间的区别及应用场景。
# 2.虚拟机VS容器
## 2.1 容器技术概览
### 2.1.1 容器技术定义
“容器”是一个操作系统级别的轻量级虚拟化技术，它封装了一个完整的应用环境，其中的软件都运行在一个独立的容器中。而在容器内，应用进程可以像正常运行一样，通过cgroup和namespace技术进行资源隔离。容器技术通过极低的资源开销、快速启动速度和高度一致性，帮助业务应用实现可移植性、灵活性、弹性扩展和弹性伸缩等能力。

### 2.1.2 容器技术特点
#### 2.1.2.1 轻量化
容器技术基于操作系统原生支持的cgroup和namespace机制，对底层硬件资源、操作系统内核进行精细化控制。因此，容器比传统虚拟机更加“轻量”。

#### 2.1.2.2 可移植性
容器镜像技术允许开发人员将开发、测试、预发布、生产环境的软件环境打包成标准的镜像文件。这种技术使得容器可以在不同的操作系统上运行，从而实现了跨平台、可移植性。

#### 2.1.2.3 快速启动
由于容器具有更小的内存占用、启动速度快、快速部署特性，因此，相较于传统虚拟机技术，容器技术更适合微服务架构、高并发、分布式等场景。

#### 2.1.2.4 一致性
容器间共享宿主机内核，因此容器之间具有高度一致性。由于容器内的应用进程之间没有虚拟机额外的性能损耗，因此可以有效避免虚拟机调度开销，提升系统整体性能。

#### 2.1.2.5 弹性扩展
容器技术能够方便地动态伸缩应用负载，通过增加或者减少容器数量，实现应用的横向扩展和纵向扩展。

## 2.2 IaaS层技术
### 2.2.1 IaaS层概览
IaaS（基础设施即服务）层通常包括虚拟化、网络、存储等基础资源管理功能，以及软件部署、自动运维、监控管理等管理工具。在此之上，IaaS还提供了一些平台级服务，如弹性伸缩、备份、高可用、安全等。随着容器技术的流行，云计算的IaaS也开始提供基于容器技术的服务，比如Docker Machine或Kubernetes等。

### 2.2.2 虚拟机IaaS层
虚拟机IaaS层提供基于Xen或KVM的虚拟化、网络、存储等基础资源管理功能，以及管理工具OpenStack Nova、Neutron、Glance、Cinder、Heat等。这些技术支持创建、删除、启动、停止、暂停、恢复、克隆、迁移、备份、快照、加密等基础虚拟化操作。

### 2.2.3 容器IaaS层
容器IaaS层提供了基于Docker Swarm或Kubernetes的容器编排、调度、管理等技术，以及管理工具Rancher、Weave Scope等。这些技术支持创建、删除、更新、启动、停止、暂停、恢复、回滚、复制、迁移等容器编排操作。另外，容器IaaS层还可以提供基于Service Mesh的服务发现、熔断降级、请求路由等平台级服务。

## 2.3 选择IaaS层的原因
容器技术正在成为主流云计算技术。很多创新公司都采用容器技术构建自己的云平台，比如Red Hat OpenShift、CoreOS Tectonic、AWS ECS、微软Azure Kubernetes Service等。因此，选择正确的IaaS层，对于云计算的发展至关重要。

笔者认为，选择虚拟机IaaS层还是容器IaaS层主要取决于以下几点：

1. 硬件资源要求：如果目标应用需要非常强大的计算资源，建议选择容器IaaS层；反之，则可以选择虚拟机IaaS层。
2. 服务稳定性要求：容器IaaS层依赖容器技术，其服务稳定性优于虚拟机IaaS层，但前提是要搭配好容器编排技术，让容器具备自动弹性伸缩、服务发现等功能，并做好相应的容错处理。
3. 客户资源投入：容器IaaS层涉及更多的技术栈，因此，企业需要长期投入资源投入才能部署起来，但若业务应用简单、应用不复杂、容器编排技术成熟，则可以考虑选择虚拟机IaaS层。