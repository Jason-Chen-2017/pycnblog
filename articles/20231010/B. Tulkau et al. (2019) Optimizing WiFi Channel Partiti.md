
作者：禅与计算机程序设计艺术                    

# 1.背景介绍


## 概要
随着5G、6G和今后更多的高通系芯片的采用，无线通信终端被逐渐转变为移动通信终端的重要组成部分。无线通信网络作为物理层、传输层和应用层的分层结构的基础设施之一，能够极大地提升通信设备的性能和可靠性。而人们在使用无线通信时，往往会面临着多个信道带来的信号不均衡的问题，进而影响到通信质量。
目前市场上主流的无线通信系统是基于IEEE 802.11协议的，基于物理层的无线信道共享机制导致用户只能在同一个信道上进行数据通信。随着智能手机等移动终端的普及，频谱资源的需求也越来越大。因此，无论是提升无线通信设备的性能还是降低成本，优化无线信道分配策略都至关重要。
## 发展状况
### IEEE 802.11协议
IEEE 802.11协议是无线局域网（WLAN）的标准协议之一，它定义了无线网络中节点之间如何进行无线电交换的规则。IEEE 802.11协议可以支持各种不同的业务模式，包括点对点（P2P）通信、Ad hoc（自组织）组网、Wi-Fi接入点（AP）、低功耗蓝牙（BLE）等，但其最主要的功能是定义无线信道划分的规则。

IEEE 802.11协议定义了一组信道，其中每一信道都有一个特定的频率范围，不同的信道通常具有不同的带宽和调制方式。例如，信道1通常用于802.11b或11g协议，而信道6通常用于802.11n协议，从而使得用户可以在不同业务模式下共用较少的信道，有效避免信号不均衡的问题。

IEEE 802.11协议通过加密机制保证数据的安全性，但是由于协议规定了信道划分机制，并且信道分配存在固有的不平衡现象，所以信道划分问题是一个值得研究的课题。

### 信道划分机制
IEEE 802.11协议定义了一组信道，每个信道都有一个特定的频率范围，例如，信道1、信道2、信道3、信道4……。每条无线信号在整个空间中的传播方向可以由两根连续的导线相互连接形成三维空间中的一个曲面，称为路径loss。路径loss反映的是两个站点之间的物理距离与两根导线间隔的比值，是决定无线信道分配的重要因素。

当一条无线信号要经过某个信道时，首先需要经过2.4GHz或5GHz两种基带通道，再通过适当的射频调制方式将信号转换为无线电波，最后才能被接收器接收并解译。如果一条无线信号在同一条信道上同时传输，那么其所携带的信息可能会被干扰，导致信息丢失。为了防止信号碰撞，IEEE 802.11协议规定，一个信道上只能允许两个设备传输数据，如果有第三个设备想要加入该信道，则必须等待第一个设备结束当前的传输。

即便是在相同的数据速率下，不同业务模式下的无线信道分配也是不同的。例如，对于点对点通信而言，信道1通常只用来传输控制包，而信道5通常用于传输数据包。对于Wi-Fi接入点而言，信道1通常用来管理设备，而信道6通常用于上传输数据。

### 目前的分配机制
目前，国际上对于无线信道划分的主流方法是基于最短时间优先（STP）算法。这是一种动态路由协议，通过了解网络拓扑结构来自动分配信道，尽可能减小信号碰撞。其基本思路是通过计算两台设备之间的路径的延迟（包括物理链路损耗、噪声、阻抗等），然后选择延迟最小的路径进行通信。STP算法优点是简单易实现、不需要调整参数，缺点是不能直接满足高频使用场景。

另外，国内针对信道划分的方法还有一些探索，如干扰免疫（CSMA/CA）算法、轮循码分多址（CAR）算法等。这些算法是根据网络拓扑结构、负载情况及用户习惯等指标来确定信道分配的。

### 设计目标
设计目标是尽可能降低功耗同时提高通信质量，实现信道分配效率最大化。为了达到这一目标，可以通过以下几个方面来提升信道划分的效果：

1.减少信道之间的干扰
2.改善信道划分的平衡性
3.更好地利用频谱资源

除此之外，还需要考虑不同业务模式的需求，提出各自的优化方案。

# 2.核心概念与联系
## 无线信道划分
无线通信中，信道就是无线电波的传输路径，它决定了无线信号的强弱，是无线电信道分配的一个重要环节。无线信道划分的目的就是将频段内的无线电信道分配给不同的设备，以提高信噪比和降低噪声的影响，从而增强无线通信的能力。一般来说，无线通信中信道的划分可以分为如下四种类型：

1.静态信道划分：静态信道划分是指按照固定模式划分信道，常见的模式有1x1、1xN、NxM等；
2.动态信道划分：动态信道划分是指根据网络流量、负载情况及用户习惯等指标来确定信道划分，常用的方法有最短路径优先SPF、多目标调度MAP等；
3.灵活信道划分：灵活信道划分是指设备可以随时调整信道，即可以自由选择自己的信道，常用的方法有轮询和协商协议CRS；
4.邻域信道划分：邻域信道划分是指通过集中部署多台接入点，将频段划分为不同区域，每个区域分别服务于不同的用户，常用的方法有无线站群（WSN）。

## STP协议
即时切换协议（Short-Term Protection，STP）是IEEE 802.1D协议的核心机制，它的主要作用是实现动态路由协议，即通过计算两台设备之间的路径的延迟（包括物理链路损耗、噪声、阻抗等），然后选择延迟最小的路径进行通信。通过周期性地发送BPDU消息，把邻居设备的状态信息汇报给路由器，最终实现了不同端口的链路平衡。STP协议工作原理图如下图所示：


通过SPT协议，路由器可以发现并评估当前网络中的所有连接，并根据设备的优先级来决定向哪个端口发送数据，从而避免了拥塞、减少了丢包率、提高了网络吞吐量。

STP协议优点是简单、易于实现，缺点是不能满足高频使用场景。

## 轮循码分多址（CAR）算法
轮循码分多址算法（Carrier Sense Multiple Access，CSMA）又称为冲突检测多点接入，是IEEE 802.3协议中用于以太网数据传输的协议。在半双工通信模型中，信道利用率（Channel Utilization，CU）表示该信道上的利用率，CU的值在0～1之间，0表示空闲，1表示忙。CSMA算法通过轮询的方式判断信道是否空闲，如果为空闲，则发送帧，否则等待一段随机时间后重新尝试。如果一直没有获得信道资源，则视为冲突，放弃数据帧的传输。

CSMA算法优点是简单、易于实现，缺点是只能适用于半双工通信，在全双工通信时仍然会发生冲突。

## 常见问题解答
### 为什么要考虑信道划分？
无线信道划分的目的就是将频段内的无线电信道分配给不同的设备，以提高信噪比和降低噪声的影响，从而增强无线通信的能力。这就涉及到资源的合理分配，也就是说，只有保证无线通信的资源得到充分利用，才能发挥无线通信的最大价值。

### 为什么要采用最短时间优先（STP）算法？
最短时间优先算法（Shortest Path First，SPF）是一种动态路由协议，通过了解网络拓扑结构来自动分配信道，尽可能减小信号碰撞。STP协议不像CSMA、CAR那样具有单一规则，它可以对不同类型的设备、不同业务模式下的无线信道分配提供多种解决方案。

### STP的缺陷是什么？
最短时间优先算法（SPF）存在以下缺点：

- SPT协议存在时延，造成性能损失；
- 在较大的网络中，SPF算法执行起来比较慢，会占用较多CPU资源；
- SPT协议使用广播机制，容易产生广播风暴；
- SPF算法只适用于同频段的设备间通信，无法有效处理跨频段的通信。

### 灵活信道划分方法有哪些？
灵活信道划分方法有两种：轮询和协商协议CRS。

1.轮询方法：这种方法是指在一段时间内，所有的设备都以相同的速度轮流占用信道资源，直到信道被占满时，才进入空闲状态，等待其他设备释放信道资源。轮询方法虽然简单，但存在争夺信道资源的问题，因此难以应付复杂的环境变化。
2.协商协议CRS：这种方法是指在某一段时间内，所有的设备都以相同的速度试图占用信道资源，但同时还要求能够识别到信道冲突，因此采取措施来消除冲突。当设备意识到自己已经占用了信道资源时，它可以暂停发送数据，等待协商结果。协商协议CRS采用独占式共享方式，不需要依赖中心控制，具有较好的抗攻击性，但是如果出现网络故障，那么所有的设备都会停止发送数据。

### STP和灵活信道划分的区别和联系是什么？
灵活信道划分是指设备可以随时调整信道，即可以自由选择自己的信道。而STP协议是一种动态路由协议，通过了解网络拓扑结构来自动分配信道，尽可能减小信号碰撞。两者之间存在着密切的联系，并且STP算法的缺点也受到了灵活信道划分的限制。