
作者：禅与计算机程序设计艺术                    
                
                
C++中的多态性：优雅地实现继承和多态
====================















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































                                            

# C++中的多态性：优雅地实现继承和多态

多态性是 C++中面向对象编程中的一个重要概念，它指的是同一个类或接口可以有多个派生类，每个派生类都可以继承基类，并且每个派生类都可以定义自己的成员函数。多态性是 C++中面向对象编程的核心概念，它使得编写代码变得更加简单，且可以提高程序的灵活性。本文将介绍 C++中多态性的实现方法，包括继承、多态和接口继承。

### 1. 继承

C++ 中的继承是实现多态性的重要手段之一，通过继承可以实现基类和派生类之间的类型转换。派生类可以继承基类的成员函数、变量和成员变量，并且可以添加自己的成员变量和成员函数。在 C++ 中，可以通过如下方式实现继承：
```cpp
class Base {
public:
    void foo();
};

class Derived : public Base {
public:
    void foo();
};

void Derived::foo() {
    // 派生类的成员函数
}
```
在这个例子中，`Base` 是基类，`Derived` 是派生类。`Derived` 类继承自 `Base` 类，并且重写了 `Base` 类的成员函数 `foo()`。通过继承，`Derived` 类可以调用 `Base` 类的成员函数，并且可以定义自己的成员函数。

### 2. 多态

多态是 C++ 中实现多态性的另一种方式，它可以使得同一个函数可以有不同的行为，从而增加代码的灵活性。在 C++ 中，可以通过如下方式实现多态：
```cpp
#include <iostream>

class Shape {
public:
    virtual void print() {
        std::cout << "Shape::print() called";
    }
};

class Circle : public Shape {
public:
    void print() {
        std::cout << "Circle::print() called";
    }
};

int main() {
    Circle circle;
    Shape* shape = &circle;
    
    // 调用 print() 函数
    shape->print();  // 输出 "Circle::print() called"
    shape->print();  // 输出 "Shape::print() called"
    
    return 0;
}
```
在这个例子中，`Shape` 是基类，`Circle` 是派生类。`Circle` 类继承自 `Shape` 类，并且重写了 `Shape` 类的成员函数 `print()`。通过多态，`Circle` 类可以调用 `Shape` 类的成员函数 `print()`，并且可以定义自己的成员函数。在 `main()` 函数中，创建了一个 `Circle` 对象，并且将一个 `Shape` 指针指向该对象。调用 `print()` 函数时，会根据对象类型调用相应的成员函数，从而实现多态性。

### 3. 接口继承

在 C++ 中，可以通过接口继承实现多态性。通过接口继承，可以实现多态性，同时又不会引入额外的类型。在 C++ 中，可以通过如下方式实现接口继承：
```cpp
#include <iostream>

class Shape {
public:
    virtual void print() {
        std::cout << "Shape::print() called";
    }
};

class Circle : public Shape {
public:
    void print() {
        std::cout << "Circle::print() called";
    }
};

class CirclePrinter : public std::ostream<Shape> {
public:
    CirclePrinter() {
        this->set_print_function("print< Circle >");
    }
    void print(const Shape& shape) {
        shape->print();
    }
};

int main() {
    Circle circle;
    Shape* shape = &circle;
    
    // 创建一个 CirclePrinter 对象，用于输出 "Circle"
    CirclePrinter printer;
    
    // 调用 print() 函数
    print< Circle >(shape);  // 输出 "Circle::print() called"
    
    return 0;
}
```
在这个例子中，`Shape` 是基类，`Circle` 是派生类。`CirclePrinter` 是一个接口类，它声明了一个成员函数 `print()` 和一个成员变量 `CirclePrinter`。`CirclePrinter` 类继承自 `std::ostream<Shape>` 类，并且声明了自己的成员函数 `print()`。通过接口继承，`Circle` 类可以定义自己的成员函数，并且可以调用 `Shape` 类的成员函数。在 `main()` 函数中，创建了一个 `Circle` 对象，并且将一个 `Shape` 指针指向该对象。创建了一个 `CirclePrinter` 对象，用于输出 `Circle` 对象的成员函数 `print()`。调用 `print()` 函数时，会根据对象类型调用相应的成员函数，从而实现多态性。

