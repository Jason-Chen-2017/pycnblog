
作者：禅与计算机程序设计艺术                    

# 1.简介
  

MongoDB是一个基于分布式文件存储的开源NoSQL数据库。早期版本中，它主要用于关系型数据库领域，现已扩展到非关系型数据库领域。因此，MongoDB作为非关系型数据库，有着极高的灵活性、可伸缩性及容错性。

为了方便读者理解，本文将对MongoDB进行一个非结构化数据的入门介绍。不涉及复杂的数据模型设计、索引优化等相关内容。由于篇幅原因，非结构化数据的相关介绍仅限于以下几点：
1. MongoDB文档存储（BSON）
2. 查询语言查询方式
3. 使用GridFS文件存储模式
4. 分片集群架构

在开始介绍之前，先回顾下相关的一些概念和术语。
# 2.基本概念术语说明
## 2.1 BSON(Binary JSON)
BSON（Binary JSON）是一种用于存储与交换二进制数据类型的数据格式。这种数据格式类似于JavaScript Object Notation，但其更紧凑。BSON最大的特点就是小而快速。BSON在传输时无需解析，速度非常快。它的二进制形式和JSON字符串形式相同。

BSON主要用来序列化各种数据类型，包括数字、字符串、数组、对象、布尔值、日期时间、正则表达式等。每个数据类型都以独有的字节序列编码，使得BSON可以有效地处理二进制数据。

BSON并没有实现所有数据类型的标准，比如Map和Set类型没有实现，而提供了额外的方式来存储这些数据类型。除此之外，还支持用户自定义的类型。

## 2.2 插件
MongoDB提供了许多插件，通过插件可以增强功能或添加新的功能。一般来说，有两种类型的插件：
### 2.2.1 系统级插件
系统级插件属于内置插件，直接启动的插件，不需要手动加载。系统级插件提供了额外的功能，如备份恢复、身份验证、监控等。
### 2.2.2 用户级插件
用户级插件需要手动安装，然后才能启动。用户级插件提供各种各样的功能，如数据加密、分析、日志记录、连接池管理等。

除了系统级插件和用户级插件，还有其他的插件，如Sharding组件的分片集群插件等。

## 2.3 数据库
数据库（Database）是存储集合（Collection）的地方。一个MongoDB服务端可以包含多个数据库，每一个数据库中可以包含多个集合。数据库可以看做是表的组成，集合是行的组成。

默认情况下，一个MongoDB服务器会自动创建名为“test”的数据库。如果要访问其他数据库中的集合或者文档，需要显式指定数据库名称。

## 2.4 集合
集合（Collection）是由一系列文档组成的数据结构。集合类似于关系数据库中的表，不过集合不同于表，它不限定每条数据必须拥有相同的数据结构。

集合中的每个文档都是独立的，并且没有任何关系。所以如果有一个文档的某字段的值是另外一个文档的_id，那么两个文档是不相关的。

集合中的文档可以动态添加、修改、删除。

## 2.5 文档
文档（Document）是一个记录（record）或者实体，是MongoDB中最小的逻辑单位。一条文档就像一张表中的一行。

文档是一个没有固定结构的 BSON 对象，它可以包含键-值对、数组、嵌套文档、ObjectId、日期等数据类型。

每个文档至少包含两个特殊的键：`_id` 和 `_v`。`_id` 是文档的唯一标识符，每一个文档都会有一个独一无二的`_id`，即使两个文档的内容完全一样。`_v` 表示文档的版本号。

默认情况下，MongoDB 创建的文档不会自动生成`_id`，除非主动设置。如果没有设置，MongoDB 会自己生成一个默认的ObjectId作为`_id`。

## 2.6 GridFS
GridFS（文件存储）是用于在单个集合中存储文件的一个机制。GridFS采用了两个集合来实现：一个集合用于存放元数据信息，另一个集合用于存放文件内容。

元数据信息包括文档ID、文件名、上传时间、文件大小、校验和等。元数据信息中的文件名不是唯一的，同一个文件名可以被重复上传。

文件内容保存在另一个集合中，以文件的Id作为文档的键值，文档的value包含文件块的序号和文件块数据。

GridFS 适合于存储大型二进制文件，因为它允许只下载或删除文件的一部分，而不是整个文件。

## 2.7 Sharding
Sharding是指将数据水平划分为多个区（shard），这样可以在数据量较大的情况下提升查询效率。Sharding还可以解决数据量过大的问题，将数据集拆分到不同的机器上，通过网络相互通信。

目前最流行的Sharding组件是MongoDb官方的分片组件——sharding。MongoDb官方已经把分片组件整合到db.collection()方法中，默认开启，不需要额外配置就可以使用分片功能。