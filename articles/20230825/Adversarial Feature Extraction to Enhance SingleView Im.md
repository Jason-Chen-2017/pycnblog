
作者：禅与计算机程序设计艺术                    

# 1.简介
  

单视图图像检索(Single View Image Retrieval, SVR)任务是在给定一个query image $q$，检索出最相似的其他image集合中的图片$I=\{i_1,\cdots,i_n\}$ 。目前的SVR方法一般分为两类，第一类为基于特征的SVR方法，如SIFT、HOG等，第二类为基于深度学习的方法，如CNN、RNN+CNN等。基于特征的SVR方法通过提取图像中物体的特征，计算它们之间的距离，从而检索出最相似的图片；而基于深度学习的SVR方法则借助深度学习网络（DNN）进行特征抽取，同时训练模型使得网络能够区别出不同类别的图像，并通过图像之间深层次的关联性进行检索。但是，目前基于深度学习的SVR方法由于缺乏有效的对抗样本生成能力，其检测性能存在较大的困难，并且效果不稳定。因此，作者提出了一种新的模型——对抗样本提升网络(Adversarial Feature Enhancement Network, AFE)，来增强基于深度学习的SVR方法的检测性能。
AFE模型主要由三个子网络组成，包括特征提取器、对抗样本生成器以及检索网络。特征提取器用于提取图像特征，检索网络用于在特征空间中检索出最相似的图像，而对抗样�生成器则用来产生具有目标属性的对抗样本，对抗训练可以有效缓解过拟合问题。实验结果表明，在PASCAL VOC和COCO数据集上，对于很多复杂场景下的目标检测任务，AFE模型都优于传统模型，甚至取得了更好的性能。

2.相关工作
基于深度学习的SVR方法的多种研究已经取得了突破性的进步，在多视角、深度学习、小样本学习等方面都取得了前所未有的成果。然而，最近几年来，基于深度学习的SVR方法遇到了两个难题，一个是检测性能差，另一个是对抗样本生成过程不够合理。针对第一个问题，一些方法通过增加网络的复杂度、调整损失函数或者采用多个视图的方式来提高检测性能。而针对第二个问题，一些方法通过对抗样本生成过程中引入正则化项来减轻对抗样本的影响，但效果仍然不理想。因此，作者提出的AFE模型是一个全新的模型，其整体框架与传统模型类似，但是加入了一个额外的对抗网络，从而克服了传统的无监督学习技术无法生成合理对抗样本的问题。

3.模型结构
AFE模型由三部分组成：特征提取器、对抗样本生成器和检索网络。如下图所示：

其中，特征提取器包括卷积神经网络(CNN)，它负责提取图像的局部特征；对抗样本生成器是一个GAN，它负责生成具有目标属性的对抗样本；检索网络是一个Siamese结构的结构，它根据特征向量计算它们之间的距离，从而检索出最相似的图像。
整个流程可以总结为以下几步：首先，将输入的query图像传入特征提取器CNN得到其特征表示；然后，利用对抗样本生成器生成具有目标属性的对抗样本$\hat{\mathcal{D}}$；最后，将query特征向量$f_{q}$与所有对抗样本特征向量$f_{\hat{\mathcal{D}}}$一起送入检索网络Siamese结构中，得到它们之间的相似度。
## 3.1 对抗样本生成器
为了生成具有目标属性的对抗样本，AFE模型提出了一个简单的GAN结构，它的结构如下图所示：

该GAN网络由一个生成器和一个判别器组成，生成器用于生成对抗样本，判别器用于判断生成的样本是否真实可信，判别器通过对生成样本的真伪进行二分类，输出一个概率值，接着将生成的样本和真实样本送入到判别器中，判别器再对生成的样本和真实样本进行一次交叉熵损失，并输出损失值，反向传播更新参数。
生成器的网络结构如下图所示：

判别器的网络结构如下图所示：

为了生成具有目标属性的对抗样本，生成器的网络结构需要具备对抗性，即要生成恶意的对抗样本，而不是普通的正样本。作者在生成器的网络结构中加入了以下模块：
1. 噪声输入：生成器的输入除了图像特征外，还需要添加噪声，噪声输入模块负责生成随机的噪声。
2. 对抗扰动：生成器的输出需要满足对抗性要求，因此对生成器的输出增加一个对抗扰动，对抗扰动模块通过生成的目标标签，生成带有目标属性的对抗样本。
3. 普通目标标签：为了训练生成器，需要同时提供标签信息。普通目标标签模块则只生成正常样本。
4. 对抗损失：为了保持生成器的判别能力，判别器应当尽可能的识别出生成器生成的样本，因此判别器会在原判别器基础上加上对抗损失，对抗损失模块通过判别器输出的概率值计算损失。
## 3.2 特征提取器
特征提取器用于提取图像特征，特征提取器的网络结构如下图所示：

特征提取器网络由两部分组成：基础网络和特征提取层。基础网络是基于ResNet18和AlexNet的预训练模型，将图像映射为特征表示；特征提取层则是一个全连接层，将基础网络的输出与全连接层进行拼接，再通过ReLU激活函数和Dropout层后，输出特征向量。
## 3.3 检索网络
检索网络用于在特征空间中进行图像检索。它的结构是一个双塔结构的Siamese网络，它的主干网络是一个ResNet-18结构。在该网络的输入端，接收两个相同尺寸的图像；在一个共享的特征提取层后，该网络分别通过两个不同的路径进行特征提取，得到两个不同的特征表示。这两个特征表示将送入不同的层，如一个全连接层和一个线性层，将它们的输出进行拼接，送入一个统一的向量空间，这个向量空间的维度可以在超参中设定。在向量空间内，采用余弦相似度计算两个图像之间的相似度。
# 4.实验
## 4.1 数据集
作者使用了两个常用的图像检索数据集--Pascal Voc和COCO数据集。Pascal Voc数据集共有20个类别，包含2007年发表的VOC 2012训练集和测试集，共1464张图片。COCO数据集是目前最常用的数据集之一，包含80个类别，共计超过20万张图片。
## 4.2 评价指标
作者使用了两种常用的评价指标：平均精确率(Average Precision, AP)和AUC-ROC曲线。AP用来衡量模型的查全率和查准率。AUC-ROC曲线用来衡量模型的准确率和召回率之间的权衡程度。
## 4.3 模型超参设置
作者设置的典型的超参如下：
1. Learning rate: 0.0001
2. Batch size: 128
3. Epochs: 150
4. Weight decay: 0.0005
5. Regularization coefficient for adversary loss term: 1e-4
6. Parameter of the regularization of detector in contrastive learning: 0.1
7. Dimensionality of the latent space: 256
8. Percentage of target samples: 0.5 (for each epoch)