
作者：禅与计算机程序设计艺术                    

# 1.背景介绍


随着人们对自然环境的关注越来越多，智能交通领域也迅速跟上了这个潮流。随着智能手机、无人机等新型传感器的普及，能够实时地捕捉到人类活动的场所成为迫在眉睫的需求。如何从众多传感器的数据中提取出人类行走轨迹是一个重要的问题。目前常用的方法主要是基于传感器融合的方法或者基于机器学习的方法进行处理。其中传感器融合的方法可以将来自不同类型传感器的数据进行融合，然后利用分类器进行预测；而机器学习的方法则需要建立一个训练好的模型，然后利用模型进行预测。而这两种方法都存在着一些弊端：
- 方法一比较简单，但是在某些特殊场景下效果不好
- 方法二比较复杂，但是训练起来比较耗费资源，且对数据的要求较高
因此，作者借鉴了图神经网络（Graph Neural Network）中的一种卷积结构——空间卷积核和时序卷积核，结合多尺度空间下的信息，提出了一个新的模型——空间时序图卷积网络（Spatial-Temporal Graph Convolutional Networks）。该模型能够有效解决传感器融合方法中遇到的一些问题，而且相比于传感器融合的方法在计算效率和模型规模方面也有很大的优势。
# 2.核心概念与联系
## 空间时序图卷积网络的定义
空间时序图卷积网络（Spatial-Temporal Graph Convolutional Networks），ST-GCN，由多层空间卷积层和多层时间卷积层组成，采用图卷积的原理构建动态空间时序图的特征表示，并通过堆叠多个空间时序图卷积层对空间时序图进行多次局部特征建模和全局特征融合，最终输出每个目标点的时空预测结果。
## 模型结构
## 时空卷积核
ST-GCN模型中，空间卷积核采用基于空间向量表示的顶点卷积核，时序卷积核采用基于时序向量表示的边卷积核。对于空间卷积核，首先通过空间距离函数计算两节点之间的空间距离向量，再进行特征向量投影，得到投影后距离的加权和作为节点的特征向量。对于时序卷积核，首先通过时序差分函数计算两节点之间的时序差分向量，再进行特征向量投影，得到投影后的时序差分的加权和作为边的特征向量。两个卷积核共同作用形成局部特征矩阵，之后再进行池化、降维、规范化等操作使其具有全局特征。
## ST-GCN网络结构
### 空间卷积层（Spatial Convolution Layer）
空间卷积层的输入是一个静态的邻接矩阵$A$，代表地理位置的连接关系。首先，计算节点之间的空间距离矩阵$L$，用作顶点卷积核的权重。对于每个节点，其空间邻居节点之间根据空间距离进行加权求和，得到节点的空间特征。用公式如下：
$$h_{v}^{l+1}=\sigma\left(\tilde{D}_{v}^{l}\right) \sum_{u \in N(v)} W_{e_{uv}} h_{u}^{l}$$
其中$N(v)$表示节点$v$的邻居节点集合，$\tilde{D}_{v}^{l}$表示节点$v$到所有邻居节点的空间距离向量，$W_{e_{uv}}$表示节点$u$和节点$v$之间的边权重，$\sigma$是非线性激活函数。

### 时序卷积层（Temporal Convolution Layer）
时序卷积层的输入是一个动态的邻接矩阵$B$，代表时序上的连接关系。首先，对邻接矩阵$B$计算邻接矩阵$T$，用作边卷积核的权重。对于每条边$(i,j)$，计算其时序上邻居边$(i',j')$的差别$t_{ij}-t_{i'j'}$，用作边卷积核的权重，得到边的时序特征。用公式如下：
$$h_{e_{ij}}^{l+1}=\sigma\left(\tilde{D}_{e_{ij}}^{l}\right) f\left(x_{e_{ij}}\right), e=1:E$$
其中$f$为非线性激活函数，$\tilde{D}_{e_{ij}}^{l}$表示边$e=(i,j)$到所有邻居边的时序差分向量。

### 空间时序图卷积层（Spatial-temporal graph convolution layer）
空间时序图卷积层（Spatial-temporal graph convolution layer）将上述两个卷积层的结果融合为节点特征矩阵$H^{(l+1)}$和边特征矩阵$C^{(l+1)}$，再经过一次全连接层，得到输出节点的时空预测值。用公式如下：
$$\hat{y}_{v}^{l+1}=h_{v}^{l+1}+\sum_{u \in N(v)} \sum_{e \in E_{v u}} C_{e}^{l+1} h_{e}^{l}, v=1:V$$
其中$E_{v u}$表示节点$u$邻接到的节点$v$的所有边。

### 深度残差网络（Depthwise Separable Convolutions）
为了防止网络退化，ST-GCN模型采用深度可分离卷积（Depthwise Separable Convolutions）方法。深度可分离卷积即先做深度方向的卷积，再做空间方向的卷积。这种方式能够让模型更好的关注到局部特征。用公式如下：
$$x_{\cdot l+1} = \mathcal{F}(x_{\cdot l}) + x_{\cdot l}$$