
作者：禅与计算机程序设计艺术                    

# 1.背景介绍


Wireshark是目前最流行、功能最强大的抓包分析工具，其能够帮助我们更好地理解网络通信协议、设备之间的交互流程，为后期的攻击防御、性能优化等提供了非常有力的武器。但是对于入门级的用户来说，学习、应用Wireshark还是有一定难度的。因此，作为技术专家，我想通过系列文章向大家分享如何利用Wireshark对复杂网络通信数据包进行高效的分析。本文假设读者具有网络编程基础，对计算机网络协议、数据结构等有基本的了解。
# 2.核心概念与联系
## 2.1 数据链路层
数据链路层（Data Link Layer）又称链路层或网络接口层。它主要包括两个子层：物理层（Physical Layer）和数据链路控制层（Data Link Control Layer）。物理层负责传输比特流（0和1），而数据链路控制层用来进行数据帧的发送、接收和错误处理。数据链路层工作在OSI模型的第2层，属于网络层之上的数据链路层。它的功能主要有：

1.封装成帧：将网络层传下来的原始数据进行分割成适当长度的字段或“帧”（frame），然后加上必要的首部信息。

2.透明传输：允许不同网络之间的数据传输不受任何影响。

3.差错控制：使错误不会造成数据的丢失，并确保数据被正确的顺序到达目的地。

4.流量控制：控制网络上传输数据的速率，防止网络拥塞。


## 2.2 以太网
以太网是世界上广泛使用的以太网。它是由IEEE组织定义的IEEE 802.3协议族的一部分，并由英特尔、博通、法林克兰、爱立信、三星、联电、日立、中兴、迅雷等厂商生产，每台连接到以太网上的计算机都有一个唯一的48位MAC地址。在发送数据时，以太网把源节点的MAC地址放在帧的前部，目标节点的MAC地址放在帧的后部。以太网的数据帧被打包成512字节的单元，这样就可以保证即使不考虑其他因素，每个帧都能被完整的传送到另一个站点。

以太网的数据链路层协议规定了帧格式、帧校验序列（FCS）、介质访问控制（MAC）算法、速率控制、可靠传输和循环冗余检测（CRC）等内容。

## 2.3 TCP/IP协议栈
TCP/IP协议栈是Internet的核心协议，它规定了计算机之间网络通信的规则。

TCP/IP协议体系结构：


1.应用层（Application Layer）：应用程序，如浏览器、邮件客户端、P2P文件共享等。

2.传输层（Transport Layer）：负责端到端的数据传输，如TCP、UDP协议。

3.网络层（Network Layer）：负责路由选择、数据包从源到终点的转发，如IPv4、IPv6协议。

4.数据链路层（Data Link Layer）：负责在两个相邻节点间建立数据链路连接、传输数据帧，如以太网、PPP协议。

## 2.4 Wireshark简介
Wireshark是一个开源的、跨平台的网络捕获、分析工具，支持众多网络协议，包括TCP/IP、DNS、HTTP、Ethernet、SSL、SMB、VoIP、RADIUS等。Wireshark能够捕获网络数据包、显示各种报文头部信息、构造过滤器、通过抓包分析、监控网络流量、调试网络故障等功能。

Wireshark能在Windows、Linux、Mac OS X、FreeBSD、OpenBSD等操作系统运行，可以导入和导出pcap格式的文件。它还可以通过插件扩展功能，添加新的协议支持和过滤器语法。

## 2.5 Wireshark的安装与配置
### 2.5.1 安装
下载地址：https://www.wireshark.org/download.html

根据自己的操作系统版本下载对应的安装包，按照默认安装即可。

### 2.5.2 配置
打开Wireshark，出现如下窗口代表安装成功：


如图所示，Wireshark默认只抓取经过本地接口的数据包，如果需要抓取局域网中的数据包，需设置相应的网络接口才可。点击“Edit→Preferences”按钮，弹出偏好设置窗口：


如图所示，在“Capture”标签页中，勾选“Capture on all interfaces”，再点击“Apply”按钮，则Wireshark会监听所有网络接口的数据包，包括Wi-Fi、蓝牙、USB等。

除此外，还可以在“Protocols”标签页中，启用或者禁用某些网络协议的分析，以提升性能。点击“Apply”按钮保存设置。