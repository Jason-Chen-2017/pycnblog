
作者：禅与计算机程序设计艺术                    

# 1.背景介绍


## 边缘计算简介
### 什么是边缘计算
在传统云计算中，应用运行于中心服务器上，可以直连到互联网，所有数据流经中心服务器，因此延迟较高且带宽受限，但随着移动互联网的发展，越来越多的应用需要部署在边缘节点（设备）上，通过本地通信实现数据的处理、分析和传输，降低延迟和提升性能。例如，物联网设备的采集、处理、分析数据并将结果传输至云端，城市环境监测系统的实时监控等都属于边缘计算场景。
### 为什么要边缘计算？
当今互联网经济和信息爆炸已经促使人们对于快速响应、实时反应性的需求，而人类对快速反应性的需求又推动着边缘计算的研究。边缘计算能够提供低延迟和高吞吐量，并且能够满足设备对资源的独占要求。此外，边缘计算还可用于创新性的应用开发、智能终端产品开发、工业自动化、车联网、体育赛事信息等领域。
## KubeEdge介绍
### KubeEdge是什么？
KubeEdge是一个开源的边缘计算框架，它根据Kubernetes容器集群管理能力构建的面向边缘的Kubernetes。它把边缘设备制造商、应用开发者和云供应商的关注点分离开，从而让边缘计算变得更加简单和统一，极大地促进了边缘计算的发展。
### KubeEdge组件介绍
- EdgeCore：作为一个独立的服务运行在每个边缘节点，负责kubelet模块的功能扩展，包括设备发现、健康检查、pod生命周期管理、应用程序部署、集群路由、消息通知等。
- Kublet：它是默认的容器引擎，用来管理Pod及其相关资源的运行状态，支持Docker和containerd等不同容器运行时，可以运行任意兼容OCI标准的镜像。
- Moby：是一种轻量级容器引擎，它可以与Kublet一起工作，使用namespace隔离不同的容器组，并提供一个简单的远程过程调用接口来管理容器。
- EdgeMesh：边缘网格，KubeEdge的核心组件之一，是负责整个集群内边缘节点之间的通信和流量调度。它通过边缘代理模式，在集群内部各个节点之间建立安全的双向连接通道，解决节点间容器通信、负载均衡和流量控制的问题。
- CloudCore：作为一个独立的服务运行在云端，用来管理云端应用的生命周期，包括应用部署、状态同步、配置管理、日志收集和监控等。
- CloudHub：云端消息中心，由一个hub模块和多个agent模块组成，用来接收并处理来自边缘节点的消息。
- OpenAPI Aggregation Layer：边缘API聚合层，基于kube-apiserver提供给应用使用的标准RESTful API接口，它提供了应用查询、创建、更新、删除集群中资源的能力。
## KubeEdge架构概览
KubeEdge架构总共分为四个部分：云端，边缘端，控制平面，以及核心组件。其中，云端部分就是Kubernetes集群，边缘端部分是KubeEdge运行在边缘设备上的Kublet和EdgeCore两个模块，控制平面是cloudcore和edgemesh两部分，核心组件则是k8s和Istio等组件。如图所示，KubeEdge架构总体比较复杂，但是如果细致划分的话，可以分为以下几个主要组成部分：
### 控制器(Controller)控制器是指用来管理系统的组件，比如说负责事件监听的控制器，或者负责为Pod分配IP地址的控制器。在KubeEdge中，主要有两类控制器：
#### cloudcore控制器
CloudCore控制器管理云端应用的生命周期，包括应用部署、状态同步、配置管理、日志收集、监控等。它首先会获取CloudHub中收到的事件，然后按照相应的策略进行处理。例如，当云端接收到应用的部署请求时，CloudCore会创建一个新的Deployment对象，并根据定义好的规则选择一个运行该应用的边缘节点，然后发送到对应的边缘节点的EdgeCore。
#### edgemesh控制器
EdgeMesh控制器管理边缘节点之间消息的转发和流量调度，包括节点通信、负载均衡和流量控制等。它首先会在全局范围内选取多个边缘节点，然后设置多个边缘节点之间的路由规则，确保边缘节点之间的通信畅通。当云端应用或其他外部事件发生时，它也会相应地触发边缘节点之间的消息转发。
### 模块(Module)模块是指执行特定的功能的实体，比如 kubelet 和 edgecore 模块就是用来管理 Pod 和 EdgeCore 服务的。在KubeEdge中，主要有两种类型的模块：
#### 普通模块
普通模块只会在一个节点上运行，比如运行在物理机上的 NodeAgent 模块。它们可以作为客户端，向云端发送数据或接收命令。
#### EdgeCore模块
EdgeCore模块会在每个边缘节点上运行，包括 Kubelet 和 EdgeSub 模块。其中，Kubelet 是默认的 Kubernetes kubelet，它负责管理 Pod 及其相关资源的运行状态，同时它也支持容器的镜像拉取、运行和停止等功能。EdgeSub 模块是一个可选的插件，通过订阅 CRD 来支持边缘应用程序的部署、管理和协作。
### 代理(Agent)代理是指用来代理特定节点上的模块功能的实体，它运行在每个边缘节点上。在KubeEdge中，主要有两种类型的代理：
#### 普通代理
普通代理会在每个节点上运行，比如在物理机上运行的 NodeAgent 模块。它们可以监听来自云端或其他节点的数据变化，然后根据相应的规则做出决策。
#### EdgeCore代理
EdgeCore代理会在每个边缘节点上运行，包括 edged 和 edgesite 两个模块。其中，edged 是运行在每个节点上的 agent，负责启动运行容器、管理容器生命周期，并报告状态；edgesite 是 EdgeMesh 的前置代理，它会处理来自 EdgeCore 的请求，并帮助它完成消息的转发和流量调度。
### 协议(Protocol)协议是指用来传递数据的格式、语法和语义的一套标准。在KubeEdge中，主要使用 gRPC 和 WebSocket 协议。