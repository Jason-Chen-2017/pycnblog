
作者：禅与计算机程序设计艺术                    

# 1.简介
  

## 什么是词法分析？
词法分析(Lexical Analysis)是识别、分类并标记一串字符序列中的单个词、短语或符号的过程，它由几个模块组成：扫描器(Scanner)、分割器(Splitter)、标点符号过滤器(Punctuation Filterer)、词素(Lexeme)生成器(Lexeme Generator)。在计算机科学中，词法分析通常作为编译器前端的一部分执行。词法分析的目的是将源代码文本(Source Code Text)划分为符合语言语法规定的词汇序列(Token Sequence)，进而进行语法分析。词法分析程序在做词法分析时主要完成以下三个工作：
- 将源代码文本按照扫描顺序逐个字符地扫描；
- 根据词法定义规则，将连续的标识符、关键字、运算符等，切分成词素；
- 将非终结符、运算符、界符等词素标记成相应的类型，例如整数、浮点数、字符串等。
## 为什么要做词法分析？
做词法分析的原因：
- 通过词法分析可以提取出程序的基本语法元素（标识符、关键字、运算符、注释等），对后续语法分析和语义分析起到重要作用；
- 在词法分析过程中还会检查源码是否存在错误，如编码风格不规范或语句逻辑不正确等；
- 可以方便程序优化和代码生成，提高代码的可读性和易维护性。
## 词法分析的种类
目前已有的词法分析方法主要有三种：
- 分词法(Lexing): 也叫按词法单元划分的方法。把编程语言的原始输入流拆分成词法单元（Token）。比如C++语言，词法单元包括关键字、标识符、整数常量、界符、运算符等。这种方式简单直观，但缺乏语义信息，无法处理复杂的语义规则。
- 正则表达式法: 即通过正则表达式来进行词法分析。这种方法可以比较灵活地匹配各类词素，但编写正则表达式麻烦且效率低下。
- 混合法: 一般采用正则表达式法来实现词法分析的基础上，再用一些手段来辅助分析，比如状态机、图算法等。
## 词法分析的步骤
词法分析是一个串行的过程，其基本步骤如下所示：
1. 使用扫描器(Scanner)扫描源代码文本，一次扫描一个字符，并根据输入流中的当前位置，决定下一步应采取的动作。
2. 如果扫描到的字符是空白字符(空格、制表符、换行符等)，则跳过该字符，继续向前扫描；如果扫描到的字符是注释，则忽略掉该注释，继续向前扫描；否则认为这是有效的源代码字符，输出到缓冲区。
3. 判断缓冲区中的有效源代码字符是否可以组成一个词素(Lexeme)。对于C/C++语言，词素就是标识符、关键字、数字、运算符等。每个词素都有一个对应的类型，用于标志它的实际意义。
4. 如果当前词素没有对应的类型，则输出报错信息，需要重新扫描；否则，输出词素及其类型。
5. 消耗掉缓冲区中的所有有效源代码字符，并进入下一轮扫描。重复上述步骤，直至扫描结束。
词法分析的最终结果是一系列词素，它们代表了源代码文本中所有的基本语法元素。
## 词法分析示例
词法分析示例如下：
```c++
int main() {
    int a = 1;
    float b = 3.14f;
    char c[] = "Hello, world!";
    return 0;
}
```
扫描器扫描这个程序源代码，产生的词素及其类型分别是：
```
int      Keyword   (标识符)
main     Identifier    (标识符)
()       LeftParen     ()
{        LeftBrace     {}
int      Keyword   (标识符)
a        Identifier    (标识符)
=        AssignOp      =
1        IntegerConstant   (整数常量)
;        Semicolon      ;
float    Keyword   (标识符)
b        Identifier    (标识符)
=        AssignOp      =
3.14f    FloatConstant (浮点常量)
;        Semicolon      ;
char     Keyword   (标识符)
c        Identifier    (标识符)
[        LeftBracket   []
]        RightBracket  ]
=        AssignOp      =
"Hello, world!" StringLiteral (字符串常量)
;        Semicolon      ;
return   Keyword   (标识符)
0        IntegerConstant   (整数常量)
;        Semicolon      ;
}        RightBrace     }
;        Semicolon      ;
```