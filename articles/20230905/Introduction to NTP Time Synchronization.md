
作者：禅与计算机程序设计艺术                    

# 1.简介
  

网络时间协议（Network Time Protocol，NTP）是由互联网工程任务组（IETF）所制定的网络时间同步协议，用于同步计算机时钟。它可以使各个时钟之间的时间误差保持在较小范围内，从而保证分布式系统中的各台计算机能够正确的时间协调，保证分布式环境中的各种时间序列数据能够一致。其特点是简单、精准、可靠、无时钟漂移，适用于小型、微型、中型局域网以及广域网。

NTP分为主服务器和客户端两个角色。主服务器就是授时中心，负责产生时间戳并将它们传播到客户机；客户端则根据从主服务器接收到的时间戳进行时间同步。

# 2.核心概念术语
## 2.1 时钟偏差
对于任意两台计算机来说，如果它们拥有相同的参考时钟，那么它们之间的时差就称为偏差（offset）。

由于不同的信号、噪声、传输延迟等因素，时钟之间总会存在一定程度的偏差。因此，同一时刻不同计算机上的时间可能存在着偏差。

## 2.2 晶体振荡
晶体振荡是指两个不同频率的电子同时通过一个晶体管，导致其振荡。这是因为同一管脚的两个信号通过共用电容后，会受到激励而产生差异，从而引起了振荡。

发生晶体振荡不代表时钟停止走位。相反，只是表示了时钟变慢或者快的现象。因此，需要采取相应措施，如校准或者调整系统时钟，以避免这种情况的出现。

## 2.3 时钟漂移
时钟漂移是指本地时钟按照规律运行，但是由于各种原因导致时钟产生错误。

最常见的时钟漂移场景是由于时钟偏移引起的时钟漂移。由于GPS卫星的日光暴露以及其它因素影响，地球上的时区相对于当地实际时间会发生变化，因此引入了UTC(Coordinated Universal Time)标准来统一世界各地的时间。基于UTC标准的世界时区被划分成一个一个小时的格林威治时区（GMT），每个格林威治时区的偏移量大小与该时区对应的夏令时、规则时或加热时长相关。虽然这样可以降低世界各地由于太阳黑子引起的时间漂移，但仍然无法消除其它原因导致的漂移。

另外，在分钟级时间上，由于天文运动、闰秒以及其它因素影响，时钟也会产生漂移。例如，中国在每年1月7号，为了纪念建军节，夜里重重的日出造成时钟漂移超过一分钟，严重影响分布式系统中的应用。

除了上面提到的两种主要场景之外，还有一些其它场景也可能导致时钟漂移，比如自然灾害、系统故障或者人为操作等。因此，时钟漂移是一个比较复杂的难题，需要各方共同努力才能解决。

## 2.4 GPS
全球定位系统（Global Positioning System，GPS）是一个卫星导航定位系统，由美国Naval Research Laboratory设计，主要用于定位GPS卫星。GPS利用卫星钟（LSR=Lunar Satellite Rise，航空母舰升起）、轨道星历、供氧系统、数字化卫星定位装置（DORIS）、独立计算机、以及用户交互界面等多种手段，进行高度准确的坐标定位。 

GPS本身存在时钟漂移的问题，尤其是在夜晚。由于观测者距离卫星越近，越容易看到精确的时间信息，从而导致GPS时间漂移更加剧烈。目前已有许多工作研究GPS相关的时钟漂移问题，以期提供更加稳定的时间服务。