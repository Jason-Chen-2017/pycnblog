
作者：禅与计算机程序设计艺术                    

# 1.简介
  

椭圆曲线加密算法（Elliptic Curve Cryptography, ECC）是一种基于椭圆曲线的公钥加密算法。它的优点是计算速度快、安全性高，并且应用广泛。它可以用来进行密钥交换、数字签名、消息认证码等。ECC算法由美国国家标准与技术研究院（NIST）定义并提交给国际密码学会（IEEE）。NIST对ECC算法做了详细的定义，包括算法类型、椭圆曲ulse、位宽、运算性能、曲率等。
本文将介绍两种最流行的椭圆曲线加密算法：椭圆曲线 Diffie-Hellman （ECDH），椭圆曲面离散对数难题算法（Elliptic Curve Digital Signature Algorithm，ECDSA）。这些算法都是目前公钥加密领域里最有影响力的算法。
# 2.基本概念术语
## 2.1 椭圆曲线
椭圆曲线（Elliptic curve）是一种二维曲线，其上任意一点都可以通过指定一个参数 t 来唯一确定。在椭圆曲线上绘制一系列的点，每两个相邻点之间的距离也相同。这样，我们就可以用一个标量 t 来代表某个点的坐标。
椭圆曲线上面的所有点都有唯一的参数 t ，并且满足 t^2 + a*t + b = 0 （其中 a 和 b 是不可约的实数）。其中 a 称为椭圆曲线的参数，b 可以看成是一个偏移量。为了方便，我们把曲线在 O(x轴) 方向的切线称作 x 轴切线。
椭圆曲线方程具有以下几种形式：
### 曲线方程法
在欧氏空间中的椭圆曲线方程可记作：y^2 = x^3 + ax + b (a 不等于 0)。这是关于 y 的二次方程。
这个方程的根既可能是实数，也可能是复数。如果仅考虑实根的话，方程两边同时乘以 y'=-1 可得：(y')^2 = -x^3 -ax - b (a 不等于 0)，再除以 2a 将得到另一组椭圆曲线方程：y'^2 = (-x)^3 + bx (b 不等于 0)。如果存在两个相邻根是实数时，它们构成的椭圆叫做“椭圆曲线”。
### 辗转相除法
在群上椭圆曲线方程可以用辗转相除法来求解。首先设 u=(2xy)^2=(-1)^(r/2)(qx)^2, v=(qy)^2, 用 Fp 欧拉函数求出 p 次单位根 g 。取 q=n+1 时，有 p 个不同的椭圆曲线。它们被标记为 E_1，E_2，……，E_p，并且两两之间有连通性，即存在一条直线不经过端点，连接这 p 个椭圆。下一步，设 M 为 p 的最小素因子，K 为任意整数，满足 (M|K)=1。设 t=u/v，则存在一根 t 在 M*E_m 上。重复此过程，直到 t=g 为止，于是 E_k 是一个椭圆，且 k 有多项式时间复杂度的单解。
### 椭圆曲线公式法
椭圆曲线公式法利用椭圆曲线的重要属性——切线恒定于自变量。通过三阶齐次方程组，可以得到三个不相等的三次多项式。根据这些方程，可以确定该椭圆曲线上的所有点。
一般地，对于椭圆曲线 E，其方程为：y^2 = x^3 + Ax^2 + Bx + C (A,B,C为常数)。而其切线恒定于自变量，所以可以从原方程出发，对 x 取值，通过求解 A、B、C 来确定椭圆曲线上的所有点。
## 2.2 椭圆曲线参数生成
要想生成一个椭圆曲线，需要确定椭圆曲线方程的四个系数。通常情况下，选择一种椭圆曲线类型（如短情曲线或双曲线），并选取一些初始参数。然后随机迭代产生新的参数，直到找到一个合适的参数。
随机产生的参数常用方法有两种：
- 使用系统随机数发生器，通过指定椭圆曲线类型和参数个数，自动生成随机的系数；
- 根据已知的椭圆曲线方程，利用代数变换的方法，找出相似的椭圆曲线。
## 2.3 椭圆曲线域
椭圆曲线域（ECDLP，也称为伽罗华域）是指由椭圆曲线上的一个原点到其他所有点的一个有限子集。每个椭圆曲线域都是由椭圆曲线上的一个点所确定，因此它还可以用椭圆曲线上的点来表示。
# 3. ECDH
## 3.1 概述
椭圆曲线 Diffie-Hellman （ECDH）算法用于密钥交换。它基于椭圆曲线离散对数难题的困难性，使用群上的椭圆曲线算法，同时采用随机化的过程保证了安全性。ECDH 的基本思路是在一个椭圆曲线上选取两个不同但共享私钥的点作为基点，双方各取一随机数，求得共享密钥。
## 3.2 椭圆曲线 Diffie-Hellman 算法
假设甲希望和乙建立密钥交换协议，双方先选择一个椭圆曲线 E 和两个点 P，Q。其中 P 为甲的公开信息，Q 为乙的私钥，再选择一个哈希函数 H 以便之后验证身份。双方都遵循如下步骤：

1. 甲先生成自己的私钥 d_a、公开信息 Q，并发送 Q=dp * P。

2. 乙接收到甲发送的消息后，生成自己的私钥 d_b、公开信息 R，并发送 R=dq * Q。

3. 甲计算出共享密钥 K：

   K = (dp * Q) ^ d_b mod n

   其中 dp 是乙的公开信息。

4. 乙计算出共享密钥 K：

   K = (dq * P) ^ d_a mod n

   其中 dq 是甲的公开信息。

5. 对比双方计算出的共享密钥 K 是否一致，若一致，则双方建立了密钥交换协议。

6. 验证身份：

   H((R,d_a)) == H((Q,dp))

   其中 H 为所选用的哈希函数。若结果相等，则验证成功。否则验证失败。

## 3.3 性能分析
虽然 ECDH 比较简单，但是它仍然是一种在非对称加密中应用最广泛的算法。与传统的 RSA 或 ElGamal 算法相比，ECDH 有着更好的性能，因为它可以在不需要密钥分发中心的前提下完成密钥交换，而且更加简单。另一方面，在某些特定场景下，比如密钥长度比较短、对抗攻击较弱等，ECDH 可能会受到一些限制。
# 4. ECDSA
## 4.1 概述
椭圆曲线 Digital Signature Algorithm （ECDSA）基于椭圆曲线离散对数难题，其基本思想是将生成签名的私钥和消息一起输入到哈希函数中，得到摘要，然后对该摘要进行签名，产生签名和公钥。验证签名的时候，首先用相同的哈希函数计算摘要，然后再和公钥配对，如果计算结果相同，则说明该签名确实是由私钥对应的公钥生成的。
## 4.2 椭圆曲线签名算法
假设甲希望对消息 m 消息进行签名，他首先选择一个椭圆曲线 E，选择一个哈希函数 H，并生成自己的私钥 d，以及公钥 Q=d * G。

1. 甲用自己的私钥和消息 m 生成摘要：

    r = H(m) mod n
    s = ((H(m + rd)) / r) mod n //rd 是随机的

2. 用私钥 d 以及随机数 r 生成签名 signature：

    signature = (r,s)

3. 验证签名：

    (w * Q) == ((r + sw) * G) mod n
    w = (signature[0] in [1,n-1])
    sig_w = powmod(G, signature[1], n)
    result = sig_w == ((signature[0] * G) + ((signature[1] * W) % n)) % n
    
    其中 G 为椭圆曲线的基点，W=H(Qx,Qy) 为公钥的验证信息。

## 4.3 性能分析
ECDSA 基于椭圆曲线离散对数难题，其运行时间依赖于哈希函数的计算复杂度，但并不是随着哈希函数的复杂度增加而线性增长。目前主流的签名算法，如 DSS 和 Schnorr，都采取了改进的哈希函数以减少计算时间。