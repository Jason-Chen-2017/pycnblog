
作者：禅与计算机程序设计艺术                    

# 1.简介
  

排序是一种对数据集合进行排列的方法，通常应用在数据库、文件系统、网页的显示、搜索结果排序等场景。在MySQL中，排序规则被称为collation或者字符集。

排序规则定义了对于同一个字符串或字段值的大小关系如何判断，如：升序、降序，大小是否区分等。排序规则影响到查询、更新、删除数据的性能，所以选择合适的排序规则非常重要。

目前，MySQL支持的排序规则包括utf8_general_ci、utf8_bin、gbk_chinese_ci、gbk_bin、gb18030_chinese_ci、gb18030_bin、latin1_swedish_ci、latin1_german1_ci等。

本文通过对中文排序规则Big5进行阐述，解释Big5排序规则在排序过程中如何处理汉字。

# 2.基本概念术语说明
1. ASCII码

   ASCII码（American Standard Code for Information Interchange）是最早用于计算机通信的字符编码标准之一。它为每一个可打印的英文字母、数字、标点符号设定一个唯一对应的二进制代码。
   
   ASCII码共收录128个字符，前32个字符用来控制计算机发出的指令，后95个字符用来表示正常的可见字符，其编码值都不大于127。

2. GB2312

    GB2312编码又称GBK编码，它是中国国家标准GB18030的基础，是基于汉字集的统一编码，由两个字节组成，每两个字节分别代表一个汉字。
    
    在GB2312编码中，每个字符的前面都有一个特定的标识位，用来表示该字符属于哪个区段。不同区域使用的字符编码范围也不一样。
    
3. Big-5编码

   Big-5编码，又叫CP950，是香港使用的主要的繁体中文编码。它是GB2312编码兼容的变体，主要用于香港、台湾地区。它共收录6821个字符，与GB2312编码兼容，可以直接用于GB2312编码工作。

   在Big-5编码中，保留第一个字节作为标识符，区分不同的区段。对繁体汉字，第一个字节是0x81至0xFE，第二个字节是0x40至0x7E，对简体汉字，第一个字节是0xA1至0xF9，第二个字节是0x40至0x7E。
    
# 3.核心算法原理和具体操作步骤以及数学公式讲解

## 3.1 对字符串的首字符进行比较

Big5编码按照原有的GB2312编码来继续使用，但需要增加一个识别字节。如果一个字节的第一位是0，则这个字符是繁体字；否则这个字符是简体字。因此，Big5编码采用两字节模式。

首先，先对字符串进行切割，取出每两个字节，将它们组合起来，得到3个字节。

假设我们的字符串是S，长度为N。我们把S切割成K份，每份有3个字节。对于第i个切片，假设它的第一个字节是b1，第二个字节是b2，第三个字节是b3。

由于采用了Big5编码，所以必然存在以下情况:

* 如果b1在0x81～0xFE之间，则表示的字符属于繁体字，此时如果b2满足条件，则表示的字符符合GB2312编码；反之，如果b2不在0x40～0x7E之间，则表明违背GB2312的规则，我们无法确定字符。

* 如果b1在0xA1～0xF9之间，则表示的字符属于简体字，此时如果b2满足条件，则表示的字符串符合GB2312编码；反之，如果b2不在0x40～0x7E之间，则表明违背GB2312的规则，我们无法确定字符。

我们可以用下图来表示：


## 3.2 比较两个切片

在比较两个切片的情况时，我们只需比较两个切片的第一个字节。如果第一个字节相等，则进入下一步比较；否则就确定它们的相对位置。如果第一个字节不相等，那么我们就可以确定它是不是一个汉字。

* 如果第一个字节相等，则比较第二个字节：

  * 如果第二个字节在0x40~0x7E之间，则可以确定这是一个GB2312编码的字符，此时可以简单比较它们的值并确定大小。

  * 如果第二个字节不在0x40~0x7E之间，则表明可能是大量空格等特殊符号。这种情况下，我们应该跳过这两个字节，然后递归地对接下来的两个切片进行比较。
  
* 如果第一个字节不相等，则只能确定这是一个繁简混杂的字符，我们无法知道它的具体含义。为了防止混乱，我们应该跳过这两个字节，然后递归地对接下来的两个切片进行比较。

## 3.3 小结

Big5编码是一个两字节模式，我们首先对输入字符串进行划分，然后再分别对每两个字节进行比较。

如果两个字节的首字节相同，那么我们就比较二者；如果不相同，那么我们跳过当前字节，并且继续对剩下的字节进行比较，直到找到一个合法的字节为止。

最后，如果没有找到合法的字节，那么就会返回错误信息。