
作者：禅与计算机程序设计艺术                    

# 1.简介
  

## 1.1 什么是死锁？
死锁是一个进程无限期地等待其他进程所需的资源而导致的一种状况，通常由于竞争资源或者彼此通信而引起的。在系统中，如果多个进程或线程在同一时间内因请求对方占用的资源而发生互相等待，而一直不能被满足时，将会发生死锁。死锁产生的原因如下:

1、系统资源不足。这是因为某些资源（如内存）已分配完毕，又被另一些进程（或线程）等待，这种情况就会造成死锁。

2、运行过程中，进程之间的通讯互斥，因而导致死锁。若进程之间有某个资源要进行交换，但该资源已经由自己持有，此时又同时需要由别人给自己申请，则系统处于死锁状态。例如两个进程都要用某一资源，但是该资源被另一个进程占用，而此时又想申请该资源，两者互相等待，结果就是死锁。

3、进程间循环等待。若一个进程A一直等待资源R1而被阻塞，同时，也被另一个进程B一直等待资源R2而被阻塞，即进程A永远无法获得资源R2；进程B永远无法获得资源R1。也就是说，系统中存在一条资源永远无法获取的链路。

## 1.2 为何会出现死锁?
死锁的发生具有不可预测性，其触发因素主要包括以下几个方面:

1.资源竞争。当两个或更多进程因争夺资源而陷入互相等待的时候，死锁就可能发生。

2.资源请求规则。系统中的进程在请求资源时，可能会按照一定的顺序进行，那么如果请求序列不当，也会造成死锁。例如，当进程P1向系统请求资源A时，系统分配资源后再向进程P2请求资源B，但是此时系统又分配了资源C给进程Q，进程Q同时也想申请资源A，但又被进程P1占用，这时候便产生了死锁。

3.资源分配不当。进程在申请资源之前，应该预估系统中各类资源的最大需求量并计算相应的分配策略，否则，资源分配不当，也可能产生死锁。

4.进程推进顺序不当。进程间资源分配的顺序不当，也会产生死锁。假设进程P1、P2、P3依次向系统请求资源，但P1始终占据着资源B，P2请求资源D失败，P3请求资源C成功，此时产生了死锁。

总之，产生死锁的根本原因是，多个进程在执行过程中，因争夺资源而造成一种错乱的状态，称之为死锁。如果没有及时的对死锁进行处理，最终会导致系统崩溃甚至资源的长时间等待，从而影响整个系统的运行。

## 2.如何避免死锁?
为了避免死锁，系统应采取如下措施:

1.加锁顺序。保证所有进程以相同的顺序加锁，以避免死锁发生。

2.超时等待。设置一个计时器，若进程在指定的时间内仍不能获得所需资源，则放弃资源。

3.鸵鸟策略。进程提前释放它拥有的资源，让自己可以继续执行下去，但不要依赖于他人的帮助。

4.回滚操作。发生死锁时，尝试通过回退操作来解除死锁。

5.多级反应器模式。允许系统采用不同优先级的响应方式，使死锁发生的概率降低。