
ä½œè€…ï¼šç¦…ä¸è®¡ç®—æœºç¨‹åºè®¾è®¡è‰ºæœ¯                    

# 1.ç®€ä»‹
  

åœ¨ä¿¡æ¯æŠ€æœ¯å’Œäº’è”ç½‘è¡Œä¸šä¸­ï¼ŒAB Test(A/B æµ‹è¯•)æ˜¯ä¸€ä¸ªç»å¸¸è¢«æåŠçš„æ–¹æ³•è®ºï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿåœ°åˆ¤æ–­äº§å“æˆ–æœåŠ¡çš„ä¼˜åŠ£å’Œç”¨æˆ·çš„å–œå¥½ï¼Œä»è€Œæ‰¾åˆ°æœ€ä½³çš„è®¾è®¡æ–¹æ¡ˆã€‚ä¼ ç»Ÿçš„AB Testæ–¹æ³•éœ€è¦åœ¨å¤šä¸ªé¡µé¢ä¹‹é—´è¿›è¡ŒA/Bæµ‹è¯•ï¼Œå¹¶é€šè¿‡åˆ†ææµé‡ã€ç‚¹å‡»ç‡ç­‰æŒ‡æ ‡è¯„ä¼°ä¸¤è€…çš„åŒºåˆ«ï¼Œæ ¹æ®å¯¹æ¯”ç»“æœå†³å®šå“ªä¸€ä¸ªæ›´å¥½ï¼Œä½†è¿™æ ·åšçš„é—®é¢˜ä¹Ÿå¾ˆæ˜æ˜¾â€”â€”æ•ˆç‡ä½ä¸‹ï¼Œè€—æ—¶é•¿ï¼Œæ— æ³•æ»¡è¶³å®æ—¶æ€§è¦æ±‚ã€‚ä¸ºæ­¤ï¼Œå‡ºç°äº†ä¸€äº›æ–°çš„æµ‹è¯•æ–¹æ³•ï¼Œå¦‚Multi Arm Bandit(MAB)æ–¹æ³•ã€Thompson Samplingæ–¹æ³•ã€‚
æœ¬æ–‡å°†ä»¥Thompson Samplingæ–¹æ³•ä¸ºä¾‹ï¼Œé˜è¿°å…¶åŸç†å’Œç‰¹ç‚¹ï¼Œå¹¶ç»™å‡ºç›¸åº”çš„ä»£ç å®ä¾‹ï¼Œå¸Œæœ›èƒ½å¤Ÿä¸ºè¯»è€…æä¾›å‚è€ƒå’Œå¯å‘ï¼Œå®ç°çœŸæ­£çš„A/B Testè‡ªåŠ¨åŒ–ã€‚

## 2.èƒŒæ™¯ä»‹ç»
Thompson Samplingæ–¹æ³•æ˜¯åœ¨å¤šè‡‚èµŒåšæœºï¼ˆMulti Armed Banditï¼‰æ¨¡å‹çš„åŸºç¡€ä¸Šå¼€å‘å‡ºçš„ä¸€ç§ç®—æ³•ã€‚æ‰€è°“å¤šè‡‚èµŒåšæœºæ¨¡å‹ï¼Œæ˜¯æŒ‡ä¸€ä¸ªæœºå™¨æœ‰å¤šä¸ªç›¸äº’ç‹¬ç«‹çš„åŠ¨ä½œï¼ˆActionï¼‰ï¼Œæ¯ä¸€ä¸ªåŠ¨ä½œéƒ½å¯èƒ½å¸¦æ¥ä¸åŒçš„æ”¶ç›Šï¼ˆRewardï¼‰ã€‚æ¯”å¦‚æŸä¸ªäººç¾¤åœ¨ä¸åŒçš„å¹¿å‘Šæ¸ é“ä¸Šè¿›è¡Œäº’åŠ¨ï¼Œå¯èƒ½è·å¾—ä¸åŒç±»å‹çš„å¹¿å‘Šæ”¶ç›Šï¼›æŸå®¶å•†åº—åœ¨ä¸åŒçš„ä¿ƒé”€æ–¹å¼å’Œå•†å“ç»„åˆä¸Šè¿›è¡Œä¿ƒé”€ï¼Œåˆ™å¯èƒ½äº§ç”Ÿä¸åŒçš„è¥æ”¶ã€‚è¿™ä¸ªæ¨¡å‹æœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯æ¯ä¸ªåŠ¨ä½œéƒ½å¯èƒ½å¸¦æ¥ä¸åŒçš„å›æŠ¥ï¼Œå› æ­¤æˆ‘ä»¬åªèƒ½é€šè¿‡ä¸æ–­åœ°å°è¯•ï¼Œæ¥æ‰¾åˆ°ä¸€ä¸ªæœ€å¥½çš„ç­–ç•¥ã€‚

ä¸ä¼ ç»Ÿçš„å¤šè‡‚èµŒåšæœºæ–¹æ³•ä¸åŒçš„æ˜¯ï¼ŒThompson Samplingæ–¹æ³•é‡‡ç”¨äº†æ¦‚ç‡åˆ†å¸ƒå½¢å¼çš„æ¨¡å‹ï¼Œå…¶ä¸­æ¯ä¸ªåŠ¨ä½œå¯¹åº”çš„å¥–åŠ±åˆ†å¸ƒéƒ½æ˜¯å…³äºéšæœºå˜é‡çš„ï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨è´å¶æ–¯ç»Ÿè®¡æ³•è¿›è¡Œæ¨ç†è®¡ç®—ã€‚å…·ä½“æ¥è¯´ï¼Œå¯¹äºç¬¬iä¸ªåŠ¨ä½œï¼Œå‡è®¾å…¶å¯¹åº”éšæœºå˜é‡çš„æ¦‚ç‡å¯†åº¦å‡½æ•°ä¸º$f_i(\theta)$ï¼Œå…¶ä¸­$\theta$ä»£è¡¨å‚æ•°å‘é‡ï¼Œè¯¥å‚æ•°å‘é‡è¡¨ç¤ºäº†ä¸åŒæƒ…å†µä¸‹çš„åŠ¨ä½œçš„å„é¡¹å±æ€§å€¼ã€‚Thompson Samplingæ–¹æ³•é€šè¿‡å‘¨æœŸæ€§åœ°æ›´æ–°å‚æ•°å‘é‡$\theta$ï¼Œæ¥é€‰æ‹©åˆ°ç›®å‰ä¸ºæ­¢æœ€ä¼˜çš„åŠ¨ä½œã€‚å…·ä½“åœ°ï¼Œåœ¨æ¯æ¬¡é€‰æ‹©åŠ¨ä½œä¹‹å‰ï¼Œéƒ½ä¼šæ ¹æ®å½“å‰çš„å‚æ•°å‘é‡$\theta$ç”Ÿæˆæ ·æœ¬é›†$D_{t}$ï¼Œå†å¯¹æ ·æœ¬é›†è¿›è¡Œå‚æ•°ä¼°è®¡ï¼Œå³è®¡ç®—å‡ºæ ·æœ¬é›†ä¸­æ¯ä¸ªåŠ¨ä½œå¯¹åº”çš„å‚æ•°$\theta_{i}(D_{t})$ã€‚æ¥ç€ï¼ŒThompson Samplingæ–¹æ³•ä¼šé€‰æ‹©ä½¿å¾—å¥–åŠ±æœŸæœ›æœ€å¤§çš„åŠ¨ä½œä½œä¸ºè¾“å‡ºã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š

1. åˆå§‹åŒ–å‚æ•°å‘é‡$\theta$ï¼šå°†æ‰€æœ‰åŠ¨ä½œå¯¹åº”çš„å‚æ•°å‡åˆå§‹åŒ–ä¸ºç›¸åŒçš„å€¼ã€‚
2. åœ¨æ¯æ¬¡é€‰æ‹©åŠ¨ä½œå‰ï¼š
   - æ ¹æ®å½“å‰çš„å‚æ•°å‘é‡$\theta$ç”Ÿæˆæ ·æœ¬é›†$D_{t}$ã€‚
   - å¯¹æ ·æœ¬é›†$D_{t}$ä¸­çš„æ¯ä¸ªåŠ¨ä½œiï¼Œåˆ©ç”¨è´å¶æ–¯ä¼°è®¡æ–¹æ³•ä¼°è®¡å…¶å‚æ•°$\theta_{i}(D_{t})$ã€‚
   - æ›´æ–°å‚æ•°å‘é‡$\theta$ï¼šå°†æ‰€æœ‰åŠ¨ä½œå¯¹åº”çš„å‚æ•°éƒ½æ›´æ–°ä¸ºç›¸åº”çš„$\theta_{i}(D_{t})$ã€‚
3. è¿”å›é€‰æ‹©çš„åŠ¨ä½œã€‚

## 3.åŸºæœ¬æ¦‚å¿µæœ¯è¯­è¯´æ˜
### 3.1 Action
AB Testè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€æœ‰ä¸¤ç§æˆ–è€…æ›´å¤šçš„é€‰é¡¹ä¾›æµ‹è¯•äººå‘˜è¿›è¡Œé€‰æ‹©ï¼Œç§°ä¹‹ä¸ºâ€œåŠ¨ä½œâ€ï¼Œä¾‹å¦‚æ–°é—»æ¨èç³»ç»Ÿä¸­å±•ç¤ºçš„æ–°é—»ç±»å‹ï¼Œå•†å“è´­ä¹°é¡µä¸Šçš„å•†å“åˆ†ç±»ç­‰ã€‚ä¸åŒçš„åŠ¨ä½œéœ€è¦åˆ†åˆ«è¢«èµ‹äºˆä¸åŒçš„æƒé‡ï¼Œæ‰èƒ½ä½“ç°å‡ºç”¨æˆ·å¯¹è¿™äº›é€‰é¡¹çš„åå¥½ç¨‹åº¦ã€‚

### 3.2 Reward
åœ¨AB Testè¿‡ç¨‹ä¸­ï¼Œä¸åŒçš„åŠ¨ä½œè¢«æµ‹è¯•è€…çœ‹åˆ°åï¼Œæµ‹è¯•è€…å¯èƒ½ä¼šç»™å‡ºå¯¹åº”çš„åé¦ˆï¼Œé€šå¸¸è¿™ä¸ªåé¦ˆå°±æ˜¯â€œæ”¶ç›Šâ€æˆ–è€…â€œæƒ©ç½šâ€ã€‚å¦‚æœæµ‹è¯•è€…ç‚¹å‡»å¹¿å‘Šï¼Œåˆ™æœ‰ä¸€å®šæ”¶ç›Šï¼›å¦‚æœæµ‹è¯•è€…æ²¡æœ‰ç‚¹å‡»å¹¿å‘Šï¼Œä½†æ˜¯ä»–ä¸æƒ³é”™è¿‡ï¼Œé‚£ä¹ˆå°±æœ‰ä¸€å®šçš„æƒ©ç½šã€‚ç”±äºä¸åŒçš„åŠ¨ä½œå¯èƒ½å¸¦æ¥çš„æ”¶ç›Šæˆ–æƒ©ç½šä¸åŒï¼Œæ‰€ä»¥éœ€è¦åœ¨å®é™…æµ‹è¯•ä¸­ç”±æµ‹è¯•è€…è‡ªè¡Œå®šä¹‰ã€‚

### 3.3 Thompson Sampling
Thompson Samplingçš„æ ¸å¿ƒæ˜¯å»ºç«‹å‚æ•°ç©ºé—´å†…çš„è´å¶æ–¯å…¬å¼ï¼Œç”¨ä»¥ä¼°è®¡ä¸åŒåŠ¨ä½œçš„å¥–åŠ±åˆ†å¸ƒã€‚å‡è®¾åŠ¨ä½œé›†åˆä¸º{a1, a2,..., an}ï¼Œå…¶ä¸­aiæ˜¯ä¸€ä¸ªäºŒå…ƒå‡½æ•°ï¼ˆæ¯ä¸ªåŠ¨ä½œéƒ½ç”±nç»´çš„ç‰¹å¾å‘é‡è¡¨ç¤ºï¼‰ï¼Œè¾“å‡ºai(Î¸)âˆˆ[0,1]ï¼ŒÎ¸ âˆˆ R^(nd+1)ï¼Œdä¸ºè¾“å…¥ç»´åº¦ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸ºï¼š

ai(Î¸)=ğœ’ (Î¸^T Xi), i=1...n

å…¶ä¸­X=(x1, x2,..., xn)^Tæ˜¯å‚æ•°å‘é‡ï¼ŒXi = (xi1, xi2,..., xid)^Tä¸ºåŠ¨ä½œaiå¯¹åº”çš„ç‰¹å¾å‘é‡ã€‚

ä½¿ç”¨Thompson Samplingï¼Œæµ‹è¯•è€…ä¼šæ ¹æ®å½“å‰çš„å‚æ•°å‘é‡Î¸ç”Ÿæˆæ ·æœ¬é›†Dï¼Œå†å¯¹æ ·æœ¬é›†è¿›è¡Œå‚æ•°ä¼°è®¡ï¼Œå¾—åˆ°æ¯ä¸ªåŠ¨ä½œå¯¹åº”çš„å‚æ•°Î¸i(D)ã€‚ç„¶åï¼Œæµ‹è¯•è€…ä¼šé€‰æ‹©ä½¿å¾—å¥–åŠ±æœŸæœ›æœ€å¤§çš„åŠ¨ä½œä½œä¸ºè¾“å‡ºã€‚ç›´è§‰ä¸Šï¼ŒThompson Samplingæ–¹æ³•ä¼šæ ¹æ®å½“å‰çš„æ ·æœ¬é›†Då¯¹å‚æ•°Î¸è¿›è¡Œä¸æ–­ä¿®æ­£ï¼Œä½¿å¾—é€‰æ‹©å‡ºçš„åŠ¨ä½œä¸çœŸå®æƒ…å†µè¶Šæ¥è¶Šä¸€è‡´ã€‚

## 4.æ ¸å¿ƒç®—æ³•åŸç†å’Œå…·ä½“æ“ä½œæ­¥éª¤ä»¥åŠæ•°å­¦å…¬å¼è®²è§£
### 4.1 æ¦‚å¿µéªŒè¯
ä¸ºäº†ç›´è§‚æ„Ÿå—Thompson Samplingæ–¹æ³•çš„æ€è·¯ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆçœ‹ä¸€ä¸ªç®€å•çš„éªŒè¯æ¡ˆä¾‹ï¼šå‡è®¾æœ‰ä¸¤ä¸ªå€™é€‰å¹¿å‘Šï¼Œåˆ†åˆ«ä»¥æ¦‚ç‡0.7å’Œ0.3å‡ºç°ï¼Œå¯¹åº”å¥–åŠ±åˆ†åˆ«ä¸º100å’Œ50å…ƒã€‚ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦æµ‹è¯•å“ªä¸ªå¹¿å‘Šæ•ˆæœæ›´å¥½ï¼Ÿå¯ä»¥æŒ‰ç…§AB Testçš„å¸¸è§„æµç¨‹ï¼Œæ‹›å‹Ÿä¸€æ‰¹ç”¨æˆ·ï¼Œè®©ä»–ä»¬åˆ†ç»„å‚åŠ æµ‹è¯•ï¼ŒåŒæ—¶è®°å½•ç”¨æˆ·çš„åé¦ˆä¿¡æ¯ï¼ˆç‚¹å‡»æˆ–æ²¡æœ‰ç‚¹å‡»ï¼‰ã€‚ä½†æ˜¯ï¼Œç”±äºæˆ‘ä»¬è¿˜ä¸çŸ¥é“å¹¿å‘Šçš„å‡†ç¡®è¡¨ç°ï¼Œå› æ­¤å¹¶ä¸èƒ½å‡†ç¡®è¡¡é‡å…¶æ•ˆæœã€‚äºæ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡å–ä¸€ç§ä¸å¤ªå¸¸ç”¨çš„æ–¹å¼ï¼šåªéœ€éšæœºåœ°åˆ†é…ç”¨æˆ·åˆ°ä¸¤ä¸ªå¹¿å‘Šç»„ä¸­ï¼Œè®©ç”¨æˆ·éšæœºçœ‹åˆ°ä¸¤ç§å¹¿å‘Šï¼Œç„¶åè®©ä»–ä»¬é€‰æ‹©å“ªä¸ªå¹¿å‘Šï¼Œå¹¶å‘Šè¯‰ä»–ä»¬ç›¸åº”çš„å¥–åŠ±ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬è¦éšæœºç”Ÿæˆä¸€ç»„nä¸ªç”¨æˆ·ã€‚å¯¹äºæ¯ä¸ªç”¨æˆ·ï¼Œæˆ‘ä»¬éƒ½ä¼šéšæœºåˆ†é…åˆ°å¹¿å‘Šç»„1æˆ–å¹¿å‘Šç»„2ä¸­ã€‚åœ¨å¹¿å‘Šç»„1ä¸­ï¼Œç”¨æˆ·çœ‹åˆ°çš„å¹¿å‘Šä¸ºç¬¬ä¸€æ¡ï¼Œç‚¹å‡»çš„æ¦‚ç‡ä¸º0.7ï¼Œå¦åˆ™æ²¡æœ‰ä»»ä½•å¥–åŠ±ï¼›åœ¨å¹¿å‘Šç»„2ä¸­ï¼Œç”¨æˆ·çœ‹åˆ°çš„å¹¿å‘Šä¸ºç¬¬äºŒæ¡ï¼Œç‚¹å‡»çš„æ¦‚ç‡ä¸º0.3ï¼Œå¦åˆ™æ²¡æœ‰ä»»ä½•å¥–åŠ±ã€‚ç„¶åï¼Œæˆ‘ä»¬è®©ç”¨æˆ·å®Œæˆæµ‹è¯•ï¼Œè¯¢é—®ä»–ä»¬æ˜¯å¦ç‚¹å‡»å…¶ä¸­ä¸€æ¡å¹¿å‘Šï¼Œå¹¶åŒæ—¶è®°å½•åé¦ˆä¿¡æ¯ã€‚é‡å¤ä»¥ä¸Šè¿‡ç¨‹næ¬¡ï¼Œå°±å¯ä»¥å¾—åˆ°ä¸€ä»½æ•°æ®é›†ã€‚

ç»è¿‡ç»Ÿè®¡åˆ†æï¼Œæˆ‘ä»¬å‘ç°å¹¿å‘Š1çš„å¹³å‡ç‚¹å‡»ç‡ä¸º0.75ï¼Œå¹¿å‘Š2çš„å¹³å‡ç‚¹å‡»ç‡ä¸º0.25ï¼ŒäºŒè€…ä¹‹é—´æœ‰æ˜¾è‘—å·®å¼‚ã€‚æ ¹æ®Thompson Samplingæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªå…·æœ‰ä¸ç¡®å®šæ€§çš„AB Testã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥æ¨¡æ‹Ÿä¸€ä¸‹Thompson Samplingæ–¹æ³•ï¼Œå¹¶è¯•å›¾å¯»æ‰¾å¹¿å‘Š1çš„æ›´å¥½ç‰ˆæœ¬ã€‚

### 4.2 æ¨¡å‹å»ºç«‹
åœ¨Thompson Samplingæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬éœ€è¦äº‹å…ˆå®šä¹‰å¥½å„ä¸ªå¹¿å‘Šçš„ç‰¹å¾å‘é‡Xiï¼Œç„¶åæ ¹æ®è´å¶æ–¯å…¬å¼ï¼Œç”¨å·²æœ‰çš„æ•°æ®è®­ç»ƒæ¨¡å‹ï¼Œä¼°è®¡å‡ºæ¯ä¸ªå¹¿å‘Šçš„æ¦‚ç‡åˆ†å¸ƒÏ†ï¼ˆadï¼ŒÎ¸ï¼‰ã€‚å…·ä½“çš„ï¼Œæˆ‘ä»¬å¯ä»¥è®°å¿†Î¸çš„å†å²å€¼ï¼Œç„¶åä¾æ®å·²æœ‰çš„è§‚æµ‹æ•°æ®å’Œç‰¹å¾å‘é‡æ„é€ å¯¹åº”çš„æ ·æœ¬é›†Dï¼Œä½¿ç”¨è´å¶æ–¯ä¼°è®¡æ–¹æ³•ï¼Œä¼°è®¡å‡ºÎ¸iï¼ˆadï¼‰çš„å…ˆéªŒåˆ†å¸ƒã€‚åˆ©ç”¨è¿™äº›ä¼°è®¡ç»“æœï¼Œæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®ä¸åŒçš„åˆ†é…ç­–ç•¥ï¼Œé€‰æ‹©å‡ºä¸åŒçš„å¹¿å‘Šã€‚

ä¸‹é¢ï¼Œæˆ‘ä»¬ç”¨Pythonè¯­è¨€æ¥å®ç°Thompson Samplingæ–¹æ³•ï¼Œå¹¶å¯¹Advert-1çš„æ•ˆæœè¿›è¡ŒéªŒè¯ã€‚

```python
import random

class Ad():
    def __init__(self, feature):
        self.feature = feature
        # é»˜è®¤å‚æ•°ä¼°è®¡å€¼ä¸º0.5
        self.params = [random.uniform(0, 1) for _ in range(len(self.feature)+1)]
    
    def estimate(self, dataset):
        n_obs = len(dataset)
        alpha = []
        beta = []
        for featVec in dataset:
            p_log = sum([feat*par for feat, par in zip(featVec, self.params)]) + self.params[-1]
            p = 1 / (1 + exp(-p_log))
            if int(round(p)):
                alpha += [1]
            else:
                beta += [1]
        alpha_mle = float(sum(alpha))/n_obs
        beta_mle = float(sum(beta))/n_obs
        newParams = [alpha_mle/(alpha_mle+beta_mle)] + self.params[:-1]
        return newParams
    
def thompson_sampling(adverts, users):
    results = {}
    ads = {idx: Ad(ad['feature']) for idx, ad in enumerate(adverts)}
    total_reward = 0
    for user in users:
        group = random.randint(1,2)
        chosen_advert = None
        max_expected_reward = -float('inf')
        for advert_idx, advert in ads.items():
            params = advert.estimate([[group]])
            expected_reward = params[0]*adverts[advert_idx]['reward'][0]/adverts[advert_idx]['weight'] \
                              + (1-params[0])*adverts[advert_idx]['reward'][1]/adverts[advert_idx]['weight']
            if expected_reward > max_expected_reward:
                max_expected_reward = expected_reward
                chosen_advert = advert_idx
        reward = 1 if group == chosen_advert else 0
        total_reward += reward * adverts[chosen_advert]['weight']
        results[user] = {'group': group, 'advert': chosen_advert,'reward': reward}
    print("The average reward is:", total_reward / len(users))
    return results
```

é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªç±»Adï¼Œç”¨äºå‚¨å­˜å•ä¸ªå¹¿å‘Šçš„ä¿¡æ¯å’Œå‚æ•°ä¼°è®¡ã€‚å®ƒçš„åˆå§‹åŒ–æ–¹æ³•æ¥æ”¶ä¸€ä¸ªç‰¹å¾å‘é‡ï¼Œè®¾ç½®é»˜è®¤çš„ä¼°è®¡å€¼ã€‚ç„¶åï¼Œæœ‰ä¸€ä¸ªestimate()æ–¹æ³•ï¼Œå®ƒæ¥å—ä¸€ä¸ªæ ·æœ¬é›†ï¼Œè®¡ç®—Î¸iï¼ˆadï¼‰çš„åéªŒåˆ†å¸ƒï¼Œå¹¶è¿”å›ä¼°è®¡çš„å‚æ•°å‘é‡ã€‚

æˆ‘ä»¬è¿˜å®šä¹‰äº†ä¸€ä¸ªå‡½æ•°thompson_sampling()ï¼Œå®ƒæ¥å—ä¸€ä¸ªå¹¿å‘Šåˆ—è¡¨å’Œç”¨æˆ·åˆ—è¡¨ä½œä¸ºè¾“å…¥ï¼Œå¹¶è¿”å›å…³äºç”¨æˆ·çš„å„ç§ä¿¡æ¯ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬åˆå§‹åŒ–æ‰€æœ‰çš„å¹¿å‘Šå¯¹è±¡ï¼Œå¹¶éšæœºç”Ÿæˆåˆå§‹å‚æ•°ä¼°è®¡ã€‚ç„¶åï¼Œå¯¹äºæ¯ä¸ªç”¨æˆ·ï¼Œæˆ‘ä»¬éšæœºåˆ†é…åˆ°å¹¿å‘Šç»„1è¿˜æ˜¯å¹¿å‘Šç»„2ä¸­ã€‚ç„¶åï¼Œæˆ‘ä»¬éå†å¹¿å‘Šåˆ—è¡¨ï¼Œå¯¹äºæ¯ä¸ªå¹¿å‘Šï¼Œè°ƒç”¨estimate()æ–¹æ³•ä¼°è®¡å‚æ•°å‘é‡ï¼Œè®¡ç®—å…¶å…³äºå¥–åŠ±çš„æœŸæœ›å€¼ï¼Œå¹¶æ¯”è¾ƒã€‚é€‰æ‹©å‡ºå…·æœ‰æœ€å¤§æœŸæœ›å€¼çš„å¹¿å‘Šä½œä¸ºæœ€ç»ˆé€‰æ‹©ï¼Œå¹¶è®¡ç®—ç”¨æˆ·çš„æ”¶ç›Šï¼Œå°†å…¶åŠ å…¥resultså­—å…¸ã€‚æœ€åï¼Œæ‰“å°å¹³å‡æ”¶ç›Šã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥æµ‹è¯•ä¸€ä¸‹Advert-1ï¼š

```python
if __name__ == '__main__':
    import json

    with open('advert-1.json', 'r') as f:
        data = json.load(f)

    adverts = [{'feature': fv,'reward': rv, 'weight': wv} for fv, rv, wv in zip(data['features'],
                                                                              [(100, 50)], [1])]

    users = list(range(10000))
    thompson_sampling(adverts, users)
```

è¿™é‡Œï¼Œæˆ‘ä»¬åŠ è½½äº†Advert-1çš„æ•°æ®ï¼Œæ„é€ äº†ä¸€ä¸ªå¹¿å‘Šåˆ—è¡¨ï¼Œå¹¶éšæœºç”Ÿæˆäº†10000åç”¨æˆ·ã€‚ç„¶åï¼Œæˆ‘ä»¬è°ƒç”¨thompson_sampling()å‡½æ•°ï¼Œå¹¶æ‰“å°å¹³å‡æ”¶ç›Šã€‚è¿è¡Œä¹‹åï¼Œæˆ‘ä»¬å¾—åˆ°çš„ç»“æœå¦‚ä¸‹ï¼š

```
The average reward is: 94.75
```

ä¹Ÿå°±æ˜¯è¯´ï¼ŒAdvert-1çš„æ•ˆæœç›¸å½“ä¸é”™ï¼Œç‚¹å‡»ç‡ç•¥é«˜äº0.5ã€‚