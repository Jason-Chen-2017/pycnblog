
作者：禅与计算机程序设计艺术                    

# 1.背景介绍


关系型数据库管理系统（RDBMS）是最常用的数据库系统之一，其设计理念与其它数据库系统有所不同。在企业级应用中，关系型数据库的用途十分广泛，对数据一致性、完整性等方面都具有极高的要求。但由于复杂的数据模型及多对多、多对一、一对多等关联关系的存在，关系型数据库难免会存在性能低下、数据冗余、数据不一致等问题。为了解决这些问题，人们提出了规范化理论，即数据库范式化理论。数据库范式化理论认为关系型数据库应满足某种模式才能保证数据的正确性、安全性及快速查询。它将关系型数据库分为五种不同的范式模型：第一范式（1NF），第二范式（2NF），第三范式（3NF），BCNF范式（BCNF），第四范式（4NF）。这几种范式之间的区别主要表现为数据冗余程度不同、数据依赖性不同以及数据更新方式不同。根据范式化理论，关系型数据库应符合第三范式或更高的范式模型才可提供高度的事务支持、并发处理能力和数据一致性。

范式设计是一个具有里程碑意义的问题。随着互联网的兴起、云计算的蓬勃发展、移动互联网的兴起等一系列新技术的推进，传统数据库逐渐失去效率和扩展性。为了应对这种技术革命带来的应用需求的变化，许多公司、组织和个人开始寻找一种新的数据库解决方案。其中，NoSQL和NewSQL这两种技术方向相当引人注目。NoSQL代表非关系型数据库，它的特点是灵活、动态、分布式的结构，易于横向扩展；而NewSQL则代表一种将关系型数据库和NoSQL结合的数据库，其兼顾了两者优点。

由于企业级应用对数据库的要求越来越高，数据库专家成为了IT部门的重要力量。数据库工程师必须熟悉数据库范式化理论，了解各种数据库范式的适用场景，能够进行范式转换、反范式设计、索引优化、分库分表等诸多工作。本专栏的作者从事数据库行业超过二十年的时间，积累了一定的经验和教训，希望通过这篇文章，抛砖引玉，帮助读者掌握数据库范式化理论的精髓，并顺利转型到NewSQL或NoSQL的时代。

# 2.核心概念与联系
## 1NF 第一范式(1st Normal Form)
**定义**：在计算机 science 中,第一范式（英语：First Normal Form，简称1NF）是指数据库设计中的第一个正交原则，也叫1NF，它规定一个关系模式只能有一个主键。简单地说，就是数据库表的每一列都是不可分割的原子值单元，即列的数据类型不能再分成其他集合。换句话说，1NF确保每一列都是单一数据项，即使该数据项是由多个元素组成的复合数据。

1NF 意味着表中的所有字段都是不可拆分的原子值项。因此，1NF模式的一个显著特征是没有重复的数据，也就是说，同一行不会有两个相同的值。这就意味着，对于任何查询来说，如果两个或更多行共享了一个相同的值，则这些行都会被合并起来。例如，假设有一个包含名称、地址、电话号码和电子邮件地址的Customers表，那么此表满足1NF。如果有两个或更多客户共享了相同的名称，他们将被合并到同一行中。

1NF 只允许单个表格中的每个字段包含一个值。在1NF中，每个记录或者行只有唯一标识符，而没有重复的属性或字段。如果一个关系模式属于1NF，则不应该出现以下情况：

- 多值属性：1NF要求每个字段的值都是不可分割的原子值，因此多值的属性无法存储。例如，一个实体类可以有多个姓名，但1NF中每个字段只存储一个值。

- 分层结构：1NF 不允许分层结构。例如，一个订单包括多个商品信息，而这些商品信息又包含多个货品信息，这种情况下属于分层结构。

- 存在依赖关系：1NF 不允许存在字段之间存在循环依赖关系。例如，一个订单可以依赖于它的用户ID，而用户ID可能依赖于订单ID。

## 2NF 第二范式(2nd Normal Form)
**定义**：第二范式（英语：Second Normal Form，简称2NF）是1971年由罗伊·费尔德在IBM的研究项目“EERD: Entity–Relationship Data Model and Query Language”的基础上提出的。它是数据库中的一个范式，描述了关系表中的数据如何围绕一个中心主键（primary key）而建立，并且确保关系数据中的每一个字段都直接依赖于主键，而不能间接依赖于主键。也就是说，第二范式的要求是消除非主关键字（non-prime attribute）对于主键的部分函数依赖，也就是说不能存在非主关键字决定主键的情况。

2NF 对关系表进行分解，消除了部分函数依赖。具体来说，第二范式采用“一对多”或“多对一”的依赖关系，这样就可以消除非主关键字对于主键的部分函数依赖。例如，一个客户可以有多个订单，但是每笔订单只能属于一个客户，因此不存在字段“订单号”作为主键，而要把“客户号”作为主键，然后通过“订单号”字段来连接两个表。

根据2NF，关系表中不得含有如下形式的字段依赖：

1. 属性A依赖于任何除主键外的属性，除了部分函数依赖（非主关键字部分决定主键）
2. 任何属性B依赖于任何包含在属性A中取值的部分

因此，2NF不仅限于主键与非主键，而且还要保证字段间的依赖关系不违反主体。

在实际应用中，2NF通常需要具备以下三个条件：

1. 在1NF基础上，实体关系中不存在字段间的循环依赖，也就是说，存在一个依赖链条可以直接或间接回到已知的某个实体（主键）。
2. 表中的各个字段都直接依赖于主键，不允许存在依赖于非主键的子集（候选键）。
3. 任何非主属性必须完全依赖于主键，而不是某个其他字段。

## BCNF范式 (Boyce-Codd normal form or 3NF)
**定义**：BCNF范式（英语：Boyce-Codd normal form，缩写为BCNF）是1979年由约翰·贝奇和莱昂哈德·科达一起提出的，它是基于关系代数理论的一套规则。与前述的范式不同的是，BCNF的原则是要尽量避免超键（superkey）的出现。BCNF只涉及对关系模型进行一个简单的重新排序，不涉及关系的选择或删除。简单来讲，BCNF保证关系模型没有“重复的部分”。

1NF和2NF给出了一些基本的原则，而BCNF却在此基础上给出了更加严格的条件。BCNF保证关系模型没有重复的部分，是基于简单关系代数的规律：

1. 每张关系表都可以看作是元组集，且不可以有传递依赖。
2. 对于任意的关系R(A1, A2,..., An)，其中Ai为域，即属性，满足其中的每个属性对应一个唯一的键值对，即主键。

具体来说，在BCNF中，不允许有以下情况发生：

1. 如果R存在超键，即键值组合能唯一确定元组，则该超键应被删除。例如，关系R(SNO, CNO, SNAME, CNAME, PHONE)的SNO和CNO构成了超键，因为它们能够唯一确定元组。超键中的任何一个属性都不能独立地决定元组，所以，SNO和CNO应被删除。
2. R中的任何属性不能够被另外一个关系表R'中以外的属性函数决定。

## 3NF 第三范式（Third Normal Form）
**定义**：第三范式（英语：Third Normal Form，简称3NF）是1992年由弗朗西斯·马丁·科德（<NAME>）、托马斯·海登·贝克（Tom Harding）和威廉姆·萨瑞德（William Saunders）共同提出的。它是一种更加宽松的范式，对数据冗余和不一致性较低的数据库设计是有益处的。这种范式相对于第二范式、第一范式等严格的范式是一种偏向于降低冗余的范式。

3NF基于BCNF，它在BCNF的基础上规定了属性不能够引用其他表的字段。具体来说，3NF将关系数据按尽可能少的字段划分成几个关系表，以便降低数据冗余和不一致性。

3NF要求关系数据不得有以下情形：

1. 一个关系表不能有超过两次以上的数据冗余。例如，在一个学生和他的课程的关系中，学生的姓名、班级、年龄等信息可以放入一个表中，而课程的信息可以放入另一个表中。但在这种情况下，同一个学生的姓名、班级、年龄等信息不能出现在不同的表中。
2. 一对多的关系不得跨越关系表边界。也就是说，一对多的关系只能出现在两个表中，不能出现在三张或更多的表中。
3. 非键属性不得依赖于键属性的子集。

在实际应用中，3NF要求关系数据模型中所有的依赖关系均必须遵守第三范式的原则。即不能出现如下情况：

1. 属性依赖其他属性，但不是完全依赖。
2. 属性不能够依赖于外键。
3. 属性不能依赖于多重外键。
4. 关系表之间不能存在传递依赖。
5. 数据集合的相似性不得超过一次。