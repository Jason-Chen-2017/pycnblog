
作者：禅与计算机程序设计艺术                    

# 1.简介
  

事件驱动架构（Event Driven Architecture）或者叫做事件溯源架构（Event Sourcing），是一种架构设计方法论，它将系统中的状态改变都视为事件记录，并在之后的状态查询时重新构建当前系统状态。这种架构的主要优点是在某些情况下可以简化复杂的业务逻辑，从而提高系统的可维护性、扩展性和容错能力。本文主要基于《软件架构设计与模式》第五章的内容，探讨事件驱动架构和Event Sourcing相关的理论和实践。

# 2.背景介绍
## 什么是事件驱动架构？

事件驱动架构（EDA）又称为事件溯源架构（ESA），是指用事件序列来描述系统中的状态转换或状态变化过程，并根据这些事件来重新计算当前系统状态。该架构的创始人格里芬·皮凡尔（Gerald Weinberg）于1999年发明了事件驱动架构，该架构通过建立一个基于事件的数据流模型来描述应用程序的行为，从而实现对系统行为的解耦和追踪。在其设计理念中，应用系统的所有行为都由事件的发生和传播所驱动，这些事件经过处理、存储和重放后形成完整的业务流程历史记录。

## 为什么要使用事件驱动架构？

事件驱动架构和Event Sourcing对于复杂的业务系统来说非常重要，因为它能够帮助解决以下两个主要问题：

1. 降低复杂性

   在传统的业务系统中，大多数功能通常是松散耦合的，导致它们难以理解、修改或扩展。事件驱动架构和Event Sourcing允许系统的各个部分之间进行高度解耦，进而促进系统的扩展和维护。它还可以简化复杂的业务规则，例如订单处理、库存管理、物流配送等，同时也减轻了开发人员的负担，让他们专注于更复杂的业务问题上。

2. 实现实时的可观察性

   通过建立事件数据流模型，事件驱动架构和Event Sourcing使得系统的运行状态变得透明、可测量和可监控。它提供了一种全新的角度来观察系统的行为，并且可以帮助发现和诊断一些难以捉摸的问题。此外，由于事件数据流模型中的所有数据都是实时的，因此可以提供实时的业务数据用于决策支持和预警系统。


## 事件驱动架构和Event Sourcing的定义

事件驱动架构：用事件序列来描述系统中的状态转换或状态变化过程，并根据这些事件来重新计算当前系统状态。它通过建立一个基于事件的数据流模型来描述应用程序的行为，从而实现对系统行为的解耦和追踪。事件驱动架构通常比传统的面向服务架构（SOA）结构更加灵活和模块化。

Event Sourcing：是一种用来对域对象生成事件日志的设计模式，其中每个事件都表示一个对象的状态变化。事件日志提供了一种有价值的方式来检索系统的状态变化，从而允许系统的任何部分可以被独立地更新、查询、分析和报告。

## EDA VS Event Sourcing

事件驱动架构和Event Sourcing都是用来实现“事件溯源”的两种方式，但是两者又有不同的特点。

- 事件驱动架构

    - 是一种构建在消息传递机制基础上的架构，利用事件流来建模系统的状态机
    - 更适合中小型系统，而且关注的是事件触发的而不是命令/请求
    - 可以将事件驱动架构与CQRS结合起来实现更细粒度的事件处理
    - 不能支持联合查询，需要另外的工具和机制来支持

- Event Sourcing

    - 是一种基于数据的日志记录机制
    - 更适合大的分布式系统
    - 对系统的外部查询可以返回最新的数据，因此更加实时和准确
    - 不支持复杂的事务处理，只能支持简单的数据更新和查询
    - 支持联合查询和复杂的事务处理

## EDA和Event Sourcing的比较

| | EDA | Event Sourcing |
|--|--|--|
| 定义 | 用事件序列来描述系统中的状态转换或状态变化过程，并根据这些事件来重新计算当前系统状态。 | 是一种用来对域对象生成事件日志的设计模式，其中每个事件都表示一个对象的状态变化。 |
| 适应场景 | 中小型系统 | 大型分布式系统 |
| 抽象层次 | 对象级别 | 数据级别 |
| 处理复杂事务 | 支持 | 不支持 |
| 查询支持 | 支持 | 支持 |
| 实时性 | 有限 | 无限 |
| 性能 | 慢 | 快 |