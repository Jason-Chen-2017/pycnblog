
作者：禅与计算机程序设计艺术                    

# 1.简介
         
Databricks 是由美国加州的一家初创公司——Amberdata 发起并建立起来的开源数据科学工作室。其产品云服务基于 Apache Spark 技术，支持超过十种数据源、云环境等，适合企业进行数据处理、分析、可视化等高端的大数据分析工作。Databricks 作为市场领先的云计算公司，其对大数据分析提供的服务已超越了商业部门的预期。随着 Databricks 在云服务中的地位越来越重要，Databricks 也在加速推出新的版本——Databricks 2.0，其全面升级后将成为 Apache Spark 的先驱者。在本文中，我会以 Databricks 2.0 为主题，详细介绍 Databricks 2.0 的新功能及其架构设计。
# 2.主要特性
- 分布式多租户运行环境
Databricks 提供了一整套的分布式多租户运行环境，使得多个团队或个人可以同时访问同一套资源，共享相同的集群配置和存储空间，并运行各自独有的作业任务，彼此之间互不干扰。
- 一键安装
Databricks 支持一键安装，用户只需要按照 Web UI 中的指示输入信息即可完成安装过程，而不需要复杂的操作系统配置。另外，Databricks 还提供了详细的报错提示，帮助用户排查错误，提升安装成功率。
- 用户友好的数据准备界面
Databricks 提供了一个直观的、用户友好的界面用于数据准备。除了支持 CSV 文件导入外，还可以通过 SQL、Python 或 Scala 来编写自定义脚本，方便用户导入其他类型的格式或结构化数据。通过简单易用的图形化界面，用户也可以轻松地查看数据的概览、统计信息和质量。
- 可视化库增强
Databricks 对可视化库做了增强，增加了对 TensorFlow、PyTorch、Pandas、Seaborn、Matplotlib 等常用 Python 数据分析库的支持，用户可以使用熟悉的 API 将数据转换成可视化的形式，更容易地理解数据间的联系。
- 动态伸缩群集
Databricks 使用自动调整的动态群集管理机制，根据集群资源利用率实时调整集群规模。当有更多任务需要执行时，Databricks 会自动创建新节点加入集群，避免过多占用资源造成性能下降。这种方式也减少了资源浪费。
- 安全性增强
Databricks 提供基于角色的权限控制，并集成了现代化的认证体系，帮助用户保障数据和作业的安全。它还内置了严格的访问控制列表（ACL），支持细粒度的用户控制，并支持无缝集成 Hadoop、Hive、Impala、Presto、Kudu 等第三方工具，统一管理和授权所有数据访问请求。
- 操作界面改进
Databricks 操作界面经过优化，更加简洁、直观，具有更强的交互性。用户可以在一个页面上看到多项数据分析任务的运行情况。同时，还支持通过拖放的方式快速构建数据分析工作流。
- 更丰富的机器学习算法支持
Databricks 2.0 提供了更多的机器学习算法，包括分类、回归、聚类、推荐系统、文本分析、图像识别、声音识别等，帮助用户实现更多的机器学习应用。
- 数据湖支持
Databricks 2.0 与 Cloudera Data Lake 集成，支持从云端直接访问、查询和写入数据湖中的数据。Data Lake 可以作为通用的高容灾备份、离线分析、存档、数据采集、数据倾斜等多种场景下的可靠数据源，为生产级数据分析工作流提供了更高的效率。
# 3.核心组件
Databricks 2.0 共分为四个核心组件，即 Workspace、Clusters、Repos、Jobs 和 Secrets。其中，Workspace 组件负责文件管理、代码协作、笔记编辑等工作，Clusters 组件用来启动和管理分布式计算集群，Repos 组件用来管理数据集市，Jobs 组件用来编排和监控长时间运行的任务，Secrets 组件用来保存机密数据，如密码和密钥等。
## 3.1 Workspace
Workspace 是一个基于浏览器的 IDE，允许用户在不离开浏览器的情况下，编写、调试和运行代码。用户可以打开本地编辑器或外部 IDE，并直接同步到 Databricks Cloud，以便于分享和协作。通过与 Databricks Repos 集成，Workspace 可以对 Databricks 框架内的任何文件类型进行版本控制、协作开发和分享。
![](https://img.wanghaoyun.cn/blog/images/20190716101225.png)
## 3.2 Clusters
Clusters 组件用来启动和管理分布式计算集群。用户可以创建单节点、多节点、容器化等各种类型的集群，并设置不同的资源分配。对于需要高性能计算的任务，用户可以选择高性能 GPU 节点或 CPU 节点。对于需要大内存的任务，用户可以选择内存优化的节点，以节省成本。Clusters 组件还支持基于社区的第三方平台，如 Amazon EMR、Google Dataproc 等，直接在 Databricks 中创建集群。
![](https://img.wanghaoyun.cn/blog/images/20190716101237.png)
## 3.3 Jobs
Jobs 组件用来编排和监控长时间运行的任务。用户可以创建提交批处理作业或交互式笔记，并设置不同的运行参数、依赖关系和通知策略。Jobs 组件还支持基于 Kubernetes 的超大规模集群调度系统，可以自动扩展、缩容集群资源。
![](https://img.wanghaoyun.cn/blog/images/20190716101247.png)
## 3.4 Repos
Repos 组件用来管理数据集市。用户可以把自己的代码库上传到 Databricks 云端，通过 Repos ，就可以像 Git、SVN 一样对代码进行版本控制、协作开发、分享和部署。Repos 可以与 Workspace 组件结合起来，让用户在同一个页面中对数据、代码和文档进行管理。
![](https://img.wanghaoyun.cn/blog/images/20190716101256.png)
## 3.5 Secrets
Secrets 组件用来保存机密数据。用户可以在不同组件中设置不同的凭据，包括用户名、密码、私钥等敏感数据，Secrets 组件可以加密存储这些数据，并保证它们安全。
![](https://img.wanghaoyun.cn/blog/images/20190716101307.png)
# 4.架构设计
Databricks 2.0 采用微服务架构，每个组件都由一组松耦合的服务构成，互相之间通过 RESTful API 通信。整个系统由中心仓库、客户端库、集群管理器、容器编排器、驱动程序和服务运行器五大模块组成。中心仓库用于存储共享的数据，客户端库用于与各个组件进行交互，集群管理器用于管理 Databricks 集群资源，容器编排器用于管理 Docker 镜像，驱动程序用于执行 Databricks 的内部任务，服务运行器则用于实际运行服务。架构如下图所示：
![](https://img.wanghaoyun.cn/blog/images/20190716101317.png)
# 5.总结
Databricks 2.0 是由 Amberdata 创立并开发的一款开源大数据分析平台。其提供了一整套分布式多租户运行环境，支持一键安装、用户友好的界面、可视化库增强、动态伸缩群集、安全性增强、操作界面改进、更多的机器学习算法支持、数据湖支持等新特性，使得企业能够快速、低成本、高效地处理大数据分析任务。

