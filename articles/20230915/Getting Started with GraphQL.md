
ä½œè€…ï¼šç¦…ä¸è®¡ç®—æœºç¨‹åºè®¾è®¡è‰ºæœ¯                    

# 1.ç®€ä»‹
  

GraphQLï¼ˆä¹Ÿå«åšGraph Query Languageï¼‰æ˜¯ä¸€ç§ç”¨äºAPIå¼€å‘çš„æ–°å…´æŸ¥è¯¢è¯­è¨€ï¼Œå®ƒè¢«Facebookã€GitHubç­‰å…¬å¸é‡‡ç”¨ï¼Œä¸ºAPIæä¾›æ›´ä¼˜é›…çš„æ•°æ®è·å–æ–¹å¼ã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»GraphQLçš„åŸºæœ¬æ¦‚å¿µã€åŸç†åŠç”¨æ³•ã€‚


# 2.èƒŒæ™¯ä»‹ç»
## 2.1 APIä»‹ç»
APIï¼ŒApplication Programming Interfaceï¼Œåº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼Œæ˜¯è®¡ç®—æœºç³»ç»Ÿä¹‹é—´è¿›è¡Œä¿¡æ¯äº¤æµçš„ä¸€ç§çº¦å®šä¿—æˆçš„è§„åˆ™ã€‚é€šè¿‡æ¥å£ï¼Œä¸€ä¸ªåº”ç”¨å¯ä»¥è®¿é—®å¦ä¸€ä¸ªåº”ç”¨æˆ–æœåŠ¡ä¸­çš„æ•°æ®æˆ–åŠŸèƒ½ï¼Œè€Œæ— éœ€è€ƒè™‘å…¶å†…éƒ¨å®ç°é€»è¾‘ã€‚æ¯”å¦‚ï¼Œæ‰‹æœºçš„æ“ä½œç³»ç»Ÿé€šè¿‡æ¥å£è°ƒç”¨åº”ç”¨å±‚çš„APIï¼Œä»è€Œå®ç°å„ç§æ“ä½œåŠŸèƒ½ï¼Œå¦‚æ‹ç…§ã€è¯»å–è”ç³»äººç­‰ã€‚åŒæ ·ï¼Œå¾®ä¿¡ã€æ”¯ä»˜å®ç­‰APPéƒ½æä¾›äº†å„è‡ªçš„APIï¼Œè®©ç¬¬ä¸‰æ–¹å¼€å‘è€…å¯ä»¥æ–¹ä¾¿åœ°é›†æˆè¿™äº›æœåŠ¡åˆ°è‡ªå·±çš„APPä¸­ã€‚



## 2.2 RESTful APIä»‹ç»
RESTful APIï¼ŒRepresentational State Transferï¼Œå³è¡¨è¿°æ€§çŠ¶æ€è½¬ç§»ï¼Œæ˜¯ä¸€ç§åŸºäºHTTPåè®®çš„WebæœåŠ¡æ¥å£è§„èŒƒï¼Œå®šä¹‰äº†å®¢æˆ·ç«¯å¦‚ä½•è¯·æ±‚æœåŠ¡å™¨èµ„æºå¹¶å¤„ç†å“åº”çš„æ ¼å¼ã€‚RESTfulé£æ ¼çš„APIä¸€èˆ¬éµå¾ªä»¥ä¸‹å‡ ä¸ªçº¦æŸæ¡ä»¶ï¼š

1. Client-Server: å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯åˆ†ç¦»ï¼Œå­˜åœ¨äº’ç›¸ä¾èµ–å…³ç³»ï¼›
2. Stateless: æ— çŠ¶æ€ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦è‡ªåŒ…å«çš„ä¿¡æ¯ï¼›
3. Cacheable: å¯ç¼“å­˜ï¼Œæ”¯æŒHTTPçš„ç¼“å­˜æœºåˆ¶ï¼›
4. Layered System: åˆ†å±‚è®¾è®¡ï¼Œå…è®¸ä¸åŒçº§åˆ«çš„ç¼“å­˜ï¼›
5. Code on Demand (optional): åªåœ¨éœ€è¦æ—¶æ‰ä¸‹è½½ä»£ç ï¼Œå³æŒ‰éœ€ä¸‹è½½ï¼ŒèŠ‚çœå¸¦å®½ã€‚

## 2.3 åŸºäºRESTful APIçš„ç¼ºç‚¹
è™½ç„¶åŸºäºRESTfulçš„APIè§„èŒƒå·²ç»æˆä¸ºäº‹å®ä¸Šçš„æ ‡å‡†ï¼Œä½†æ˜¯ä»ç„¶æœ‰ä¸€äº›ä¸è¶³ä¹‹å¤„ï¼š

1. æ•°æ®æ ¼å¼å›ºå®šï¼šä¼ ç»Ÿçš„åŸºäºRESTfulçš„APIæš´éœ²çš„æ˜¯JSONæˆ–è€…XMLè¿™æ ·çš„é™æ€æ•°æ®æ ¼å¼ï¼Œè€Œå¯¹äºåƒå›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘è¿™æ ·çš„åŠ¨æ€æ•°æ®ï¼Œåªèƒ½é€šè¿‡ä¸“é—¨çš„ä¸Šä¼ ä¸‹è½½APIè¿›è¡Œä¼ è¾“ã€‚å› æ­¤ï¼Œå¯¹äºç§»åŠ¨äº’è”ç½‘ç­‰æ–°å…´é¢†åŸŸï¼Œè¦æ±‚æœåŠ¡ç«¯æ”¯æŒå¤šç§æ•°æ®æ ¼å¼å°±æˆä¸ºä¸€ä¸ªæ–°çš„éœ€æ±‚ï¼›
2. å­¦ä¹ æ›²çº¿é™¡å³­ï¼šä½œä¸ºä¸€ä¸ªæ–°æŠ€æœ¯ï¼ŒåŸºäºRESTfulçš„APIå¹¶æ²¡æœ‰ç»Ÿä¸€çš„æ ‡å‡†è§„èŒƒï¼Œæ¯ä¸ªæœåŠ¡ç«¯çš„å®ç°æ–¹å¼å¯èƒ½åƒå·®ä¸‡åˆ«ï¼Œå¯¼è‡´åˆå­¦è€…å­¦ä¹ èµ·æ¥éå¸¸å›°éš¾ï¼Œå°¤å…¶æ˜¯åœ¨å›½å†…æœ‰ç½‘ç»œå®¡æŸ¥çš„æƒ…å†µä¸‹ï¼›
3. æœåŠ¡ç«¯æ€§èƒ½ç“¶é¢ˆï¼šRESTfulçš„APIå¾€å¾€éƒ¨ç½²åœ¨è½»é‡çº§çš„æœåŠ¡å™¨ä¸Šï¼Œè€Œä¸”èµ„æºè®¿é—®ä¸€èˆ¬ç”±æ•°æ®åº“å®Œæˆï¼Œå› æ­¤å¯¹äºæ•°æ®é‡å¤§çš„æœåŠ¡ï¼ŒæœåŠ¡å™¨çš„æ€§èƒ½ä¼šæˆä¸ºç“¶é¢ˆã€‚é’ˆå¯¹è¿™ä¸€é—®é¢˜ï¼Œå¾ˆå¤šæœåŠ¡ç«¯å¼€æºæ¡†æ¶ä¸ºäº†ä¼˜åŒ–æ€§èƒ½æå‡ºäº†ä¸åŒçš„è§£å†³æ–¹æ¡ˆï¼Œä¾‹å¦‚å¾®æœåŠ¡æ¶æ„ã€NoSQLæ•°æ®åº“ç­‰ï¼›
4. å¯¹å‰ç«¯å¼€å‘è€…çš„é™åˆ¶ï¼šç”±äºRESTfulçš„APIé€šè®¯é‡‡ç”¨HTTPåè®®ï¼Œå‰ç«¯å¼€å‘è€…å¿…é¡»ä¾èµ–äºXHRè¿™ç§æµè§ˆå™¨APIæ‰èƒ½å‘èµ·å¼‚æ­¥è¯·æ±‚ï¼Œè¿™å¯¹ä¸€äº›ä¸šåŠ¡é€»è¾‘ç®€å•çš„åœºæ™¯æ¥è¯´ï¼Œå¹¶ä¸å¤Ÿå‹å¥½ã€‚

# 3.åŸºæœ¬æ¦‚å¿µæœ¯è¯­è¯´æ˜
## 3.1 Graphqlæ¦‚è§ˆ
GraphQLæ˜¯ä¸€ä¸ªåŸºäºç°ä»£webæŠ€æœ¯æ„å»ºçš„æ•°æ®æŸ¥è¯¢è¯­è¨€ï¼Œèƒ½å¤Ÿæè¿°å’Œæ‰§è¡Œå¤æ‚çš„æŸ¥è¯¢ï¼Œå…·æœ‰å¼ºå¤§çš„åŠŸèƒ½ã€‚å®ƒçš„ä¸»è¦ç‰¹ç‚¹å¦‚ä¸‹ï¼š

1. Type Systemï¼šGraphQLç±»å‹ç³»ç»Ÿä¸­å®šä¹‰äº†æ•°æ®æ¨¡å‹ä¸­çš„å¯¹è±¡ç±»å‹ã€å­—æ®µç±»å‹ã€è¾“å…¥ç±»å‹å’Œæ¥å£ç±»å‹ç­‰ã€‚GraphQLä½¿ç”¨ç±»å‹ç³»ç»Ÿæ¥é©±åŠ¨APIï¼Œå®šä¹‰å…è®¸çš„æŸ¥è¯¢å’Œå…¶è¿”å›ç»“æœç»“æ„ã€‚
2. Schema Definition Language (SDL)ï¼šGraphQL SDLæ˜¯ç”¨äºå®šä¹‰GraphQLç±»å‹ç³»ç»Ÿçš„è¯­è¨€ã€‚å®ƒå¯ä»¥ç”¨æ¥å®šä¹‰ç±»å‹ã€å­—æ®µã€æšä¸¾å€¼å’Œå…¶ä»–GraphQLå…ƒç´ ã€‚
3. Queries and Mutationsï¼šGraphQLæ”¯æŒä¸¤ç§ç±»å‹çš„æŸ¥è¯¢è¯­å¥ï¼Œå³æŸ¥è¯¢å’Œå˜æ›´ã€‚æŸ¥è¯¢æ˜¯åªè¯»çš„ï¼Œä¸ä¿®æ”¹æ•°æ®çš„æ“ä½œï¼Œè¿”å›JSONæ ¼å¼çš„æŸ¥è¯¢ç»“æœï¼›å˜æ›´æ˜¯æŒ‡æ‰§è¡Œåˆ›å»ºã€æ›´æ–°æˆ–åˆ é™¤æ•°æ®çš„æ“ä½œï¼Œè¿”å›æ“ä½œæ˜¯å¦æˆåŠŸçš„å¸ƒå°”ç±»å‹ã€‚
4. Introspectionï¼šGraphQLçš„ç±»å‹ç³»ç»Ÿå¯ç”¨äºæœ‰æ•ˆåœ°å‘ç°GraphQL APIçš„èƒ½åŠ›ã€‚
5. Resolversï¼šGraphQLä½¿ç”¨Resolverså‡½æ•°æ˜ å°„æŸ¥è¯¢çš„å­—æ®µåˆ°ç›¸åº”çš„æœåŠ¡ç«¯æ•°æ®æºã€‚Resolversè´Ÿè´£è§£æç”¨æˆ·æŸ¥è¯¢è¯­å¥å¹¶è¿”å›æ‰€éœ€æ•°æ®ã€‚

## 3.2 æ¦‚å¿µè¯¦è§£
### 3.2.1 Types
GraphQLä½¿ç”¨ç±»å‹ç³»ç»Ÿæ¥é©±åŠ¨APIï¼Œæ‰€æœ‰çš„ç±»å‹éƒ½æœ‰ä¸€ä¸ªå…±åŒçš„åŸºç±»â€œç±»å‹â€ã€‚æ¯ç§ç±»å‹ä»£è¡¨ä¸€ç§ç‰¹å®šçš„å€¼ã€‚GraphQLæä¾›äº†äº”ç§åŸºæœ¬ç±»å‹ï¼š

1. Scalar typesï¼šæ ‡é‡ç±»å‹æ˜¯æœ€åŸºç¡€çš„ç±»å‹ï¼ŒåŒ…æ‹¬å­—ç¬¦ä¸²ã€æ•´æ•°ã€æµ®ç‚¹æ•°ã€å¸ƒå°”å€¼ç­‰ã€‚é™¤äº†è¿™äº›ç±»å‹å¤–ï¼Œè¿˜å¯ä»¥è‡ªå®šä¹‰ä¸€äº›æ–°çš„æ ‡é‡ç±»å‹ã€‚
2. Object typeï¼šå¯¹è±¡ç±»å‹æ˜¯GraphQLä¸­çš„å¤æ‚ç±»å‹ï¼Œå¯ä»¥åŒ…å«å¤šä¸ªå­—æ®µï¼Œå­—æ®µå¯ä»¥æ˜¯ç®€å•ç±»å‹æˆ–è€…å¦ä¸€ä¸ªå¤æ‚ç±»å‹ã€‚
3. Interface typeï¼šæ¥å£ç±»å‹ç±»ä¼¼äºC++é‡Œé¢çš„æŠ½è±¡ç±»ï¼Œå®ƒå®šä¹‰äº†ä¸€ç»„æ–¹æ³•ï¼ŒåŒ…æ‹¬å­—æ®µç­¾åã€å‚æ•°å’Œè¿”å›ç±»å‹ã€‚ä»»ä½•å®ç°äº†è¯¥æ¥å£çš„ç±»å‹éƒ½å¯ä»¥ä½¿ç”¨è¿™äº›æ–¹æ³•ã€‚
4. Union typeï¼šè”åˆç±»å‹æ˜¯æŒ‡ä¸€ä¸ªå¯¹è±¡å¯èƒ½æ˜¯ä¸€ä¸ªå®é™…çš„ç±»å‹ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªæ¥å£ç±»å‹ã€‚
5. Enum typeï¼šæšä¸¾ç±»å‹æ˜¯ä¸€ç»„å‘½åçš„å­—ç¬¦ä¸²å¸¸é‡ï¼Œå¯ä»¥é€šè¿‡åç§°ç›´æ¥è·å–å¯¹åº”çš„å¸¸é‡å€¼ã€‚

### 3.2.2 Fields
GraphQLå¯¹è±¡çš„å­—æ®µè¡¨ç¤ºå®ƒä»¬çš„å±æ€§ï¼Œæ¯”å¦‚Userå¯¹è±¡å¯èƒ½åŒ…å«firstNameã€lastNameã€ageç­‰å­—æ®µã€‚æ¯ä¸ªå­—æ®µéƒ½æœ‰ä¸ªåå­—å’Œç±»å‹ã€‚GraphQLä½¿ç”¨å­—æ®µè¡¨è¾¾å¼æ¥æŒ‡å®šæŸ¥è¯¢ç»“æœä¸­çš„å“ªäº›å­—æ®µåº”è¯¥åŒ…å«ã€‚

### 3.2.3 Arguments
GraphQLæ”¯æŒå‚æ•°ä¼ é€’ï¼Œå¯ä»¥åœ¨å­—æ®µã€å­—æ®µé€‰æ‹©å™¨ã€å˜é‡å’Œè‡ªå®šä¹‰æŒ‡ä»¤ä¸­è®¾ç½®å‚æ•°ã€‚å‚æ•°å¯ä»¥å¸®åŠ©æ§åˆ¶å­—æ®µçš„è¡Œä¸ºï¼Œæ¯”å¦‚è¿‡æ»¤ã€æ’åºç­‰ã€‚

### 3.2.4 Input objects
GraphQLå…è®¸è¾“å…¥å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œé€šè¿‡è¾“å…¥å¯¹è±¡å¯ä»¥æ‰¹é‡ä¼ å…¥å¤šæ¡æ•°æ®ã€‚

### 3.2.5 Directives
GraphQLæä¾›äº†è‡ªå®šä¹‰æŒ‡ä»¤ï¼Œå¯ä»¥å¯¹æŸ¥è¯¢ã€å­—æ®µå’Œå­—æ®µé€‰æ‹©å™¨æ‰§è¡Œé¢å¤–çš„æ“ä½œã€‚

### 3.2.6 Scalars
GraphQLå®šä¹‰äº†äº”ç§åŸºæœ¬çš„æ ‡é‡ç±»å‹ï¼ŒåŒ…æ‹¬Stringã€Intã€Floatã€Booleanã€IDã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥è‡ªå®šä¹‰ä¸€äº›æ–°çš„æ ‡é‡ç±»å‹ã€‚

### 3.2.7 Enums
GraphQLå…è®¸å®šä¹‰æšä¸¾ç±»å‹ï¼Œæšä¸¾ç±»å‹æ˜¯ä¸€ä¸ªå‘½åçš„å­—ç¬¦ä¸²é›†åˆï¼Œæä¾›äº†ä¸€ç§ç¬¦å·åŒ–çš„æ–¹å¼æ¥è¡¨ç¤ºä¸€ç³»åˆ—ç›¸å…³çš„å€¼ã€‚

### 3.2.8 Interfaces
GraphQLæ¥å£æ˜¯ä¸€ç»„æ–¹æ³•ç­¾åçš„é›†åˆï¼Œå¯ä»¥è®©ä¸åŒç±»å‹çš„å¯¹è±¡æ‹¥æœ‰ç›¸åŒçš„æ–¹æ³•ã€‚ä»»ä½•å®ç°äº†æŸä¸ªæ¥å£çš„ç±»å‹éƒ½å¯ä»¥è°ƒç”¨æ¥å£ä¸­çš„æ–¹æ³•ã€‚

### 3.2.9 Unions
GraphQLè”åˆç±»å‹å¯ä»¥è®©ä¸€ä¸ªå¯¹è±¡æ—¢å¯ä»¥æ˜¯æŸä¸ªç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯æŸç»„æ¥å£ç±»å‹ã€‚

### 3.2.10 Subscriptions
GraphQLæ”¯æŒè®¢é˜…åŠŸèƒ½ï¼Œè®¢é˜…å¯ä»¥è®¢é˜…æ•°æ®å˜åŒ–å¹¶æ”¶åˆ°é€šçŸ¥ã€‚

# 4.æ ¸å¿ƒç®—æ³•åŸç†å’Œå…·ä½“æ“ä½œæ­¥éª¤ä»¥åŠæ•°å­¦å…¬å¼è®²è§£
## 4.1 ä½¿ç”¨åœºæ™¯å’Œç¤ºä¾‹
### 4.1.1 ç”¨ä¾‹1ï¼šåˆ†é¡µæŸ¥è¯¢
å‡è®¾æœ‰ä¸€ä¸ªç”µå•†ç½‘ç«™ï¼Œç”¨æˆ·å¯ä»¥æµè§ˆå•†å“åˆ—è¡¨ï¼Œç‚¹å‡»æ¯é¡µæ˜¾ç¤ºæ›´å¤šæŒ‰é’®åŠ è½½æ›´å¤šå•†å“ã€‚å½“å‰é¡µé¢å•†å“åˆ—è¡¨çš„æ•°é‡ä¸º10æ¡ï¼Œå¸Œæœ›æ ¹æ®ç”¨æˆ·çš„åå¥½å¯¹å•†å“åˆ—è¡¨è¿›è¡Œæ’åºï¼Œæ’åºä¾æ®æ˜¯æŒ‰ç…§é”€å”®é‡é™åºæ’åˆ—ã€‚

```graphql
query {
  products(sort:"sales", limit:10){
    id
    name
    price
    sales
  }
}

mutation {
  updateProductSales($productId:$id, $saleCount:1){
    ok
  }
}
```

### 4.1.2 ç”¨ä¾‹2ï¼šGraphQLå®ç°æœç´¢å¼•æ“
å‡è®¾æœ‰ä¸€å¥—ç”µå­ä¹¦ç®¡ç†ç³»ç»Ÿï¼Œç”¨æˆ·å¯ä»¥æœç´¢ç”µå­ä¹¦çš„å†…å®¹ã€‚ç”¨æˆ·å¯ä»¥è¾“å…¥å…³é”®è¯ï¼Œé€šè¿‡GraphQLæŸ¥è¯¢åç«¯çš„æ•°æ®ï¼Œå¾—åˆ°åŒ¹é…çš„ç”µå­ä¹¦åˆ—è¡¨ã€‚GraphQLçš„schemaå¦‚ä¸‹ï¼š

```graphql
type Book {
  id: ID!
  title: String!
  author: Author!
  publisher: Publisher!
  publicationDate: Date!
  content: [Chapter]!
}

type Chapter {
  id: ID!
  title: String!
  content: String!
}

type Author {
  id: ID!
  firstName: String!
  lastName: String!
}

type Publisher {
  id: ID!
  name: String!
}

input SearchInput {
  keyword: String!
}

type Query {
  searchBooks(searchInput: SearchInput!, pageNumber: Int!, pageSize: Int!) : [Book!]!
}
```

Resolverå‡½æ•°çš„ä¼ªä»£ç å¦‚ä¸‹ï¼š

```javascript
function resolvers({ Book, Chapter, Author, Publisher }) {
  return {
    searchBooks(_, args) {
      const { searchInput, pageNumber, pageSize } = args;

      // åœ¨è¿™é‡Œä½¿ç”¨æ•°æ®åº“æŸ¥è¯¢åŠŸèƒ½ï¼Œæ£€ç´¢keywordåŒ¹é…çš„ç”µå­ä¹¦åˆ—è¡¨
      let books = database.getBooksByKeyword(searchInput);
      
      // æ ¹æ®é”€é‡æ’åº
      books.sort((a, b) => b.sales - a.sales);

      // è¿”å›æŒ‡å®šé¡µç å’Œæ¯é¡µå¤§å°çš„ç”µå­ä¹¦åˆ—è¡¨
      const start = (pageNumber - 1) * pageSize;
      const end = start + pageSize;

      return books.slice(start, end).map(book => ({
       ...book,
        chapters: book.content.map(chapter => ({
         ...chapter,
          __typename: 'Chapter'
        })),
        author: {
         ...book.author,
          __typename: 'Author'
        },
        publisher: {
         ...book.publisher,
          __typename: 'Publisher'
        },
        __typename: 'Book'
      }));
    }
  };
}
```

# 5.å…·ä½“ä»£ç å®ä¾‹å’Œè§£é‡Šè¯´æ˜
## 5.1 å®‰è£…é…ç½®GraphQLç¯å¢ƒ
å®‰è£…NodeJSå’Œnpmï¼Œç„¶åé€šè¿‡npmå®‰è£…GraphQLç›¸å…³åŒ…ï¼š

```bash
$ npm install express graphql apollo-server body-parser
```

åˆ›å»ºä¸€ä¸ªå…¥å£æ–‡ä»¶index.jsï¼Œå¹¶å¼•å…¥éœ€è¦ä½¿ç”¨çš„æ¨¡å—ï¼š

```javascript
const express = require('express');
const { ApolloServer } = require('apollo-server-express');
const bodyParser = require('body-parser');
```

åˆå§‹åŒ–ä¸€ä¸ªApolloServerå®ä¾‹ï¼š

```javascript
const server = new ApolloServer();
```

ä½¿ç”¨Expressæ¡†æ¶ï¼Œåˆ›å»ºä¸€ä¸ªè·¯ç”±å¹¶ç›‘å¬ç«¯å£ï¼š

```javascript
const app = express();
app.use('/graphql', bodyParser.json(), server.getMiddleware());
app.listen(port, () => console.log(`ğŸš€ Server ready at http://localhost:${port}/graphql`));
```

å¯åŠ¨ç¨‹åºï¼š

```bash
$ node index.js
```

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®http://localhost:3000/graphqlï¼Œå¯ä»¥çœ‹åˆ°GraphQL Playgroundç•Œé¢ã€‚
