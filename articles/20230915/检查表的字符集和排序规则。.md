
作者：禅与计算机程序设计艺术                    

# 1.简介
  

检查表（Check Table）在数据库中用来帮助用户快速了解数据库相关信息。它包括有关数据表结构、数据存储信息、数据库引擎版本、存储类型等的信息。当数据库中的字符编码、排序规则发生变化时，都可以通过检查表帮助用户做出相应调整。

本文将主要探讨SQLServer数据库的检查表，并对以下两个方面进行介绍：

1. 字符集和排序规则
2. 存储路径和文件名


# 2. 基本概念术语说明
## 数据表结构
数据表（Table）是关系型数据库中的基础数据单元。一个数据表由若干列（Column）和行（Row）组成，每一列对应于某个属性或对象的值，而每一行则代表一个记录。数据表可以存储任意类型的信息，如整数、日期、字符串、浮点数、逻辑值等。

## 数据存储信息
数据存储信息包括数据表所使用的存储模型（如堆表、聚集索引表），每个数据表的数据量大小、总字节数、空闲空间占比等。这些信息可帮助用户更好地了解数据库当前的资源使用情况。

## 数据库引擎版本
数据库引擎版本指的是数据库采用的SQL Server版本，例如SQL Server 2017/2019。如果数据库使用了不同的引擎版本，通过检查表就可以知道是否存在兼容性问题。

## 存储类型
存储类型指的是数据库的物理存储结构，例如内存中的表、磁盘上的日志文件等。存储类型决定了数据的检索速度、更新效率和查询灵活性。

# 3. 核心算法原理和具体操作步骤
## 字符集和排序规则
为了解决不同国家或地区的语言、符号、字母的使用问题，SQL Server提供了字符集和排序规则的功能。字符集（Charset）是指一种字符的集合，它定义了一个字符集中的所有字符的编号、名称和顺序。排序规则（Collation）是指用来比较或排序文本的规则。当创建或者修改表的时候，系统会根据指定的字符集和排序规则自动对文本进行编码和比较。

用户可以通过以下方式查看数据库的字符集和排序规则：

```sql
SELECT name, collation_name 
FROM sys.databases;
```

上面的语句查询到的结果表示数据库的默认字符集和排序规则。我们还可以指定数据库的默认字符集和排序规则。例如，如下语句设置了数据库的默认字符集为Chinese_PRC，排序规则为Chinese_PRC_CI_AS：

```sql
ALTER DATABASE database_name
COLLATE Chinese_PRC_CI_AS;
```

对于已经创建的表，也可以通过下面的命令查看其字符集和排序规则：

```sql
SELECT TABLE_NAME AS '表名', DATA_TYPE AS '字段类型', COLLATION_NAME AS '排序规则' 
FROM INFORMATION_SCHEMA.COLUMNS WHERE COLUMNPROPERTY(object_id('table_name'), column_name, 'IsIdentity') = 0
AND ISNULL(CHARACTER_MAXIMUM_LENGTH, -1) > 0;
```

上面的命令查询到的结果展示了所有用户定义的非标识字段的字符集和排序规则。

对于修改后的表来说，由于系统不允许直接修改表的字符集和排序规则，所以我们需要新建一个带有新字符集和排序规则的表，再将旧表数据迁移到新的表中。

## 文件夹位置和命名规范
SQL Server数据库的文件位置一般为 `C:\Program Files\Microsoft SQL Server\<version>\MSSQL15.MSSQLSERVER\MSSQL\DATA` 。其中 `<version>` 为SQL Server版本号。该文件夹下存放着所有的数据库文件。

为了管理方便，建议按照如下目录结构存放数据库文件：

```
|——DatabaseName1
  |——Data
    |——TableName1.mdf (数据文件)
    |——TableName1_log.ldf (事务日志文件)
  |——Log
  	|——TableName1_log.trc (跟踪日志)
  |——Temp
    |——tempdb.mdf (临时数据文件)
    |——tempdb.ldf (临时事务日志文件)
  |——Backup
    |——TableName1-full.bak (完整备份文件)
    |——TableName1-diff.bak (差异备份文件)
|——DatabaseName2
  |——Data
    |——TableName2.mdf 
    |——TableName2_log.ldf 
  |——Log
  	|——TableName2_log.trc 
  |——Temp
    |——tempdb.mdf 
    |——tempdb.ldf 
  |——Backup
    |——TableName2-full.bak 
    |——TableName2-diff.bak 

```

上面的目录结构示例中，`DatabaseName` 表示数据库的名称；`Data`、`Log` 和 `Temp` 分别用于存放数据库数据、日志文件、临时文件；`Backup` 用于存放数据库备份文件。

为了使目录结构更加清晰易懂，建议将同一个数据库的各种文件放在一起。另外，请注意将备份文件分开存放。