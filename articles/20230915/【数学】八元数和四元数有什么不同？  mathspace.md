
作者：禅与计算机程序设计艺术                    

# 1.简介
  

在计算机图形学、虚拟现实、神经网络等领域，有些研究人员把视觉(三维)与动觉(四维)统一起来，认为这两种表示方法之间存在着一定的联系。其中一种方法是八元数，而另一种方法则是四元数。两者之间有何区别，各自的优缺点又如何？
# 2.基本概念和术语
## 2.1 三维空间中三角测量中的欧拉角
欧拉角是指从笛卡尔直角坐标系到指定参考系的旋转角度。在使用三维空间时，需通过旋转变换将物体从一个位置移动到另一个位置。如图所示，物体可以沿三个轴（X、Y、Z）任意方向旋转，分别用三种角度来描述：A、B、C。如下图所示：


其中，z轴是摆动轴（又称为旋转轴），表示物体绕此轴进行旋转。该轴旋转角度θ表示绕Z轴旋转了多少度；y轴旋转角度ψ表示绕Y轴旋转了多少度；x轴旋转角度ω表示绕X轴旋转了多少度。由此可见，三维空间中的角度通常用欧拉角来表示。

## 2.2 四元数(Quaternion)
四元数也叫恒等型张量，是一个复数构成的四个数。在三维空间中，四元数的本质是用两个向量来描述空间旋转，第一个向量为单位圆锥上的一点，第二个向量指向该点的切线，这两个向量与空间中的任一矢量在正交关系下构成的张量，其内积表示旋转。因此，四元数不仅用来描述空间的旋转，还可以用来表示其他物理量，如平移、缩放等。

四元数的形式化定义为：
$$q = w + xi+yj+zk$$

其中w,x,y,z是实数，i,j,k都是虚数单位。由于虚数单位的存在，四元数也可以用它的分量表示：

$$q = w + \vec{v}$$

其中，$\vec{v}$是三维向量，是虚数单位的三个分量之和，即$v=(\xi+\lambda i,\ y+\lambda j, \ z+\lambda k)$，这里$\lambda$是一个实数，$i$, $j$, $k$都是实数。

## 2.3 八元数(Octonion)
八元数是四元数的推广，它不止含有三个虚数单位，还可以含有七个虚数单位。也就是说，一个八元数可以表示任意四维空间中的一个元素，如四元数所表示的空间旋转，加上三个三维向量（它们的合成，等于由球面上的一点到其切面的向量），就可以描述任意四维空间中的元素。

## 2.4 六元数(Sedenion)
六元数是八元数的推广，它可以表示任意六维空间中的元素。

# 3.核心算法原理和具体操作步骤以及数学公式讲解
下面详细讲述八元数和四元数的区别，以及如何使用它们来实现旋转变换。
## 3.1 八元数和四元数的区别
### （1）总结
* 八元数与四元数均采用四个数表示，只是个数的数量不同，八元数多了一个虚数单位而已。
* 四元数表示旋转，是由空间中任一矢量与单位圆锥上的一点在正交关系下构成的张量，其内积表示旋转，表示空间中的3D变换，包括平移和缩放；八元数除了表示旋转外，还可以表示其他物理量，如平移、缩放。

### （2）比较
* 欧拉角、四元数、旋转矩阵：欧拉角、四元数都用于描述空间中空间旋转，但是其表示方式不同，欧拉角是弧度制，四元数是形式自由的。而旋转矩阵是由数学家张伯特·爱德华·克罗克福(George Clark Klocraft)在19世纪末提出的，用于描述空间中刚体运动。
* 万向节、四视图、欧氏架：万向节和四视图都用来描述空间中位置，虽然都用三个参数表示空间中的位置，但是它们对同一位置的表示可能不同，如万向节采用非线性约束，四视图采用折叠约束。而欧氏架是最简单的局部坐标系，用两个三角坐标表示，描述空间中的位置。
* 海塞矩阵、柯西矩阵、四阶行列式：海塞矩阵、柯西矩阵都用来表示旋转矩阵，但只能表示3D空间中的刚体运动，而不能表示一般的空间旋转。而四阶行列式可以用来判断任意4x4矩阵是否可逆。

### （3）应用范围
* 沿轴旋转变换——欧拉角和四元数
* 旋转矩阵——三维空间刚体运动的表示
* 仿射变换——欧氏距离和齐次坐标
* 四维空间的旋转——八元数和六元数

## 3.2 使用八元数来实现旋转变换
对于任意一个平面上的曲面（如圆面或椭圆面），四元数可以用来表示其空间中的元素。当我们对这个曲面做旋转变换时，可以通过四元数的数值来实现。举例来说，设有一个二维椭圆曲面$E$，我们希望其沿着一定的角度$\theta$（顺时针方向的逆时针旋转）进行旋转。那么，我们就需要用到八元数的概念，如下图所示：


假定椭圆面中心$O$为原点，椭圆圆心$C$的坐标为$(a, b)$，倾斜角$\phi$为椭圆倾斜角，椭圆方程为：

$$F(x, y)=\frac{(x-h)^2}{a^2}+\frac{(y-k)^2}{b^2}-1=0$$

也就是说，椭圆的焦点$P$的坐标为$(-h,-k)$。设椭圆面在$SO(3)$空间中的旋转变换为$\vec{q}$，那么对应的四元数为：

$$q=\cos{\frac{\theta}{2}}+\sin{\frac{\theta}{2}}\cdot i+(1-\cos{\frac{\theta}{2}})x\cdot i+yx\cdot j-(zx)\cdot k$$

其中，$i^2+j^2+k^2+w^2=1$。由此，我们就可以求出椭圆面在旋转后新的中心$P'$的坐标$Q'=(a\cos\phi, b\sin\phi)$，其余各点的坐标可以通过复合四元数的旋转来得到。

注：一般情况下，椭圆面旋转不会出现奇异情况，即保持法向量不变。

## 3.3 四元数的性质
下面我们来讨论四元数的一些性质。

### （1）任意四元数的乘积
任意四元数$p=(p_w, p_x, p_y, p_z), q=(q_w, q_x, q_y, q_z)$的乘积为：

$$pq = (p_wq_w-p_xq_x-p_yq_y-p_zq_z, p_wp_x+p_wq_y-p_xp_y+p_yp_z-p_zq_x, p_wp_y+p_wq_z+p_xp_x-p_yp_y+p_zp_z, p_wp_z-p_wq_x+p_xp_y+p_yp_x-p_zp_y)$$

### （2）四元数的加法
两个四元数$p=(p_w, p_x, p_y, p_z)$和$q=(q_w, q_x, q_y, q_z)$的和为：

$$p+q = (p_w+q_w, p_x+q_x, p_y+q_y, p_z+q_z)$$

### （3）四元数的负号
对于四元数$p=(p_w, p_x, p_y, p_z)$，它的负号为：

$$-p =(p_w, -p_x, -p_y, -p_z)$$

### （4）单位四元数
如果四元数$p=(p_w, p_x, p_y, p_z)$满足：

$$p^2=-1\quad and\quad ||p||=1$$

那么，$p$就是一个单位四元数。

### （5）相似性
对于任意两个四元数$p=(p_w, p_x, p_y, p_z)$和$q=(q_w, q_x, q_y, q_z)$，如果它们满足：

$$p\cdot q=-q\cdot p$$

那么，$p$和$q$是相似的。

### （6）共轭四元数
对于任意四元数$p=(p_w, p_x, p_y, p_z)$，它的共轭四元数为：

$$p^{\star}=(p_w,-p_x,-p_y,-p_z)$$

它与$p$的和为零，并且它的乘积为$-1$.

### （7）角度和旋转向量
对于单位四元数$p=(p_w, p_x, p_y, p_z)$，它表示了角$\theta$和单位旋转向量$\vec{n}$，其中：

$$|\vec{n}|=1\quad and\quad |\vec{n}|^2=1$$

角度$\theta$可以通过以下方法计算：

$$\tan^{-1}\left(\frac{2(p_w\vec{i}_w+p_x\vec{i}_x+p_y\vec{i}_y+p_z\vec{i}_z)}{\sqrt{(p_w^2+p_x^2+p_y^2+p_z^2)(p_w^2+p_x^2+p_y^2+p_z^2)}}\right)\cdot 180^\circ$$

旋转向量$\vec{n}$可以通过以下方法计算：

$$\frac{2(p_w\vec{i}_w+p_x\vec{i}_x+p_y\vec{i}_y+p_z\vec{i}_z)}{\sqrt{(p_w^2+p_x^2+p_y^2+p_z^2)}}\cdot\hat{n}$$

## 3.4 使用四元数来表示三维空间中的刚体运动
刚体运动是指质点位移的物理过程。在三维空间中，可以使用刚体坐标系来描述刚体的位置和姿态。

### （1）基本概念
首先，定义刚体的质心位置$r_{c}$为：

$$r_{c}=r_c+t$$

其中，$r_c$为刚体的中心坐标，$t$为刚体运动的一组参数。参数集合$T$可以表示刚体的状态，可以用这些参数来控制刚体的运动。

接着，定义刚体的姿态$\eta=(\eta_1, \eta_2,..., \eta_d)$，$\eta_j$为刚体$j$轴的角速度，$R$为旋转矩阵，$R_j$为在$j$轴上的旋转矩阵，$e_j$为$j$轴的单位向量。旋转矩阵为：

$$R=\begin{bmatrix}R_{11}& R_{12}&...& R_{1d}\\ R_{21}& R_{22}&...& R_{2d}\\.\\.\\.\\. \\ R_{d1}& R_{d2}&...& R_{dd}\end{bmatrix}, \quad R_j=\begin{bmatrix}1& 0&\dots &0 \\ 0& cos\theta_j&\dots &-sin\theta_j\\.\\\.\.\.\\.\\ 0& sin\theta_j&\dots& cos\theta_j\end{bmatrix}$$

其中，$\theta_j$为角速度$\eta_j$对应的角度。刚体的位置可以表示为：

$$r_{ij}(t)=r_{ic}+R_j(t)\cdot e_j$$

其中，$r_{ic}$为刚体$i$轴的偏移。

### （2）使用四元数表示刚体姿态
为了方便地描述刚体的姿态，可以使用四元数$q_{\eta}$来表示。定义$\eta$和$e_j$的关系为：

$$\eta_j=\frac{2}{||e_j||}\vec{u}^te_j=\frac{2}{|\eta|}\vec{u}^tq_{\eta}$$

$\vec{u}$是一个单位长度的向量，用来表示任意轴。因此，我们只需要把角度$\theta_j$转换为四元数的形式就可以了。例如，假设$j=3$轴的旋转角度$\theta_3=30^\circ$，那么对应的四元数为：

$$q_{\eta}=\cos{\frac{\theta_3}{2}}, (\sin{\frac{\theta_3}{2}}x\cdot e_1+\sin{\frac{\theta_3}{2}}y\cdot e_2+\sin{\frac{\theta_3}{2}}z\cdot e_3)$$

这样，四元数就可以用来表示刚体的姿态了。