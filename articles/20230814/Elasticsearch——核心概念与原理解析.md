
作者：禅与计算机程序设计艺术                    

# 1.简介
  

什么是Elasticsearch?它是一个基于Lucene全文搜索引擎开源项目（Apache许可）的搜索服务器。由<NAME>于2007年创建，基于Java开发并作为Apache软件基金会的顶级项目进行维护。它提供了一个分布式、可靠、多租户的全文搜索引擎，支持RESTful Web接口。其主要特点如下：
- 面向文档存储：ElasticSearch的内部数据存储结构是索引（index），每个索引又包含一个或多个类型（type）。每一个类型都相当于关系型数据库中的表，而每条记录都是一个文档（document），它可以被理解成是一个JSON对象，里面可以包含不同字段的数据，比如字符串、数字、日期等。
- 分布式实时文件存储：ElasticSearch自带分布式的文件系统，能够存储和处理大规模数据，且具备高容错性和可用性。用户无需管理任何分片或者副本就可以扩展集群规模。
- 云计算搜索服务：ElasticSearch提供了开放平台，用户可以使用ElasticCloud上云的服务。还可以通过插件提供商那种基于ElasticSearch的商业产品。
- RESTful Web接口：ElasticSearch通过HTTP协议提供丰富的Restful API接口。用户可以使用简单的HTTP方法来执行索引、搜索、更新、删除等操作。
- 自动完成建议：ElasticSearch可以基于近似搜索来提供自动完成建议，用户可以在搜索框输入词汇后得到相关联的建议词汇。
- 大数据分析：ElasticSearch提供海量数据的实时分析能力，并且可以通过复杂查询语句来实现高级搜索功能。
- 查询分析器：ElasticSearch提供不同的查询分析器，使得用户可以按照自己的需求对搜索结果进行筛选和排序。
- 海量数据分析：ElasticSearch可以使用多种插件，如聚类分析、关联分析等，对海量数据进行快速分析。
- 可视化数据分析工具：ElasticSearch提供可视化数据分析工具Kibana，用户可以直观地看到数据分析结果。
- 滚动实时日志检索：ElasticSearch能够实时分析日志数据，并根据相关性提供滚动查询结果。
# 2.基本概念术语说明
## 2.1.索引（Index)
索引（Index）是用来存储数据的逻辑容器。一个索引可以包含多个文档（Document）、每个文档包含多个字段（Field）。索引可以被看做是一个大的数据库表。每个索引在ElasticSearch中都有一个唯一的名称。索引名称不能包含空格、逗号、句点字符，只能包含字母、数字、下划线、短横线字符。

例如，你有一个应用需要存储订单信息。你可以创建一个名为“orders”的索引，然后在这个索引下创建一个名为“order”的文档类型。每个订单对应一条文档，其中包含了订单编号、客户姓名、订单金额、创建时间等信息。

ElasticSearch官方要求索引名称不要用_all这个特殊的名称。所以，一般情况下最好使用自定义的索引名称。

## 2.2.文档（Document）
文档（Document）是存储数据的最小单位。它可以是一条用户评论、一张电影评论、一条交易记录等。一个文档必须属于一个索引，它可以有多个字段。每个文档都有一个唯一标识符_id。

例如，订单信息就是一个文档，它的唯一标识符是订单编号。

## 2.3.字段（Field）
字段（Field）是文档的属性。它包含两个元素：一个名字和一个值。字段支持不同的数据类型，如字符串、数字、日期、布尔值、数组、嵌套文档。字段的名称是动态的，即可以添加新的字段。

例如，订单信息可以有以下字段：订单编号、客户姓名、订单金额、创建时间等。

## 2.4.分片（Shard）
分片（Shard）是ElasticSearch中用于水平拆分的基础机制。当索引中的数据超过单个节点的磁盘大小限制时，ElasticSearch会将索引切割成多个分片，分布到集群中的各个节点上。每个分片都是一个Lucene的主从复制的完整的索引。

默认情况下，每个索引分配5个分片，可以通过设置参数number_of_shards来更改分片数量。分片的数量越多，索引的吞吐率也就越高，但同时也增加了内存消耗。

## 2.5.复制（Replica）
复制（Replica）是一种冗余机制，用来提高搜索性能和可靠性。当某个分片发生故障时，另一个分片可以接管失效分片的工作，保证集群中有足够的备份以应对节点的损坏、崩溃或者网络故障。

每个分片可以配置为1个或者更多的副本。如果一个分片有N个副本，那么该分片中至少存在N+1个副本，包括原始分片及其所有副本。

## 2.6.映射（Mapping）
映射（Mapping）定义了每个字段的数据类型和一些其他属性。映射定义完成后，ElasticSearch就会根据映射规则来验证和处理文档中所存储的值。

例如，对于订单信息来说，可以设置映射规则，指定订单编号和客户姓名都是字符串类型；订单金额和创建时间是数值类型，而且不能为负数。

## 2.7.文档ID（_id）
文档ID（_id）是一个动态生成的UUID，用来唯一标识一个文档。

文档ID的生成规则是随机的，不会重复，并且可以保证索引文档的顺序。

文档ID在对已有索引添加新文档的时候很重要。如果没有显式指定文档ID，ElasticSearch会自己生成一个。然而，如果手动设置了文档ID，那么相同的ID会导致文档冲突。所以，要确保索引文档的唯一性。