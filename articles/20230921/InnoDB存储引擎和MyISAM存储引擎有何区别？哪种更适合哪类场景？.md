
作者：禅与计算机程序设计艺术                    

# 1.简介
  

InnoDB存储引擎和MyISAM存储引擎是两个经典的关系型数据库系统的存储引擎。其中MyISAM存储引擎的历史比InnoDB要久一些，所以我们先来看一下两者之间的差异。
## 1.1 InnoDB与MyISAM的区别
### 1.1.1 数据存储形式不同
- MyISAM的数据是保存成文件，并且每个数据记录被存放在独立的文件中。
- InnoDB的数据是保存于表空间内，表空间是由若干数据页组成的一个整体，而每张表对应一个表空间。

### 1.1.2 索引支持
- MyISAM不支持索引，只能以全表扫描的方式进行查询。
- InnoDB支持行级锁定、事务处理、崩溃恢复等功能，并且还支持外键约束。

### 1.1.3 缓冲区管理机制
- MyISAM缓存整个数据库，直到执行关闭连接或销毁表时才释放内存。
- InnoDB采用缓冲池的机制，使得其可以脱机工作，即可以正常运行，即使数据库本身发生故障也不会影响其运行。

### 1.1.4 其它特性
- MyISAM支持全文检索，但不支持事务处理。
- MyISAM允许用户指定文件名及路径，方便移动表文件。
- InnoDB支持行级锁定和外键约束。

### 1.1.5 选择依据
从上述对InnoDB和MyISAM的了解之后，我们可以总结如下几点来帮助我们决定选用哪种存储引擎：
1. 查询频繁：如果应用的主要任务就是执行查询，而且数据的查询量非常大，则应该选择InnoDB存储引擎。因为InnoDB支持事务处理和行级锁定，在并发查询时能够提供比MyISAM更好的性能；
2. 更新频繁：如果应用需要执行大量的更新操作，或者需要保证数据完整性，则应该选择InnoDB存储引擎。因为InnoDB支持事务处理，当数据发生错误时，InnoDB提供了事务回滚和崩溃修复的功能，InnoDB通过锁定机制确保数据的完整性，从而保证了数据的一致性；
3. 需要外键：如果应用中存在外键约束，则应该选择InnoDB存储引擎。因为InnoDB支持外键，可以实现参照完整性，提高数据完整性；
4. 大容量写入：如果应用需要处理大量的写入操作，比如日志文件这种静态表，则应该选择MyISAM存储引擎。因为MyISAM不支持事务处理，所以写入速度快，占用的内存少；
5. 如果不是很确定，就都试试吧！

# 2. InnoDB存储引擎
## 2.1 InnoDB存储引擎特点
- 支持行级锁定：InnoDB支持行级锁定，是传统的数据库系统中最具备成熟并发控制能力的一种机制，它允许多个事务同时对同一行数据进行读写，但是仅限于这些语句所在的相同事务。同时，InnoDB通过两阶段提交协议实现了对锁的管理和释放，确保数据的安全性。
- 支持事务处理：InnoDB支持事务处理，这是数据库领域中的一个里程碑事件。它为数据库的ACID属性提供了保证，包括原子性（Atomicity）、一致性（Consistency）、隔离性（Isolation）、持久性（Durability）。InnoDB存储引擎会在插入数据之前自动开启事务，并且在事务结束时自动提交事务。
- 提供外键支持：InnoDB支持外键约束，是一个重要特征。你可以通过它建立起表间的引用依赖关系，也可以用来实现数据库的完整性。

## 2.2 InnoDB存储引擎架构
InnoDB存储引擎由表空间（tablespace），索引，数据字典，日志组成，如下图所示：
**表空间**：InnoDB存储引擎把所有的数据库对象（例如表，索引，视图，触发器）都统一地存放在表空间内，表空间是共享资源，因此它要求系统只支持单个实例的InnoDB存储引擎，不支持多实例部署。

**索引**: InnoDB存储引擎支持基于聚集索引和辅助索引两种类型的索引，通过不同的索引类型，InnoDB存储引擎可以最大化地发挥其性能优势。

**数据字典**：InnoDB存储引擎有一个特殊的地方，那就是它维护了一个自己的数据库字典，其中包含了关于数据库对象的一系列信息，包括表结构，字段定义，索引定义等。

**日志**：InnoDB存储引擎支持对数据的修改操作，并且将每次的修改操作都记录在日志中，这样可以在出现异常情况的时候，通过日志文件还原数据，保证数据的完整性。

## 2.3 InnoDB存储引擎使用场景
- 事务型应用：InnoDB存储引擎对事务的支持一直是各大关系数据库厂商争相推出的新产品或增强版产品，特别是在金融、零售、互联网、电信等互联网行业对高并发事务处理要求的情况下，InnoDB存储引擎具有良好的响应时间、吞吐量以及稳定性。

- 实时性要求高的应用程序：对于一些实时性要求比较高的应用来说，例如银行转账交易系统、互联网游戏平台、电视直播系统等，InnoDB存储引擎的性能至关重要，尤其是在OLTP和OLAP相互混合的场景下，InnoDB存储引擎的处理能力能够支撑业务需求。

- 长事务：在OLTP环境下，一条普通的INSERT或UPDATE语句执行的时间一般都较短，甚至可以忽略不计。但是，在某些业务场景下，一条UPDATE或DELETE语句可能会花费数分钟甚至几十分钟的时间，这就会导致长事务问题的产生。

- 高并发读写场景：对于需要频繁读写的业务场景来说，InnoDB存储引擎的性能比其他关系数据库存储引擎要好很多，尤其是在并发量大的情况下，InnoDB存储引擎的性能更胜一筹。

- 独特的数据访问模式：由于InnoDB存储引擎独有的索引组织方式，以及支持对事务的完整性保护等特性，在某些业务场景下，InnoDB存储引擎的表现要远远超出其他关系数据库存储引擎的表现。