
作者：禅与计算机程序设计艺术                    

# 1.简介
  

委托模式（Delegate pattern）是一种设计模式，允许对象将一些工作委托给其他对象执行，从而降低耦合度。继承可以被视为一种强大的机制来实现面向对象的多态性，然而当需要将工作委托给其他对象时，继承就显得不够灵活了。因此，在设计中应优先考虑委托模式。本文通过具体的例子，阐述了为什么要优先选择委托模式，并举出了一个实际的场景，在该场景下如何应用委托模式来解决问题。
# 2.相关概念及术语
- 抽象类（abstract class）:一个抽象类是不能直接创建对象的，它定义了一组接口方法或函数，它的子类必须重写这些方法，才能完成具体的功能。例如，java语言中的`java.lang.Object`。
- 委托类（delegate class）:委托类是一个类，它对另一个类的实例进行封装，并提供一组用于访问底层对象的方法。委托类负责维护底层对象的生命周期，并调用底层对象的方法，而不是自己实现相同的功能。
- 对象（object）:是指由内存空间分配，赋予标识符，并且能够接收消息的一段可执行代码。
- 方法（method）:是属于类的函数，用来处理输入数据或者提供输出数据的功能。
- 属性（attribute）:是代表对象的状态变量，即存储在内存中的值。
- 客户端（client）:是那些使用委托类（或其子类）创建的类的实例。
- 源（source）:指的是客户端在其源文件中的定义的类。
- 目标（target）:指的是委托类（或其子类）所委托的类的实例。
# 3.委托模式
## 3.1 概念
委托模式（Delegate Pattern）是面向对象编程中的一种设计模式。这个模式提倡把某些任务委派给依赖对象管理。这种模式涉及到一个称之为委托人的对象，它只负责任务的发起者或者经理。但是，它的工作流程却不受影响。委托人的职责就是通过自己的工作任务，让一个或多个代理对象来处理复杂的或者重复的任务，然后再收集结果反馈给委托人。

在委托模式中，主要包含以下四个角色：

1. 抽象主题（Abstract Subject）角色：抽象主题角色是最高层级的抽象类或接口，它为所有的具体主题（ConcreteSubject）角色提供统一的接口。抽象主题角色通常会声明一个指向具体主题角色的引用变量，供其子类去管理。同时，抽象主题角色还会声明出所有具体主题角色都共有的业务逻辑。

2. 具体主题（Concrete Subject）角色：具体主题角色是委托人的实体类，它是最原始的实体类，负责完成所有具体的业务逻辑。具体主题角色通常会提供一些属性和方法，供其子类使用。但是，具体主题角色并不应该过多地关注委托人的细节信息，因为委托人已经帮他做好了准备。同时，具体主题角色也不应该持有委托人的引用，因为对于其改变造成的影响无法预测。

3. 抽象代理（Abstract Proxy）角色：抽象代理角色是代理人的抽象类或接口，它定义了所有代理人都必须遵守的通用接口。抽象代理角色通常会声明一个指向委托人的引用变量，供其子类去引用。抽象代理角色还会声明出代理人所具有的业务逻辑接口。

4. 代理人（Proxy）角色：代理人角色是实际的委托人，它扩展了抽象代理角色，覆盖了其中的方法。代理人角色通常会持有指向具体主题角色的引用变量，通过调用其方法，来完成相应的任务。同时，代理人角色也会将请求转发给具体主题角色，从而实现委托人角色的功能。

一般来说，抽象主题角色和具体主题角色之间是比较弱的耦合关系，它们之间的通信交互较少。但是，在具体主题角色中，委托人的作用就体现出来了，具体主题角色的行为并不是由自己主动发起的，而是由委托人发起的。这种情况就引出了本文要讨论的问题——委托模式。

## 3.2 使用场景
### 3.2.1 当系统中存在大量的中介者对象时
由于中介者模式的缺点，在复杂的业务系统中，常常会产生大量的中介者对象。而使用委托模式之后，减少了中介者对象的个数，降低了耦合度，提升了系统的可读性和扩展性。而且，使用委托模式也可以避免因某个单一中介者对象出现问题导致整个系统崩溃的问题。

### 3.2.2 需要对客户隐藏内部结构
在系统设计中，某些对象可能因为某种原因需要屏蔽掉部分细节信息。这时候，就需要使用代理模式。对于这些对象来说，如果不使用代理模式，就意味着这些对象需要知道很多的私有实现细节。但使用代理模式后，就可以把私有信息隐藏起来，用户不需要知道，也无需了解对象的底层实现。另外，代理模式还可以根据需要动态地添加、修改、删除对象的功能。

### 3.2.3 控制访问时的权限和安全检查
在某些情况下，需要控制对对象的访问权限。比如，在公司里，只有特定人员才有权利访问一些特定的资源。这时候，可以使用代理模式来实现权限的控制。代理人只会为授权的用户提供服务，而禁止其他用户访问。

还有一种情况是，某些对象可能需要进行安全检查。比如，访问数据库时，需要检查用户名和密码是否正确。在这种情况下，可以利用代理模式，在代理人前面加入安全检查。代理人只会向正确的用户提供服务，而其他用户则被拒绝。