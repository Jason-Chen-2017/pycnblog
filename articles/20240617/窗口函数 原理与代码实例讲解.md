                 
# 窗口函数 原理与代码实例讲解

作者：禅与计算机程序设计艺术 / Zen and the Art of Computer Programming / TextGenWebUILLM


窗口函数（Window Function）是SQL中一种非常有用的聚合功能，它允许我们对一组相关记录进行操作。窗口函数通常在数据排序和分组的基础上执行计算。

### 窗口函数原理

窗口函数一般包含以下几个关键组件：

1. **OVER()**：定义一个“窗口”，其中指定的行集被视为一个整体。
2. **ORDER BY**：用于确定窗口中的行顺序。这通常是基于某个字段的值进行排序。
3. **ROWS BETWEEN OR RANGE BETWEEN**：用来定义窗口内的行范围。

### 代码实例 - 求每个部门的平均工资

假设你有一个名为 `employees` 的表，其中包含以下字段：

- `emp_id`: 员工ID
- `name`: 姓名
- `salary`: 工资
- `department`: 部门名称

下面是一个使用窗口函数来计算每个部门员工平均工资的例子：

```sql
SELECT 
    department,
    AVG(salary) OVER (PARTITION BY department) as avg_salary_per_dept
FROM employees;
```

这里：
- `AVG(salary) OVER (PARTITION BY department)` 是窗口函数的一部分。
- `PARTITION BY department` 表示我们要按照不同的部门分割数据，对于每一个部门的子集，计算平均工资。
- `AVG(salary)` 则表示我们对每一组内的 `salary` 进行平均运算。

### 实例解析

这个查询将返回一个结果集，包括每个部门及其对应的平均工资。通过这种方式，我们可以轻松地分析不同部门之间的薪资差异。

---

如果你有更具体的问题或者需要其他类型的窗口函数实例，请详细描述你的需求或问题背景，我会提供相应的帮助和解答！

