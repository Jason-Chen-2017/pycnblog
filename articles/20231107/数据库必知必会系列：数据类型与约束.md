
作者：禅与计算机程序设计艺术                    

# 1.背景介绍


## 数据类型概述
数据类型（data type）是指存储在一个数据库中的数据所属的类型、属性及其取值的集合。数据类型定义了如何将信息存储在计算机内，以及如何处理该信息。不同的数据库管理系统（DBMS），比如MySQL、Oracle等都提供了不同种类的数据类型。

一般来说，数据库中的数据类型分为四类:

1. 字符型(char):通常用于存储定长字符串，如名字、地址等；占用固定空间，缺省情况下为1或255个字符；

2. 数值型(numerics):用来存储整数、浮点数或者货币金额等数值数据；占用固定长度的存储单元；

3. 日期时间型(date/time types):用于存储日期和时间数据；包括DATE、DATETIME、TIMESTAMP、TIME、YEAR等；

4. 其它类型(others):如bit、text、blob等。

除此之外，还有一些特定数据库的特定数据类型，如SQL Server中的hierarchyid数据类型。由于各数据库厂商对这些数据类型的支持程度不一，所以我们在这里只做简要介绍。

## 约束概述
约束（constraint）是一个数据库内部的规则。它限制了数据库中表格的结构、定义、插入和删除的数据。当违反了某个约束时，数据库系统会自动生成一个错误消息并拒绝执行相应的SQL语句。约束可以应用于单个列、多列、表、触发器、视图和存储过程上。约束也可以帮助保证数据的完整性、统一性、一致性以及安全性。

常用的约束类型包括以下几种：

1. NOT NULL:确保字段不能为NULL；

2. UNIQUE:确保字段值的唯一性；

3. PRIMARY KEY:唯一标识一个记录，并且不能为空；

4. FOREIGN KEY:用来表示两个表之间的关系；

5. CHECK:用来限定字段值的范围；

6. DEFAULT:默认值；

7. INDEX:加速检索速度的一种索引机制。

本文主要讨论数据类型和约束两个主题，并从理论上阐述它们的功能、区别和联系。希望通过阅读本文，读者能更好地理解数据库中的数据类型和约束，并运用到实际生产环境中。
# 2.核心概念与联系
## 数据类型
### 数值型
数值型用于存储整数、浮点数或者货币金额等数值数据，可分为整型、浮点型、定点型、浮动类型等。整型（integer）是指没有小数点的数字，包括tinyint、smallint、mediumint、int、bigint等。其中，tinyint最大值为2^8-1，SMALLINT最大值为2^16-1，MEDIUMINT最大值为2^24-1，INT最大值为2^32-1，BIGINT最大值为2^64-1。例如：
```mysql
CREATE TABLE myTable (
    id INT AUTO_INCREMENT PRIMARY KEY,
    age TINYINT UNSIGNED ZEROFILL, -- 无符号整数
    height SMALLINT SIGNED ZEROFILL, -- 有符号整数
    weight MEDIUMINT UNSIGNED ZEROFILL,
    score FLOAT UNSIGNED ZEROFILL, -- 浮点数
    salary DECIMAL(10,2) UNSIGNED ZEROFILL, -- 定点数
    check (age >= 0 AND age <= 120),
    unique key idx_height (height)
);
```
### 字符型
字符型用于存储定长字符串，如名字、地址等。有VARCHAR、CHAR、BINARY三种字符类型，它们的区别如下：

1. VARCHAR：可变长字符串，在创建表时，给定其最大长度，如果输入的值超过这个长度，则截断或空值填充。

2. CHAR：定长字符串，创建表时需要指定其长度。长度过短则在后面补空格，长度过长则截断。

3. BINARY：二进制字符串，类似于CHAR，但所有数据都以二进制形式存入。

例如：
```mysql
CREATE TABLE myTable (
  name VARCHAR(50) NOT NULL,
  addr CHAR(100),
  email VARBINARY(100)
);
```
### 日期时间型
日期时间型用于存储日期和时间数据，包括DATE、DATETIME、TIMESTAMP、TIME、YEAR等。

1. DATE：日期类型，表示年月日，如'2020-09-10';

2. DATETIME：日期时间类型，表示年月日、时分秒，精度为0~6，如'2020-09-10 12:00:00';

3. TIMESTAMP：时间戳，存储方式与DATETIME相同，但它的存储空间比DATETIME少。

4. TIME：时间类型，表示时分秒，精度为0~6，如'12:00:00';

5. YEAR：年份类型，仅存储年份。

例如：
```mysql
CREATE TABLE myTable (
  created_at DATETIME NOT NULL,
  last_modified_at TIMESTAMP NOT NULL,
  birthday DATE NOT NULL,
  start_time TIME,
  year YEAR NOT NULL
);
```
### 其它类型
其它类型包括bit、text、blob等。bit类型用于存储位模式数据，如true/false；text和blob类型用于存储文本和二进制数据，不过它们都可以设置最大长度。

例如：
```mysql
CREATE TABLE myTable (
  flag bit(1) NOT NULL,
  content text NOT NULL,
  picture blob NOT NULL
);
```
## 约束
### NOT NULL
NOT NULL约束用于防止字段为空值。它是最基本的约束，如果试图向非空字段插入NULL值，则会报出错误。

例如：
```mysql
CREATE TABLE myTable (
  id int not null primary key,
  name varchar(50) not null,
  address char(100)
);
```
### UNIQUE
UNIQUE约束用于确保字段值的唯一性。如果试图向已经存在的值插入新值，则会报出错误。

例如：
```mysql
CREATE TABLE myTable (
  id int not null primary key,
  name varchar(50) not null,
  phone varchar(20) unique
);
```
### PRIMARY KEY
PRIMARY KEY约束用于定义主键。主键必须唯一且不能为空。一个表只能有一个主键。

例如：
```mysql
CREATE TABLE myTable (
  id int not null primary key,
  name varchar(50) not null,
  phone varchar(20) unique
);
```
### FOREIGN KEY
FOREIGN KEY约束用于定义外键。它要求两个表的列必须存在参照关系，并确保参照关系上的一致性。

例如：
```mysql
CREATE TABLE order_table (
  order_id INT NOT NULL AUTO_INCREMENT,
  customer_name VARCHAR(50) NOT NULL,
  employee_id INT NOT NULL,
  PRIMARY KEY (order_id),
  FOREIGN KEY (employee_id) REFERENCES employees(employee_id)
);
```
### CHECK
CHECK约束用于限制字段值的范围。它可以指定表达式，只有满足表达式才能插入或更新字段。

例如：
```mysql
CREATE TABLE myTable (
  id int not null primary key,
  age int,
  constraint chk_age check (age between 0 and 120)
);
```
### DEFAULT
DEFAULT约束用于指定字段的默认值。在插入数据之前，如果没有明确指定值，则会使用默认值。

例如：
```mysql
CREATE TABLE myTable (
  id int not null primary key,
  name varchar(50) default 'unknown',
  price decimal(10,2) default 0
);
```
### INDEX
INDEX约束用于加速检索速度的一种索引机制。一个索引可以帮助优化WHERE子句，ORDER BY子句，GROUP BY子句和JOIN子句。

例如：
```mysql
CREATE TABLE myTable (
  id int not null primary key,
  name varchar(50) not null,
  index idx_name (name)
);
```