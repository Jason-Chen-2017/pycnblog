
作者：禅与计算机程序设计艺术                    

# 1.简介
         
 DNS（Domain Name System）域名系统，它是TCP/IP协议簇中的一项服务，用于将域名转换成IP地址，也可以把IP地址转化为对应的域名。而域名解析就是将域名转换为IP地址的过程。目前，域名解析分为两种模式：递归查询和迭代查询。本文主要介绍这两种模式的区别及其应用场景。
          # 2.DNS的基本概念与术语 
          DNS的基本术语如下表所示:
        | 术语 | 解释|
        |:-------|:-------:|
        | 域名服务器 | 负责保存域名和IP地址之间的映射关系，并提供相应的域名解析服务。每个域名服务器都拥有一个或多个域名。域名服务器向DNS客户机返回域名解析结果。|
        | 顶级域名服务器 | 由各国的ICANN（Internet Corporation for Assigned Names and Numbers）管理，包括com、org、net、edu等，这些域名服务器通常直接缓存了互联网上最常用的域名解析记录。|
        | 权威域名服务器 | 由当地IT部门管理，提供各种域内资源信息。权威域名服务器一般会缓存域内所有主机的IP地址信息，实现本地域名解析。|
        | 本地域名服务器 | 也称作客户端域名服务器或者stub域名服务器，通常部署在用户的设备上，主要负责接收来自客户端的DNS请求，从本地缓存中查找响应结果，并向其他域名服务器请求进行辅助解析。|
        | 域名 | 用树状结构表示的互联网域名，例如www.baidu.com，包含多级子域名。顶级域名TLD（如.com.org.cn等）都是通过委托给各地ICANN管理的权威域名服务器注册的。|
        | IP地址 | 每个网络连接设备都有唯一的数字标识，叫做IP地址，IP地址可以是IPv4和IPv6两个版本。IPv4的IP地址由32位组成，每8位对应一个10进制数，范围从0.0.0.0到255.255.255.255。IPv6的IP地址由128位组成，每4位对应一个16进制数，范围从0:0:0:0:0:0:0:0到FFFF:FFFF:FFFF:FFFF:FFFF:FFFF:FFFF:FFFF。|
        | 次级域名 | 在同一级域名下，子域名是指具有相同根域名的不同二级域名。比如baidu.com 和 baidu.net 是属于同一级别的二级域名，它们的根域名是baidu.com。|
        | CNAME记录 | Canonical Name Record的缩写，用于将域名（主域名）别名（附加域名）绑定，如www.example.com可以指向www.test.example.com。CNAME记录不会经过递归解析，只能解析本地存在的别名。但是，当权威域名服务器收到CNAME记录时，会给出它的真实值，从而完成域名的解析工作。|
        | MX记录 | Mail eXchange Record的缩写，用于指定邮件服务器，如mx.example.com指向邮箱服务器。MX记录在给定域名下，只能有一个，是MX优先级高于A记录的一种方式。|
        | A记录 | Address Record的缩写，用于指定域名对应的IP地址。A记录只能存在一条，如果同时存在A记录和MX记录，则MX记录无效。|
        | NS记录 | Name Server Record的缩写，用于指定域名的域名服务器地址。NS记录通常会在顶级域名服务器上配置，是域名的权威服务器。|
        # 3.DNS递归查询与迭代查询 
        DNS的两种查询模式分别为递归查询和迭代查询。
        ## 3.1 DNS递归查询
        递归查询又称迭代查询，顾名思义，即查询服务器回应客户机的请求直到得到最终响应结果。DNS递归查询需要客户机先向本地域名服务器发送请求报文，然后该服务器根据本地数据库查询后，再向本地域名服务器发送请求，以此类推，直到域名服务器收到最终的请求响应报文。 
        图1显示了递归查询的过程，其中请求报文经过本地域名服务器（Local Domain Name Server, LDNS）解析后，被传递到默认路由器。路由器根据本地数据库对目标域名进行相应记录查询，找到后发送响应报文，客户机接收到响应报文后，读取响应结果即可。 
        递归查询的优点是简单易用，缺点也是很明显的，如果某个中间服务器故障导致域名解析失败，整个解析链路就会因此失败，并且查询的层次可能会增加，导致解析时间延长。
       ![img](https://pic1.zhimg.com/80/v2-19d0a7f33d03080d3bcfa13c48e75dc7_720w.jpg)
        <center>图1 DNS递归查询</center>
        
        ## 3.2 DNS迭代查询 
        迭代查询是指查询服务器不回应客户机的请求，而是通知客户机去联系其它域名服务器，由其继续查询，直到得到最终响应结果。迭代查询的过程类似于TCP三次握手过程，首先建立连接，客户端向服务器端发送请求报文，服务器端接收到请求报文之后，返回确认消息，随后客户端开始查询域名解析记录。 

        图2显示了迭代查询的过程。在迭代查询过程中，DNS客户机只与域名服务器通信一次，不需要每次都查询所有的中间服务器。在初始阶段，客户机查询本地域名服务器是否有要查找的域名的解析记录；如果没有，则向上级域名服务器查询；若上级域名服务器仍然找不到，则向其它域名服务器查询；最后，获得最终域名解析记录。

        迭代查询的优点是速度快，不会受到任何中间服务器的影响；缺点则是复杂程度较高，且无法保证最终解析结果的正确性。迭代查询适合需要快速解析域名的场景，例如手机APP的翻译功能、浏览器的自动填充功能等。
       ![img](https://pic2.zhimg.com/80/v2-41bf2d18d04b5fc5d5c5105eb94f0a5c_720w.jpg)
        <center>图2 DNS迭代查询</center>

