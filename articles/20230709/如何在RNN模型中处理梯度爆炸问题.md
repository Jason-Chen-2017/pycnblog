
作者：禅与计算机程序设计艺术                    
                
                
98. 如何在RNN模型中处理梯度爆炸问题
========================

在自然语言处理、语音识别等任务中，循环神经网络（RNN）模型被广泛应用。然而，在训练过程中，可能会出现梯度爆炸的问题，即在模型训练过程中，梯度的计算过程中出现异常，导致梯度爆炸。这种情况下，梯度的计算公式将不再适用，需要使用一些特殊的技术来处理这个问题。本文将介绍如何在RNN模型中处理梯度爆炸问题，包括技术原理、实现步骤与流程、应用示例以及优化与改进等方面。

1. 技术原理及概念
---------

在RNN模型中，梯度的计算是通过反向传播算法来实现的。具体来说，使用链式法则计算梯度：

$$\frac{\partial J}{\partial     heta_i}=\sum_{j=1}^{n-1}a_{ij} \frac{\partial a_{j}}{\partial     heta_i}$$$$=\sum_{j=1}^{n-1}a_{ij} \frac{\partial^2 a_{j}}{\partial     heta_i^2}$$$$=\sum_{j=1}^{n-1}a_{ij} (a_{j} \frac{\partial a_{i}}{\partial     heta_i}) = \sum_{j=1}^{n-1}a_{ij} a_{j} \frac{\partial a_{i}}{\partial     heta_i}$$$$=\sum_{j=1}^{n-1}j a_{ij} a_{j}$$

然而，在实际应用中，由于反向传播算法的特殊性，当梯度计算过程中出现异常时，可能会导致梯度爆炸。为了解决这个问题，我们需要对梯度进行一些处理，使得计算过程更加稳定。

1.1. 背景介绍
---------

在训练过程中，如果出现梯度爆炸的问题，首先需要对数据进行一些预处理，比如对数据进行清洗、标准化等操作，以消除数据中的异常值。此外，还可以通过调整学习率、激活函数等参数来影响模型的训练过程，使得模型更加稳定。

1.2. 文章目的
---------

本文旨在探讨如何在RNN模型中处理梯度爆炸问题，以及如何通过预处理和调整参数等方法来提高模型的训练稳定性。

1.3. 目标受众
---------

本文主要面向自然语言处理、语音识别等领域的技术从业者，以及对RNN模型有一定了解的读者。

2. 技术原理及概念
---------

2.1. 基本概念解释
---------

在RNN模型中，梯度的计算是通过反向传播算法来实现的。具体来说，使用链式法则计算梯度：

$$\frac{\partial J}{\partial     heta_i}=\sum_{j=1}^{n-1}a_{ij} \frac{\partial a_{j}}{\partial     heta_i}$$$$=\sum_{j=1}^{n-1}a_{ij} \frac{\partial^2 a_{j}}{\partial     heta_i^2}$$$$=\sum_{j=1}^{n-1}a_{ij} (a_{j} \frac{\partial a_{i}}{\partial     heta_i}) = \sum_{j=1}^{n-1}a_{ij} a_{j} \frac{\partial a_{i}}{\partial     heta_i}$$$$=\sum_{j=1}^{n-1}j a_{ij} a_{j}$$

然而，在实际应用中，由于反向传播算法的特殊性，当梯度计算过程中出现异常时，可能会导致梯度爆炸。为了解决这个问题，我们需要对梯度进行一些处理，使得计算过程更加稳定。

2.2. 技术原理介绍
---------

在实际应用中，可以通过对梯度进行以下处理来避免梯度爆炸：

$$\frac{\partial J}{\partial     heta_i}=\sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j}}{\partial     heta_i} - \frac{\partial a_{i}}{\partial     heta_i} \right)$$$$=\sum_{j=1}^{n-1}a_{ij} \frac{\partial a_{j}}{\partial     heta_i} - \sum_{j=1}^{n-1}a_{i} \frac{\partial a_{i}}{\partial     heta_i}$$$$=\sum_{j=1}^{n-1}a_{ij} \frac{\partial a_{j}}{\partial     heta_i} + \sum_{j=1}^{n-1}a_{i} \left( \frac{\partial a_{j}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right)$$

$$\Rightarrow \frac{\partial J}{\partial     heta_i}=\sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j}}{\partial     heta_i} + \sum_{k=1}^{n-2}a_{k} \frac{\partial a_{j-k}}{\partial     heta_j} \right)$$

$$\Rightarrow \frac{\partial J}{\partial     heta_i}=\sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j}}{\partial     heta_i} + \sum_{k=1}^{n-2}a_{k} \frac{\partial a_{j-k}}{\partial     heta_j} \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right)$$

$$\Rightarrow \frac{\partial J}{\partial     heta_i}=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right)$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i}$$$$=\frac{\partial a_{i}}{\partial     heta_i} \left( \sum_{j=1}^{n-1}a_{ij} \left( \frac{\partial a_{j-1}}{\partial     heta_j} - \frac{\partial a_{j}}{\partial     heta_i} \right) \right) + \frac{\partial a_{i}}{\partial     heta_i

