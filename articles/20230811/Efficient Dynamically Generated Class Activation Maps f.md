
作者：禅与计算机程序设计艺术                    

# 1.简介
         

这是一篇关于如何高效生成弱监督目标定位的类激活图(Class Activation Map, CAM)的论文。目前，图像分类、目标检测、语义分割等任务都离不开CAM模型的支持。但是，在弱监督学习(Weakly Supervised Learning, WSL)中应用CAM模型却遇到了困难。主要原因是弱监督样本的标签信息往往很少或缺失，因此训练CAM模型时需要利用到大量未标注的数据才能得到好的结果。本文通过寻找一种有效的方法来动态生成CAM图片，来解决WSL中生成CAM图片的问题。
# 2.相关工作
CAM模型最早由Zhang et al.[2]提出，目的是帮助CNN识别视觉特征之间的关系。后来又被He et al.[3]、Lin et al.[4]等人用作弱监督目标定位的前期阶段。然而，由于未标注数据的不足，这些方法仍存在着较大的准确率损失。为了更好地理解它们的缺陷和局限性，本文首先对CAM模型进行了综述。
# 3.相关技术
## 3.1 CAM模型概览
CAM模型通过网络中间层的特征图计算每个像素的重要性，即输出置信度(confidence score)。CNN最后的分类器层提供了一个全局的预测结果，其中，神经元响应越大，表示该类别可能性越高；神经元响应越小，表示该类别可能性越低。为了获得感兴趣区域（ROI）中的所有像素的重要性，CAM模型将权重共享的CNN最后一个卷积层输出的特征图乘上一个可学习的参数μ，并加上一个可学习的参数γ，再次将所有像素点的结果相加，就得到了像素的CAM值(Class Activation Map, CAM)。然后，通过softmax函数映射到每种类别上的置信度。CAM模型的示意图如下所示：
## 3.2 生成CAM图片的两种方法
CAM模型可以用来生成两种类型的图片，即直观图片和热度图。直观图片代表了每个像素对最终预测结果的贡献程度，它体现了网络对于某个目标物体的注意力分布。而热度图则展示了各个区域对于最终预测结果的贡献情况，它提供了一种更高层次的全局认识。两种方法的区别主要体现在：
### （1）生成直观图片—— Grad-CAM
Grad-CAM[5]是生成直观图片的方法之一，其基本思路是：先反向传播到分类层，计算梯度，根据梯度方向，去修正输入图像，使得目标区域的梯度最大化。然后，使用修正后的图像作为预测输入，再次计算分类结果。这种方法能够产生清晰、鲜亮的图，但速度较慢。
### （2）生成热度图—— Score-CAM
Score-CAM[6]是生成热度图的方法之一，其基本思路是：针对每个类别生成CAM图，然后求平均值作为整个图像的CAM图。通过这一技巧，作者发现CAM图对于分类结果具有一定的一致性，而且与原始图像特征无关。同时，作者认为CAM图能够揭示出网络在不同层级的关注点，因此能很好地解释一些较为复杂的场景。因此，Score-CAM在解决弱监督目标定位方面取得了显著的成果。
# 4. 实验设置及数据集介绍
实验中，作者在两个著名的弱监督目标定位数据集──ImageNet-LOC[7]和Places[8]上评估了两种生成CAM图片的方法。ImageNet-LOC是一个大型的大规模图像数据集，用于弱监督目标定位。Places是一个小型的小规模弱监督目标定位数据集，只包含一百多个图片，但提供了丰富的注释信息。为了比较两种方法的效果，作者分别在两个数据集上训练ResNet50和VGG16作为弱监督模型，并且固定其他超参数。作者从两个数据集中随机选取一百张未标注的图片作为测试集，作为弱监督样本的测试。作者采用最简单的策略，将测试图片的标签全部设置为“不知道”即可。
# 5. 方法
## 5.1 CAM模型训练
作者首先训练三个ResNet-50模型。第一个模型是预训练模型，其权重是微调得到的，第二个模型是随机初始化的，第三个模型是采用不同的初始化方式的。最后，三者融合在一起，得到最终的ResNet-50模型。在训练阶段，作者采用两阶段策略，第一阶段固定所有BN层的权重，不更新；第二阶段释放所有BN层的权重，允许更新。作者训练ResNet-50模型的过程如下：
## 5.2 生成CAM图片
对于每个测试图片，作者先生成它们的CAM图片，然后使用各种指标对比这些CAM图片。这里的指标包括AUC、FPR、TPR和KL散度。另外，作者也计算了ResNet-50模型在相同测试图片上的预测概率，并分析了预测结果。作者还测试了生成CAM图片的方法—— Grad-CAM 和 Score-CAM。为了生成CAM图片，作者对ResNet-50模型的最后几个卷积层的输出使用全局池化层之后的ReLU激活函数得到CAM。接下来，作者将CAM应用于相应的测试图片，并绘制热力图。最后，作者对生成的CAM图片和直观图片进行比较。下面详细介绍生成CAM图片的具体过程。
### （1）CAM图生成
首先，作者对ResNet-50模型的最后几个卷积层的输出使用全局池化层之后的ReLU激活函数得到CAM。作者使用k=10的一个多项式函数对所有特征图进行校正，使得结果保持在合适的范围内。对于每张测试图片，作者获取该图片的所有特征图，并把它们连起来。如此一来，便形成了一张通道数为10*n的CAM图，n表示特征图数量，第i个通道表示第i个特征图对测试图片的关注点的权重。
### （2）生成Heatmaps
接下来，作者对生成的CAM图进行聚类处理，聚成10个子图，每个子图代表一种对象类。作者使用K-Means算法，设置聚类中心的个数为k=10。作者遍历所有的测试图片，将它们的CAM图划分为10个子图，并将它们与聚类中心距离最近的那个子图归属于该图片。
### （3）Heatmaps合并
接下来，作者对Heatmaps进行合并，得到最终的CAM图片。首先，作者对每个子图进行归一化处理。然后，作者计算每个测试图片的每个类别的置信度，并根据置信度对Heatmaps排序。最后，作者将同一类的所有Heatmaps拼接在一起，得到最后的CAM图片。
## 5.3 对比结果
作者对生成的CAM图片和直观图片进行比较。首先，作者计算所有测试图片的平均AUC、FPR、TPR和KL散度。为了比较生成的CAM图片和直观图片的质量，作者采用两种方法——纹理掩膜法(texture masking)和直方图拉伸(histogram stretching)。然后，作者对生成的CAM图片和直观图片进行直方图拉伸处理，这样就能清晰地显示出CAM图片的热点区域。最后，作者对生成的CAM图片进行纹理掩膜处理，然后与直观图片对比。下面给出了两种方法的对比结果。
## 5.4 分析预测结果
为了验证生成的CAM图片的有效性，作者分析了预测结果。首先，作者计算了ResNet-50模型在相同测试图片上的预测概率，并分析了预测结果。首先，作者将ResNet-50模型输出的置信度结果转化为类别得分结果，并进行softmax处理。然后，作者利用置信度阈值t=0.5来进行预测，将每个测试图片分为两个类别，类别1包含置信度大于等于t的像素点，类别0包含置信度小于t的像素点。然后，作者将预测的两个类别的置信度值求和，并按置信度值排序，得到排序后的预测结果。最后，作者计算Top-1准确率(Accuracy@1)、Top-5准确率(Accuracy@5)、平均精确率(mAP)，以评价预测的准确性。下表展示了不同方法下的Top-1准确率和Top-5准确率。
# 6. 总结与展望
作者对生成CAM图片的两种方法进行了比较。生成的CAM图片清晰、具有鲜明的热点区域，还能保持每个像素对最终预测结果的贡献，因此能够很好地定位到目标区域。Score-CAM方法比Grad-CAM方法更有效，可以显著提升性能。作者还分析了不同方法下的预测准确率，证明生成的CAM图片的有效性。
作者的研究在计算机视觉领域尚处于起步阶段，还有很多挑战。首先，CAM模型只考虑了CNN最后一个卷积层的输出，忽略了中间层的特征，这可能会导致结果的不完整性。其次，CAM模型只是利用标签信息来生成CAM图，而没有考虑到其他信息。第三，CAM模型依赖于大量的训练数据，这是有待改进的地方。作者还提出了一种新的聚类方法——半监督聚类(Semi-Supervised Clustering)，可以在不使用训练数据时，通过样本之间的关联性来聚类样本。最后，作者指出了许多可供改进的研究方向，包括：改进CAM模型，增加更多的通道来更好地刻画中间层的特征；扩展到其他任务；研究不同形式的CAM；建立强大的基线模型来评估新方法的优劣。