
作者：禅与计算机程序设计艺术                    

# 1.简介
  

无人机（Unmanned Aerial Vehicles，UAV）在近几年蓬勃发展，其技术水平已经达到了国际领先水平。国内外很多高校、研究机构均相继设立了无人机相关的研究中心或实验室，相关课程开设。但是对于一些高级工程师来说，对于无人机的基础知识掌握程度仍然不够，缺乏相关的系统的设计开发经验，因此需要进一步研读相关的文档，系统学习无人机的基本知识、技术与技能。本文将尝试从无人机飞行控制系统的整体视角，将飞控系统分成多个层次进行系统化地阐述，并基于相关案例展现完整的操作流程，希望能够帮助读者在自身的研究方向上有所收获。由于篇幅限制，文章主要着重于介绍飞控系统的整个流程及关键点，不涉及太多具体的编程实现。另外，文章的题目借用了一位游戏开发大牛曾经总结过的一句话“教给学生的课才叫教授的课”。欢迎大家提供宝贵意见。
# 2.无人机飞控系统
无人机（Unmanned Aerial Vehicle，UAV）作为一个全新的交通工具，拥有独特的机动性与空间能力，具有极高的工作载荷。为了满足对此类飞行器的各种复杂任务，各种硬件、软件与算法组件都应运而生。这些系统包括感知、规划、控制、通信、运载管理等各个层次，各个模块之间通过通信接口相互协同工作，最终达到高度精准的控制效果。
如图1所示，无人机的飞控系统由感知、预处理、控制、后处理、操纵四个部分组成。这五大部分分别负责无人机的各种功能，是相互独立的。它们的关系可以用流程图表示如下：
# 3.感知层
感知层负责获取外部环境的信息，比如图像、声音、雷达数据等，转换为可用于控制层处理的数据形式，并将获得的数据上传至下一层进行处理。感知层可以分成底层传感器、激光雷达、INS技术、视觉、红外等。
## 3.1 底层传感器
最基础的就是声音检测传感器，这种传感器一般配合微型麦克风或者单通道红外摄像头一起使用，通过读取信号强弱来确定航点的位置和方向。如果需要高精度的导航信息，则需要配合多通道低功耗的光电传感器或者毫米波雷达。
## 3.2 激光雷达
激光雷达可以获取距离、方位、速度、姿态、海拔信息，并且具备极大的灵敏度。激光雷达通常与计算机配合使用，通过云台、雷达、底盘、视觉等模块，建立映射模型，估计出物体的真实位置，完成精确的导航。激光雷达通常采用固定模式、多目标模式或者跟踪模式三种工作方式。
## 3.3 INS技术
INS（Inertial Navigation System，惯性导航系统），也称为惯性测量系统，它主要用于测量机体的三轴加速度、三轴角速度、三轴位置误差，计算出机体在空间中的位置。INS技术能提供较高的精度和稳定性，适用于各种类型的运载火箭、直升机、固定翼等应用。目前，世界上已有的两种INS系统，一种是GPS和GLONASS组合，另一种是VLBI（Visual Land Imaging，视觉陆地影像）。
## 3.4 视觉
视觉也就是图像处理技术，通过读取图像信息，获取无人机前方物体的距离、方位、大小等信息，用于规划层的决策。视觉也是无人机系统的一个重要部分，它对场景的理解和识别能力十分重要，具有广泛的应用。
## 3.5 红外
红外是一种超声波的衍生物，它可以提供较高的距离信息，与激光雷达不同的是，它更易于被遮蔽，对于有遮挡物、穿透障碍物的场景，红外传感器更加有效。当前市场上的红外传感器有越来越多，包括小型激光红外传感器、四路红外传感器、红外探测雷达等。
# 4.预处理层
预处理层用于提取特征，去除噪声，并转化为控制层可以使用的输入数据。主要包括特征提取、去噪、图像处理等。
## 4.1 特征提取
特征提取是指从图像、声音、其他传感器中提取有用的信息，然后转化为控制层的输入。特征可以是颜色、形状、距离等。特征提取可以根据需要选择不同的方法，比如特征匹配、SIFT（尺度不变特征变换）、HOG（霍夫梯度直方图）等。
## 4.2 去噪
去噪技术主要是消除噪声、降低噪声影响。噪声主要来自于雷达等传感器的反射作用、云层、温度变化等，会引起控制层的不准确。常用的去噪方法有均值滤波、高斯滤波、贝叶斯滤波等。
## 4.3 图像处理
图像处理是指对得到的图像进行特征提取、处理，提取有用的信息，然后转化为控制层的输入。图像处理方法有基于边缘检测、轮廓提取的Harris角点检测、斑点检测、傅里叶变换的局部描述子、SIFT、SURF、MSER、LBP等。
# 5.控制层
控制层主要用来对无人机的各项参数进行调节，让无人机按照指令执行任务。控制层由控制器、路径规划器、避障机制、风控系统等模块组成。
## 5.1 控制器
控制器是无人机最重要的模块之一，它根据预处理层、感知层等信息进行决策，调整无人机的各项参数，实现飞行的精确和稳定。常用的控制器有PID（比例积分控制）、MPC（模型 predictive control，预测性控制）、LQR（线性二次控制）等。
## 5.2 路径规划器
路径规划器负责找出无人机的航向、位置、速度、航迹等。路径规划器的功能有无人机的自动巡航、自动轨道返航、避障导航、战术飞行等。路径规划器常用算法有RRT（ rapidly exploring random trees，快速可达树）、RRT*、A*、FAST-SBA等。
## 5.3 避障机制
避障机制是指在无人机移动过程中，当遇到障碍物时如何躲避，保障无人机安全。常用的避障机制有布娃娃、红外避障等。
## 5.4 风控系统
风控系统是一个防止无人机失控的安全系统。风控系统主要检查无人机状态，识别危险行为，并作出相应的响应。风控系统的功能有保护无人机生命、减少人员伤亡、降低财产损失等。
# 6.后处理层
后处理层主要是指对控制层输出的结果进行再处理，提升控制效果。后处理层的功能有助力悬停、提升实时性、优化控制效率等。
# 7.操纵层
操纵层主要是指控制层输出的指令送至电机驱动器、杆件的驱动器等，实现无人机的操控。操纵层的功能有自动驾驶、自动降落、任务切换等。
# 8.相关案例
飞行控制系统是无人机的核心模块，本文将围绕无人机的操控模式及实际操作流程，分享相关的案例。
## 8.1 静态平移
静态平移即简单地把无人机按照一定的航向移动到某个指定的地点，这里暂且只讨论这种最简单的情况，实际上静态平移还可以扩展到连续移动到指定位置，这里暂且只讨论静态平移。这种情况下，无人机的位置由位置控制器控制，轨道控制器不参与决策。无人机在接收到静态指令后，首先保持当前航向，然后沿着指令航向运行，到达目的地后停止。如果指令航向和当前航向一致，则直接到达目的地。
流程图如下：
## 8.2 动态跟踪
动态跟踪是指无人机根据动态障碍物的出现、消失、位置变化等动态变化，对障碍物进行跟踪。这种跟踪的方式可以是精确的三维定位、视觉检测等，也可以是循迹的方式，根据位置、速度信息判断障碍物的走向。动态跟踪通常通过多种传感器组合实现，包括激光雷达、红外测距、激光测距等。无人机的位置由位置控制器和轨道控制器共同控制，障碍物的位置由轨迹控制器实时检测并修正。如果有多个目标存在，则需要选择最近的目标。
流程图如下：
## 8.3 巡逻
巡逻是指无人机持续不断地巡查周围环境，识别目标，维护航向、轨迹和防撞力。巡逻方式可以是单路巡逻、双路巡逻等，其中单路巡逻可以利用单目摄像头获取环境信息，利用障碍物识别、路径规划和轨迹跟踪等模块实现。无人机的位置由位置控制器和轨道控制器共同控制，轨迹由路径规划器生成。
流程图如下：
## 8.4 自动降落
自动降落是指无人机根据一定条件触发降落，降落时机与位置由位置控制器控制。降落过程由降落控制模块控制，包括高度控制、俯仰控制、滑动控制等。降落后，无人机与位置控制器恢复交互。降落的方式有软降落、软着陆、硬着陆等。
流程图如下：
## 9.未来发展
无人机飞控系统还有很长的路要走，它的未来发展方向主要有如下几个方面：

1.智能制导、智能感知：无人机智能制导能够让无人机自己学习制导策略，提升性能。智能感知能够提高无人机的识别能力，对环境进行自我感知，辅助无人机发现和制导目标。

2.密集无人机集群：随着无人机性能的提升，需要更多数量的无人机协同工作。分布式计算平台将会成为支撑无人机集群的重要基石，也是未来飞控系统的发展方向。

3.无人机网络：无人机网络将会是未来飞控系统的核心组件，能够实现规模化的无人机通信，解决跨域问题。

4.工业控制系统：工业控制系统将是一个重要的研究方向，因为工业制造领域的特殊需求使得工业控制系统的设计、构建、部署成为一个难题。