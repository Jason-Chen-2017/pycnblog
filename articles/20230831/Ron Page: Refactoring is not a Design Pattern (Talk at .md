
作者：禅与计算机程序设计艺术                    

# 1.简介
  

软件工程中，“重构”一直是开发人员的一项重要工作。当初设计软件的时候，采用了某种模式；随着时间的推移，代码的需求变更、环境变化等原因，需要对软件进行重构。那么什么是重构呢？本文将首先对“重构”的定义及其过程进行阐述，然后分析其不具备系统性和科学性。之后，阐述Ron Page的研究成果——在1997年提出的“Refactoring is Not a Design Pattern”（RIPD）理论，其基本观点是，在过去的几十年里，软件开发者总结出来的一些方法论其实都可以看作是软件设计模式。然而，如果把这些模式直接用于代码重构，则必然会导致不必要的复杂化、混乱和错误，甚至让代码无法运行。所以，RIPD试图说明，对于重构来说，不能仅仅使用某个设计模式，还需要注意通过一些专业技能的培养和严格的流程约束来确保代码质量。最后，我们还将探讨现实世界中一些关于重构的面临的问题，并给出Ron Page推荐的一些解决方案。

2.定义及其过程
“重构”这个词语始于一群软件工程师在1990年代提出的名词。他们认为软件的维护和演进离不开一系列的改善活动，其中包括重写、重构、优化、扩展等等。在这里，重写指的是修改软件的代码，使得它可以按照新的功能要求正确运行。而重构则是指基于已有的代码改动而进行的一系列小型的修改，目的是为了提高软件的可理解性、可维护性、可扩展性、灵活性等。

重构一般分为四个阶段：反思、识别、设计、执行。其反思阶段，是指对当前软件的状况做一个总体的评估，看是否存在可以改善的地方。识别阶段，是在反思阶段的基础上，找出哪些模块或代码需要重构。设计阶段，是针对识别出的重构需求，制定新的实现方式。执行阶段，是指在设计出来的实现上进行测试和修改，最终达到代码的最佳状态。

“重构”这个过程的目的之一是为了促进软件的长期维护，改善代码的质量和结构。它的意义在于：
- 提升代码的可读性、可维护性和可扩展性
- 提升软件的适应能力和可复用性
- 消除重复代码
- 更快地找到和解决软件中的bug

此外，“重构”也是一种好的学习经验的方式，因为它能帮助你理解软件的实现逻辑、以及代码应该如何进行设计才能有效地解决问题。例如，如果你发现某个函数或模块的命名不合适，就可以尝试重构它，改善代码的可读性。又如，如果你发现某个功能缺少单元测试，就可以尝试编写测试用例，加强代码的健壮性。

3.RIPD理论的发现
“重构”在近几十年间成为软件开发者的一项重要工作，但由于缺乏系统性和科学性，往往被误用或者滥用，导致软件出现各种问题。1997年，也就是著名的贝尔实验室大学演示程序员埃里克·迪斯尼·托马斯毕业时，他撰写了一篇名为《Refactoring is Not a Design Pattern》的论文。在这篇文章中，他提出了一个基本观点，即软件开发过程中所使用的一些方法论其实都可以看作是软件设计模式。事实证明，这一观点并不是空穴来风，实际上早在1990年代就已经有相关研究。如同其它的软件设计模式一样，这种模式能够帮助开发者快速、有效地开发软件。然而，如果把这些模式直接用于代码重构，则可能导致错误的设计，代码质量下降、出现难以诊断的性能问题，甚至导致软件崩溃。因此，RIPD试图说明，在软件开发的各个环节都需要在不同程度上进行专业技能的培养、严格的流程约束，才可以确保软件的质量。

RIPD的作者是托马斯，他的研究兴趣在计算机编程语言理论方面。他发现，虽然不同的编程语言、框架和库都提供了丰富的库函数、接口和工具箱，但是仍然存在一些共性的模式。比如，绝大多数情况下，打印日志和追踪函数调用可以归类为“控制流管理”(control flow management)，都属于“可维护性”(maintainability)的范畴。于是，他提出了RIPD理论，即开发者重构代码时，不仅要遵循最佳实践、严格遵循设计模式，而且还需要熟练掌握软件工程领域的专业技能。

RIPD的核心假设是，软件开发的各个环节都存在着一些相似之处，它们之间都可以抽象出一些通用的设计模式。换句话说，软件开发就是一门“设计模式”的实践。基于这些模式，托马斯总结出了一套完整的方法论，描述了软件开发的每个阶段，以及每个阶段需要处理的特定问题。不过，托马斯的研究仍然局限于编程语言理论领域，尚未将其应用到软件工程领域。

4.现实世界中的“重构”问题
现在回顾一下“重构”的定义及其过程，就会发现其确实是一项复杂且繁琐的工作。“重构”需要开发人员充分关注代码质量、效率、可维护性、可扩展性等多方面的因素，同时还需要有高度的专业知识、专业能力和坚持不懈的精神。这要求不仅需要工程师具备广泛的技能、知识和能力，还需要在团队内部建立起一定的共识、推行一些规范、提供必要的培训和指导。否则，重构的结果很可能反映不出软件开发者真正的水平。

另一方面，现实世界中的“重构”也存在着诸多问题。首先，很多时候，我们只是想重构代码，却忽略了软件工程最重要的部分——沟通、协作、架构设计。没有一个好的架构设计可以帮助开发者构建出可维护、可扩展、灵活的软件。其次，与其花费大量的时间在“重构”，不如花更多的时间在代码的编写和架构的设计上。第三，代码的重构往往会引入错误、陷入复杂和混乱的境地。最后，重构往往需要非常谨慎，只有在充分考虑后，才能确定正确的方案。

综上所述，“重构”是一个复杂的工程实践，需要工程师具有高度的专业知识和能力，还需要有良好的沟通、协作和架构设计的能力，才能确保软件质量的稳定、持续地向前发展。在现实世界中，作为一名工程师，如何才能更好地运用自己的专业技能，更加高效地完成“重构”任务，这是值得思考的问题。

Ron Page推荐的解决方案
为了提升软件工程师的技能水平，降低“重构”的风险，Ron Page提出以下建议：
1.专业技能培养
为了做到高效率的“重构”，工程师需要熟悉软件工程的各种理论和技术。通过阅读、听课、参加会议等方式，工程师可以系统地学习软件工程的相关知识，包括项目管理、编码规范、自动化测试、架构设计、性能调优等多个方面。通过这些学习，工程师可以更好地理解软件工程的原理和方法论，并利用这些知识提升自己的工作效率。

2.职场道德与纪律约束
“重构”是一个复杂的工程实践，工程师必须保持谦逊的态度和优秀的品德。这可以通过刻苦钻研、求知欲强、锲而不舍、积极主动等方式来实现。在职场中，工程师应该充分认识自己的责任、职责和权力，并且遵守公司的组织章程、业务策略和工作安排，并为此付出努力。

3.建立强大的工程架构
软件架构设计是构建可靠、可维护、可扩展、灵活的软件的关键环节。它涉及到多个层级的决策，包括设计模型、组件依赖关系、数据存储、通信协议、分布式计算、用户界面设计、安全性、资源利用率等。通过系统地了解软件工程的原理和方法论，以及通过与架构师进行深入的交流，工程师可以更好地理解软件架构的设计原则和流程，并提升自己对架构设计的技能。

4.提倡软件开发流程约束
软件开发流程中最重要的环节莫过于“重构”。在进行“重构”之前，工程师应该充分审视自己的代码，保证其可理解性、可维护性和可扩展性。每一次重构都是一次机会，工程师需要清晰地定义目标、制订计划、收集反馈和改进方案。为此，工程师需要注意构建一个科学、一致的软件开发流程，并落实到日常的软件开发中。

5.团队建设
软件工程最重要的环节是团队建设。工程师应积极参与软件项目的整体规划、设计、开发和测试等流程，并且需要为此付出艰苦的努力。为此，工程师应建立起一个互相信任的、自我激励的团队，并制定一系列项目管理计划和标准。

通过以上建议，工程师可以在一定程度上降低“重构”带来的风险，提升软件工程师的职业能力和个人价值。