
作者：禅与计算机程序设计艺术                    

# 1.背景介绍


## 概述
并查集（英语：Disjoint-set data structure），是一个用于处理动态集合的问题的数据结构。它提供了一种有效的方法来合并、查找和判定集合中的元素关系。并查集的本质是基于树形结构，并且每个节点代表一个集合，每条边代表两个节点间的根路径上的分支。其名称“并”源自于：在并查集中，每个节点都是一条被确定的路径，而这个路径上的所有节点所属的集合之间互不相交。因此，“并”字指代的是两个集合的分离。

## 应用场景
并查集常用在许多领域，如：

1. 维护动态连通性问题：比如有向图中找出无环图。利用并查集可以判断任意两点是否连通，进而对图进行连通分量划分。
2. Kruskal算法：Kruskal算法适合求最小生成树。通过堆排序选取权值最小的边加入到最小生成树中。如果两个节点属于同一个集合则跳过。
3. Least Common Ancestor(LCA)查询：该问题可以通过路径压缩和按秩合并来解决。

## 为什么要学习并查集？
作为一名技术人员，在解决实际问题时，经常会面临各种复杂的场景。比如，动态连通性问题在很多工程上都有着重要作用。为了更好地理解并查集，掌握它的基本原理和使用方法将有助于提升个人能力、改善工作效率，从而更加游刃有余地应对复杂问题。

# 2.核心概念与联系
## 定义
### 集合
并查集是一种数据结构，用来存储一些集合（或称为“类”）。一个集合中可能包含若干个元素，这些元素成为该集合的元素。元素既可以是简单的整数，也可以是指针。

### 树
每个集合对应于一棵树。树的根节点表示整个集合，根节点下面的子节点分别表示集合中的元素。树的每条边表示两个结点之间的唯一路径，路径上所有的结点均属于该集合。根据树的特点，集合之间存在两种关系：父子关系和祖先关系。其中，父子关系是指树结构的一种基本构建块，一个结点的父亲就是它的一个儿子的所有祖先，一个结点的孩子表示它作为父亲的父母。祖先关系是指两个结点共同前缀的集合。

## 操作
### 插入操作
插入操作是指创建一个新的集合并把一个元素加入到新集合中。首先找到某个集合根节点，然后给该根节点添加一个子节点。这个过程是递归完成的。例如，假设要插入元素x到集合s1中，那么可以在树中找到节点s1，然后让s1的儿子指向一个新的结点v。然后，v就成为集合s1的一个成员。

### 查找操作
查找操作是指确定某一个元素所属的集合。对于并查集来说，查找操作主要基于路径压缩。即当我们发现某一个元素的祖先不是自己的时候，我们就更新一下它的父亲节点的值。

### 合并操作
合并操作是指将两个集合合并成一个集合。首先找到这两个集合的根节点，然后让它们的根节点指向相同的祖先，也就是说，将第二个集合的根节点加入第一个集合的根节点所在集合中。这样做的目的是消除重复的集合，使得整个并查集只有一个集合。合并操作也是递归实现的。

### 查询操作
查询操作就是查找两个元素间的祖先关系。因为并查集记录了每个节点的父亲节点，所以我们只需要沿着父亲链一直往上遍历，直到找到它们的祖先节点，就可以得到他们的祖先关系了。当然，这种查询比较慢，但可以采用路径压缩技巧优化。

## 属性
### 连通性与森林性
并查集的另外一个重要属性是连通性和森林性。

#### 连通性
并查集中没有任何两个元素的祖先是同一个结点的情况下，它就是一个连通的集合。连接几个集合构成一个连通的连通组件，并查集拥有最大的连通性。

#### 森林性
并查集可以表示为一颗森林，森林是一组互不相交的连通集合的集合。森林内每个集合可以看作树。树的大小等于集合个数，即一个集合只对应一个树。森林的大小等于树的个数乘上集合个数，即每个集合对应两个不同的树。森林性指明了每个集合不必独立存在，而是在其他集合的基础上产生的。