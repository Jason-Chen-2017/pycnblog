
作者：禅与计算机程序设计艺术                    

# 1.背景介绍


## 最大流问题简介
最大流问题（maximum flow problem）是在有向图中，找出一条从源点到汇点且最大流量不超过给定值$K$的路径的问题。具体来说，就是在一个有向图中，找到一条由$s$到$t$的可行流$f$，满足$f\geq K$，使得$V-E+f=c$，其中$V$是顶点集，$E$是边集，$s$、$t$分别是源点和汇点，$c$是容量限制。同时还要保证不存在不安全边，即当存在一个边$(u,v)$，$c_{uv}<f_u$时，称边$(u,v)$为不安全边。
最大流问题一直是计算机网络、通信、信息流等领域的一个重要研究课题，它在线性规划、动态规划、拓扑排序、最短路算法等领域都有着广泛的应用。最大流问题属于运输规划类问题。它的两个主要的求解方法是Ford-Fulkerson法和Dinic法，本文将对这两种算法进行详细的阐述。

## Ford-Fulkerson方法
Ford-Fulkerson方法是最著名的最大流问题解决方法。它的基本思想是通过反复增广增广路算法，可以确定一条能够满足容量限制且最大流量的路径。这个算法可以在时间复杂度$O(EV^2)$内解决问题。Ford-Fulkerson方法的关键思想是采用“增广”的思路，逐步试探扩大流量。直观地理解，增广就像在电力网络中，在某条线路上添加流量，让它变成可以传输更多的电流，如果网络中没有超载的环路，就可以从源头到达目的地。Ford-Fulkerson方法的运行过程如下图所示：


 - 在第一步，设初值为$f=0$，令$s\rightarrow t$的残留网络图$G_f$，其每条边的容量都设置为$+\infty$，但源点$s$的容量被设置为$-K$；
 
 - 从源点$s$开始计算残留网络的最小割$f^\ast=(s,\delta_\text{min})$，即从$s$到任意点的最小费用。若残留网络中的某条边$e=(u,v)$的容量减去当前割$f$后等于$0$，则称边$e$为安全边，否则为不安全边。同时，计算得到$f$，该割也称为残留网络的可行流；
 	
 - 如果$f$等于$K$，则停止计算并输出结果，否则转入第二步。
 	
 - 在第二步，通过反复增广的思路计算新的残留网络图$G_f'$，并设置新割$f'^\ast=(s,\delta^\prime_\text{min})$，这里的$\delta^\prime_\text{min}$表示从源点$s$到其他所有点的残留最小费用。如果存在某个不安全边$e=(u,v)$，那么增广$e$使其容量增加至$\lceil \frac{f}{2}\rceil$，并设置$\delta^{\prime\prime}_{\text{new}}=\delta_{\text{min}}[u]+1$。如果不存在不安全边，则停止计算并输出结果。重复以上步骤，直到计算完毕。
 
 
## Dinic方法
Dinic方法是另一种基于压榨的最大流问题解决方法。其基本思想是通过“压榨”的方法，可以决定某些顶点放置一些额外的水，这些水可以通过增广流的方式从源点到汇点的路径上流过。然而，由于容量限制可能出现不足的情况，因此需要反复迭代，直到所有可以进行流量增大的路径都被利用。这样，最终会产生一组关于流量及其流向的信息。该方法的时间复杂度为$O(EV^{2}/R)$，其中$R$表示任意的容量限制的最大值。Dinic算法的运行过程如下图所示：

 

- 初始化：创建残留网络$G_f$和$Q$，其中$G_f$是一个邻接矩阵表示的图，$Q$是一个队列。把源点$s$和汇点$t$加入$Q$中。设源点$s$处的残留容量为$0$。

- 当$Q$为空时，停止计算并输出结果。否则，从$Q$中取出一个顶点$u$，更新$u$的支配容量$d_u$和该顶点可以向哪些顶点发送流$P_u$。具体来说，如果$u$是源点，那么$d_u=-\infty$，并且$P_u=\varnothing$。如果$u$不是源点，那么$d_u$的值为$-\infty$，并检查$u$的所有入边$((u,v),c_u)$，如果$c_u>0$，则可以从$u$向$v$发送流，计算$w(u,v)-d_u$，如果$w(u,v)>d_u$，则更新$d_u=w(u,v)$，并且把$(u,v)$加入$P_u$。

- 如果顶点$u$的支配容量$d_u$大于等于汇点$t$的残留容量$f^\ast_{t,u}-f^\ast_{s,u}$，则可送出的流量已经超过了$t$点的剩余容量，停止计算并输出结果。否则，将$d_u$加到$u$的汇点$t$的残留容量中。将$u$从$Q$中移除，并把所有从$u$出发的入边$(v,v')$加入$Q$，且容量减少为$v'-d'_u$。

- 返回第二步。

由此，算法从源点出发，遍历图，根据残留网络中的容量限制，增广图上的流，使流量不超过容量限制，同时生成关于流量及其流向的信息，直到所有可以进行流量增大的路径都被利用。