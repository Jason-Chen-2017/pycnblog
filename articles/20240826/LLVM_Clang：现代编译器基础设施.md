                 

关键词：LLVM，Clang，编译器，现代基础设施，代码优化，语言支持，跨平台开发。

摘要：本文将深入探讨LLVM和Clang在现代编译器基础设施中的重要角色。我们将从背景介绍开始，详细讲解核心概念和架构，分析核心算法原理，阐述数学模型和公式，展示项目实践中的代码实例，并讨论实际应用场景和未来展望。

## 1. 背景介绍

编译器是计算机科学中至关重要的工具之一。它将高级编程语言（如C++、Java等）转换成机器代码，使得计算机能够执行这些程序。随着软件系统的日益复杂，编译器的角色变得更加重要。现代编译器不仅需要高效地转换代码，还需要进行代码优化，提高程序的执行效率。

LLVM（Low Level Virtual Machine）是一个模块化的、可重用的中间表示（IR）编译器基础设施。它提供了丰富的工具链，包括Clang、Lli、gcc等。LLVM的设计目标是实现高效的代码生成和优化，同时保持高度的可扩展性。

Clang是LLVM的一个前端，它提供了C、C++、Objective-C和Objective-C++的编译器。Clang以其快速的语法解析和语法分析能力而闻名，同时也是LLVM编译器生态系统中的重要组成部分。

本文将详细介绍LLVM和Clang的核心概念、架构、算法原理以及实际应用，帮助读者更好地理解这两个工具在现代编译器基础设施中的重要性。

## 2. 核心概念与联系

### 2.1 LLVM架构

LLVM的核心架构可以分为三个主要部分：前端（Frontend）、中间表示（IR）和后端（Backend）。

#### 前端

前端负责将源代码解析成抽象语法树（AST），然后将其转换成LLVM的中间表示（IR）。前端通常依赖于源语言的语法和语义，实现语法解析和语义分析。对于C++等复杂语言，前端需要处理模板、重载、引用等高级特性。

#### 中间表示（IR）

中间表示（IR）是LLVM的核心，它提供了一种统一的表示方式，使得不同的前端和后端可以共享相同的代码。IR是一种低级、结构化的表示，它抽象了具体的机器指令，使得代码优化和生成变得更加简单。

#### 后端

后端负责将中间表示（IR）转换成目标平台的机器代码。每个目标平台都有一个特定的后端，它负责生成最优的机器代码。后端通常包括代码生成、代码优化和调试等功能。

### 2.2 LLVM与Clang的关系

Clang是LLVM的前端，它实现了C、C++、Objective-C和Objective-C++的语法解析、语义分析和代码生成。Clang以其快速的语法解析和语法分析能力而著称，可以与GCC等传统的编译器相媲美。同时，Clang也提供了丰富的错误诊断和代码提示功能，使得开发过程更加高效。

Clang和LLVM的关系可以类比为前端和后端的关系。Clang作为前端，将源代码转换成中间表示（IR），然后由LLVM的后端生成目标平台的机器代码。

### 2.3 Mermaid流程图

下面是一个描述LLVM架构的Mermaid流程图，展示了前端、中间表示（IR）和后端之间的交互过程。

```mermaid
graph TD
A[源代码] --> B[前端]
B --> C[抽象语法树(AST)]
C --> D[语义分析]
D --> E[中间表示(IR)]
E --> F[优化]
F --> G[后端]
G --> H[目标机器代码]
```

## 3. 核心算法原理 & 具体操作步骤

### 3.1 算法原理概述

LLVM的核心算法原理主要包括以下三个方面：

1. **中间表示（IR）**：LLVM使用中间表示（IR）作为编译过程中的一个中间抽象。这种表示方式使得代码优化和生成变得更加简单和高效。

2. **代码优化**：LLVM提供了丰富的优化技术，包括循环展开、死代码消除、常数折叠等。这些优化技术可以显著提高程序的执行效率。

3. **后端代码生成**：LLVM的后端负责将中间表示（IR）转换成目标平台的机器代码。后端利用目标平台的特点，生成最优的机器代码。

### 3.2 算法步骤详解

LLVM的编译过程可以分为以下步骤：

1. **词法分析**：将源代码转换成词法符号流。

2. **语法分析**：将词法符号流转换成抽象语法树（AST）。

3. **语义分析**：检查AST的语义正确性，包括类型检查、变量作用域等。

4. **中间表示（IR）生成**：将AST转换成中间表示（IR）。

5. **代码优化**：对中间表示（IR）进行各种优化。

6. **目标代码生成**：将中间表示（IR）转换成目标平台的机器代码。

7. **调试信息生成**：为机器代码生成调试信息。

### 3.3 算法优缺点

**优点**：

1. **模块化设计**：LLVM采用模块化设计，使得前端和后端可以独立开发、维护和扩展。

2. **高效的代码优化**：LLVM提供了丰富的优化技术，可以显著提高程序的执行效率。

3. **跨平台支持**：LLVM支持多种目标平台，使得编译器可以方便地移植到不同的操作系统和硬件架构。

**缺点**：

1. **学习曲线较陡**：LLVM是一个复杂且功能强大的编译器基础设施，对于初学者来说，学习曲线较陡。

2. **性能开销**：由于LLVM的模块化设计，编译过程中的性能开销较大。

### 3.4 算法应用领域

LLVM和Clang广泛应用于以下领域：

1. **开源编译器**：如Clang、gcc等。

2. **跨平台开发**：使用LLVM和Clang可以轻松实现跨平台编译。

3. **代码优化工具**：LLVM提供的优化技术可以用于各种代码优化工具。

4. **静态分析工具**：LLVM可以作为静态分析工具的底层基础设施。

## 4. 数学模型和公式 & 详细讲解 & 举例说明

### 4.1 数学模型构建

LLVM的优化过程涉及到多种数学模型和公式。下面是一个简单的数学模型示例，用于描述循环优化中的迭代计数问题。

设循环次数为\( n \)，每次迭代的执行时间为\( t \)，则循环的总执行时间为\( n \times t \)。

### 4.2 公式推导过程

为了优化循环，我们可以使用以下公式：

\[ n' = \lceil \frac{n}{w} \rceil \]

其中，\( n' \)为优化后的循环次数，\( w \)为循环体执行的最小单位时间。

### 4.3 案例分析与讲解

假设一个循环需要执行100次，每次迭代执行1秒。根据上述公式，优化后的循环次数为：

\[ n' = \lceil \frac{100}{1} \rceil = 100 \]

这意味着优化后的循环仍然需要100秒执行，但实际上，我们可以通过并行执行或提前终止循环来进一步优化执行时间。例如，如果我们可以在50秒内完成循环，则优化后的循环次数为：

\[ n' = \lceil \frac{100}{50} \rceil = 2 \]

这样，循环只需要2秒就可以完成。

## 5. 项目实践：代码实例和详细解释说明

### 5.1 开发环境搭建

要在本地搭建LLVM和Clang的开发环境，首先需要安装LLVM和Clang的源代码。可以在[LLVM官网](https://llvm.org/)下载最新版本的源代码。

```bash
git clone https://github.com/llvm/llvm-project.git
cd llvm-project
mkdir build && cd build
```

然后，使用CMake配置和编译：

```bash
cmake ..
make
```

最后，安装编译器：

```bash
sudo make install
```

### 5.2 源代码详细实现

以下是一个简单的Clang编译器示例，用于将C++代码编译成机器代码。

```cpp
// main.cpp
#include <iostream>

int main() {
    std::cout << "Hello, World!" << std::endl;
    return 0;
}
```

使用Clang编译上述代码：

```bash
clang++ main.cpp -o main
```

这将生成一个名为`main`的可执行文件。

### 5.3 代码解读与分析

上述示例中，我们首先包含了iostream头文件，以便使用标准输出流。然后，我们定义了main函数，它输出“Hello, World!”并返回0。

编译过程首先由Clang前端将C++代码转换成中间表示（IR），然后由LLVM后端生成机器代码。在执行时，机器代码将被加载到内存中，并执行main函数。

### 5.4 运行结果展示

运行生成的可执行文件：

```bash
./main
```

输出结果：

```
Hello, World!
```

这表明Clang成功地编译并执行了C++代码。

## 6. 实际应用场景

LLVM和Clang在现代编译器基础设施中有着广泛的应用场景：

1. **开源编译器**：Clang作为开源编译器的代表，广泛应用于Linux、macOS等操作系统中。

2. **跨平台开发**：LLVM和Clang支持多种编程语言和目标平台，使得开发者可以方便地实现跨平台开发。

3. **性能优化**：LLVM提供了丰富的优化技术，可以显著提高程序的执行效率。

4. **静态分析**：LLVM可以作为静态分析工具的底层基础设施，用于代码审查和安全性分析。

5. **教育与研究**：LLVM和Clang为计算机科学教育和研究提供了一个强大的工具集，使得学生和研究者可以深入理解编译器的工作原理。

## 7. 工具和资源推荐

### 7.1 学习资源推荐

1. [LLVM官方文档](https://llvm.org/docs/)
2. [Clang官方文档](https://clang.llvm.org/docs/)
3. 《LLVM/Clang官方手册》
4. 《深入理解计算机系统》
5. 《编译原理：艺术与科学》

### 7.2 开发工具推荐

1. **LLVM和Clang源代码**：[https://llvm.org/](https://llvm.org/)
2. **CMake**：[https://cmake.org/](https://cmake.org/)
3. **Eclipse CDT**：[https://www.eclipse.org/CDT/](https://www.eclipse.org/CDT/)
4. **Visual Studio Code**：[https://code.visualstudio.com/](https://code.visualstudio.com/)

### 7.3 相关论文推荐

1. “The LLVM Compiler Infrastructure”
2. “A Retargetable C Compiler for Program Exploration and Testing”
3. “Fast Incremental Compilation in LLVM”
4. “An Overview of LLVM: Status and Evolution”
5. “The Design and Implementation of the C++ Frontend for LLVM”

## 8. 总结：未来发展趋势与挑战

### 8.1 研究成果总结

LLVM和Clang在现代编译器基础设施中取得了显著的研究成果。它们提供了强大的代码优化和跨平台支持功能，广泛应用于开源编译器、性能优化、静态分析等领域。

### 8.2 未来发展趋势

未来，LLVM和Clang将继续致力于改进代码优化算法、扩展语言支持、提高编译速度和性能。此外，它们还可能引入更多的高级特性，如机器学习、自动并行化等。

### 8.3 面临的挑战

1. **性能优化**：随着硬件性能的不断提升，如何进一步提高编译器的性能成为一个挑战。

2. **语言支持**：如何支持更多的新型编程语言和语言特性。

3. **兼容性**：如何保持与其他编译器（如GCC）的兼容性。

4. **安全性**：如何提高编译器的安全性，防止潜在的安全漏洞。

### 8.4 研究展望

未来，LLVM和Clang将继续在编译器领域发挥重要作用。通过不断改进和扩展，它们将为开发者提供更高效、更安全的编译器解决方案。

## 9. 附录：常见问题与解答

### 9.1 如何安装LLVM和Clang？

首先，从[LLVM官网](https://llvm.org/)下载LLVM和Clang的源代码。然后，使用CMake配置和编译，最后安装编译器。

### 9.2 LLVM和Clang的主要区别是什么？

LLVM是一个模块化的、可重用的中间表示（IR）编译器基础设施，而Clang是LLVM的一个前端，实现了C、C++、Objective-C和Objective-C++的语法解析、语义分析和代码生成。

### 9.3 LLVM和GCC的区别是什么？

LLVM和GCC都是编译器基础设施，但LLVM更加模块化、可重用，支持更多的编程语言和目标平台，同时提供了强大的优化技术。GCC虽然历史悠久，但在某些方面（如优化技术）可能不如LLVM先进。

### 9.4 LLVM和Clang的优缺点是什么？

**优点**：模块化设计、高效的代码优化、跨平台支持。**缺点**：学习曲线较陡、性能开销较大。

### 9.5 如何优化LLVM和Clang的编译速度？

可以通过以下方法优化LLVM和Clang的编译速度：

1. 使用预编译头文件。
2. 关闭不必要的调试信息生成。
3. 使用并行编译。
4. 定制CMake配置，优化编译器参数。

---

本文基于LLVM和Clang在现代编译器基础设施中的重要角色，详细介绍了其核心概念、架构、算法原理、数学模型以及实际应用场景。通过本文，读者可以更好地理解LLVM和Clang的工作原理及其在编译器领域的重要性。在未来的研究和实践中，LLVM和Clang将继续发挥重要作用，为开发者提供更高效、更安全的编译器解决方案。作者：禅与计算机程序设计艺术 / Zen and the Art of Computer Programming
----------------------------------------------------------------

以上是完整版的文章，现在按照markdown格式进行排版。

```markdown
# LLVM/Clang：现代编译器基础设施

关键词：LLVM，Clang，编译器，现代基础设施，代码优化，语言支持，跨平台开发。

摘要：本文将深入探讨LLVM和Clang在现代编译器基础设施中的重要角色。我们将从背景介绍开始，详细讲解核心概念和架构，分析核心算法原理，阐述数学模型和公式，展示项目实践中的代码实例，并讨论实际应用场景和未来展望。

## 1. 背景介绍

编译器是计算机科学中至关重要的工具之一。它将高级编程语言（如C++、Java等）转换成机器代码，使得计算机能够执行这些程序。随着软件系统的日益复杂，编译器的角色变得更加重要。现代编译器不仅需要高效地转换代码，还需要进行代码优化，提高程序的执行效率。

LLVM（Low Level Virtual Machine）是一个模块化的、可重用的中间表示（IR）编译器基础设施。它提供了丰富的工具链，包括Clang、Lli、gcc等。LLVM的设计目标是实现高效的代码生成和优化，同时保持高度的可扩展性。

Clang是LLVM的一个前端，它实现了C、C++、Objective-C和Objective-C++的编译器。Clang以其快速的语法解析和语法分析能力而闻名，同时也是LLVM编译器生态系统中的重要组成部分。

本文将详细介绍LLVM和Clang的核心概念、架构、算法原理以及实际应用，帮助读者更好地理解这两个工具在现代编译器基础设施中的重要性。

## 2. 核心概念与联系

### 2.1 LLVM架构

LLVM的核心架构可以分为三个主要部分：前端（Frontend）、中间表示（IR）和后端（Backend）。

#### 前端

前端负责将源代码解析成抽象语法树（AST），然后将其转换成LLVM的中间表示（IR）。前端通常依赖于源语言的语法和语义，实现语法解析和语义分析。对于C++等复杂语言，前端需要处理模板、重载、引用等高级特性。

#### 中间表示（IR）

中间表示（IR）是LLVM的核心，它提供了一种统一的表示方式，使得不同的前端和后端可以共享相同的代码。IR是一种低级、结构化的表示，它抽象了具体的机器指令，使得代码优化和生成变得更加简单。

#### 后端

后端负责将中间表示（IR）转换成目标平台的机器代码。每个目标平台都有一个特定的后端，它负责生成最优的机器代码。后端通常包括代码生成、代码优化和调试等功能。

### 2.2 LLVM与Clang的关系

Clang是LLVM的前端，它实现了C、C++、Objective-C和Objective-C++的语法解析、语义分析和代码生成。Clang以其快速的语法解析和语法分析能力而著称，可以与GCC等传统的编译器相媲美。同时，Clang也提供了丰富的错误诊断和代码提示功能，使得开发过程更加高效。

Clang和LLVM的关系可以类比为前端和后端的关系。Clang作为前端，将源代码转换成中间表示（IR），然后由LLVM的后端生成目标平台的机器代码。

### 2.3 Mermaid流程图

下面是一个描述LLVM架构的Mermaid流程图，展示了前端、中间表示（IR）和后端之间的交互过程。

```mermaid
graph TD
A[源代码] --> B[前端]
B --> C[抽象语法树(AST)]
C --> D[语义分析]
D --> E[中间表示(IR)]
E --> F[优化]
F --> G[后端]
G --> H[目标机器代码]
```

## 3. 核心算法原理 & 具体操作步骤

### 3.1 算法原理概述

LLVM的核心算法原理主要包括以下三个方面：

1. **中间表示（IR）**：LLVM使用中间表示（IR）作为编译过程中的一个中间抽象。这种表示方式使得代码优化和生成变得更加简单和高效。

2. **代码优化**：LLVM提供了丰富的优化技术，包括循环展开、死代码消除、常数折叠等。这些优化技术可以显著提高程序的执行效率。

3. **后端代码生成**：LLVM的后端负责将中间表示（IR）转换成目标平台的机器代码。后端利用目标平台的特点，生成最优的机器代码。

### 3.2 算法步骤详解

LLVM的编译过程可以分为以下步骤：

1. **词法分析**：将源代码转换成词法符号流。

2. **语法分析**：将词法符号流转换成抽象语法树（AST）。

3. **语义分析**：检查AST的语义正确性，包括类型检查、变量作用域等。

4. **中间表示（IR）生成**：将AST转换成中间表示（IR）。

5. **代码优化**：对中间表示（IR）进行各种优化。

6. **目标代码生成**：将中间表示（IR）转换成目标平台的机器代码。

7. **调试信息生成**：为机器代码生成调试信息。

### 3.3 算法优缺点

**优点**：

1. **模块化设计**：LLVM采用模块化设计，使得前端和后端可以独立开发、维护和扩展。

2. **高效的代码优化**：LLVM提供了丰富的优化技术，可以显著提高程序的执行效率。

3. **跨平台支持**：LLVM支持多种目标平台，使得编译器可以方便地移植到不同的操作系统和硬件架构。

**缺点**：

1. **学习曲线较陡**：LLVM是一个复杂且功能强大的编译器基础设施，对于初学者来说，学习曲线较陡。

2. **性能开销**：由于LLVM的模块化设计，编译过程中的性能开销较大。

### 3.4 算法应用领域

LLVM和Clang广泛应用于以下领域：

1. **开源编译器**：如Clang、gcc等。

2. **跨平台开发**：使用LLVM和Clang可以轻松实现跨平台编译。

3. **代码优化工具**：LLVM提供的优化技术可以用于各种代码优化工具。

4. **静态分析工具**：LLVM可以作为静态分析工具的底层基础设施。

## 4. 数学模型和公式 & 详细讲解 & 举例说明

### 4.1 数学模型构建

LLVM的优化过程涉及到多种数学模型和公式。下面是一个简单的数学模型示例，用于描述循环优化中的迭代计数问题。

设循环次数为\( n \)，每次迭代的执行时间为\( t \)，则循环的总执行时间为\( n \times t \)。

### 4.2 公式推导过程

为了优化循环，我们可以使用以下公式：

\[ n' = \lceil \frac{n}{w} \rceil \]

其中，\( n' \)为优化后的循环次数，\( w \)为循环体执行的最小单位时间。

### 4.3 案例分析与讲解

假设一个循环需要执行100次，每次迭代执行1秒。根据上述公式，优化后的循环次数为：

\[ n' = \lceil \frac{100}{1} \rceil = 100 \]

这意味着优化后的循环仍然需要100秒执行，但实际上，我们可以通过并行执行或提前终止循环来进一步优化执行时间。例如，如果我们可以在50秒内完成循环，则优化后的循环次数为：

\[ n' = \lceil \frac{100}{50} \rceil = 2 \]

这样，循环只需要2秒就可以完成。

## 5. 项目实践：代码实例和详细解释说明

### 5.1 开发环境搭建

要在本地搭建LLVM和Clang的开发环境，首先需要安装LLVM和Clang的源代码。可以在[LLVM官网](https://llvm.org/)下载最新版本的源代码。

```bash
git clone https://github.com/llvm/llvm-project.git
cd llvm-project
mkdir build && cd build
```

然后，使用CMake配置和编译：

```bash
cmake ..
make
```

最后，安装编译器：

```bash
sudo make install
```

### 5.2 源代码详细实现

以下是一个简单的Clang编译器示例，用于将C++代码编译成机器代码。

```cpp
// main.cpp
#include <iostream>

int main() {
    std::cout << "Hello, World!" << std::endl;
    return 0;
}
```

使用Clang编译上述代码：

```bash
clang++ main.cpp -o main
```

这将生成一个名为`main`的可执行文件。

### 5.3 代码解读与分析

上述示例中，我们首先包含了iostream头文件，以便使用标准输出流。然后，我们定义了main函数，它输出“Hello, World!”并返回0。

编译过程首先由Clang前端将C++代码转换成中间表示（IR），然后由LLVM后端生成机器代码。在执行时，机器代码将被加载到内存中，并执行main函数。

### 5.4 运行结果展示

运行生成的可执行文件：

```bash
./main
```

输出结果：

```
Hello, World!
```

这表明Clang成功地编译并执行了C++代码。

## 6. 实际应用场景

LLVM和Clang在现代编译器基础设施中有着广泛的应用场景：

1. **开源编译器**：Clang作为开源编译器的代表，广泛应用于Linux、macOS等操作系统中。

2. **跨平台开发**：LLVM和Clang支持多种编程语言和目标平台，使得开发者可以方便地实现跨平台开发。

3. **性能优化**：LLVM提供了丰富的优化技术，可以显著提高程序的执行效率。

4. **静态分析**：LLVM可以作为静态分析工具的底层基础设施，用于代码审查和安全性分析。

5. **教育与研究**：LLVM和Clang为计算机科学教育和研究提供了一个强大的工具集，使得学生和研究者可以深入理解编译器的工作原理。

## 7. 工具和资源推荐

### 7.1 学习资源推荐

1. [LLVM官方文档](https://llvm.org/docs/)
2. [Clang官方文档](https://clang.llvm.org/docs/)
3. 《LLVM/Clang官方手册》
4. 《深入理解计算机系统》
5. 《编译原理：艺术与科学》

### 7.2 开发工具推荐

1. **LLVM和Clang源代码**：[https://llvm.org/](https://llvm.org/)
2. **CMake**：[https://cmake.org/](https://cmake.org/)
3. **Eclipse CDT**：[https://www.eclipse.org/CDT/](https://www.eclipse.org/CDT/)
4. **Visual Studio Code**：[https://code.visualstudio.com/](https://code.visualstudio.com/)

### 7.3 相关论文推荐

1. “The LLVM Compiler Infrastructure”
2. “A Retargetable C Compiler for Program Exploration and Testing”
3. “Fast Incremental Compilation in LLVM”
4. “An Overview of LLVM: Status and Evolution”
5. “The Design and Implementation of the C++ Frontend for LLVM”

## 8. 总结：未来发展趋势与挑战

### 8.1 研究成果总结

LLVM和Clang在现代编译器基础设施中取得了显著的研究成果。它们提供了强大的代码优化和跨平台支持功能，广泛应用于开源编译器、性能优化、静态分析等领域。

### 8.2 未来发展趋势

未来，LLVM和Clang将继续致力于改进代码优化算法、扩展语言支持、提高编译速度和性能。此外，它们还可能引入更多的高级特性，如机器学习、自动并行化等。

### 8.3 面临的挑战

1. **性能优化**：随着硬件性能的不断提升，如何进一步提高编译器的性能成为一个挑战。

2. **语言支持**：如何支持更多的新型编程语言和语言特性。

3. **兼容性**：如何保持与其他编译器（如GCC）的兼容性。

4. **安全性**：如何提高编译器的安全性，防止潜在的安全漏洞。

### 8.4 研究展望

未来，LLVM和Clang将继续在编译器领域发挥重要作用。通过不断改进和扩展，它们将为开发者提供更高效、更安全的编译器解决方案。

## 9. 附录：常见问题与解答

### 9.1 如何安装LLVM和Clang？

首先，从[LLVM官网](https://llvm.org/)下载LLVM和Clang的源代码。然后，使用CMake配置和编译，最后安装编译器。

### 9.2 LLVM和Clang的主要区别是什么？

LLVM是一个模块化的、可重用的中间表示（IR）编译器基础设施，而Clang是LLVM的一个前端，实现了C、C++、Objective-C和Objective-C++的语法解析、语义分析和代码生成。

### 9.3 LLVM和GCC的区别是什么？

LLVM和GCC都是编译器基础设施，但LLVM更加模块化、可重用，支持更多的编程语言和目标平台，同时提供了强大的优化技术。GCC虽然历史悠久，但在某些方面（如优化技术）可能不如LLVM先进。

### 9.4 LLVM和Clang的优缺点是什么？

**优点**：模块化设计、高效的代码优化、跨平台支持。**缺点**：学习曲线较陡、性能开销较大。

### 9.5 如何优化LLVM和Clang的编译速度？

可以通过以下方法优化LLVM和Clang的编译速度：

1. 使用预编译头文件。
2. 关闭不必要的调试信息生成。
3. 使用并行编译。
4. 定制CMake配置，优化编译器参数。

---

以上是完整版的markdown格式的文章，希望对您有所帮助。
```

请注意，由于markdown不支持嵌入LaTeX数学公式，如果您需要在文章中包含数学公式，您可能需要考虑将这部分内容以图片或单独的PDF文件形式附在文章结尾。此外，Mermaid流程图需要在支持Mermaid的markdown编辑器中渲染，某些markdown平台可能不支持直接嵌入。

