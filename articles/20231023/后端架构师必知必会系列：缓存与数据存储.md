
作者：禅与计算机程序设计艺术                    

# 1.背景介绍


## 什么是缓存？
缓存（Cache）又称为页面缓冲、高速缓冲器或运行缓冲区，是存储在计算机系统内用于临时保存数据的区域。缓存是利用空间换时间的策略，使得对高频访问的数据能更快地被访问到。由于CPU速度远高于内存速度，所以如果CPU需要访问的数据常常处于内存中，则无疑会造成资源的巨大浪费。而缓存机制就是为了解决这一问题，将那些经常用到的、同时也很小的访问数据复制一份放在缓存中，这样就可以避免对实际数据的访问，从而提高程序的执行效率。
## 为什么要用缓存？
1.降低数据库查询压力。由于CPU的处理能力远不及内存的读写速度，因此，当数据库中的数据量过大时，可能导致CPU等待时间过长，甚至超时无法返回结果。缓存可以把常用的查询结果暂存到内存中，下次请求同样的数据就直接从缓存中获取，有效地降低了数据库的查询压力。
2.提升页面响应速度。对于相同用户访问某个页面的多次请求，可以将页面的渲染结果直接存入缓存，这样可以提高页面的响应速度，减少页面的加载时间，加快用户体验。
3.降低服务器负载。在缓存失效后，若仍然需要从数据库中读取数据，则需要再次向数据库发送请求，这种做法对服务器的压力较大，因此可以利用缓存作为分流手段，尽量减少对服务器的请求，从而降低服务器的负载。
## 缓存分类
根据存放数据的位置不同，缓存可分为内存缓存和磁盘缓存两种。
### 内存缓存
内存缓存是指将数据保留在内存中，它具有最快的响应速度，但是内存容量有限，所以缓存通常都设置一个上限，超出这个上限的数据就会被自动删除掉。常用的内存缓存产品有Redis、Memcached等。
### 磁盘缓存
磁盘缓存是指将数据保留在硬盘中，它的优点是可以突破内存限制，但存储成本较高，响应速度相对慢一些。常用的磁盘缓存产品有Ehcache、Jboss Cache等。
## 数据类型
### 缓存穿透
缓存穿透是指查询一个一定不存在的数据时，此时缓存没有命中，所导致的全请求转发到DB，导致数据库压力过大甚至崩溃。比如黑客故意制造大量不存在的缓存key，导致这些请求均落到了DB。解决方法：一般情况下，把非法请求或者不存在的情况缓存设为空值，这样即便访问非法或不存在的缓存，依然不会消耗大量的资源。
### 缓存雪崩
缓存雪崩是指多个Key同时过期，所导致的缓存回源查询DB，从而对数据库造成压力过重，甚至崩溃。解决方法：设置合适的过期时间，避免同时失效的Key占用过多内存资源，另外可以通过布隆过滤器进行缓存校验，避免过期Key查询DB。
### 缓存击穿
缓存击穿是指某个热点 Key 在某一个时间段内大面积失效，此时 DB 查询被激烈打击，导致 DB 负载压力过重，甚至瘫痪。解决方法：为热点 Key 设置较短的过期时间，保证热点 Key 不被立即过期，另外通过互斥锁/乐观锁避免缓存击穿。