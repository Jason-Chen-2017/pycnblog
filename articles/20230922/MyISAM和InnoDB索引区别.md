
作者：禅与计算机程序设计艺术                    

# 1.简介
  

MyISAM和InnoDB都是MySQL数据库引擎，都支持对表进行索引，但他们在实现索引的方式、对查询性能的影响上存在着不同之处。本文将详细介绍MyISAM和InnoDB索引的区别，并用实例说明如何更好地选择索引类型。
# 2. MyISAM索引
MyISAM索引是在MySQL 3.23.x版本中引入的，它在数据文件和索引文件之间建立一个单列索引文件（key_file）。每个索引记录由两部分组成：第一部分是数据页的地址；第二部分是聚集索引的值或数据行的地址。
索引文件的大小一般设置为数据文件的大小的1/5~1/4，且MyISAM的索引文件只能以READ方式打开，不能够写入。
由于是基于数据文件建立的索引，所以索引的创建和维护比较简单，不需要考虑锁的问题。对于大型的数据表来说，这种索引方式可以满足日常使用的需求。
但是，缺点也很明显，每张表只能有一个主索引，同时，索引文件也会占用物理空间。因此，当数据量较大时，可以使用MyISAM作为辅助索引来提高检索效率。
# 3. InnoDB索引
InnoDB是MySQL默认的数据库引擎，从MySQL 5.5.x开始，InnoDB支持行级锁定和外键完整性约束。相比于MyISAM，InnoDB索引通过主键和唯一键进行索引，并且支持多种索引类型。
InnoDB索引分为聚集索引和辅助索引。InnoDB的聚集索引类似于MyISAM的主索引，根据索引字段排序的数据行存储在一个结构化的索引表里。每张InnoDB表都至少要有一个聚集索引，如果没有定义主键或者唯一索引，InnoDB将自动创建一个隐藏的聚集索引。
InnoDB支持多种类型的索引，包括普通索引(也叫做BTREE索引)、全文索引、空间索引和哈希索引等。对于每种类型的索引，InnoDB都会维护相应的索引文件，索引文件里的记录用来告诉InnoDB数据行的物理位置。
InnoDB索引需要更多的磁盘空间来存储索引文件，同时为了保证事务的一致性和并发控制，InnoDB还使用了内部锁机制来确保索引的正确性。因此，InnoDB索引具有更好的性能。
# 4. MyISAM索引优点和缺点
## 4.1. 优点
- 支持全文索引：MyISAM支持全文索引功能，使得用户可以在搜索关键词时直接定位到相关数据。
- 不支持事务处理：MyISAM不支持事务处理，这就意味着在执行插入、更新和删除语句时不会原子化地执行，也就是说，如果有一条SQL语句执行失败，并不是说数据库本身就发生错误，而是事后无法撤销的状态。
- 数据可压缩性高：MyISAM的索引可以被压缩，这对于节省磁盘空间很有帮助。
- 插入速度快：对于静态或是较小的表，插入数据的速度比InnoDB快很多。
## 4.2. 缺点
- 查询效率低下：MyISAM的索引文件仅保存数据表中主键和第一个独立索引的值，因此，如果该表的查询语句仅涉及主键或者第一个独立索引，那么MyISAM将非常高效。但如果查询语句中既包含主键又包含非聚集索引，那么查询效率可能就不如InnoDB。此外，MyISAM只支持表级锁，这限制了并发处理能力。
- 内存碎片：MyISAM虽然支持内存表，但其设计目标却是内存数据库，因此，对大的结果集进行排序时可能会出现内存溢出错误。
- 不支持事务安全机制：对于MyISAM表的读写操作，不会自动加锁，这就会导致并发访问时数据不一致的问题。
- 没有崩溃恢复能力：在服务器奔溃时，MyISAM不会自动从损坏的表中�复数据，用户需要自己手动备份，或者利用其它工具恢复。
# 5. InnoDB索引优点和缺点
## 5.1. 优点
- 支持行级锁：InnoDB支持行级锁定，可以有效地防止阻塞。
- 外键约束完整性：InnoDB采用的是聚集索引，因此它能够确保数据的完整性。
- 提供事务安全机制：InnoDB支持事务，而且它是通过多种机制来确保数据的完整性，包括插入、删除、修改、复制、回滚等。
- 数据可压缩性强：InnoDB存储引擎提供了许多压缩选项，可以将表格数据压缩进磁盘，从而减少硬盘I/O消耗。
## 5.2. 缺点
- INSERT性能差：INSERT操作的效率低下，因为InnoDB不像MyISAM一样有预读机制，所有插入操作都要顺序地写入磁盘。
- 更新缓存失效：由于InnoDB支持行级锁定，即使在读取时刻也不能执行DELETE或UPDATE语句，这就可能导致数据的更新缓存发生冲突，从而导致查询结果的不准确。
- 占用更多的磁盘空间：InnoDB会为每个表分配额外的内存，同时为了维持数据和索引的一致性，InnoDB不允许任何用户直接修改系统表，这样可以确保数据的安全性。