
作者：禅与计算机程序设计艺术                    

# 1.背景介绍


在现实生活中,经常会遇到这样一种情况:需要连接两个不同的设备或者模块,但它们之间没有统一接口,无法实现直接通信.比如想通过串口与某台上位机进行通信,但是上位机的硬件接口和编程语言都不兼容,不能直接连接,那么就需要一个适配器将上位机的接口转换成符合串口协议的标准,这样就可以通过串口与上位机进行通信了.再如,希望将一个功能简单的手机应用转化成复杂的游戏系统的画面渲染部分,就需要一个适配器将手机屏幕上绘制的内容转换成游戏窗口可以接受的数据格式.总之,适配器模式就是为了解决不同设备之间的接口不一致而产生的中间层,使得两者能够实现沟通互动.

模式驱动开发(MDD)是一种敏捷开发方法,它基于对象,组件,模式等概念构建应用。它的基本原则是从通用模式、行为模式、领域模式、设计模式、结构模式四个层次分别抽象出类、组件、模式及其它构件。它由IDE提供支持,包括UML建模工具、模式工程师工作模板、模式库、自动生成的代码等。模式驱动开发包括识别模式、创建模式、组织模式、验证模式、演化模式、复用模式六个阶段,有助于提高应用的可维护性、扩展性、复用性和可移植性。

适配器模式(Adapter Pattern)是结构型模式之一,其定义如下:一个适配器允许对象参与到另一个接口中,从而起到翻译作用.适配器实现了一个中间的包装,使得原本由于接口不兼容而不能一起工作的那些类可以在一起协作.适配器模式的优点是可以通过一个已有的类来满足新的需求,并减少耦合度,增加灵活性.缺点是代码可能很复杂,并且难以维护,所以尽量避免使用适配器模式,应该在层次划分清晰时才考虑使用适配器模式.

通常来说,适配器模式分为类的适配器模式和对象适配器模式两种。类适配器模式需要编写一组完整的接口类,客户端才能利用这些接口与目标接口相连。对象适配器模式不需要编写额外的接口类,而是在运行时动态地创建源对象和目标对象,而且可以把它们组合起来.当然,在实际场景中,如果没有特别要求,一般使用对象的适配器模式更加灵活方便.

在实际应用中,适配器模式经常被用在以下几个方面:

1. 技术间的适配:一些开源框架或SDK只能与特定类型或版本的设备或协议兼容,这时候就需要适配器模式将开源框架的接口转换成特定硬件或协议的接口,才能与设备或协议交互。比如说USB HID适配器能将HID设备转换成普通USB接口,可以让系统识别该设备。

2. 接口规范化:当不同厂商生产的产品具有相同的接口,但兼容性不好时,适配器模式可以将不同厂商的接口规范化为共同的接口,以便统一使用。

3. 框架封装:在软件架构设计中,为了达到良好的可维护性和扩展性,往往会把关键的业务逻辑封装进框架中,外部应用只需要调用接口即可。对于框架内部实现的某个模块来说,如果依赖于其他模块的接口,而它们又存在着兼容性问题,这时候就需要引入适配器模式进行适配。

4. 数据转换:不同协议间的数据格式不一致,或者一些数据处理方式与系统设计有所冲突时,就需要引入适配器模式对数据的转换。例如,HTTP请求的数据格式与数据库数据表字段不一致,这时候就需要引入JSON-RPC、SOAP等适配器将请求的数据转换为数据库字段。

5. 第三方接口:有时候一些开源项目仅提供了简单而原始的接口,这种情况下需要引入适配器模式提供定制的接口,将原有的接口规范化。

# 2. 核心概念与联系
适配器模式的主要角色有三个:

1. Client:指客户,也就是调用适配器的对象,他要使用的功能由适配器的Adaptee完成.

2. Target:指目标接口,客户期待得到的接口.

3. Adaptee:指被适配的对象,也就是目标接口所需的接口,但此接口与客户所需的接口不一致.


## UML图示

适配器模式的UML类图表示如下:


## 适配器模式的主要优点和缺点
### 适配器模式的主要优点
1. 主要优点之一是可以使得类的接口符合用户的预期,使得类更加符合直觉和惯例。比如采用适配器模式将一个旧的接口转换成新接口,使得原来正常工作的类可以与新接口一起工作,而无须修改源代码。

2. 主要优点之二是适配器模式实现了“开闭”原则,对于那些不需要用到的功能,可以单独关闭甚至移除,并不会影响其他用到这个功能的客户。

3. 适配器模式的目的是消除由于接口不兼容所造成的类的兼容性问题。通过适配器模式,程序中的对象与其所期待的接口之间形成了一个适配器,这样就可以通过该适配器与其通信,从而获得想要的功能。

### 适配器模式的主要缺点
1. 在使用适配器模式时,需要了解被适配者和目标接口的特性,确保匹配。如果出现不匹配的情况,适配器可能会导致错误发生。

2. 适配器模式可能会增加类的数量,因为在设计初期应当考虑到所有可能用到的适配器类,而设计最后并没有完全遵循开闭原则,反而引入了很多冗余的类。

3. 适配器模式会引起类的个数过多,这也违背了设计模式的“少即是多”的原则。

4. 如果设计不当,可能会造成复杂性过高,不易维护和修改。