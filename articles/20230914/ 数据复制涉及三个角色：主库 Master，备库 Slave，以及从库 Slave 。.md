
作者：禅与计算机程序设计艺术                    

# 1.简介
  

数据复制（Data Replication）是指在多个数据库服务器之间保持数据的同步和一致性。复制通常由两部分组成：一个是从数据库服务器中获取数据的实时拷贝（即复制），另一个是将数据从主数据库服务器传送到从数据库服务器（即同步）。目前，主流的数据复制技术一般分为两种：
- 基于语句级的复制：主要用于关系型数据库，例如MySQL、Oracle等，它通过SQL语句的复制方式实现数据的复制，其优点是简单易用，缺点是效率低下。
- 基于日志文件或二进制日志文件的复制：主要用于非关系型数据库，如MongoDB、Redis等，它通过记录操作日志的方式实现数据的复制，其优点是灵活快捷，缺点是需要额外配置才能实现。

本文仅讨论基于语句级的复制。

常见的主从复制模式如下：
- 一主多从模式：一个主数据库服务器负责写入数据并同时将数据同步到多个从数据库服务器。
- 多主一从模式：多个主数据库服务器负责写入数据，但只有一个从数据库服务器负责读取和同步数据。
- 混合模式：混合多主多从模式。

本文讨论的内容仅涉及一主多从模式。

# 2.基本概念术语说明
## 2.1 概念
### 2.1.1 主库Master
主库（Master）又称为数据源库、主服务器或主机服务器，是复制环境中的第一个数据库服务器，负责进行所有的写入操作，并且会将所有数据变更事件通知给其他数据库服务器。它拥有完整的数据集，即使在发生任何故障之后也不会丢失任何数据。主库上可以进行各种DDL（Data Definition Language，数据定义语言）操作，包括创建表、索引、视图等。

### 2.1.2 从库Slave
从库（Slave）又称为数据目标库、从服务器或从机服务器，是复制环境中的第二个数据库服务器，用来接收主库发送过来的更新。当主库出现故障时，从库可以接管工作。从库只能执行SELECT和SHOW操作，不能执行INSERT、UPDATE和DELETE操作。从库通常比主库具有更好的性能，因为它只处理读操作，不处理写操作。但是如果主库重启后重新连接，则主库和从库的数据就会不一致。因此，如果必须保证数据一致性，可以通过开启二进制日志（Binary Log）来避免。

### 2.1.3 复制延迟
复制延迟（Replication Delay）是指从库收到主库的更新所经历的时间，它反映了复制环境中数据更新的延迟情况。

### 2.1.4 异步复制
异步复制（Asynchronous Replication）是指主库将数据变更事件通知给其他数据库服务器后便立即返回，而不等待从库完成更新。这样的话，主库和从库的数据就可能存在延迟。

### 2.1.5 事务
事务（Transaction）是一系列 SQL 操作序列，它作为单个不可分割的工作单元被执行，要么完全成功，要么完全失败。事务提供了一种机制，用来管理对数据库所做更改，确保这些更改不会因单个失败操作而导致整个系统的崩溃。

### 2.1.6 自动提交
自动提交（Auto Commit）是默认设置，在每次执行一条语句后，事务都会自动提交，不需要显式地调用commit命令。它的好处是用户不需要手动去提交事务，减少了用户的操作量；坏处也是会造成一些隐患，比如异常情况下无法回滚事务。

## 2.2 术语
### 2.2.1 逻辑复制
逻辑复制（Logical Replication）是指通过将数据变更记录（change events）应用到目标数据库，而不是物理复制整个数据库的结构。

### 2.2.2 物理复制
物理复制（Physical Replication）是指主库直接将数据文件复制到从库，再将它们在磁盘上的位置映射到不同的进程地址空间。

### 2.2.3 阻塞复制
阻塞复制（Blocking Replication）是指在发生数据变化时，如果目标服务器正在运行事务，则主库暂停复制，直到目标服务器结束当前事务。

### 2.2.4 轮询复制
轮询复制（Polling Replication）是指每隔一段时间检查一次主库是否有新的更新，然后将新更新传播到所有从库。这种方式比较耗费资源，尤其是在主库繁忙时。

### 2.2.5 其它术语
- GTID（Global Transaction IDentifier）：全局事务标识符，由主库生成的唯一事务编号。
- 慢查点（Checkpoint）：在主库上创建一个事务ID标记，主库把该标记之前的更新都写入日志并刷新到磁盘。在从库上建立一个GTID集合，从库定期从主库拉取该集合。
- 只读副本（Read Only Replica）：数据库副本，只能执行查询操作，不能执行写操作。