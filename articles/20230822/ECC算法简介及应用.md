
作者：禅与计算机程序设计艺术                    

# 1.简介
  
：
现代密码学中，存在着对称加密（如DES、AES等）、公钥加密（RSA、DSA等）、密钥交换协议（Diffie-Hellman、ElGamal、ECDH等）、数字签名等一系列加密技术。其中，ECC（Elliptic Curve Cryptography，椭圆曲线加密算法）可以用来解决“基于离散对数难题”的安全性问题，它属于一种密码学算法，由美国计算机科学家Maurice Williams发明，是一种基于椭圆曲线的公共密钥加密方案，能够在很小的通信通道中安全地进行通信。它具有以下优点：

1. 椭圆曲线方程本身易于计算，可以实现高效的加法运算；

2. ECC公钥长度较短，仅需要密钥协商过程中交换的一部分信息，而非对称加密中的完整公钥长度；

3. 避免了RSA中的模重复性问题，使得密钥更安全。

其它的一些加密技术虽然也可以用于对称加密或公钥加密，但是由于其性能不够高或者要求太高，无法完全替代ECC，因此大多数人还是会选择ECC。

# 2.基本概念术语说明：
## 2.1.群
群是一个集合，对于两个元素A和B，他们的积等于C，则称C为A、B的共轭乘积，记作AB。
如果C也属于集合，则称这个集合为一个群，群的元素也被称为群元。
例如，整数集{−2,−1,0,1,2}构成了一个群，其中任何两个元素的积都有一个非零因子。
如果把集合S中的元素称为g1、g2、…、gn，将S中的每个元素分别与S中的任意两个元素相乘，得到一个新的集合，称为新集合为g1^1、g2^1、…、gn^1、g1^2、g2^2、…、gn^2、…，一直到Sn，则称这个新集合为这个群的Generators。

## 2.2.椭圆曲线
已知一个整数域F上面的一条曲线E: y^2=x^3+ax+b，其中a、b、c是已知参数，且a≠0，则称该曲线为椭圆曲线，E上的每一点都对应着一个阶为q的子群，它通过其基点G(x,y)来表示，即有G=√xy。

设E上点P=(px,py)为椭圆曲线上的一个点，E上点Q=(qx,qy)，则有两条辅助线l_p和l_q：

l_p：与P所在直线平行，与P相切，过Q;

l_q：与Q所在直线平行，与Q相切，过P。

如果l_p与l_q之间没有交点，则称P、Q互素；否则，称P、Q无穷远处的不同时相交。

**定义2** ECC算法适用的椭圆曲线一般为一元二次方程组： y^2 = x^3 + ax + b ，它们都有固定的底元素b，只有a才是个可选参数，通常取值为6、12、18、24、48、72中的某个值。

椭圆曲线的关于原点O的切线方程为：y^2 = x^3 + ax + b 。

椭圆曲线的基点G=(gx,gy)：

gx^3+gy^3=1+d*gx^2*gy^2。其中，d是一个参数，即：

    if a==0:
        return None
    else:
        d = (1/4)*(-3*(pow(sqrt((a-b)/(a+b)),2))+(a+3*b)*(a+b)*(b-a))

椭圆曲线的参数方程：

    y^2 = x^3 + ax + b

椭圆曲线上所有的点 P=(px, py), p是整数,满足：

    0<=px<q
    0<=py<q
    0<gx^3+gy^3-x^3-y^3≤s

其中q是一个质数,s为某正整数。

群的阶n：

    n = q+1

**定义3** 映射：

    def maptoPoint(k):  
        while True:  
            k += q   # k+q is used to calculate px and py  
            r = pow(k,-1,(q-1)//2)  
            rx = ((r*rx)%q)**2 % q  
            ry = ((r*ry)%q)**2 % q  
            x = ((rx - gx)%q)**2 % q  
            y = ((ry - gy)%q)**2 % q  
            if not (x == 0 and y == 0):  
                break   # point P has been found  
        return [px, py]  

maptoPoint函数输入一个整数k，返回该整数对应的椭圆曲线上一点坐标。

**定义4** 对称密码编码方法 (Symmetric Key Encryption Method)：

对称密码编码方法又称对称加密方法、对称加密算法。是一种最简单、最广泛使用的加密方式之一。在对称密码编码方法中，发送者和接收者事先商定一个密钥，然后再使用相同的密钥对消息进行加密和解密。由于双方必须采用相同的密钥，所以安全性较高。

这种加密方式中，加密过程用的是同一个密钥进行加密，解密过程也是使用同样的密钥进行解密。

**定义5** 分组密码编码方法 （Block Cipher Mode of Operation）：

分组密码编码方法主要包括ECB模式、CBC模式、CFB模式、OFB模式、CTR模式、GCM模式等。其中，ECB模式是最简单的分组密码编码方法。

ECB模式（Electronic Code Book，电码本模式）：

ECB模式直接将明文分成若干块（块大小为N字节），并对每块独立加密，这样就使得每一块都是独立的，不会因为之前的数据影响当前数据的加密结果。因此，这种模式虽然简单但容易受到攻击。

CBC模式（Cipher Block Chaining，密码块链模式）：

CBC模式采用了链接加密技术，对每一块数据先进行加密，然后再将加密结果和前一块数据进行异或（XOR）操作，作为下一块数据的加密输入。这种模式可以有效抵御某些分析攻击，并且可以防止数据流的泄露。

CFB模式（Cipher Feedback，密钥反馈模式）：

CFB模式类似于ECB模式，也是将明文分成若干块，并对每块独立加密。但是，在CFB模式中，增加了一层密码流生成器，将加密结果和前一块密文直接连接起来作为下一块加密输入。此外，还引入了一个初始化向量IV，保证了加密结果的初始随机性。

OFB模式（Output Feedback，输出反馈模式）：

OFB模式与CFB模式一样，也是将明文分成若干块，并对每块独立加密。但是，不同的是，OFB模式在加密后输出的密文只用来产生下一块加密密钥，而不是直接参与下一步加密。

CTR模式（CounTeR Mode，计数模式）：

CTR模式是一种特殊的分组密码编码方法。在CTR模式中，将一个计数器加入加密算法的输入。在每一段数据加密前，计数器递增，并与密钥结合形成一个加密密钥。每一个明文块都用此加密密钥加密，然后输出密文，而计数器继续递增。

GCM模式（Galois Counter Mode，盖洛伊-计数器模式）：

GCM模式是一种特殊的分组密码编码方法，是为了解决ECB模式的弱点而提出的。与其它模式不同，GCM模式能够提供额外的认证信息，对数据完整性的保护比其它模式要好。

**定义6** 哈希函数：

哈希函数是从任意长度的数据（又称消息摘要，message digest）转换到固定长度输出值的函数。哈希函数目的就是为了计算出一段数据在一定长度的情况下，能够产生唯一的固定长度输出值。

SHA-256：

SHA-256是目前推荐的加密Hash算法之一。它是一种五种分组加密算法之一，最初由美国国家安全局设计。

HMAC-SHA-256：

HMAC-SHA-256是一种利用哈希函数消息鉴别代码的认证算法。它是基于密钥相关哈希的一种加密过程，可以在不可靠的网络环境下实现安全的通信。