
作者：禅与计算机程序设计艺术                    

# 1.背景介绍


查询缓存与结果缓存是mysql中最基本的优化策略。查询缓存将对数据库进行查询时的请求进行缓存，使得之后相同的请求能够直接从缓存中返回结果；而结果缓存则在查询完成后对结果进行缓存，下次相同的查询不需要再次执行，直接返回结果缓存中的数据。查询缓存与结果缓存的优化对于提高数据库性能起到至关重要的作用。本文介绍的是mysql查询缓存与结果缓存的工作机制、原理以及相关配置项。
# 2.核心概念与联系

### 查询缓存

查询缓存(query cache)是mysql的一个优化功能，其目的是为了加速数据库的查询速度。当数据库服务器接收到一个查询请求时，首先会先查看是否有该查询语句的缓存结果。如果有，则会直接返回缓存结果；如果没有，则会继续处理该请求并将结果缓存起来，这样以后再出现相同的查询请求的时候就可以直接从缓存中获取结果，避免了重新执行查询语句。

### 查询缓存工作流程

1. 查询缓存被默认开启，可以通过设置show variables like '%query_cache%';命令来查看query_cache的值。
2. 当用户第一次执行一个查询语句时，mysql服务器将该查询语句及相关参数和结果存入查询缓存中。
3. 下一次相同的查询请求发生时，mysql服务器会先检查查询缓存是否存在相应的结果。
4. 如果找到对应的结果，mysql服务器就不会再去执行查询语句，而是直接从缓存中返回结果。
5. 如果找不到结果，那么mysql服务器才会真正地执行查询语句，然后将查询结果缓存在查询缓存中。

### 结果缓存

结果缓存(result cache)与查询缓存类似，也是mysql的一个优化功能。不同之处在于，结果缓存是指在对数据库查询的结果进行缓存。也就是说，在查询执行完成后，服务器把查询结果存放到内存或磁盘中，供下次查询使用。

### 结果缓存工作流程

1. 结果缓存也被默认开启，可以通过设置show variables like '%result_cache%';命令来查看result_cache的值。
2. 查询语句被执行后产生结果后，结果被存放到结果缓存中。
3. 下一次相同的查询请求发生时，mysql服务器首先检查结果缓存中是否存在之前查询的结果。
4. 如果找到结果缓存，mysql服务器直接从缓存中取出结果并返回，而不是再次执行查询语句。
5. 如果找不到结果缓存，那么mysql服务器才会真正地执行查询语句，然后将查询结果存放到结果缓存中。
6. 对同一个表的多个查询请求可以使用查询缓存，但是对其他表的查询不使用查询缓存。

### 配置项

配置项 | 作用 
--- | --- 
query_cache_type | 设置查询缓存的类型：DEMAND（默认值）、ON、OFF。
query_cache_size | 设置查询缓存的大小，单位：字节。
query_cache_limit | 设置查询缓存的限制大小，单位：字节。
long_query_time | 设置慢查询阈值，单位：秒。超过这个时间的查询都会被记录到日志文件中。
key_buffer_size | 设置索引缓冲区大小，单位：字节。
sort_buffer_size | 设置排序缓冲区大小，单位：字节。
myisam_sort_buffer_size | 设置MyISAM索引排序缓冲区大小，单位：字节。
read_buffer_size | 设置读缓存大小，单位：字节。
read_rnd_buffer_size | 设置随机读缓存大小，单位：字节。
bulk_insert_buffer_size | 设置批量插入缓存大小，单位：字节。
thread_cache_size | 设置线程缓存大小。
table_open_cache | 设置打开表格缓存数量。
table_definition_cache | 设置表定义信息缓存数量。
table_open_cache | 设置打开表格缓存数量。
max_connections | 设置最大连接数。
max_user_connections | 设置每个用户的最大连接数。
wait_timeout | 设置客户端空闲连接超时时间，单位：秒。
net_buffer_length | 设置网络读写缓冲区大小，单位：字节。
binlog_cache_size | 设置二进制日志缓存大小，单位：字节。
binlog_stmt_cache_size | 设置二进制日志状态变量缓存大小，单位：字节。