
作者：禅与计算机程序设计艺术                    

# 1.背景介绍


## Event-driven Architecture（EDA）
事件驱动架构（EDA）是一种分布式、异步、可扩展的应用架构模式。它基于事件溯源模式，并将应用程序划分成一个个事件处理器，每当某个事件发生时，会触发一个或多个事件处理器执行相关操作。

在一个分布式系统里，组件之间通过消息传递进行通信，消息传递有两种模式：同步（同步模式）、异步（异步模式）。在同步模式下，发送者和接收者需要同时收到信息才能继续往下执行；而异步模式下，发送者可以先发送消息，然后再继续执行自己的逻辑，等到接收者准备好了之后再处理。在EDA中，消息是异步的，因此，组件之间的通信采用异步模式。

Event-Driven Architecture提倡通过发布/订阅的方式建立松耦合的边界。事件驱动架构里的应用会自动地将消息发布给感兴趣的事件处理器，从而简化应用的开发、调试和维护，提升系统的可靠性、弹性和可伸缩性。

### Event-driven architecture优点
- 分布式：EDA 允许多个服务节点并行运行，从而提高整体性能。
- 异步：EDA 使用异步消息传递方式，使得各个服务组件之间解耦合，降低复杂性。
- 可扩展性：EDA 可以按需增加节点，进而提升整体性能。
- 弹性：由于使用了异步机制，失败不会导致整个系统崩溃，因此系统更具弹性。
- 可观测性：EDA 提供了丰富的指标监控功能，能够实时掌握系统运行状况。

### Event-driven architecture缺点
- 复杂性：系统越复杂，实现 EDA 就越难。
- 技术门槛：实现 EDA 的技术要求高，对开发人员的知识和能力要求也较高。

## What is event sourcing?
事件溯源模式(event sourcing)描述的是如何用数据记录实际发生的事情，而非只记录事件。相比于传统的数据建模方法，事件溯源把所有产生的事件都保存在一个日志数据库里面，然后根据这些事件重建出当前对象的状态历史。

事件溯源适用于以下场景：

1. 数据修改频繁，比如账务系统中的交易记录、库存管理系统中的商品库存等
2. 需要追踪对象历史状态，比如订单生命周期的变化、设备在线/离线的变化等
3. 多次修改后才会产生数据的情况，比如金融交易所中进行反向委托的记录
4. 对历史数据的审计需求很强烈

### 为什么要使用事件溯源？

事件溯源模式在很多领域都有广泛应用。这里以金融行业举例说明为什么要使用事件溯源：

1. 金融行业对于实时的交易非常敏感，短时间内的实时价格变动会影响投资结果。但是传统的计算手段无法保证实时价格的准确性。
2. 在金融市场中，多方参与同一笔交易，每方只能看到自己参与的那一方的行为，而无法看到整个过程。
3. 交易往往需要经过复杂的审核流程，但传统的审计记录通常都是静态的，无法反映交易的真实状态。

所以，事件溯源正是为了解决这些问题而出现的。通过将交易过程中的每个事件都持久化存储下来，可以构建出完整的交易链条，记录到一个数据库中，然后再由不同的人士根据不同的角度审查，从而保证交易的真实性、完整性和一致性。