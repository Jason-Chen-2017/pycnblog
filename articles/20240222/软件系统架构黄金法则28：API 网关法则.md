                 

ğŸ‰ğŸ‰ğŸ‰è½¯ä»¶ç³»ç»Ÿæ¶æ„é»„é‡‘æ³•åˆ™28ï¼šAPI ç½‘å…³æ³•åˆ™ğŸ”¥ğŸ”¥ğŸ”¥
=====================================

ä½œè€…ï¼šç¦…ä¸è®¡ç®—æœºç¨‹åºè®¾è®¡è‰ºæœ¯
---------------------------

### æ³¨æ„

æœ¬æ–‡å± **ä¸“ä¸š IT é¢†åŸŸçš„æŠ€æœ¯åšå®¢**ï¼Œæ–‡ä¸­éš¾ç‚¹ä¼šé€šè¿‡ **æ•°å­¦æ¨¡å‹** è¯¦ç»†è¯´æ˜ã€‚å¦‚æœä½ å¯¹æ•°å­¦æ¨¡å‹æ¯”è¾ƒç”Ÿç–ï¼Œå¯ä»¥å…ˆè·³è¿‡è¿™äº›éƒ¨åˆ†ï¼Œä½†å»ºè®®åç»­å¤šå­¦ä¹ ç›¸å…³çŸ¥è¯†ä»¥è¿›ä¸€æ­¥ç†è§£ã€‚

å¦å¤–ï¼Œæœ¬æ–‡å·²ä½¿ç”¨ **Markdown æ ¼å¼** ç¼–å†™ï¼Œå› æ­¤æ”¯æŒåœ¨æ‰€æœ‰æ”¯æŒ Markdown æ¸²æŸ“çš„å¹³å°ä¸Šé˜…è¯»ã€‚

## ğŸ¯èƒŒæ™¯ä»‹ç»

### API ç½‘å…³

åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œæ¯ä¸ªå¾®æœåŠ¡éƒ½å¯ä»¥ç‹¬ç«‹éƒ¨ç½²å’Œæ‰©å±•ã€‚ä¸ºäº†ç®¡ç†å’Œä¿æŠ¤è¿™äº›å¾®æœåŠ¡ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª **API ç½‘å…³**ã€‚API ç½‘å…³ä½œä¸ºå¾®æœåŠ¡é›†åˆçš„ **å”¯ä¸€å…¥å£**ï¼Œæ‰¿æ‹…ä»¥ä¸‹èŒè´£ï¼š

1. èº«ä»½è®¤è¯å’Œæˆæƒï¼šéªŒè¯å®¢æˆ·ç«¯èº«ä»½ï¼Œç¡®ä¿åªæœ‰æˆæƒè®¿é—®çš„å®¢æˆ·ç«¯å¯ä»¥è°ƒç”¨å¾®æœåŠ¡ã€‚
2. é€Ÿç‡é™åˆ¶ï¼šé¿å…æŸäº›å®¢æˆ·ç«¯è¿‡åº¦è°ƒç”¨å¾®æœåŠ¡ï¼Œå½±å“å…¶ä»–å®¢æˆ·ç«¯çš„æœåŠ¡è´¨é‡ã€‚
3. ç›‘æ§å’Œæ—¥å¿—ï¼šè®°å½•æ¯æ¬¡è¯·æ±‚å’Œå“åº”ï¼Œä¾¿äºæ’æŸ¥é—®é¢˜å’Œæ”¹è¿›ç³»ç»Ÿã€‚
4. è´Ÿè½½å‡è¡¡ï¼šå°†æµé‡åˆ†é…åˆ°å¤šä¸ªå¾®æœåŠ¡å®ä¾‹ä¸Šï¼Œæé«˜ç³»ç»Ÿæ•´ä½“æ€§èƒ½å’Œå¯ç”¨æ€§ã€‚
5. ç¼“å­˜ï¼šå‡å°‘å¯¹æ•°æ®åº“çš„è®¿é—®æ¬¡æ•°ï¼Œæé«˜ç³»ç»Ÿæ€§èƒ½ã€‚
6. è½¬æ¢ï¼šå°†å®¢æˆ·ç«¯è¯·æ±‚è½¬æ¢æˆå¾®æœåŠ¡å¯ä»¥ç†è§£çš„æ ¼å¼ï¼Œä¹Ÿå¯ä»¥å°†å¾®æœåŠ¡çš„å“åº”è½¬æ¢æˆå®¢æˆ·ç«¯å¯ä»¥ç†è§£çš„æ ¼å¼ã€‚

### API ç½‘å…³æ¨¡å¼

API ç½‘å…³æ¨¡å¼åŒ…æ‹¬ä»¥ä¸‹å‡ ç§ï¼š

1. **å•ä¸€å…¥å£æ¨¡å¼ï¼ˆSingle-Entryï¼‰**ï¼šæ‰€æœ‰è¯·æ±‚å¿…é¡»ç»è¿‡ API ç½‘å…³ï¼Œæ‰èƒ½åˆ°è¾¾å¾®æœåŠ¡ã€‚
2. **æ™ºèƒ½è·¯ç”±æ¨¡å¼ï¼ˆSmart Routingï¼‰**ï¼šæ ¹æ®ä¸åŒæ¡ä»¶ï¼ˆä¾‹å¦‚ URIã€HTTP æ–¹æ³•ã€Header ç­‰ï¼‰ï¼Œå°†è¯·æ±‚è·¯ç”±åˆ°ä¸åŒçš„å¾®æœåŠ¡ã€‚
3. åå‘ä»£ç†æ¨¡å¼ï¼ˆReverse Proxyï¼‰ï¼šAPI ç½‘å…³æ—¢æ˜¯å®¢æˆ·ç«¯çš„æœåŠ¡å™¨ï¼Œåˆæ˜¯å¾®æœåŠ¡çš„å®¢æˆ·ç«¯ã€‚

## ğŸ”—æ ¸å¿ƒæ¦‚å¿µä¸è”ç³»

### å¸¸è§æ¦‚å¿µ

#### API

APIï¼ˆApplication Programming Interfaceï¼‰æ˜¯ä¸€ç»„ç”¨äºå¼€å‘å’Œé›†æˆåº”ç”¨ç¨‹åºçš„æ¥å£ã€‚API å®šä¹‰äº†åº”ç”¨ç¨‹åºå¦‚ä½•ç›¸äº’é€šä¿¡ï¼Œä»¥åŠä¼ è¾“æ•°æ®çš„æ ¼å¼ã€‚

#### HTTP

HTTPï¼ˆHypertext Transfer Protocolï¼‰æ˜¯ä¸€ç§åŸºäº TCP/IP åè®®æ ˆçš„åº”ç”¨å±‚åè®®ï¼Œç”¨äºåœ¨ Web ä¸Šä¼ è¾“è¶…æ–‡æœ¬æ•°æ®ã€‚HTTP çš„ä¸»è¦ç‰¹ç‚¹æ˜¯æ”¯æŒè¯·æ±‚-å“åº”æ¨¡å‹ã€ç®€å•å¿«é€Ÿã€çµæ´»ã€æ— çŠ¶æ€ç­‰ã€‚

#### å¾®æœåŠ¡

å¾®æœåŠ¡æ˜¯ä¸€ç§æ¶æ„é£æ ¼ï¼Œå®ƒå°†å•ä¸€åº”ç”¨ç¨‹åºæ‹†åˆ†æˆå¤šä¸ªå°å‹æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡è¿è¡Œåœ¨è‡ªå·±çš„è¿›ç¨‹ä¸­ï¼Œå¹¶ä½¿ç”¨è½»é‡çº§é€šä¿¡æœºåˆ¶ï¼ˆä¾‹å¦‚ RESTful APIsã€Message Queuesï¼‰ç›¸äº’æ²Ÿé€šã€‚

### å…³é”®æ¦‚å¿µ

#### API ç½‘å…³

API ç½‘å…³æ˜¯ä¸€ç§ä¸­é—´ä»¶ï¼Œå®ƒä½äºå®¢æˆ·ç«¯å’Œå¾®æœåŠ¡ä¹‹é—´ï¼Œæ‰¿æ‹…ä»¥ä¸‹èŒè´£ï¼š

1. èº«ä»½è®¤è¯å’Œæˆæƒï¼šéªŒè¯å®¢æˆ·ç«¯èº«ä»½ï¼Œç¡®ä¿åªæœ‰æˆæƒè®¿é—®çš„å®¢æˆ·ç«¯å¯ä»¥è°ƒç”¨å¾®æœåŠ¡ã€‚
2. é€Ÿç‡é™åˆ¶ï¼šé¿å…æŸäº›å®¢æˆ·ç«¯è¿‡åº¦è°ƒç”¨å¾®æœåŠ¡ï¼Œå½±å“å…¶ä»–å®¢æˆ·ç«¯çš„æœåŠ¡è´¨é‡ã€‚
3. ç›‘æ§å’Œæ—¥å¿—ï¼šè®°å½•æ¯æ¬¡è¯·æ±‚å’Œå“åº”ï¼Œä¾¿äºæ’æŸ¥é—®é¢˜å’Œæ”¹è¿›ç³»ç»Ÿã€‚
4. è´Ÿè½½å‡è¡¡ï¼šå°†æµé‡åˆ†é…åˆ°å¤šä¸ªå¾®æœåŠ¡å®ä¾‹ä¸Šï¼Œæé«˜ç³»ç»Ÿæ•´ä½“æ€§èƒ½å’Œå¯ç”¨æ€§ã€‚
5. ç¼“å­˜ï¼šå‡å°‘å¯¹æ•°æ®åº“çš„è®¿é—®æ¬¡æ•°ï¼Œæé«˜ç³»ç»Ÿæ€§èƒ½ã€‚
6. è½¬æ¢ï¼šå°†å®¢æˆ·ç«¯è¯·æ±‚è½¬æ¢æˆå¾®æœåŠ¡å¯ä»¥ç†è§£çš„æ ¼å¼ï¼Œä¹Ÿå¯ä»¥å°†å¾®æœåŠ¡çš„å“åº”è½¬æ¢æˆå®¢æˆ·ç«¯å¯ä»¥ç†è§£çš„æ ¼å¼ã€‚

#### å•ä¸€å…¥å£æ¨¡å¼

å•ä¸€å…¥å£æ¨¡å¼æ˜¯æœ€ç®€å•çš„ API ç½‘å…³æ¨¡å¼ï¼Œå®ƒè§„å®šæ‰€æœ‰è¯·æ±‚å¿…é¡»ç»è¿‡ API ç½‘å…³ï¼Œæ‰èƒ½åˆ°è¾¾å¾®æœåŠ¡ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥ç®€åŒ–ç½‘ç»œæ‹“æ‰‘ç»“æ„ã€é›†ä¸­ç®¡ç†å’Œæ§åˆ¶ API è®¿é—®ï¼Œæé«˜å®‰å…¨æ€§å’Œå¯ç®¡ç†æ€§ã€‚

#### æ™ºèƒ½è·¯ç”±æ¨¡å¼

æ™ºèƒ½è·¯ç”±æ¨¡å¼æ˜¯ä¸€ç§æ›´çµæ´»çš„ API ç½‘å…³æ¨¡å¼ï¼Œå®ƒæ ¹æ®ä¸åŒæ¡ä»¶ï¼ˆä¾‹å¦‚ URIã€HTTP æ–¹æ³•ã€Header ç­‰ï¼‰ï¼Œå°†è¯·æ±‚è·¯ç”±åˆ°ä¸åŒçš„å¾®æœåŠ¡ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥ç»†ç²’åº¦åœ°ç®¡ç†å’Œæ§åˆ¶ API è®¿é—®ï¼Œæé«˜ç³»ç»Ÿæ€§èƒ½å’Œå¯æ‰©å±•æ€§ã€‚

#### åå‘ä»£ç†æ¨¡å¼

åå‘ä»£ç†æ¨¡å¼æ˜¯ä¸€ç§ä¸­é—´ä»¶æ¨¡å¼ï¼Œå®ƒæ—¢æ˜¯å®¢æˆ·ç«¯çš„æœåŠ¡å™¨ï¼Œåˆæ˜¯å¾®æœåŠ¡çš„å®¢æˆ·ç«¯ã€‚API ç½‘å…³ä½œä¸ºå®¢æˆ·ç«¯çš„æœåŠ¡å™¨ï¼Œæä¾›ç»Ÿä¸€çš„æ¥å£ç»™å®¢æˆ·ç«¯è°ƒç”¨ï¼›API ç½‘å…³ä½œä¸ºå¾®æœåŠ¡çš„å®¢æˆ·ç«¯ï¼Œå°†è¯·æ±‚è½¬å‘ç»™çœŸæ­£çš„å¾®æœåŠ¡ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥ç®€åŒ–å®¢æˆ·ç«¯çš„ç¼–ç¨‹æ¨¡å‹ã€éšè—å¾®æœåŠ¡çš„ç»†èŠ‚ã€æé«˜å®‰å…¨æ€§å’Œå¯ç®¡ç†æ€§ã€‚

## ğŸ§®æ ¸å¿ƒç®—æ³•åŸç†å’Œå…·ä½“æ“ä½œæ­¥éª¤ä»¥åŠæ•°å­¦æ¨¡å‹å…¬å¼è¯¦ç»†è®²è§£

### èº«ä»½è®¤è¯å’Œæˆæƒ

#### ç®—æ³•åŸç†

èº«ä»½è®¤è¯å’Œæˆæƒæ˜¯æŒ‡éªŒè¯å®¢æˆ·ç«¯èº«ä»½ï¼Œå¹¶åˆ¤æ–­å®¢æˆ·ç«¯æ˜¯å¦æœ‰æƒé™è®¿é—®å¾®æœåŠ¡ã€‚API ç½‘å…³å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ç®—æ³•æ¥å®Œæˆèº«ä»½è®¤è¯å’Œæˆæƒï¼š

1. **JWTï¼ˆJSON Web Tokenï¼‰**ï¼šAPI ç½‘å…³ç”Ÿæˆä¸€ä¸ª JWTï¼ŒåŒ…å«å®¢æˆ·ç«¯çš„å”¯ä¸€æ ‡è¯†ç¬¦å’Œè®¿é—®ä»¤ç‰Œã€‚å®¢æˆ·ç«¯å°† JWT å‘é€ç»™ API ç½‘å…³ï¼ŒAPI ç½‘å…³éªŒè¯ JWT çš„æœ‰æ•ˆæ€§å’Œå®Œæ•´æ€§ï¼Œç„¶åå…è®¸æˆ–æ‹’ç»è®¿é—®ã€‚
2. **OAuth2**ï¼šAPI ç½‘å…³ä½œä¸º OAuth2 çš„èµ„æºæœåŠ¡å™¨ï¼Œæ¥å—ç”± OAuth2 æœåŠ¡å™¨å‘æ”¾çš„è®¿é—®ä»¤ç‰Œã€‚å®¢æˆ·ç«¯å°†è®¿é—®ä»¤ç‰Œå‘é€ç»™ API ç½‘å…³ï¼ŒAPI ç½‘å…³éªŒè¯ä»¤ç‰Œçš„æœ‰æ•ˆæ€§å’Œå®Œæ•´æ€§ï¼Œç„¶åå…è®¸æˆ–æ‹’ç»è®¿é—®ã€‚

#### æ“ä½œæ­¥éª¤

1. å®¢æˆ·ç«¯å‘ OAuth2 æœåŠ¡å™¨ç”³è¯·è®¿é—®ä»¤ç‰Œã€‚
2. OAuth2 æœåŠ¡å™¨éªŒè¯å®¢æˆ·ç«¯èº«ä»½ï¼Œå¹¶è¿”å›è®¿é—®ä»¤ç‰Œã€‚
3. å®¢æˆ·ç«¯å°†è®¿é—®ä»¤ç‰Œå‘é€ç»™ API ç½‘å…³ã€‚
4. API ç½‘å…³éªŒè¯è®¿é—®ä»¤ç‰Œçš„æœ‰æ•ˆæ€§å’Œå®Œæ•´æ€§ï¼Œå¹¶è®°å½•å®¢æˆ·ç«¯ä¿¡æ¯ã€‚
5. API ç½‘å…³å…è®¸æˆ–æ‹’ç»å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚

#### æ•°å­¦æ¨¡å‹

API ç½‘å…³å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ•°å­¦æ¨¡å‹æ¥æè¿°èº«ä»½è®¤è¯å’Œæˆæƒç®—æ³•ï¼š

$$
AccessToken = f(ClientID, Nonce, Timestamp, Signature)
$$

* $$AccessToken$$ è¡¨ç¤ºè®¿é—®ä»¤ç‰Œã€‚
* $$ClientID$$ è¡¨ç¤ºå®¢æˆ·ç«¯çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚
* $$Nonce$$ è¡¨ç¤ºéšæœºæ•°ï¼Œé˜²æ­¢é‡æ”¾æ”»å‡»ã€‚
* $$Timestamp$$ è¡¨ç¤ºå½“å‰æ—¶é—´æˆ³ï¼Œé˜²æ­¢é‡æ”¾æ”»å‡»ã€‚
* $$Signature$$ è¡¨ç¤ºç­¾åï¼Œç”¨äºæ ¡éªŒæ¶ˆæ¯çš„å®Œæ•´æ€§å’Œé˜²æ­¢ç¯¡æ”¹ã€‚

### é€Ÿç‡é™åˆ¶

#### ç®—æ³•åŸç†

é€Ÿç‡é™åˆ¶æ˜¯æŒ‡é¿å…æŸäº›å®¢æˆ·ç«¯è¿‡åº¦è°ƒç”¨å¾®æœåŠ¡ï¼Œå½±å“å…¶ä»–å®¢æˆ·ç«¯çš„æœåŠ¡è´¨é‡ã€‚API ç½‘å…³å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ç®—æ³•æ¥å®Œæˆé€Ÿç‡é™åˆ¶ï¼š

1. **æ¼æ¡¶ç®—æ³•ï¼ˆToken Bucketï¼‰**ï¼šAPI ç½‘å…³ç»´æŠ¤ä¸€ä¸ªå›ºå®šå¤§å°çš„ä»¤ç‰Œæ¡¶ï¼Œæ¯ä¸ªæ—¶é—´å•ä½å¢åŠ ä¸€å®šæ•°é‡çš„ä»¤ç‰Œã€‚å®¢æˆ·ç«¯æ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦æ¶ˆè€—ä¸€ä¸ªä»¤ç‰Œã€‚å¦‚æœä»¤ç‰Œæ¡¶å·²æ»¡ï¼Œåˆ™è¶…å‡ºéƒ¨åˆ†çš„è¯·æ±‚è¢«ä¸¢å¼ƒæˆ–æ’é˜Ÿã€‚
2. **è®¡æ•°å™¨ç®—æ³•ï¼ˆLeaky Bucketï¼‰**ï¼šAPI ç½‘å…³ç»´æŠ¤ä¸€ä¸ªå›ºå®šå®¹é‡çš„è®¡æ•°å™¨ï¼Œæ¯ä¸ªæ—¶é—´å•ä½æ¸…ç©ºä¸€ä¸ªè®¡æ•°å™¨ã€‚å®¢æˆ·ç«¯æ¯æ¬¡è¯·æ±‚éƒ½ä¼šå¢åŠ ä¸€ä¸ªè®¡æ•°å™¨ã€‚å¦‚æœè®¡æ•°å™¨å·²æ»¡ï¼Œåˆ™è¶…å‡ºéƒ¨åˆ†çš„è¯·æ±‚è¢«ä¸¢å¼ƒæˆ–æ’é˜Ÿã€‚

#### æ“ä½œæ­¥éª¤

1. API ç½‘å…³åˆå§‹åŒ–ä»¤ç‰Œæ¡¶æˆ–è®¡æ•°å™¨ã€‚
2. å®¢æˆ·ç«¯å‘ API ç½‘å…³å‘é€è¯·æ±‚ã€‚
3. API ç½‘å…³åˆ¤æ–­ä»¤ç‰Œæ¡¶æˆ–è®¡æ•°å™¨æ˜¯å¦å·²æ»¡ã€‚
4. å¦‚æœæœªæ»¡ï¼Œåˆ™å‡å°‘ä»¤ç‰Œæˆ–å¢åŠ è®¡æ•°å™¨ï¼Œç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚
5. å¦‚æœå·²æ»¡ï¼Œåˆ™æ‹’ç»è¯·æ±‚æˆ–æ’é˜Ÿç­‰å¾…ã€‚

#### æ•°å­¦æ¨¡odel

API ç½‘å…³å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ•°å­¦æ¨¡å‹æ¥æè¿°é€Ÿç‡é™åˆ¶ç®—æ³•ï¼š

$$
Tokens = min(Capacity, Tokens + Rate \times DeltaTime)
$$

* $$Tokens$$ è¡¨ç¤ºä»¤ç‰Œæ¡¶ä¸­çš„ä»¤ç‰Œæ•°ã€‚
* $$Capacity$$ è¡¨ç¤ºä»¤ç‰Œæ¡¶çš„æœ€å¤§å®¹é‡ã€‚
* $$Rate$$ è¡¨ç¤ºæ¯ä¸ªæ—¶é—´å•ä½å¢åŠ çš„ä»¤ç‰Œæ•°ã€‚
* $$DeltaTime$$ è¡¨ç¤ºæ—¶é—´å·®ã€‚

### ç›‘æ§å’Œæ—¥å¿—

#### ç®—æ³•åŸç†

ç›‘æ§å’Œæ—¥å¿—æ˜¯æŒ‡è®°å½•æ¯æ¬¡è¯·æ±‚å’Œå“åº”ï¼Œä¾¿äºæ’æŸ¥é—®é¢˜å’Œæ”¹è¿›ç³»ç»Ÿã€‚API ç½‘å…³å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ç®—æ³•æ¥å®Œæˆç›‘æ§å’Œæ—¥å¿—ï¼š

1. **æ—¥å¿—æ”¶é›†**ï¼šAPI ç½‘å…³åœ¨å¤„ç†æ¯ä¸ªè¯·æ±‚æ—¶ï¼Œè®°å½•è¯·æ±‚å’Œå“åº”ä¿¡æ¯ï¼Œä¾‹å¦‚è¯·æ±‚ URLã€HTTP æ–¹æ³•ã€Headerã€Bodyã€å“åº”çŠ¶æ€ç ã€å“åº”æ—¶é—´ç­‰ã€‚
2. **æ•°æ®åˆ†æ**ï¼šAPI ç½‘å…³å¯ä»¥å°†æ—¥å¿—æ•°æ®å‘é€åˆ°æ—¥å¿—æœåŠ¡å™¨æˆ–æ•°æ®ä»“åº“ä¸­ï¼Œä½¿ç”¨åˆ†æå·¥å…·å¯¹æ—¥å¿—æ•°æ®è¿›è¡Œç»Ÿè®¡å’Œåˆ†æï¼Œä¾‹å¦‚Top Nè¯·æ±‚ã€é”™è¯¯ç‡ã€æ…¢è¯·æ±‚ã€å¼‚å¸¸æƒ…å†µç­‰ã€‚

#### æ“ä½œæ­¥éª¤

1. API ç½‘å…³è®°å½•è¯·æ±‚å’Œå“åº”ä¿¡æ¯ã€‚
2. API ç½‘å…³å°†æ—¥å¿—æ•°æ®å‘é€åˆ°æ—¥å¿—æœåŠ¡å™¨æˆ–æ•°æ®ä»“åº“ä¸­ã€‚
3. ä½¿ç”¨åˆ†æå·¥å…·å¯¹æ—¥å¿—æ•°æ®è¿›è¡Œç»Ÿè®¡å’Œåˆ†æã€‚

#### æ•°å­¦æ¨¡å‹

API ç½‘å…³å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ•°å­¦æ¨¡å‹æ¥æè¿°ç›‘æ§å’Œæ—¥å¿—ç®—æ³•ï¼š

$$
LogData = \{RequestID, RequestURL, HTTPMethod, Headers, Body, ResponseStatusCode, ResponseTime\}
$$

* $$RequestID$$ è¡¨ç¤ºè¯·æ±‚çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚
* $$RequestURL$$ è¡¨ç¤ºè¯·æ±‚çš„ URLã€‚
* $$HTTPMethod$$ è¡¨ç¤º HTTP æ–¹æ³•ã€‚
* $$Headers$$ è¡¨ç¤ºè¯·æ±‚å¤´ã€‚
* $$Body$$ è¡¨ç¤ºè¯·æ±‚ä½“ã€‚
* $$ResponseStatusCode$$ è¡¨ç¤ºå“åº”çŠ¶æ€ç ã€‚
* $$ResponseTime$$ è¡¨ç¤ºå“åº”æ—¶é—´ã€‚

### è´Ÿè½½å‡è¡¡

#### ç®—æ³•åŸç†

è´Ÿè½½å‡è¡¡æ˜¯æŒ‡å°†æµé‡åˆ†é…åˆ°å¤šä¸ªå¾®æœåŠ¡å®ä¾‹ä¸Šï¼Œæé«˜ç³»ç»Ÿæ•´ä½“æ€§èƒ½å’Œå¯ç”¨æ€§ã€‚API ç½‘å…³å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ç®—æ³•æ¥å®Œæˆè´Ÿè½½å‡è¡¡ï¼š

1. **è½®è¯¢ç®—æ³•ï¼ˆRound Robinï¼‰**ï¼šAPI ç½‘å…³æŒ‰ç…§é¡ºåºå°†è¯·æ±‚åˆ†é…ç»™ä¸åŒçš„å¾®æœåŠ¡å®ä¾‹ã€‚
2. **éšæœºç®—æ³•ï¼ˆRandomï¼‰**ï¼šAPI ç½‘å…³éšæœºé€‰æ‹©ä¸€ä¸ªå¾®æœåŠ¡å®ä¾‹æ¥å¤„ç†è¯·æ±‚ã€‚
3. **æƒé‡ç®—æ³•ï¼ˆWeightedï¼‰**ï¼šAPI ç½‘å…³æ ¹æ®å¾®æœåŠ¡å®ä¾‹çš„æ€§èƒ½å’Œè´Ÿè½½æƒ…å†µï¼ŒåŠ¨æ€è°ƒæ•´è¯·æ±‚åˆ†é…æ¯”ä¾‹ã€‚

#### æ“ä½œæ­¥éª¤

1. API ç½‘å…³ç»´æŠ¤ä¸€ä¸ªå¾®æœåŠ¡å®ä¾‹åˆ—è¡¨ã€‚
2. å®¢æˆ·ç«¯å‘ API ç½‘å…³å‘é€è¯·æ±‚ã€‚
3. API ç½‘å…³é€‰æ‹©ä¸€ä¸ªå¾®æœåŠ¡å®ä¾‹æ¥å¤„ç†è¯·æ±‚ã€‚
4. API ç½‘å…³æ›´æ–°å¾®æœåŠ¡å®ä¾‹åˆ—è¡¨ã€‚

#### æ•°å­¦æ¨¡å‹

API ç½‘å…³å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ•°å­¦æ¨¡å‹æ¥æè¿°è´Ÿè½½å‡è¡¡ç®—æ³•ï¼š

$$
InstanceList = [Instance_1, Instance_2, ..., Instance_N]
$$

* $$Instance_i$$ è¡¨ç¤ºç¬¬ i ä¸ªå¾®æœåŠ¡å®ä¾‹ã€‚

$$
SelectedInstance = InstanceList[Index]
$$

* $$Index$$ è¡¨ç¤ºé€‰æ‹©çš„å¾®æœåŠ¡å®ä¾‹ç´¢å¼•ã€‚

$$
Index = f(CurrentIndex, Count, Weight)
$$

* $$CurrentIndex$$ è¡¨ç¤ºå½“å‰ç´¢å¼•ã€‚
* $$Count$$ è¡¨ç¤ºå¾®æœåŠ¡å®ä¾‹æ€»æ•°ã€‚
* $$Weight$$ è¡¨ç¤ºå¾®æœåŠ¡å®ä¾‹æƒé‡ã€‚

### ç¼“å­˜

#### ç®—æ³•åŸç†

ç¼“å­˜æ˜¯æŒ‡å‡å°‘å¯¹æ•°æ®åº“çš„è®¿é—®æ¬¡æ•°ï¼Œæé«˜ç³»ç»Ÿæ€§èƒ½ã€‚API ç½‘å…³å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ç®—æ³•æ¥å®Œæˆç¼“å­˜ï¼š

1. **æœ¬åœ°ç¼“å­˜**ï¼šAPI ç½‘å…³åœ¨å†…å­˜ä¸­ç»´æŠ¤ä¸€ä¸ªç¼“å­˜æ± ï¼Œå°†è¯·æ±‚ç»“æœç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œä»¥ä¾›åç»­è¯·æ±‚ç›´æ¥è·å–ã€‚
2. **è¿œç¨‹ç¼“å­˜**ï¼šAPI ç½‘å…³å°†è¯·æ±‚ç»“æœç¼“å­˜åœ¨å¤–éƒ¨ç¼“å­˜æœåŠ¡å™¨ä¸­ï¼Œä¾‹å¦‚ Redisã€Memcached ç­‰ã€‚

#### æ“ä½œæ­¥éª¤

1. å®¢æˆ·ç«¯å‘ API ç½‘å…³å‘é€è¯·æ±‚ã€‚
2. API ç½‘å…³åˆ¤æ–­è¯·æ±‚ç»“æœæ˜¯å¦å·²ç¼“å­˜ã€‚
3. å¦‚æœå·²ç¼“å­˜ï¼Œåˆ™ç›´æ¥è¿”å›ç¼“å­˜ç»“æœã€‚
4. å¦‚æœæœªç¼“å­˜ï¼Œåˆ™å‘å¾®æœåŠ¡å‘é€è¯·æ±‚ï¼Œå¹¶å°†è¯·æ±‚ç»“æœç¼“å­˜åœ¨ç¼“å­˜æ± æˆ–å¤–éƒ¨ç¼“å­˜æœåŠ¡å™¨ä¸­ã€‚

#### æ•°å­¦æ¨¡å‹

API ç½‘å…³å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ•°å­¦æ¨¡å‹æ¥æè¿°ç¼“å­˜ç®—æ³•ï¼š

$$
CachePool = \{Key: Value\}
$$

* $$Key$$ è¡¨ç¤ºç¼“å­˜é”®ã€‚
* $$Value$$ è¡¨ç¤ºç¼“å­˜å€¼ã€‚

$$
CacheServer = \{Key: Value\}
$$

* $$Key$$ è¡¨ç¤ºç¼“å­˜é”®ã€‚
* $$Value$$ è¡¨ç¤ºç¼“å­˜å€¼ã€‚

$$
IsCached = CachePool.ContainsKey(Key) \lor CacheServer.ContainsKey(Key)
$$

* $$IsCached$$ è¡¨ç¤ºè¯·æ±‚ç»“æœæ˜¯å¦å·²ç¼“å­˜ã€‚

### è½¬æ¢

#### ç®—æ³•åŸç†

è½¬æ¢æ˜¯æŒ‡å°†å®¢æˆ·ç«¯è¯·æ±‚è½¬æ¢æˆå¾®æœåŠ¡å¯ä»¥ç†è§£çš„æ ¼å¼ï¼Œä¹Ÿå¯ä»¥å°†å¾®æœåŠ¡çš„å“åº”è½¬æ¢æˆå®¢æˆ·ç«¯å¯ä»¥ç†è§£çš„æ ¼å¼ã€‚API ç½‘å…³å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ç®—æ³•æ¥å®Œæˆè½¬æ¢ï¼š

1. **æ¶ˆæ¯ç¼–ç **ï¼šAPI ç½‘å…³å¯ä»¥å°†å®¢æˆ·ç«¯è¯·æ±‚ä»äºŒè¿›åˆ¶æˆ–æ–‡æœ¬å½¢å¼ç¼–ç ä¸º JSONã€XMLã€Protobuf ç­‰æ ¼å¼ã€‚
2. **æ¶ˆæ¯è§£ç **ï¼šAPI ç½‘å…³å¯ä»¥å°†å¾®æœåŠ¡å“åº”ä» JSONã€XMLã€Protobuf ç­‰æ ¼å¼è§£ç ä¸ºäºŒè¿›åˆ¶æˆ–æ–‡æœ¬å½¢å¼ã€‚
3. **æ¶ˆæ¯è½¬æ¢**ï¼šAPI ç½‘å…³å¯ä»¥å°†å®¢æˆ·ç«¯è¯·æ±‚ä»ä¸€ç§æ ¼å¼è½¬æ¢ä¸ºå¦ä¸€ç§æ ¼å¼ï¼Œä¾‹å¦‚å°† GET è¯·æ±‚è½¬æ¢ä¸º POST è¯·æ±‚ã€‚

#### æ“ä½œæ­¥éª¤

1. å®¢æˆ·ç«¯å‘ API ç½‘å…³å‘é€è¯·æ±‚ã€‚
2. API ç½‘å…³åˆ¤æ–­è¯·æ±‚æ ¼å¼æ˜¯å¦æ”¯æŒã€‚
3. å¦‚æœæ”¯æŒï¼Œåˆ™å°†è¯·æ±‚è½¬æ¢ä¸ºå¾®æœåŠ¡å¯ä»¥ç†è§£çš„æ ¼å¼ã€‚
4. å¾®æœåŠ¡å¤„ç†è¯·æ±‚å¹¶è¿”å›å“åº”ã€‚
5. API ç½‘å…³å°†å“åº”è½¬æ¢ä¸ºå®¢æˆ·ç«¯å¯ä»¥ç†è§£çš„æ ¼å¼ã€‚
6. API ç½‘å…³è¿”å›å“åº”ç»™å®¢æˆ·ç«¯ã€‚

#### æ•°å­¦æ¨¡å‹

API ç½‘å…³å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ•°å­¦æ¨¡å‹æ¥æè¿°è½¬æ¢ç®—æ³•ï¼š

$$
Encode = f(Message, Format)
$$

* $$Message$$ è¡¨ç¤ºæ¶ˆæ¯ã€‚
* $$Format$$ è¡¨ç¤ºæ¶ˆæ¯æ ¼å¼ã€‚

$$
Decode = f(EncodedMessage, Format)
$$

* $$EncodedMessage$$ è¡¨ç¤ºå·²ç¼–ç çš„æ¶ˆæ¯ã€‚
* $$Format$$ è¡¨ç¤ºæ¶ˆæ¯æ ¼å¼ã€‚

$$
Convert = f(SourceMessage, SourceFormat, TargetFormat)
$$

* $$SourceMessage$$ è¡¨ç¤ºæºæ¶ˆæ¯ã€‚
* $$SourceFormat$$ è¡¨ç¤ºæºæ¶ˆæ¯æ ¼å¼ã€‚
* $$TargetFormat$$ è¡¨ç¤ºç›®æ ‡æ¶ˆæ¯æ ¼å¼ã€‚

## ğŸ’»å…·ä½“æœ€ä½³å®è·µï¼šä»£ç å®ä¾‹å’Œè¯¦ç»†è§£é‡Šè¯´æ˜

### èº«ä»½è®¤è¯å’Œæˆæƒ

#### JWT å®ç°

API ç½‘å…³å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ Java ä»£ç æ¥ç”Ÿæˆå’ŒéªŒè¯ JWTï¼š

```java
import io.jsonwebtoken.Jwts;
import io.jsonwebtoken.SignatureAlgorithm;

public class JWTUtils {
   private static final String SECRET_KEY = "your-secret-key";

   public static String generateToken(String clientID) {
       long nowMillis = System.currentTimeMillis();
       return Jwts.builder()
               .setSubject(clientID)
               .setIssuedAt(new Date(nowMillis))
               .setExpiration(new Date(nowMillis + 60 * 60 * 1000)) // token valid for 1 hour
               .signWith(SignatureAlgorithm.HS256, SECRET_KEY)
               .compact();
   }

   public static boolean validateToken(String token) {
       try {
           Jwts.parser().setSigningKey(SECRET_KEY).parseClaimsJws(token);
           return true;
       } catch (Exception e) {
           return false;
       }
   }
}
```

#### OAuth2 å®ç°

API ç½‘å…³å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ Spring Boot ä»£ç æ¥å®ç° OAuth2 èº«ä»½è®¤è¯å’Œæˆæƒï¼š

```java
import org.springframework.security.oauth2.provider.endpoint.TokenEndpoint;
import org.springframework.security.oauth2.provider.token.DefaultTokenServices;
import org.springframework.security.oauth2.provider.token.TokenStore;
import org.springframework.security.oauth2.provider.token.store.InMemoryTokenStore;

@Configuration
@EnableAuthorizationServer
public class AuthorizationServerConfig extends AuthorizationServerConfigurerAdapter {

   @Autowired
   private TokenStore tokenStore;

   @Autowired
   private DefaultTokenServices tokenServices;

   @Bean
   public TokenStore tokenStore() {
       return new InMemoryTokenStore();
   }

   @Bean
   public DefaultTokenServices tokenServices() {
       DefaultTokenServices defaultTokenServices = new DefaultTokenServices();
       defaultTokenServices.setTokenStore(tokenStore);
       defaultTokenServices.setSupportRefreshToken(true);
       return defaultTokenServices;
   }

   @Override
   public void configure(ClientDetailsServiceConfigurer clients) throws Exception {
       clients.inMemory()
               .withClient("client")
               .secret("{noop}secret")
               .authorizedGrantTypes("password", "refresh_token")
               .scopes("read", "write")
               .accessTokenValiditySeconds(3600)
               .refreshTokenValiditySeconds(86400);
   }

   @Override
   public void configure(AuthorizationServerEndpointsConfigurer endpoints) throws Exception {
       TokenEndpoint tokenEndpoint = new TokenEndpoint();
       tokenEndpoint.setTokenServices(tokenServices());
       endpoints.tokenStore(tokenStore())
               .tokenEnhancer(null)
               .accessTokenConverter(null)
               .tokenEndpoint(tokenEndpoint);
   }
}
```

### é€Ÿç‡é™åˆ¶

#### æ¼æ¡¶ç®—æ³•å®ç°

API ç½‘å…³å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ Java ä»£ç æ¥å®ç°æ¼æ¡¶ç®—æ³•ï¼š

```java
import java.util.concurrent.atomic.AtomicInteger;
import java.util.concurrent.Executors;
import java.util.concurrent.ScheduledExecutorService;
import java.util.concurrent.TimeUnit;

public class TokenBucket {
   private final int capacity;
   private final int tokensPerSecond;
   private final AtomicInteger counter;
   private final ScheduledExecutorService scheduler;

   public TokenBucket(int capacity, int tokensPerSecond) {
       this.capacity = capacity;
       this.tokensPerSecond = tokensPerSecond;
       this.counter = new AtomicInteger(capacity);
       this.scheduler = Executors.newSingleThreadScheduledExecutor();
       this.scheduler.scheduleAtFixedRate(() -> {
           int currentTokens = counter.get();
           if (currentTokens < capacity) {
               counter.set(currentTokens + 1);
           }
       }, 1, 1, TimeUnit.SECONDS);
   }

   public boolean acquire() {
       int currentTokens = counter.get();
       if (currentTokens > 0) {
           counter.decrementAndGet();
           return true;
       }
       return false;
   }

   public void release() {
       int currentTokens = counter.get();
       if (currentTokens < capacity) {
           counter.set(currentTokens + 1);
       }
   }
}
```

#### è®¡æ•°å™¨ç®—æ³•å®ç°

API ç½‘å…³å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ Java ä»£ç æ¥å®ç°è®¡æ•°å™¨ç®—æ³•ï¼š

```java
import java.util.concurrent.ConcurrentHashMap;
import java.util.concurrent.TimeUnit;

public class LeakyBucket {
   private final int capacity;
   private final ConcurrentHashMap<Long, Integer> map;

   public LeakyBucket(int capacity) {
       this.capacity = capacity;
       this.map = new ConcurrentHashMap<>();
   }

   public boolean acquire() {
       long currentTimeMillis = System.currentTimeMillis();
       int count = map.computeIfAbsent(currentTimeMillis, key -> 1) + 1;
       if (count <= capacity) {
           map.put(currentTimeMillis, count);
           return true;
       }
       return false;
   }

   public void release() {
       long currentTimeMillis = System.currentTimeMillis();
       map.computeIfPresent(currentTimeMillis, (key, value) -> value - 1);
   }
}
```

### ç›‘æ§å’Œæ—¥å¿—

#### æ—¥å¿—æ”¶é›†å®ç°

API ç½‘å…³å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ Java ä»£ç æ¥è®°å½•è¯·æ±‚å’Œå“åº”ä¿¡æ¯ï¼š

```java
import org.springframework.web.servlet.HandlerInterceptor;
import org.springframework.web.servlet.ModelAndView;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

public class LoggingInterceptor implements HandlerInterceptor {
   @Override
   public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
       // Record request information
       String requestURL = request.getRequestURL().toString();
       String httpMethod = request.getMethod();
       String headers = request.getHeaderNames().stream()
               .map(name -> name + ": " + request.getHeader(name))
               .reduce("", (a, b) -> a + "\n" + b);
       String body = IOUtils.toString(request.getInputStream(), StandardCharsets.UTF_8);

       // TODO: Save log data to database or external service

       return true;
   }

   @Override
   public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {
       // Record response information
       int statusCode = response.getStatus();
       String body = IOUtils.toString(response.getInputStream(), StandardCharsets.UTF_8);

       // TODO: Save log data to database or external service
   }
}
```

#### æ•°æ®åˆ†æå®ç°

API ç½‘å…³å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ Python ä»£ç æ¥ç»Ÿè®¡å’Œåˆ†ææ—¥å¿—æ•°æ®ï¼š

```python
import pandas as pd
import matplotlib.pyplot as plt

# Load log data from database or external service
df = pd.read_csv('log_data.csv')

# Top N requests
top_n_requests = df.groupby(['RequestURL'])['Count'].sum().sort_values(ascending=False).head(10)
print(top_n_requests)

# Error rate
error_rate = df[df['StatusCode'] >= 500]['Count'].sum() / df['Count'].sum() * 100
print(f'Error rate: {error_rate:.2f}%')

# Slow requests
slow_requests = df[(df['ResponseTime'] >= 500) & (df['StatusCode'] < 500)]['Count'].sum()
print(f'Slow requests: {slow_requests}')

# Anomaly detection
anomalies = df[df['StatusCode'] == 503]['Count'].rolling(window=10).mean().apply(lambda x: x > 10)
print(anomalies[anomalies])

# Visualization
plt.figure(figsize=(12, 6))
plt.subplot(211)
plt.plot(df.index, df['Count'], label='Total Requests')
plt.plot(df[df['StatusCode'] >= 500].index, df[df['StatusCode'] >= 500]['Count'], label='Error Requests')
plt.legend()
plt.subplot(212)
plt.plot(df.index, df['ResponseTime'], label='Response Time')
plt.xlabel('Time')
plt.ylabel('Response Time (ms)')
plt.show()
```

### è´Ÿè½½å‡è¡¡

#### è½®è¯¢ç®—æ³•å®ç°

API ç½‘å…³å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ Java ä»£ç æ¥å®ç°è½®è¯¢ç®—æ³•ï¼š

```java
import java.util.ArrayList;
import java.util.List;

public class RoundRobinLoadBalancer {
   private List<String> instances;
   private int index;

   public RoundRobinLoadBalancer(List<String> instances) {
       this.instances = new ArrayList<>(instances);
       this.index = 0;
   }

   public String getInstance() {
       if (index >= instances.size()) {
           index = 0;
       }
       String instance = instances.get(index);
       index++;
       return instance;
   }
}
```

#### éšæœºç®—æ³•å®ç°

API ç½‘å…³å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ Java ä»£ç æ¥å®ç°éšæœºç®—æ³•ï¼š

```java
import java.util.Collections;
import java.util.List;
import java.util.Random;

public class RandomLoadBalancer {
   private List<String> instances;

   public