
作者：禅与计算机程序设计艺术                    

# 1.简介
  

数据库系统从最初的数据库管理系统（DBMS）到今天越来越复杂、功能越来越强大，为了满足更多用户对数据库应用的需求，各种不同的数据库系统、索引结构、查询优化器等都在不断演进。其中最常见的就是MySQL、Oracle、SQL Server和PostgreSQL等开源数据库系统。而随着硬件性能的提升、云计算的普及，NoSQL数据库系统也逐渐兴起。NoSQL数据库主要体现为键值存储数据库Redis、文档型数据库MongoDB以及列存储数据库Cassandra等。

对于各种类型的数据库系统来说，其存储引擎的选择尤为重要。每种数据库系统都有自己独特的特性、优点和缺点，并且具有自己独特的应用场景和适用场景。下面就让我们一起看一下MyISAM和InnoDB存储引擎的区别。
# 2.引言
数据存储在磁盘上的方式是以表格化形式存在的，关系数据库管理系统采用的是基于表的存取方法。在传统的关系数据库管理系统中，有两种主要的存储引擎：MyISAM和InnoDB。

MyISAM是MySQL的一个默认的存储引擎，它是在WEB应用方面非常流行的一种存储引擎。但是，由于MyISAM只能在表级别进行行级锁定，对于高并发量的环境来说，效率较低；另外，MyISAM没有支持事务机制，也不能保证数据的完整性，因此当MyISAM出现严重错误时，数据恢复可能十分困难。

相比之下，InnoDB存储引擎是一个完全ACID兼容的事务型引擎，支持外键完整性约束、Foreign Key Constraints，支持事务处理，具有Commit、Rollback和崩溃修复能力。它的性能高于MyISAM，而且还支持表级锁定和行级锁定，并且提供日志备份和崩溃恢复能力，使得它成为了当前最流行的存储引擎之一。

然而，无论是InnoDB还是MyISAM，它们之间仍然有着一些不同之处。下面我们将探讨两者之间的差异。
# 3.区别
## 3.1 数据文件类型
MyISAM通过三个文件实现数据文件的存储：frm文件存放表定义，MYD文件存放表的数据，MYI文件存放表的索引。而InnoDB除了包含上述三种文件外，还包括两个系统文件ibd文件，用于存放数据和索引。

MyISAM只允许表的每个记录占用固定长度的字节数，即可以用任何压缩算法对数据进行压缩，但会耗费额外的IO开销，在读取大量数据时，性能上可能会受影响。在插入或更新一条记录时，会对表上锁，直到提交事务完成才释放锁。

InnoDB支持动态记录大小，最大可使用1GB的空间，且可以按需自动扩容。此外，InnoDB支持对表设置自增长字段，在写入新记录时，如果该字段不存在则自动生成。除此之外，InnoDB还支持事务处理，支持完整的事务隔离性、持久性、一致性。

## 3.2 插入速度
MyISAM的插入速度比较快，因为它不会在插入时对表做全表扫描，因此对写入速度影响较小。但是，如果插入的记录规模比较大，比如批量导入，则速度可能会受到影响。

而InnoDB的插入速度慢一些，但是相比MyISAM要快很多，因为它在插入时，除了会对表做全表扫描外，还会先申请一个空闲位置，然后插入数据，这样避免了数据页分裂的问题。

## 3.3 是否支持事务
MyISAM不支持事务，这意味着一旦开始了一个事务，则整个表锁住，直到事务结束才能继续其它操作。这种情况下，如果有多个客户端并发地向表中插入数据，就会导致插入数据混乱，甚至数据丢失。

InnoDB支持事务，通过事物日志（Undo Log）实现事务的原子性，确保数据操作的正确性。InnoDB的事务支持是在引擎层实现的，而不是在服务器层。所以，使用InnoDB作为主力数据库，可以获得接近于零的停机时间。

## 3.4 表锁
InnoDB采用行级锁，对需要修改的数据加锁，这个设计会大大减少死锁发生的概率，提高数据库的并发处理能力。同时，InnoDB采用了两阶段提交（Two-Phase Commit， 2PC）协议，使得beginTransaction/commit操作不需要等待事务结束，降低了系统开销。

MyISAM只支持表级锁，所以每次操作锁定整张表，造成了大量的表锁冲突，降低了并发处理能力。

## 3.5 主键选择
MyISAM的主键限制为单列，并且是聚集索引。这意味着，每次检索数据，都需要按照主键排序，因此效率很低。如果没有主键，MyISAM会自动创建一个非聚集索引。

InnoDB的主键可以是多个列组成的联合主键，并且可以选择性地为某些列创建索引，这样可以提高查询效率。

## 3.6 分区表
MyISAM不支持分区表。而InnoDB支持分区表。MyISAM中，如果定义了 PRIMARY KEY 或 UNIQUE KEY 时，会自动建立聚集索引，这会消耗磁盘空间。InnoDB在内存中保存数据，并通过主键聚集数据，因此不需要建立聚集索引，而只需要根据普通索引查找数据。

## 3.7 其他
除了上面所提到的差异之外，还有一些其它区别，如：

1. 安全性：MyISAM 的.frm 文件里面只保存表结构，而 InnoDB 的.frm 文件里保存了表结构以及表里面的所有数据。MyISAM 是非加密的，而 InnoDB 支持 row-level encryption 对敏感信息加密。
2. 支持事物： MyISAM 不支持事务，而 InnoDB 支持事务。
3. 崩溃后的安全恢复：MyISAM 在表损坏时，必须执行repair table 来修复表。InnoDB 提供了 online repair 选项，可以在线修复损坏的表。
4. Auto-increment：MyISAM 只能使用数字作为 AUTO_INCREMENT 字段的值，而 InnoDB 可以使用整数、字符串或时间戳。
5. 查询缓存：MyISAM 和 Memory 引擎不支持查询缓存。而 InnoDB 支持查询缓存。
6. 存储引擎参数：MyISAM 有自己的参数设置，InnoDB 使用 MySQL 自己的参数设置。

以上只是对存储引擎相关的差异作了一简单的概括，更详细的内容还需要进一步了解。

总结：

|                | MyISAM                            | InnoDB                               |
|----------------|---------------|-----------------------------|
| 数据文件类型       |.frm文件   MYD文件    MYI文件        | frm文件 ibdata文件               |
| 插入速度         | 慢                                 | 快                                  |
| 是否支持事务     | 不支持                             | 支持                                |
| 表锁           | 表级锁                              | 行级锁或表级锁                     |
| 主键选择         | 单列聚集索引                         | 多列联合主键                        |
| 分区表           | 不支持                             | 支持                                |
| 安全性           | 安全                              | 更安全                             |
| 崩溃后的安全恢复 | 需要执行repair table命令            | 自动修复                           |
| Auto-increment | 只能使用数字                       | 支持多种类型AUTO_INCREMENT          |
| 查询缓存         | 不支持                             | 支持                                |
| 参数设置         | MyISAM的参数设置                   | MySQL的参数设置                    |