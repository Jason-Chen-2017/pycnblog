
作者：禅与计算机程序设计艺术                    

# 1.简介
  

MySQL是一个开源数据库管理系统，由瑞典MySQL AB公司开发和发布。在很多公司中被作为数据库服务器使用。其中涵盖了诸如商业、金融、政务等应用领域。MySQL数据库中的数据存储用UTF-8字符编码，所以数据表的字段字符集和排序规则均设定为utf8。一般情况下，数据表的字符集及排序规则都可以根据业务需要随时调整。但是，MySQL的两个系统级参数character_set_server 和 collation_connection的配置却十分重要。本文将介绍这两个参数的相关概念和作用。
# 2.MySQL全局变量
MySQL全局变量指的是设置系统级别的参数，并对整个数据库服务起作用。这里特别指出，全局变量不仅包括MySQL提供的默认值，还可以通过配置文件或命令行的方式进行修改。

这里列举MySQL所有支持的全局变量：

Variable_name | Description | Default value
--------------|-------------|---------------
binlog_cache_size | The size of the cache to hold changes for each binary log file during a transaction before writing them to disk (in bytes). InnoDB default: 32K, MyISAM and MEMORY: 8M | Depends on operating system
binlog_format | Defines the format used when writing statements to the binary log. Valid values are 'STATEMENT' (statement-based) or 'ROW' (row-based) | STATEMENT if binlog_rows_query_log_events is set to OFF; otherwise, ROW
binlog_stmt_cache_size | The size of the cache to hold prepared statement meta data in memory (in bytes), which can be reused by multiple connections. InnoDB default: 32K, MyISAM and MEMORY: 8M | Depends on operating system
bulk_insert_buffer_size | The maximum size of an INSERT operation's internal buffer (in bytes). This buffer holds rows that have been collected but not yet inserted into the table(s) being inserted into. | 8KB for versions prior to 5.7.0, 1MB starting with version 5.7.0
connect_timeout | The number of seconds after which a connection attempt will time out if it cannot connect successfully. For TCP/IP sockets, this means the number of seconds before a timeout occurs when attempting to establish a connection. | 10 seconds
default_password_lifetime | The period of time (in days) that expired passwords remain valid in user tables. Set to 0 to disable password expiration. | No expiration.
default_storage_engine | The storage engine used by default for new tables created without specifying ENGINE explicitly. | InnoDB
disabled_storage_engines | A comma-separated list of storage engines disabled by default. Newly installed servers start up with all enabled storage engines except those listed here. | None
expire_logs_days | The number of days for automatic removal of binary logs. If set to 0, the feature is disabled. | 0 (feature disabled)
flush | Enables or disables query cache flushing at server startup and shutdown. Possible values are ON and OFF. Query caching improves performance by avoiding repetitive execution of frequently used queries, while allowing different parameters to be bound to cached queries. It is recommended to enable query caching unless you have specific reasons to turn it off. Note: Disabling query caching may cause some applications to behave unpredictably because they rely on invalidated caches instead of reusing them correctly. | ON
ft_min_word_len | The minimum length of words that will be included in full text indexes. Shorter words are discarded. This parameter has no effect if full-text indexing is disabled using DISABLE KEYS syntax. | 4
innodb_adaptive_flushing | Controls how often the InnoDB write buffer is flushed. Setting to 1 enables adaptive flushing which gradually increases the frequency of writes as the amount of pending writes approaches the threshold specified by innodb_flush_neighbors. The other possible values are 0 (no flushing) and 2 (full flushing every second). Enabling this option decreases CPU usage and therefore makes InnoDB more suitable for high-speed write workloads where latency requirements are low. However, under certain circumstances (e.g., heavy write load or many concurrent threads), enabling this option might increase page fragmentation and lead to decreased database performance. | 0 (adaptive flushing disabled)
innodb_api_bk_commit_interval | The interval between commits made from the background writer thread to the InnoDB redo log. Higher intervals improve throughput at the expense of higher latencies and reduced concurrency. Setting to zero turns off background commit altogether. | 50ms
innodb_api_disable_rowlock | Disables row locking for all queries executed outside of the storage engine API (i.e., calls made via the FAPI interface). By disabling row locks, we prevent long-running transactions from blocking other operations from running, thereby improving overall system performance. However, disabling row locks could result in inconsistent reads due to lack of proper locking mechanisms and incorrect results obtained by concurrent transactions. | Enabled (not recommended)
innodb_autoextend_increment | The increment step when extending the size of an autoextensible hash index partition. The actual extent size is calculated as the next multiple of the base size determined by this variable multiplied by the number of partitions per table. Autoextensible hash indexes offer better scalability and faster performance than B-tree indexes, especially when working with large datasets. To use autoextensible hash indexes, set the index type to "HASH" and specify AUTOEXTEND_SIZE as well. | 8
innodb_autoinc_lock_mode | Controls the behavior of InnoDB's auto-increment locking mechanism. Lock modes supported by MySQL include ROW-level locking (which allows other users to read or modify the same row while waiting for the lock to be released) and TABLE-level locking (which prevents others from accessing the entire table while holding the lock). Setting to STRICT mode ensures that only one transaction can access an auto-increment column within a single table at any given point in time, regardless of whether the column is locked or not. Setting to NOWAIT mode ensures that the calling session waits until the lock is available rather than reporting an error immediately. | STRICT
innodb_buffer_pool_dump_at_shutdown | Enables or disables dumping contents of the InnoDB buffer pool to the data dictionary at shutdown. Dumping the buffer pool helps ensure data consistency in case of a crash. | 0 (disabled)
innodb_buffer_pool_dump_now | Immediately triggers a dump of the InnoDB buffer pool to the data dictionary. This is useful for gathering diagnostic information such as statistics about buffer pool pages during runtime. The buffer pool must be idle (not dirty) for the dump to succeed. | N/A
innodb_buffer_pool_filename | Specifies the name and location of the buffer pool data file. You should always assign a unique name and path for the buffer pool file so that theInnoDB instance can locate its files even if it moves locations later. On Unix systems, the path must begin with /dev/, followed by a directory like /dev/shm, or another temporary filesystem device. | ib_buffer_pool
innodb_buffer_pool_instances | Sets the number of instances in the InnoDB buffer pool. Each instance contains separate areas of memory reserved for use by InnoDB activities. Creating additional buffer pool instances allows for parallelization of key I/O operations performed by InnoDB. Increasing the number of buffer pool instances also improves overall performance by reducing contention for resources among threads accessing the buffer pool. Additionally, increasing the number of buffer pool instances also allows for more efficient utilization of hardware resources such as parallelism and SAN connectivity. | 1
innodb_buffer_pool_load_abort | If an error occurs during the loading of the InnoDB buffer pool data file, specifies whether the server aborts (1) or continues (0) with the startup process. | 0 (continue)
innodb_buffer_pool_load_at_startup | Enables or disables loading the InnoDB buffer pool data file during the server startup process. Loading the buffer pool reduces recovery time when restarting the server after a crash, but increases startup time. The buffer pool must be empty before loading takes place. | 1 (enabled)
innodb_buffer_pool_max | Sets the total size of the InnoDB buffer pool in bytes. Generally, setting the buffer pool size to the highest possible value is not advisable, especially when dealing with larger datasets. Instead, consider choosing a reasonable value based on the available memory size and workload characteristics. | 128M
innodb_buffer_pool_pages_data | Sets the number of pages reserved for InnoDB data. These pages contain both data and undo records for transactions committed or rolled back, respectively. Reducing the number of data pages can reduce memory consumption and improve performance, but it requires allocating extra space for indexes and temporary tables. | 79% of total buffer pool size
innodb_buffer_pool_pages_dirty | Sets the number of dirty pages in the buffer pool. Dirty pages are modified but not written to disk. Reducing the number of dirty pages can help improve performance by reducing the amount of random I/O required, but it requires freeing up memory for clean pages first. | 20% of total buffer pool size
innodb_buffer_pool_pages_flushed | Sets the number of buffer pool pages that are scheduled for flushing. Pages are flushed periodically to reduce disk activity and reduce risk of data loss. Reducing the number of pages scheduled for flushing can improve performance by reducing the amount of random I/O required, but it requires backing up existing dirty pages to disk first. | Depends on OS settings and buffer pool sizes
innodb_buffer_pool_pages_free | Sets the number of free (unused) pages in the buffer pool. Free pages can be allocated to incoming queries without requiring I/O, thus reducing response times for frequent queries. Increasing the number of free pages beyond what is necessary can potentially waste memory and slow down performance. | Depends on buffer pool sizes and the amount of free memory
innodb_buffer_pool_pages_total | Sets the total number of pages in the buffer pool including data, index, and undo pages. Setting the number of total pages too small can result in excessive allocations, wasted memory, and increased overhead, whereas setting it too large can impact overall performance due to excessive swapping and I/O. | 8192
innodb_checkpoint_age | Determines the maximum age of an unflushed modification before it is considered old enough to trigger a checkpoint. An aggressive value can reduce the number of checkpoints triggered, but can also increase the likelihood of causing longer recovery times when restarting the server after a crash. Setting the age to zero forces a checkpoint to occur on every change to the buffer pool. | 120 seconds
innodb_concurrency_tickets | Sets the number of tickets to grant to each user session executing SQL statements. The higher the ticket count, the more concurrent transactions can execute simultaneously without blocking other sessions. However, too high a value can cause issues with resource allocation and reduce overall performance. Setting the number of tickets to zero causes InnoDB to automatically determine an appropriate concurrency level based on the current workload. | 500
innodb_flush_method | Sets the method used to flush modifications to disk for the InnoDB buffer pool. The options are O_DSYNC (write directly to disk synchronously) or O_DIRECT (use direct I/O without buffering). Using O_DIRECT can significantly improve write speeds at the cost of potential data corruption in case of a power failure. | O_DSYNC
innodb_flush_neighbors | When adaptive flushing is enabled (i.e., innodb_adaptive_flushing is nonzero), specifies the percentage of buffer pool pages that need to be written before flushing neighbors. This setting affects the degree of coalescing of neighbor blocks during writes, resulting in improved write efficiency. Decreasing this value can increase write bandwidth, but it also increases the chance of triggering an expensive fsync() call. | 80%
innodb_io_capacity | The upper limit on the rate at which InnoDB can consume input/output operations (IOPS). The lower the limit, the less write activity InnoDB can perform and the greater the chance of overloading the underlying disk subsystem. Increasing the limit does not guarantee improved performance, since the scheduler may still throttle IO requests accordingly. Setting the value to zero disables throttling entirely. | 200
innodb_log_file_size | The size of each binary log file generated by the server. Larger log files allow for better compression and backups at the cost of increased disk usage and slower recovery times. Reducing the log file size can improve performance at the cost of losing some logging information. | 512M
innodb_log_files_in_group | Sets the number of binary log files to be combined together in a group. Grouping allows for faster switching between groups during rotations, but it also requires more disk space and slower recovery times. Increasing the number of log files can improve performance at the cost of increased disk usage and log rotation times. | 2
innodb_open_files | The maximum number of files that InnoDB can open at once. Increasing the number of open files can improve performance, but it also requires maintaining file handles throughout the duration of the server execution. Avoid excessively high numbers, as excessive use can cause problems with file descriptor limits and instability. | 300
innodb_optimize_fulltext_only | By default, InnoDB optimizes updates to full-text indexes whenever a corresponding search is performed on the same table. Setting this option to TRUE restricts full-text optimization to just full-text updates. This can improve update performance by reducing unnecessary full-text indexing tasks, but it can also affect search quality due to incomplete indexing. | FALSE
innodb_print_all_deadlocks | Enables printing of all detected deadlocks to the error log. Use this option to troubleshoot deadlocks involving InnoDB tables. | Disabled (recommended)
innodb_purge_threads | Sets the number of purge threads used to manage the InnoDB rollback segments. The higher the number of purge threads, the faster rollback segments can be removed, but the more memory each purge thread uses. Consider increasing the number of purge threads if your server experiences sudden spikes in memory usage. | 4
innodb_read_ahead_threshold | The number of sequential blocks that need to be accessed sequentially before InnoDB starts reading ahead into the buffer pool. Increasing this value can improve performance at the cost of increased memory usage. | 56
innodb_rollback_on_timeout | When a long-running transaction encounters a timeout, determines whether InnoDB rolls back the transaction (1) or keeps the transaction in progress (0). Rolling back transactions avoids leaving incomplete transactions in the buffer pool, but it can cause performance issues and conflicts with concurrent transactions. Keeping the transaction in progress allows complete transaction recovery, although the application would need to handle errors related to transaction timeouts. | 1 (roll back on timeout)
innodb_stats_on_metadata | Indicates whether metadata (such as table names, columns, etc.) is updated in real-time as soon as changes are made to the database objects. Metadata updating can impact performance by introducing unnecessary bottlenecks and delaying other operations, but it can also provide insight into changes made to the database. | 0 (update on demand)
innodb_status_output | Controls whether InnoDB sends status messages to the error log (1) or to the standard output stream (0). Error logging provides more detailed feedback and can help diagnose problems, whereas standard output can be monitored through external tools or scripts. | 1 (error log)
innodb_thread_concurrency | Sets the number of threads allowed to concurrently access InnoDB data structures. Increasing this value can improve performance by allowing more threads to run concurrently, but it can also overload the server and cause stability issues. Consider adjusting the concurrency levels based on your workload and server configuration. | 10
innodb_thread_sleep_delay | Controls the sleep time between consecutive iterations of various InnoDB threads (e.g., Purge Thread, Page Cleaner). Lower values can reduce context switches and improve responsiveness, but they can also increase CPU usage and make hotspot detection harder. | 100 microseconds
join_buffer_size | Sets the size of the sort buffer used for performing joins and similar operations. Larger buffers can improve performance by reducing disk I/O, but they also consume more memory. Smaller values may introduce unnecessary stalls in the join pipeline. | 128 KB
large_page_size | Sets the size of large page allocations requested by applications. MySQL typically uses smaller page sizes (typically 4KB) to avoid interference with virtual memory management, but certain applications may require larger page sizes (usually 2MB or 1GB) for their memory allocations. This variable sets the default large page size for newly created tables and is overridden by the INNODB_LARGE_PAGE environment variable. | 0 (disabled)
long_query_time | Sets the threshold above which slow queries are logged to the slow query log file. Logged queries can be analyzed further to identify performance bottlenecks or identify patterns that indicate poor application design. | 10 seconds
max_allowed_packet | Limits the size of the network packet that can be sent or received by the server. Setting this value too high can cause communication failures or crashes. Adjust this value according to the size of your network infrastructure and expected network traffic. | 16MB
max_connections | Sets the maximum number of simultaneous client connections allowed to the server. Excessive connection requests exceeding the limit are rejected. | 151
max_heap_table_size | Sets the maximum size to which user-created MEMORY tables are allowed to grow. Larger tables can be stored on disk, but they take up more memory and can slow down server performance. Setting this value too high can cause Out Of Memory errors. | 16MB
net_buffer_length | Sets the size of the buffer used when sending or receiving data over the network. Increasing the buffer size can reduce the number of system calls needed, which can improve performance for high-performance networks, but it can also consume more memory. | 16K
net_read_timeout | Sets the timeout for reading data from the network. Longer timeouts can prevent connection hangs caused by network disruptions, but they also increase the risk of infinite loops and other forms of DoS attacks. | 30 seconds
net_retry_count | Sets the number of attempts made by the server to reestablish a lost connection before giving up. Increasing the retry count can improve resilience against dropped connections, but it can also increase the chances of false positives and delays in detecting failed connections. | 10
net_write_timeout | Sets the timeout for writing data to the network. Longer timeouts can prevent connection hangs caused by network congestion, but they also increase the risk of missing responses and other forms of networking failures. | 60 seconds
query_cache_limit | Sets the maximum size of the query cache. When the cache exceeds this size, least recently used entries are automatically deleted. Increasing this value can improve query response times by reducing the number of disk accesses required to fulfill queries, but it can also consume more memory and lead to increased latency for infrequently used queries. | 128 KB
query_cache_size | Sets the size of the query cache. The cache stores previously executed queries and their results, which can be retrieved quickly without having to execute the query again. Setting this value too small can lead to suboptimal performance due to unnecessary cache misses. | 16 MB
range_optimizer_max_mem_size | Sets the maximum memory size that range optimizer is allowed to allocate for sorting intermediate results. Large sorts consume more memory and can degrade performance. Increasing this value can improve query response times for complex queries involving ORDER BY clauses, but it can also exhaust available memory and lead to crashes. | 16MiB
slow_launch_time | Sets the time threshold above which launching of threads is logged to the slow query log file. Launching of threads indicates the creation of worker threads that may not be able to obtain sufficient resources, leading to degraded performance or even crashes. | 2 seconds
sort_buffer_size | Sets the size of the sort buffer used for operations such as GROUP BY, ORDER BY, and UNION. Larger buffers can improve performance by reducing disk I/O, but they also consume more memory. Smaller values may introduce unnecessary stalls in the processing pipeline. | 256 KB
sql_mode | Sets the global SQL mode used by the server. This variable controls the syntax and behavior of SQL statements. Changing this variable can affect compatibility across different MySQL versions and may affect functionality provided by third party plugins or extensions. | TRADITIONAL
table_definition_cache | Sets the number of table definitions (CREATE TABLE and ALTER TABLE statements) that can be cached in memory. Caching these statements can improve server performance by reducing the number of disk accesses required, but it can also consume more memory. | 4096
table_open_cache | Sets the maximum number of open tables allowed to the server. Open tables occupy memory and can slow down server performance if the limit is exceeded. Adjusting this value can improve performance by limiting the number of cached table definitions, but it can also lead to Out Of Memory errors if too few memory resources are available. | 4096
thread_cache_size | Sets the number of threads cached in memory for reuse. Cached threads can reduce the overhead of creating new threads, but they also occupy memory and can lead to Out Of Memory errors if too few memory resources are available. | 32