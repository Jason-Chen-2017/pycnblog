
作者：禅与计算机程序设计艺术                    

# 1.简介
  

在编写SQL语句或创建数据库或表时，对于character set的设定尤为重要。不正确的设置会导致数据的存储、读取等异常问题，因此正确地选择字符集至关重要。  
本文基于mysql5.7版本介绍了utf8mb4和utf8mb4_unicode_ci的区别及使用的场景。并通过实例分析了如何创建数据库、创建表、插入数据及索引时应该选择哪种字符集。  
# 2. mysql中的字符集
Mysql中支持三种字符集编码方式:  

1. ASCII  
2. UTF-8  
3. Unicode（也叫utf-16) 

其中UTF-8是Mysql的默认字符集，也是最常用的字符集。但在处理一些非ASCII的字符时，比如中文，就会出现乱码的问题。为了解决这个问题，Mysql还支持其它两个字符集: UTF-8和Unicode。MySQL 5.5之后增加了一个新的字符集: utf8mb4。它可以用于存储完整的4字节UTF-8字符集。从MySQL 5.5开始，utf8mb4成为Mysql的默认字符集。
# 3. mysql的字符集与排序规则
Mysql的字符集包括：

1. server：服务器内部使用的字符集
2. connection：连接客户端使用的字符集
3. database：数据库使用的字符集

另外，Mysql还支持对不同的字段进行不同的排序规则，例如：

1. binary：只比较二进制字符串，不考虑任何差异性。
2. national：用于支持国际化排序和搜索。
3. traditional：类似于national，但用于传统语言。
4. none：不进行任何排序，直接比较原值。

这些排序规则都是默认设置为binary的。如果需要调整排序规则，则可以使用alter table命令或者表结构定义文件中的collation属性进行配置。
# 4. utf8mb4的优点
utf8mb4是在mysql5.5版本中新增的字符集。它完全兼容utf8，可以存储完整的四字节UTF-8字符集。其主要优点如下：

1. 可以正确存储Emoji、表情符号；
2. 支持所有UTF-8字符；
3. 支持emoji和其他四字节字符的索引和查询；
4. 存储空间小，节省了数据库空间。

# 5. 为什么要用utf8mb4
一般情况下，使用utf8作为字符集就足够了，不需要使用utf8mb4。然而，当涉及到地区语言文字的存储和处理时，就需要考虑使用utf8mb4的优势。例如，中国有很多汉字，按照gbk编码存放在数据库里，容易造成空间浪费，特别是不同地区对同一个汉字的发音可能不同。同时，中国有很多地方采用的是utf8字符集，如新疆、西藏等少数民族地区。如果使用utf8编码，就无法很好地适应这些地区的需求。而使用utf8mb4就可以完美地解决这些问题。
# 6. utf8mb4的选择
一般情况下，使用utf8mb4就是一个不错的选择。由于性能、存储空间方面的优点，使用utf8mb4往往更好。
# 7. 使用utf8mb4的注意事项
虽然utf8mb4可以完美地支持utf8字符集的所有特性，但是仍然存在以下一些限制：

1. MySQL只能使用utf8mb4这种严格模式的utf8字符集；
2. 当使用某些客户端工具时，可能会遇到不支持该字符集的问题；
3. 如果数据库被复制到其他服务器上，utf8mb4字符集的数据库无法再使用utf8编码的数据库连接。

因此，utf8mb4不是万金油，只有在特定场合下才有效果。