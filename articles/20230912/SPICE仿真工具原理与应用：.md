
作者：禅与计算机程序设计艺术                    

# 1.简介
  
：什么是SPICE？
SPICE（Synthetic PUlisecond CIRCUITry）是一个电子集成电路仿真工具，其目标是模拟、构建并验证集成电路设计。它可用于电路布线、布局、布线优化、电源和系统设计、性能评估等方面，且具有高效率、灵活性及易用性。
SPICE由斯蒂芬·霍尔特于1972年在贝尔实验室开发出来。他是美国EECS（工程科学研究中心）的一位教授，曾就读于斯坦福大学。霍尔特先后创立了三种模式的SPICE仿真器：
- 第一代采用SPICE2,3语言，最初称为普通SPICE；
- 第二代采用NGSPICE语言，最初称为增强SPICE；
- 第三代采用HybridSPICE语言，最初称为混合SPICE。
随着时间的推移，SPICE已经成为工业界不可或缺的工具。它已广泛应用于整个电气、电子、生物和通信领域。为了更好地理解SPICE仿真器的工作机制，以及如何将其应用到实际中去，需要对其原理和流程有一个全面的了解。以下为SPICE仿真工具原理与应用系列文章的导读：

# 2.基本概念术语说明：
## 2.1 SPICE的基本概念和原理
SPICE由两部分构成：一部分是命令行界面（Command Line Interface），另一部分是图形用户界面（Graphical User Interface）。

SPICE命令行接口（CLI）是一个基于命令行输入的方式，它通过键入命令来执行任务。图形用户界面（GUI）则是一种图形化的界面，使得用户可以直观地看到电路的各种参数，并对其进行修改和调整。两个界面的主要区别在于控制权限。使用GUI的人不需要直接访问计算机底层的指令，而只需通过简单的图形操作即可完成对电路的分析和设计。相对于CLI而言，GUI更适合非计算机专业人员使用。因此，一般情况下，我们都倾向于使用GUI。

### 2.1.1 SPICE中的模型、设备和节点
SPICE最基本的建模单位是“模型”。模型是指电路中的逻辑实体，比如电阻、电容、电压源等。每个模型都有一个唯一的标识符，我们可以使用这个标识符来引用该模型。

SPICE还定义了两种不同的类型设备：

- MOSFET（MOsual Field Effect Transistor，有源场效应晶体管）
- BJT（Bipolar Junction Transistor，双极junction transistor）

SPICE中的“节点”就是电路的逻辑连接点。在SPICE中，一个节点可以表示电压、电流、电导率等信号的变化。

### 2.1.2 SPICE的运行机制
SPICE具有三个主要组成部分：解析器、数据结构、仿真器。

- 解析器：它负责把输入的脚本文件（Spice file）转换成一个有向无环图（DAG）。
- 数据结构：它负责存储有关电路的信息，包括模型的参数、节点之间的联系等。
- 仿真器：它负责按照DAG中的顺序执行每一个操作，从而计算出电路的电压分布和流动特性。

SPICE利用命令的输入、输出、参数、函数和变量等信息来描述电路，并根据这些信息来构造计算任务的有向无环图。然后，SPICE会根据有向无环图中的依赖关系，依次执行运算，最终得到电路的结果。SPICE支持多种运算形式，如加法、乘法、条件语句、循环语句、数据结构、矩阵运算等。

## 2.2 SPICE的脚本语言
SPICE的脚本语言有两种形式：普通形式的SPICE命令语法和增强形式的NGSPICE命令语法。

### 2.2.1 普通形式的SPICE命令语法
普通形式的SPICE命令语法由四个部分组成：

- 命令名：每一条命令都是由一个命令名开头，后面跟着一组参数。
- 参数：参数用来指定命令的行为方式。命令的参数有两种类型：位置参数和标志参数。位置参数由逗号分隔开，表示命令要处理的对象，可以是模型、节点、端口等；标志参数以减号开头，表示命令的选项，可以激活或关闭某些功能。
- 操作符：操作符用来表明命令所做的计算，如“+”，“-”，“*”等。
- 值：值是指特定参数所对应的实际数据。

普通形式的SPICE命令语法如下：

<命令名> <参数> [<操作符>] <值> [...]

### 2.2.2 NGSPICE命令语法
NGSPICE命令语法是普通形式的SPICE命令语法的扩展。除了标准的SPICE命令外，NGSPICE还增加了一些新的命令和语法规则。NGSPICE命令语法包括三种类型的命令：

- 子句命令：它们具有自己的子句，通常位于冒号(:)后面，用来提供附加信息给命令。
- 函数命令：它们以@开头，用来调用内置的函数。
- 模块命令：它们以模块名开头，表示要调用模块中的命令。

NGSPICE命令语法如下：

[第1条命令] [第2条命令;...]

<子句命令>: {<参数>}

<函数命令>: @<函数名>(<参数>) = <值>

<模块命令>: <模块名> {[<子句>] | (<参数>)} ;... 

其中，<子句>用于指定子句的名称和值。

例如，创建MOS封装器模块时，我们可以使用下面这样的命令：

.include "mosfet.inc"

NMOS mos1 ( D=1e-9, L=1e-6, W=50e-6, intent=dch )

这里，.include命令用来加载模块文件mosfet.inc，NMOS命令调用了模块中的MOS封装器模型。MOS封装器模型具有4个参数：D、L、W、intent。我们可以在MOS封装器模块中指定参数的值来设置MOS封装器的特性。