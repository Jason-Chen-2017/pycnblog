
作者：禅与计算机程序设计艺术                    

# 1.简介
  

图数据的分析一直是计算机科学和网络科学领域的一个重要研究方向。随着互联网的爆炸性增长、社交网络的飞速发展、大数据时代的到来，图数据的分析也从传统的基于内存的处理方式升级到了基于磁盘的海量计算平台。然而，对于大规模的图数据集来说，传统的基于迭代的方法可能会遇到困难。特别是在超大的图上进行迭代计算的时候，内存的存储瓶颈可能成为性能瓶颈。因此，如何有效地进行大规模图数据分析就成了当前亟待解决的问题。
在过去的几年中，出现了许多基于随机游走（random walk）、扩散映射（diffusion maps）和谱聚类（spectral clustering）等方法，这些方法都能够有效地对大规模图数据进行建模、分析和预测。本文将对这些方法进行系统性的介绍并探讨它们之间的区别及联系。
# 2.基本概念术语
## 2.1. 图
图（graph）是一个由边（edge）和顶点（vertex）组成的数据结构。一个图由两个集合$V$和$E$定义，其中$V$表示图中的顶点集，$E$表示图中的边集，$|V|$表示图中顶点个数，$|E|$表示图中边个数。边$(u,v)$被称作从顶点$u$指向顶点$v$的一条边，记作$u\to v$或者$(u,v)\in E$。

图可以是简单图、多重图或带属性的图。一个简单的图由边没有权值的图。通常情况下，图中的每个顶点有一个度，度反映了该顶点相邻的顶点个数。另外，路径是指一个顶点序列，它穿过边连接了所有的顶点。最小生成树（Minimum Spanning Tree，MST）就是一个简单图中的路径权值和最小的图。

多重图（multigraph）是一种允许一条边连同其它的边拥有相同的起始顶点和终止顶点的图。一个具有多重边的图可能出现自环或平行边，因此也被称作自孤立子图（Isolated Subgraph）。

带属性的图是指每条边或顶点均有一组属性，属性可以用于描述某些特定的信息，如边的权值、顶点的位置、颜色等。

## 2.2. 有向图和无向图
对于一个图G=(V,E)来说，如果有一条边$(u,v)$且$v\neq u$,则称(u,v)为该图的有向边。无向图是指所有边都是无向边。

对于有向图来说，路径的方向决定了边的方向。从顶点$u$到顶点$v$存在两条路径$(u,w_1), (w_1,w_2), \cdots, (w_{k-1},v),(v,u)$，其中$w_i \neq w_j$。一旦确定了一条路径，就不再考虑另一条路径，也就是说，要找到一条有向路径，只能沿着边的方向。比如，$a\to b\to c\to d\to e$和$c\to a\to b\to d\to e$不是同一条路径，尽管它们共享相同的顶点。如果还需要考虑路径上的顶点的次序，需要使用无向图。

## 2.3. 权重和路径长度
对于一个图，路径$(x_1,x_2,\ldots,x_n)$的权重（weight）定义为连接他们的边的权值之和。路径$(x_1,x_2,\ldots,x_n)$的长度（length）定义为沿着路径上边的数量。通常情况下，我们认为一条路径比两条不同路径更短，但在一些特殊情况下，两条相同权值的路径却比两条不同权值的路径更短。例如，对于无向图，$(u,v)$和$(v,u)$之间的距离为$d_G(u,v)=d_G(v,u)=0$。

## 2.4. 对偶图
给定一个图G，它对应的对偶图D(G)是一个包含和G相同边、顶点、度数、边权和路径的图。D(G)的顶点集等于G的边集，因为对偶图将边当作顶点，而顶点当作边。D(G)的度数等于G的顶点个数，因为对偶图的度数等于其顶点个数。对偶图的边权等于$w^{-}=\min\{w_{ij}\mid (u,v) \in G\}$,$w^+=\max\{w_{ij}\mid (u,v) \in G\}$,其中$w_{ij}=0$表示$uv$之间不存在边。对偶图的路径权值等于$c^{-}=\sum_{v \in V} \delta(v, s)$,$c^+=\sum_{v \in V} \delta(t, v)$,其中$\delta(v,s)$表示从$v$出发到$s$的最短路径的权值。对偶图不一定存在。

## 2.5. 核函数
对于一个图$G=(V,E)$，设$K(G)$为图的核矩阵。核矩阵是一个$|V|\times |V|$的矩阵，其中第$(i,j)$元素为$K(G)$第$i$行第$j$列的内积。

对于二部图（bipartite graph），$K(G)$存在且为半正定矩阵。半正定矩阵是指对于任意的非零向量$x$和$y$，都有$xy>=0$。

## 2.6. 可达性
对于一个图G，$G$中从顶点$u$可达的顶点（reachable vertex from $u$）被称为$u$的可达顶点集。有两种常用的可达性算法：广度优先搜索（BFS）和深度优先搜索（DFS）。广度优先搜索是指从源顶点开始，依次访问出发于源顶点的所有可达顶点。深度优先搜索是指从源顶点开始，先访问所有可达顶点的一级相邻顶点，然后访问这些顶点的一级相邻顶点，直至不能再继续扩张。

## 2.7. 特征根和最小生成树
一个无向图G=(V,E)，如果G中任何一个点都不是其他点的度数的约数，那么G中称这个点为G的特征根（feature root），否则，不存在特征根。特征根的度数称为特征值（feature value），最小生成树就是以特征根为根的最小权值生成树。

# 3. Random Walks
## 3.1. 概念
随机游走（Random Walk，RW）是指一个在图或网络上移动的过程，其结果是经过图中各个顶点一次且仅一次，且每次移动的概率相同。假设从顶点$s$出发，途径顶点集$T$，通过路径$\{s,v_1,v_2,\ldots,v_l\}$转移到目标顶点$t$，则随机游走的过程如下：

1. 从源顶点$s$出发，选择初始状态$\{s\}$.
2. 在状态空间$\Omega$中采样一个状态$X=v_1$，得到新状态$\{s,v_1\}$.
3. 将当前状态设置为$\{s,v_1\}$，重复以下过程：
   - 根据以$X$作为状态的转移概率分布，以一定概率改变$X$的值，并得到新的状态$Y$.
   - 如果$Y=\emptyset$或$Y=\{t\}$，结束，得到最终状态$\{s,v_1,\ldots,v_l\}$.
   - 将当前状态设置为$Y$，重复第二步。
   
假设随机游走在整个状态空间上以相同概率采样出状态，则每个状态出现的次数独立于其它状态。由于随机游走的结果只依赖于状态空间的结构，而不依赖于具体的值，所以随机游走是一种泛化的路径规划方法。随机游走适用于对网络结构以及图结构进行统计学分析，发现网络的结构模式，以及对节点进行分类、推荐等任务。

## 3.2. 近似算法
为了节省内存资源和提高效率，现有的随机游走算法往往采用局部更新策略。具体地，在一个时间步内，以一定概率接受从当前状态转移到某个相邻顶点的新状态；若没有相邻的新状态，则仍然沿着原有的状态向前走一步。在算法运行过程中，维护一个状态栈和一个已访问状态集合，遍历状态空间。算法的时间复杂度为$O(|V|+|E|)$。

## 3.3. 高斯随机游走模型
高斯随机游走模型（Gaussian random walk model）假设图G的任意两个顶点之间的链接关系服从高斯分布。即，对于边$(u,v)$，其权重（weight）满足高斯分布$N(\mu_{uv}, \sigma^2_{uv})$，其中$\mu_{uv}$是从$u$指向$v$的平均权重，$\sigma^2_{uv}$是方差。这样，在假设了随机游走模型之后，可得

$$P(A) = exp(-\frac{||A-\mu||^2}{2\sigma^2})\tag{1}$$

其中$A$为从顶点$s$出发，经过顶点集$T$的游走结果，$||.\||$表示矩阵的Frobenius范数。利用这个结论，可以得到更高效的随机游走算法，称为高斯随机游走（Gaussian Random Walk）。

## 3.4. 小世界模型
小世界模型（small world model）是指网络中存在“小世界”现象。这一现象表述为：存在很多种路径能从一点连接到另一点，但是只有很少的路径能从另一点到达那些很熟悉的节点。这是因为小世界模型假设节点之间的距离呈现“随机”（random）的规律。然而，实际的网络是复杂的，复杂的网络中又有着一些非常重要的节点。所以，为了让网络保持小型度，小世界模型往往会引入一些规则：节点间的距离一般远小于平均距离，而且连接着某节点的邻居也比较稀疏。

在小世界模型假设下，随机游走的结果具有一定的规律性。因为在小世界模型中，节点之间的距离呈现规律性。因此，可以对节点的连接关系建立相似度矩阵，并利用相似度矩阵来估计随机游走的结果。

## 3.5. 其他重要随机游走算法
包括邻接矩阵随机游走（Adjacency Matrix Random Walk，AMRW）、马尔科夫链蒙特卡洛随机游走（Markov Chain Monte Carlo Random Walk，MCMC RW）、分层随机游走（Hierarchical Random Walk，HRW）。