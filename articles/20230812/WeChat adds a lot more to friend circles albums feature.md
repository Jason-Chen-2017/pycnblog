
作者：禅与计算机程序设计艺术                    

# 1.简介
  

## 概述

今年3月份，微信宣布对朋友圈发布相册功能。相册可以将照片、视频、Gif等多种形式的文件集中保存到一个地方，并通过向朋友展示这些文件来传播自己的感受。截止到目前（2021-09-17），微信支持创建相册的功能。创建相册后，用户可以上传图片、视频、Gif等多媒体文件，还可以分享这个相册给好友们一起浏览。相册中的每张图片都可设置多个标签，用于分类管理。同时，相册内也包含一些其他的功能，如“看一看”、评论、点赞等。除了系统提供的基本功能外，相册还可以结合小程序提供更丰富的功能。


相册功能虽然已经上线，但作为一个新功能，有着一些不完善之处，例如：1）创建相册的人不能很好的进行权限控制；2）相册显示模式不是很多人的喜欢，有的朋友希望看到的是“列表”模式而不是“瀑布流”模式；3）相册里的内容推荐系统需要优化；4）相册里的功能没有一键导出到手机相册的便利。


基于以上情况，为了提升相册功能的易用性、呈现效果、优化推荐效果，微信正在推出增强版的相册。本文主要介绍微信增强版的相册功能，包括新增功能、新增优化及功能变动等方面。

## 新增功能
### 外部APP文件导入功能

相册中的照片都是由微信上传的，这就意味着不管是自己上传还是别人上传的，都是在微信内部存储空间中。这在一定程度上限制了相册功能的普适性，因此微信为用户提供了导入外部APP图片文件到相册的功能。

外部APP文件导入功能可以实现将手机上的各种应用中的图片、视频、音频文件导入到微信的相册，且不影响外部应用的原有功能。用户只需通过微信扫描文件，选择要导入的相册，就可以将对应文件导入到相册中。这样一来，就可以整合不同平台上的资源，提高相册的广泛性和互通性。另外，还可以将微信相册中的内容分享到不同平台，实现信息的跨平台传递。


### “我收藏”功能优化

相册新增了一个“我收藏”功能，允许用户标记喜欢的照片或视频，方便日后查看。但是，当用户上传大量照片时，可能会出现过多的收藏数据，影响相册的效率和速度。为了解决这一问题，微信增强版的相册中引入了“精选”功能。当用户点击相册页面底部的“精选”按钮时，可以自动根据相册中的收藏数据，筛选出十分优秀的图片，并按日期排序。这样一来，用户在浏览相册时，能够快速找到他们最喜欢的照片或视频。

### “已看”与“最近访问”功能优化

相册的“已看”功能可以记录用户查看过的照片或视频，以便下次跳过或再次观看。但是，随着相册功能的广泛使用，记录这些数据的效率可能不高。针对这一情况，微信增强版的相册添加了“最近访问”功能。点击“最近访问”，可以看到最近浏览过的照片或视频，以及相应的时间戳。这样一来，用户在查看相册时，可以较快找到自己之前看过的照片或视频，并回顾浏览历史。

### 更加灵活的相册显示模式

相册默认采用瀑布流模式显示相册内容，但由于其局限性，很多用户希望看到的是“列表”模式。于是，微信增强版的相册增加了不同的显示模式，使得用户可以根据自己的喜好选择不同的显示方式。现在，用户可以在相册的顶部切换不同的显示模式，包括“瀑布流”、“列表”、“网格”、“星形”、“时间线”五种。其中，“时间线”是微信自研的模式，它将相册按照时间先后顺序排列，显示出照片背后的信息。

## 新增优化及功能变动
### 优化上传效率

相册功能能够让用户组织照片、视频，并分享给好友，这为用户提供了一种新型的沟通方式。但是，上传过程的复杂性和冗长等待时间，也成为用户使用相册的拦路虎。所以，微信增强版的相册在性能优化方面也做了一些工作。

首先，提升上传图片的响应速度，缩短上传时间。这对于快速拍摄和创作的用户来说尤为重要。我们改进了相册上传流程，引入了异步上传机制。在用户选择完成图片后，会先压缩图片，然后进行预处理，然后才正式上传到微信服务器。这样一来，用户上传照片的速度可以大幅度提升。

其次，优化文件分片上传机制，减少文件传输失败率。目前的微信上传服务依赖于第三方的七牛云存储，它的稳定性和可用性都不太理想。为了提升上传效率，我们在后台对文件分片上传进行了优化，通过切片的方式把单个大文件分解成小块，并分别上传到微信服务器。这样一来，即使网络波动或上传失败，也可以保证文件完整性和完整性。

最后，实施上传任务调度策略，提升上传任务的并发处理能力。为了避免因单个用户上传大量照片带来的性能问题，微信增强版的相册引入了批量上传策略。如果用户一次上传多张图片，后台会自动进行分批上传，每个批次上传20张左右，降低资源占用和网络负担。同时，还通过弹窗提示用户当前上传进度，让用户了解上传状态。

### 支持通过相机上传视频文件

相册中上传视频文件的功能已存在，但用户在实际使用过程中，发现它存在以下缺陷：1）视频文件大小限制；2）仅支持MP4格式视频；3）视频上传时无声音提示。因此，微信增强版的相册对视频文件的支持力度也越来越强。

为了满足用户的需求，我们增强了视频文件的上传功能。现在，用户可以通过相册页面底部的相机图标，选择摄像头拍摄视频或直接从手机相册中选择视频文件进行上传。在获取用户的权限之后，系统会将用户拍摄或选择的视频文件压缩至指定大小，再进行预处理，最终上传到微信服务器。此外，视频上传成功后，还会生成对应的播放页，供用户预览和观看。

### 搜索功能优化

相册支持关键字搜索相册中的照片或视频，但搜索结果的准确性和效率仍然不尽如人意。为提升用户搜索体验，微信增强版的相册提供了一些优化措施。

首先，为相册中的所有照片或视频建立索引，使搜索服务更加准确。为此，微信增强版的相册引入了分布式索引服务，将照片和视频的元数据索引到云端，实现全量数据的检索。

其次，我们新增了词库索引功能，可以帮助用户自定义搜索关键词。通过词库索引，用户可以输入部分文字，搜索引擎即可快速定位相关内容。通过词库索引，用户可以提升搜索准确度和效率。

最后，我们对搜索结果的排名和显示方式进行了优化。我们将搜索结果根据相似度进行排序，给予相同搜索词下的相似结果的相似度打分，并展示置顶结果和相似结果。这样一来，搜索结果更加符合用户的预期，并且搜索服务的响应速度也更快。