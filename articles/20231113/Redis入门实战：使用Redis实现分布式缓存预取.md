                 

# 1.背景介绍


## 分布式缓存概述
随着互联网业务的发展、用户访问量的增长、应用服务的增加，单体架构已经无法满足需求。为了解决这个问题，分布式缓存应运而生。分布式缓存是一种快速读取的高性能存储介质，它在分布式环境下将热点数据缓存到集群中多个节点上，从而缓解单机的内存和CPU资源瓶颈，提升系统整体的并发处理能力。


如图所示，分布式缓存架构由客户端、代理服务器和Redis三部分组成。客户端向代理服务器发送请求，代理服务器再向Redis服务器发送请求。如果Redis缓存中没有该数据，则直接从数据库或其他缓存服务中获取，然后存放到Redis缓存中。当下次相同请求到来时，直接从Redis缓存中获取数据即可。

分布式缓存最大的优点就是降低了单个服务器的压力，使得系统拥有更强大的响应能力。但是这种架构也带来了新的问题，比如缓存不一致的问题、缓存穿透的问题等。为了解决这些问题，Redis提供了一些功能特性。其中最重要的便是预取机制。
# 2.核心概念与联系
## 2.1 预取机制
### 2.1.1 什么是预取？
预取机制是指当缓存失效的时候，可以让客户端先请求一下后端的数据，然后把数据更新到本地缓存中。这样的话，即使后端数据发生变化，也可以通过本地缓存提供服务。由于前期请求会耗费一定时间，所以一般只对频繁访问的数据进行预取。

### 2.1.2 为什么要预取？
一般来说，对于热点数据，我们都希望能够及时的从后端源头获取最新数据，而不是让用户等待。那么，就需要考虑到如何合理预先填充缓存，从而减少对后端数据的访问。否则，将导致延迟的增加，甚至造成缓存雪崩。

### 2.1.3 如何预取？
#### 2.1.3.1 请求连接方式
预取机制主要是通过请求连接的方式来实现的。Redis提供了两种连接方式，它们分别是主动触发和被动触发。

主动触发：顾名思义，主动触发是指在请求到达的时候就触发预取机制。也就是说，当客户端发出一个读请求时，若该key对应的value已经过期，则会自动去请求后端服务器，并更新本地缓存。

被动触发：相比于主动触发，被动触发是更加动态的预取方式。当客户端发起一个读请求时，如果发现缓存中的value已经过期，则不会立即触发预取机制，而是通知Redis服务器去检查是否存在新版本的value。如果存在，则通知客户端。因此，被动触发是根据访问情况动态调整预取策略，既可以节省系统开销，又能有效利用缓存空间。

#### 2.1.3.2 配置参数
##### 查看配置：`CONFIG GET prefetching`

返回值是一个redis对象。

```bash
127.0.0.1:6379> CONFIG GET prefetching
1) "prefetching"
2) "yes"
```

##### 设置参数：`CONFIG SET prefetching [yes|no]`

- yes：启用主动触发模式；
- no：关闭主动触发模式；

```bash
127.0.0.1:6379> CONFIG SET prefetching yes
OK
```