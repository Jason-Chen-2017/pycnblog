
作者：禅与计算机程序设计艺术                    

# 1.简介
         
2022 年 4 月 29 日，小米推出了小米路由器 XDR300，XDR 是全称“小米无线路由器”之首字母缩写。相比于较前几代的老路由器，XDR300 在外观、性能和耗电方面都有很大的提升。在这次发布会上，小米宣布 XDR300 将拥有 7 个品牌型号，每个品牌型号都有独特的功能特色，更有可能成为不同类型用户或领域的终端产品。但对于一般用户来说，究竟该选用哪个品牌型号呢？这项调研旨在收集对比分析 XDR300 的各项参数及其优缺点，帮助读者理解该路由器到底适合谁。
         
         # 2.基本概念术语
         ## 无线通信
         小米路由器 XDR300 使用 Wi-Fi 和蓝牙双模网卡，无线局域网连接方式支持 2.4GHz 和 5GHz 频段。Wi-Fi 信号可以覆盖城市的周围环境，而蓝牙也可以实现无线穿透，适用于户外、快捷控制、远程监控等场景。
        
         ## Wi-Fi 与 5G
        Wi-Fi 是一种无线局域网技术，它由 IEEE 802.11 协议定义，可以传输语音、视频、数据等多种信息。Wi-Fi 的最大传输速度为 2.4GHz ，其中 2.4 表示 Giga 是 10^9 的意思。然而，随着 5GHz 频段的出现，Wi-Fi 技术也越来越普及，不仅可以实现同样的传输能力，还可以提供更高的数据速率和范围。
        
        国际标准组织（International Organization for Standardization）已经制定了 5G 相关标准，5GHz 是指 5000 赫兹的意思。也就是说，5GHz 频段可以提供更高的数据速率和范围。5G 采用了新的通信技术，它把传统的 Wi-Fi 技术拓展到了新的频段上。5G 可以达到更高的数据传输速度、范围扩展性、低时延、更可靠的连接性、容量扩展性等特性，并且不需要依赖电力供应。
        ## 控制器（Controller）
        小米路由器 XDR300 拥有四个独立的控制器，它们负责管理网络设备、负载均衡、防火墙、QoS、VLAN 分配、NAT、QoE 等功能。每个控制器运行在单独的单板计算机上，分别控制不同的网络接口。
        
        ## 一体机式设计
        小米路由器 XDR300 是一体机式设计，因此所有零部件都集成在一个盒子里，方便快速组装和安装。
                
        # 3.核心算法原理
        小米路由器 XDR300 的核心处理器是 Hi3518，它是一个 ARM Cortex A72 架构的处理器。ARM 是英特尔公司开发的微处理器架构，拥有超高的计算性能和强大的安全保障。Hi3518 具有 64 MB DDR4 RAM，用于存储运行中的系统数据。
        
        ## 4G 网络控制器
        小米路由器 XDR300 具备三款 4G 网络控制器，它们是 MT76x2D 大流量控制器、MT76x2U 小流量控制器和 MT7612E PicoWiFi 小型 Wi-Fi 控制器。它们共同构成了 4G 消息处理链路。
        
        ### 4G 大流量控制器
        MT76x2D 是 4G 网络控制器系列中性能最好的芯片，它搭载 533 MHz 主频、3.2 GB/s 的接口带宽，同时支持 QAM16、QPSK、1200 和 2400 比特/秒的传输速率。
            
        ### 4G 小流量控制器
        MT76x2U 是小型 4G 网络控制器，它比 MT76x2D 更轻巧，仅有 222 MHz 主频、512MB DRAM，但其运算能力仍可满足应用需求。
        
        ### 4G PicoWiFi 小型 Wi-Fi 控制器
        MT7612E 是小型 Wi-Fi 控制器，它的主频为 2400 MHz，拥有 1.5GHz 射频性能。此外，它也支持 Wi-Fi 6E 技术，可以扩展至 370Mbps 数据速率。
        
        ## WiFi 网络控制器
        小米路由器 XDR300 具备五款 Wi-Fi 网络控制器，它们是 BCM43455、BCM43458、RTAC5770、Realtek RTL88xx 系列以及 Realtek 8723AU Wi-Fi 模块。
            
        ### Broadcom BCM43455 千兆级无线控制器
        BCM43455 是小米路由器 XDR300 的 Wi-Fi 控制器之一，它是基于博通 4345 Wi-Fi 模组设计的，并具有低功耗、高速率、易用性、出色的性能，被广泛运用于移动设备、笔记本电脑、路由器等。
            
        ### Broadcom BCM43458 千兆级无线控制器
        BCM43458 是另一款小米路由器 XDR300 的 Wi-Fi 控制器，它与 BCM43455 类似，支持相同的工作模式和功能，但它支持更多的速率，例如 2.4GHz 的 11b/g/n 速率。

        ### Realtek RTL8821CE 系列高端 Wi-Fi 控制器
        RTAC5770、RTAC880、RTAC8821CE 是小米路由器 XDR300 的第三、第四、第五款 Wi-Fi 控制器，它们都是高端 Wi-Fi 控制器，拥有千兆以太网口，在功耗和性能之间找到平衡。
            
        ### Realtek RTL88xx 系列高端 Wi-Fi 控制器
        除了 RTAC5770、RTAC880、RTAC8821CE 以外，还有许多其他的 Realtek 高端 Wi-Fi 控制器可用，比如 RTL8821AE、RTL8821AEBN、RTL8821BE、RTL8821C、RTL8821CU、RTL8821DE 等。这些控制器都可以在更长的距离上运行，并获得更高的传输速率和范围。
            
        ### Realtek 8723AU Wi-Fi 模块
        除了以上所有的 Wi-Fi 控制器以外，还有一个 Realtek 8723AU Wi-Fi 模块，它也是一款高端 Wi-Fi 模块，用于嵌入到外置 SoC 中，如 Raspberry Pi 上。
                
    # 4.具体代码实例及解释
    ```c++
    // 初始化
    struct rt_uboot_controller *uc = (struct rt_uboot_controller *)rt_malloc(sizeof(struct rt_uboot_controller));
    
    uc->name = "uboot"; // 设置名称
    uc->start = uboot_main; // 设置启动函数地址
    uc->stop = NULL; // 设置停止函数地址
    uc->probe = NULL; // 设置探测函数地址
    uc->remove = NULL; // 设置移除函数地址
    uc->suspend = NULL; // 设置休眠函数地址
    uc->resume = NULL; // 设置唤醒函数地址
    
    // 添加 u-boot 控制器
    ret = rt_device_register((struct rt_device*)uc,
                              RT_DEVICE_CTRL_CPU | RT_DEVICE_FLAG_INT_RX | RT_DEVICE_FLAG_STREAM | RT_DEVICE_FLAG_STANDALONE);
    
    if (ret!= RT_EOK)
    {
        LOG_E("Failed to register %s controller", uc->name);
        return -1;
    }
    ```
        
    在这份代码中，通过 `struct rt_uboot_controller` 创建了一个名为 uboot 的控制结构，并设置了它所对应的启动函数地址。通过调用 `rt_device_register()` 函数注册这个控制结构，使其成为 u-boot 控制组的一员。
        
    此外，通过注释，还可以看到 u-boot 控制器的所有接口函数。
        
    # 5.未来发展趋势和挑战
    从上文的内容中可以看出，XDR300 是一款高端路由器，其架构和模块化程度都非常高，能够集成多个组件一起工作，从而让路由器的功能更加丰富。但是，这种架构也引入了新的复杂性，如 Wi-Fi、4G、NAS、芯片组之间的依赖关系、网卡驱动程序、控制器的数量和驱动程序等。总而言之，XDR300 需要经过长时间的迭代和优化才能满足用户的需求，新的功能层出不穷，对硬件资源的消耗也将增加。
    
    # 6. 附录常见问题
    （1）XDR300 的 4G 模块控制器支持哪些频段？为什么 XDR300 会采用两款 4G 模块控制器，而不是单一的四核控制器？
    
    XDR300 的 4G 模块控制器目前支持北美主流 800MHz 频段，并且 XDR300 有两个 4G 模块控制器，分别处理北美和欧洲地区的接入。
        
    主要原因如下：
    
    1. 更精细的资源划分：XDR300 的硬件资源非常复杂，控制器数量众多，而且每台服务器上面又有多个处理器组成，因此很难给每一个功能分配专用的模块，否则会影响整体性能。
    
    2. 支持异地访问：当前的 XDR300 只能进行北美和欧洲地区的接入，如果要进行国内地区的接入，则需要添加更多的 4G 模块控制器。
    
    3. 4G 连接能力增强：XDR300 的性能瓶颈在于它的 4G 模块控制器，目前还无法完全支持高带宽、高信噪比的业务。
            
    （2）XDR300 的 Wi-Fi 控制器支持哪些速度？为什么 XDR300 不采用单一的 Wi-Fi 模块控制器，而是选择五个 Wi-Fi 控制器？
    
    XDR300 的 Wi-Fi 控制器包括 BCM43455、BCM43458、RTAC5770、Realtek RTL88xx 系列以及 Realtek 8723AU Wi-Fi 模块。支持的 Wi-Fi 速度如下：
    
    1. BCM43455 千兆级无线控制器：支持 2.4GHz、5GHz、60GHz 三个频段，支持 20Mhz、40Mhz、80Mhz 两种速度。
    
    2. BCM43458 千兆级无线控制器：支持 2.4GHz、5GHz、60GHz 三个频段，支持 20Mhz、40Mhz、80Mhz 两种速度。
    
    3. RTAC5770、RTAC880、RTAC8821CE 系列高端 Wi-Fi 控制器：支持 2.4GHz、5GHz、60GHz 三个频段，支持 20Mhz、40Mhz、80Mhz 两种速度。
    
    4. Realtek RTL88xx 系列高端 Wi-Fi 控制器：支持 2.4GHz、5GHz、60GHz 三个频段，支持 20Mhz、40Mhz、80Mhz、160Mhz 四种速度。
    
    5. Realtek 8723AU Wi-Fi 模块：支持 2.4GHz、5GHz、60GHz 三个频段，支持 20Mhz、40Mhz、80Mhz 两种速度。
        
    主要原因如下：
    
    1. 安全性：XDR300 主要运行在家庭网络和公共区域，因此安全性需要得到保证。
    
    2. 功耗：XDR300 使用的是定制的 SoC，控制器的功耗尚可。
    
    3. 灵活性：XDR300 的 Wi-Fi 控制器是根据不同应用需求进行高度定制的，可以使用户自由选择使用那些控制器。
    
    4. 稳定性：XDR300 的 Wi-Fi 控制器具有良好的稳定性，不会因环境变化导致故障。
        
    （3）XDR300 是否支持 Wi-Fi 6？

    XDR300 支持 Wi-Fi 6，支持 5GHz 频段 2400MHZ 速率的传输，并且在 Wi-Fi 6 下，XDR300 的处理能力会提高。
        
    （4）XDR300 的计算性能如何？
   
    XDR300 的计算性能非常强悍，所有的核心处理器都配有专用的指令集，能够轻松应付复杂的工作负载。