
作者：禅与计算机程序设计艺术                    

# 1.简介
  

for循环（英语：For Loop），又称计数循环或者迭代循环，是一种控制结构，它让计算机依次顺序地执行一系列语句或指令，一般用于遍历数组、链表等数据集合中的每一个元素。其一般语法格式如下所示：

```python
for variable in iterable:
    # do something with the variable
```

在这个语法结构中，`variable` 是用户指定的变量名，而 `iterable` 可以是一个序列、列表、字典或者其他支持迭代的数据类型，如字符串等。`do something with the variable` 表示对每次迭代时变量 `variable` 的赋值或运算表达式，可以是简单地打印输出，也可以是复杂的计算操作。

for循环可以看作是一种在重复性任务中高效处理数据的有效工具。一般来说，如果需要对某些固定次数的操作重复执行多次，则可以使用 for 循环；如果涉及到迭代某个数据的特定条件下多次进行的操作，则可以考虑使用 while 或 until 循环；如果对同一个对象连续进行多个修改，也可以考虑使用 while 循环。

for循环并不仅限于处理数组或者列表这种有序的序列数据。它还可以用来处理数字的范围，或者任意可迭代对象的元素，甚至可以用它实现无限循环的效果。在实际应用中，for循环被广泛应用在各种领域，比如网页解析、机器学习、图像处理、数据库查询等等。

# 2.基本概念术语
## 2.1 什么是迭代？
迭代是指按照一定顺序依次访问集合中的每个元素，这种访问模式称之为迭代。迭代的过程中会产生一个序列，通常该序列是有明确定义的。

## 2.2 for循环语句的组成
- 初始化表达式（for 循环后的关键字）：指定了循环的初始状态，即初始化了循环变量的值。通常是在这里引入迭代器，为循环迭代做准备。

- 检查表达式（循环条件表达式）：确定是否继续循环，若检查结果为 False，则停止循环。在循环体内，可以在检查表达式之前或之后做一些操作，比如输出日志信息。

- 更新表达式（循环后置表达式）：在每次循环结束时，会更新循环变量的值，以使得下一次循环能够正常工作。

- 循环体：通过循环变量来对集合中的元素进行处理。

## 2.3 可迭代对象
Python 中的“可迭代对象”是指支持 `iter()` 方法的对象，该方法返回一个特殊的迭代器对象，允许 Python 程序员进行相应的迭代操作。以下列出的是 Python 中支持迭代的常见对象：

- list/tuple
- str
- set/frozenset
- dict

除了以上这些类型之外，还有其他一些类型的对象也支持迭代，但它们不是作为基础类型，而是通过一定的转换方式才能转换为可迭代对象。比如，文件对象、生成器函数、迭代器对象等都是可迭代对象。

## 2.4 生成器表达式
生成器表达式（Generator Expression）是 Python 2.x 版本新增的特性，它可以更加方便地创建迭代器对象。它借鉴了数学上的推导公式的形式，语法上类似于列表生成式，但是返回的是生成器对象而不是列表对象。

语法格式如下：

```python
(expression for item in sequence if condition)
```

## 2.5 lambda 表达式
Lambda 表达式（匿名函数）是 Python 中的一项新功能，它允许用户在函数定义中嵌入一个简单的表达式。与普通函数相比，它的特点是只能有一个表达式，并且不能显式的声明参数列表。

语法格式如下：

```python
lambda arguments : expression
```

其中，`arguments` 是参数列表，`: expression` 是返回值表达式。

# 3.原理解析
## 3.1 使用range()函数实现整数序列迭代
首先，了解一下 `range()` 函数的用法。`range()` 函数返回一个从指定开始到指定结束且步长为 1 的整数序列，可以通过设置第三个参数来改变步长，如果步长为负数，则序列将反向迭代。

```python
>>> range(5)        # 从0到4的整数序列
range(0, 5)
>>> range(-5, -1)   # 从-5到-1的整数序列
range(-5, -1)
>>> range(1, 11, 2) # 从1到10，步长为2的整数序列
range(1, 11, 2)
```

然后，我们就可以使用 `range()` 函数来实现整数序列的迭代，例如：

```python
for i in range(5):
    print(i)
```

上述代码将打印出 `[0, 1, 2, 3, 4]` 。

## 3.2 使用list或tuple实现自定义迭代
另外，还可以直接传入一个自定义的序列对象来实现自定义的迭代，只需保证该对象支持 `__getitem__()` 方法即可，该方法接收一个索引值，并返回对应位置的值。

```python
my_sequence = [1, 'a', True]
for element in my_sequence:
    print(element)
```

上述代码将打印出 `[1, a, True]` ，即序列中的三个元素。

## 3.3 使用dict的keys()方法实现字典键的迭代
还可以直接调用字典的 `keys()` 方法来获取字典的所有键，然后再进行迭代。

```python
my_dict = {'name': 'Alice', 'age': 25}
for key in my_dict.keys():
    print('Key:', key, ', Value:', my_dict[key])
```

上述代码将打印出：

```
Key: name, Value: Alice
Key: age, Value: 25
```

## 3.4 使用while循环实现无限迭代
还可以利用 `while` 循环来实现无限迭代，比如当值为 `True` 时一直循环。

```python
count = 0
while count < 5:
    print("Hello world!")
    count += 1
```

上述代码将永远循环输出 "Hello World!" 。

## 3.5 使用生成器表达式实现更高效的迭代
最后，我们再来看看如何使用生成器表达式来实现更高效的迭代。对于一个迭代，往往需要创建生成器对象、迭代器对象和迭代器对象。如果只是用 `for` 循环来实现迭代，那么生成器表达式就非常适合用，因为它返回的是一个生成器对象，不需要创建完整的列表。

举个例子，假设有一个有1亿条记录的文件，我们想读取其中的偶数行。如果使用传统的方法，我们可能要创建一个包含所有行的列表，然后再过滤得到偶数行，这样需要消耗大量内存资源。

而使用生成器表达式，我们可以直接基于文件的每一行来生成偶数行，而无需预先加载所有的行到内存中。下面用生成器表达式来实现这一功能：

```python
with open('filename') as file:
    even_lines = (line for line in file if int(line.strip()) % 2 == 0)
    for line in even_lines:
        print(line)
```

上述代码将读取 `filename` 文件的内容，并根据行号判断奇偶性，并只输出偶数行。