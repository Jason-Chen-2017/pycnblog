                 

# 1.背景介绍


什么是并查集？并查集是一种树型的数据结构，它用于处理一些不相交集合的合并、查询等操作。比如在一个班级中，若同学A与同学B属于一个组，而后又有同学C、D也想加入这个组，此时需要进行合并，这时就可以使用并查集。

先看一个普通的班级管理系统页面：


上面这个界面有一个按钮“添加组成员”，可以用来向当前组中增加成员。假如点击这个按钮之后，页面上会出现一个弹窗让用户输入新的成员名称，并将其加入到当前组中。但是如果多个学生同时点击这个按钮，可能导致不同组同时拥有相同的成员，从而造成混乱。所以要保证组内成员的唯一性，就需要用到并查集。

# 2.核心概念与联系
并查集（Disjoint Set）是一个树型的数据结构。每一个元素都对应着一个集合，每个集合都是由其他的元素所组成。其中每个元素都对应一个编号，所有的元素之间通过这些编号来判断是否属于同一个集合，也可以判断两个元素是否在同一个集合中。

首先，设有一个连通图G=(V,E)，其中V表示顶点集合，E表示边集合。任意两个顶点u,v都有路径连接，则称该连通图是连通的；否则，称为非连通的。

并查集就是在连通图G上的一种分治思想，利用分治法解决如下的问题：给定一个包含n个元素的集合，对于其中任意两个元素u,v，判断它们是否属于同一个集合。

1. Make-set(初始化)：创建一个包含单个元素作为子集的集合，记作根节点。
2. Find(查找)：找到元素所在集合的根节点。
3. Union(合并)：将两个集合合并成一个大的集合。

经过以上步骤，使得所有的元素归类到不同的集合中。如果两个元素所对应的集合是同一个集合，则它们是属于同一个集合的。否则，不属于同一个集合。

另外，为了方便运算，通常对初始元素进行标号，即把1-n依次赋予不同的元素，然后对整个集合应用并查集算法。

# 3.核心算法原理和具体操作步骤以及数学模型公式详细讲解
## 初始化并查集

对于一个元素个数为n的集合，我们都可以用1-n的数字来代表它，作为它的id。因此，初始化操作就是根据元素的数量n创建大小为n的数组。假设所有元素初始化完成，那么数组的值均为空。

```python
class DisjointSet:
    def __init__(self, n):
        self.parent = [i for i in range(n+1)] # 每个元素的父节点指向自己
        self.rank = [1] * (n+1) # 元素的高度默认为1

    # 返回元素x的祖先节点，时间复杂度为O(logn)
    def find(self, x):
        if self.parent[x]!= x:
            return self.find(self.parent[x])
        else:
            return x

    # 判断元素x和y是否属于同一个集合
    def is_same_set(self, x, y):
        return self.find(x) == self.find(y)

    # 将元素x和y所在的集合合并，时间复杂度为O(logn)
    def union(self, x, y):
        rootX = self.find(x)
        rootY = self.find(y)

        if rootX == rootY:
            return False

        if self.rank[rootX] < self.rank[rootY]:
            self.parent[rootX] = rootY
        elif self.rank[rootX] > self.rank[rootY]:
            self.parent[rootY] = rootX
        else:
            self.parent[rootY] = rootX
            self.rank[rootX] += 1

        return True
```

## 查找元素

查询元素x对应的集合的根节点。由于只要访问了数组中的某一个值，时间复杂度为O(1)。

```python
def find(self, x):
    if self.parent[x]!= x:
        return self.find(self.parent[x])
    else:
        return x
```

## 判断是否属于同一个集合

判断元素x和y是否属于同一个集合。时间复杂度为O(logn)。

```python
def is_same_set(self, x, y):
    return self.find(x) == self.find(y)
```

## 合并两个集合

将元素x和y所在的集合合并。如果已经属于同一个集合，则直接返回False；否则，将两个元素的父节点设置成一样，并且把高度较低的一个的高度设置为较高的一个的高度加1，这样可以确保高度较低的一棵树作为根节点。时间复杂度为O(logn)。

```python
def union(self, x, y):
    rootX = self.find(x)
    rootY = self.find(y)

    if rootX == rootY:
        return False

    if self.rank[rootX] < self.rank[rootY]:
        self.parent[rootX] = rootY
    elif self.rank[rootX] > self.rank[rootY]:
        self.parent[rootY] = rootX
    else:
        self.parent[rootY] = rootX
        self.rank[rootX] += 1

    return True
```

## 操作演示

模拟一下以下几个操作：

1. 创建并查集：n=4
2. 查询元素1对应的集合的根节点：1
3. 查询元素2对应的集合的根节点：2
4. 查询元素3对应的集合的根节点：3
5. 查询元素4对应的集合的根节点：4
6. 合并集合1和2：True
7. 查询元素1对应的集合的根节点：1
8. 查询元素2对应的集合的根节点：1
9. 查询元素3对应的集合的根节点：1
10. 查询元素4对应的集合的根节点：1
11. 合并集合2和3：True
12. 查询元素1对应的集合的根节点：1
13. 查询元素2对应的集合的根节点：1
14. 查询元素3对应的集合的根节点：1
15. 查询元素4对应的集合的根节点：1
16. 合并集合3和4：True
17. 查询元素1对应的集合的根节点：1
18. 查询元素2对应的集合的根节点：1
19. 查询元素3对应的集合的根节点：1
20. 查询元素4对应的集合的根节点：1
