
作者：禅与计算机程序设计艺术                    

# 1.简介
  

## HDLC（High-Level Data Link Control）协议
目前HDLC协议已经成为串行通信领域中非常重要的协议之一，它是美国国防部于1984年推出的基于帧(Frame)和多帧(Multi Frames)的数据链路控制协议标准。该协议由16个不同的控制字段组成，它定义了建立、维护、终止网络数据链路通道的各种服务质量要求，并在两个设备之间提供可靠的信息传输和错误纠正功能。HDLC协议主要用于多种无线局域网（WLAN）的设备间通信，可以实现信息安全的高速连接，而且传输速度快，延迟低。 

## 时序控制芯片
现有的一种时序控制芯片是TDA18D系列芯片，其特点是在保持高速信号有效性的同时，还支持复杂系统的时钟同步。TDA18D是一种针对分布式DC/DC转换器通信网络的异步时序管理芯片，主要用于集中控制和时序功能。TDA18D集成了一个时钟分裂单元(CDR)，一个带宽分配单元(BACU)，以及一个多播处理单元(MCHP)。它的接口结构和逻辑架构都十分简单、高效，可以实现精准的时钟同步，适用于多种应用场景，如遥测和控制系统、遥感导航系统、环境监测系统等。

## TDA18D芯片评估分析及优化过程
### 1. 概览
对于HDLC协议来说，首先要解决的是HDLC协议的诸多复杂细节问题。其中包括信道噪声、数据包丢失、重传机制、流控等问题，这些问题直接影响HDLC协议本身的性能。因此，如何评估HDLC协议的性能至关重要。

HDLC协议的性能评估需要考虑以下几个方面:

1. 数据链路层性能: 数据链路层性能评价指标包括吞吐率(Throughput)、平均往返时间(Round Trip Time, RTT)、丢包率(Packet Loss Rate, PLR)等。其中吞吐率反映了数据链路的实际速率，RTT表示发送端到接收端所需的时间，PLR表示丢包率，即在数据链路通道上某时间段内，接收到的总包数量与发送总包数量之比。

2. 时序层性能: 时序层性能评价指标包括误码率(Error rate)、时延(Delay)、抖动(Jitter)等。其中误码率表示通过时序控制层产生的误码数量占所有传输位元数量的百分比，时延表示从发送时刻到接收时刻所需的时间，抖动表示发送端到接收端报文的传输过程中，数据包的实际时序与计划时序的差距大小。

3. 安全性能: 安全性能评价指标包括保密性(Confidentiality)、完整性(Integrity)、可用性(Availability)、认证性(Authentication)等。其中保密性表示信息只有授权的接收者才能访问，完整性表示传输的内容没有被修改过，可用性表示网络中的所有节点都可以正常工作，而认证性表示只有合法的用户才能访问网络资源。

因此，对于HDLC协议的评估，我们应该将以下性能指标综合考虑:

1. 数据链路层性能：吞吐率、平均往返时间、丢包率等；

2. 时序层性能：误码率、时延、抖动等；

3. 安全性能：保密性、完整性、可用性、认证性等。

### 2. 性能评估方法
通常情况下，HDLC协议的性能评估采用标准化的方法进行，即制定相关标准，测试设备是否符合相关标准。根据数据链路性能测试标准 IEEE 802.3bz，HDLC协议应满足如下要求：

1. 测试信道特性: 对信道进行白噪声测试；

2. 使用固定长度帧: 将HDLC帧分割为固定长度的包，用相同的长度和标志符对其进行封装；

3. 测试时序特征: 测试设备的时序性能，包括同步误差、锁定时间、抖动、偏移等；

4. 执行时序测试: 通过周期性交换随机数据帧验证时序性能；

5. 检查接受帧计数器: 每个发送帧都应被正确接收到。

按照此标准，我们可以评估HDLC协议的性能。但是，对于TDA18D芯片的评估，由于其应用场景特殊，因此需要额外考虑以下几个方面：

1. 时钟同步性能: 在TDA18D芯片中，时钟分裂单元(CDR)采用单倍频同步方式，因此误差不会太大。另外，时钟分裂单元也可以动态调整时钟分辨率，确保时钟精度。但这一功能目前还未完全实现。因此，为了更好地评估时钟同步性能，我们还需要进一步测试其它形式的时钟同步功能，如微波同步等。

2. 收发性能: 测试时序性能时，TDA18D芯片应执行数据连续接收测试。也就是说，TDA18D芯片应接收到发送端连续的多个数据包。除此之外，还应该测试同时向不同目标发送多个数据包的能力。

3. 时钟漂移: 在TDA18D芯片中，时钟同步精度受频率漂移影响较大。因此，除了测试TDA18D芯片的时钟同步性能之外，还需要测试其在频率漂移下的性能。

### 3. 时钟同步性能评价
#### (1). 信号同步和周期同步
时钟同步是通过匹配两个或多个设备之间的真实时钟信号实现的。这两种同步方式各有优缺点，下面分别介绍。

##### a. 信号同步
信号同步是最简单的时钟同步方式。信号同步的方式是由接收方生成一个唯一的时钟信号，并将这个时钟信号反馈给发送方。这种方式的优点是简单易行，只要接收方能够正确接收到发送方发出的时钟信号，那么就可以确定自己的时钟。但这种方式存在着时钟漂移的问题，当接收方无法正确接收到时钟信号时，会导致时钟漂移。另外，在信号同步方式下，只能检测到发送方的状态变化，不能检测到任何错误。

##### b. 周期同步
周期同步是一种高级的时钟同步方式。周期同步的方式是由接收方生成一个固定周期的时钟信号，并且周期是可以预知的。发送方定时发送时钟信号，接收方接收时钟信号，比较时钟信号的相位差，找出两个时钟信号之间的偏移，并通过偏移计算出自己的时钟。这种方式可以检测到错误，例如时钟跳变、时钟回拨等。周期同步的优点是可以避免时钟漂移，因为周期同步的两个时钟信号始终处于相邻位置。

#### (2). TDA18D时钟同步性能评价
为了评估TDA18D芯片的时钟同步性能，首先通过与主机设备的时间戳比对验证TDA18D芯片的时间戳，然后依次进行以下性能评价：

1. 同步精度: 时钟同步精度是一个很重要的性能指标，如果时钟精度太差的话，可能就会导致数据包丢失或者时延增大。因此，我们可以在短时间内重复测试不同速率下的TDA18D芯片，然后取它们之间的最大误差值作为TDA18D芯片的同步精度。

2. 时钟漂移: 如果时钟漂移超过一定范围，那么TDA18D芯片就无法正常工作了。因此，我们可以通过发送不同频率的时钟信号，并与TDA18D芯片进行时钟同步，查看它们之间的时钟漂移情况。

### 4. 收发性能评价
为了评估TDA18D芯片的收发性能，首先选取两种标准测试方案：

第一种测试方案：同时向多个目标发送多个数据包。为了确保TDA18D芯片的收发性能，我们需要发送许多小的数据包，同时向不同的目标发送数据包。这样，如果TDA18D芯片能成功收发数据包，就可以说明它具有良好的收发性能。

第二种测试方案：执行数据连续接收测试。为了测试TDA18D芯片的连续接收性能，我们可以选择发送很多数据包，但在接收端仅接收第一个数据包，然后等接收完后再继续接收。这样，就可以验证TDA18D芯片是否能够以恒定的速率接收数据。

### 5. 时序性能评价
#### （1）误码率
误码率（BER）是描述单位时间内发生错误事件个数占全部传输位元个数的比例，通常用百分比表示。误码率越低，则说明传输的错误率越低。

TDA18D芯片的时序性能应该具有良好的整体抗干扰性能，其误码率应该接近零。但是，由于TDA18D芯片采用异步传输模式，所以其误码率可能会随着传输距离的增加而提升。因此，在测试TDA18D芯片时，建议设置多个距离，比较它们之间的误码率。

#### （2）时延
时延是指发送到接收端之后，数据包的首尾在时间上的延迟，包括数据包的传输时延和接收时延。时延越小，则说明传输数据的效率越高。

TDA18D芯片的时序性能应该具有低时延，而不能有明显的抖动。其标准化测试结果表明，TDA18D芯片在同时发送多个数据包时的平均时延在几乎没有抖动。

#### （3）抖动
抖动是指数据包的接收端接收到数据包的时间与它实际传输的时间之间的差异。抖动越小，则说明抖动的影响力越小。

抖动影响因素：

1. 时钟同步误差。TDA18D芯片采用CDRLock（Clock Distribution and Reception Lock）的方式进行时钟同步，其时钟同步误差可以达到数微秒级别。

2. 速率匹配误差。TDA18D芯片的波形输出线速率一般固定不变，速率匹配误差主要来源于TDA18D芯片自身。

3. 系统损耗。由于TDA18D芯片采用异步传输模式，传输过程中经历了很多过程，如数字滤波、循环控制、数据解调、信号放大等，因此抖动会带来一些不可忽略的损耗。

#### （4）纠错性能
纠错性能是指在接收到错误数据时，纠错模块能够正确识别错误类型、生成正确数据、提高性能。纠错性能越强，则说明纠错模块的性能越好。

由于TDA18D芯片采用了循环前缀编码，其编码规则并非完全错误检测编码，因此即使出现很大的误码也难以被检测出来。因此，TDA18D芯片的纠错性能较弱，但不会导致数据丢失。