
作者：禅与计算机程序设计艺术                    

# 1.背景介绍


## 1.1什么是文件操作？
在计算机系统中，数据除了存储于内存之外，还经常会保存在磁盘上，成为硬盘上文件的形式。作为人类对计算机进行信息交流、管理和使用的工具，文件操作就是操作系统提供给用户的接口，使得用户可以对计算机的文件进行创建、读取、修改和删除等操作。
## 1.2为什么要用文件操作？
我们每天都与文件打交道，打开、保存、打印、拷贝、移动、搜索……文件操作无处不在。很多时候，文件操作都涉及到一些复杂的算法和数据结构，所以需要掌握文件操作的基本技能。
## 1.3文件操作要点总结
文件操作分为三大类：创建、读取、写入、删除。本文将从这四个方面详细介绍Python中文件操作相关知识，包括文件的读写模式、上下文管理器、文件重定向和异常处理等知识。文件操作的五大要点如下所示：

1. 文件读写模式：了解各种文件读写模式，包括r（只读）、w（只写）、a（追加）、rb（二进制格式的只读）、wb（二进制格式的只写）。

2. 上下文管理器（context manager）：用上下文管理器可以自动化地完成文件读写操作。

3. 文件重定向：可以控制输出流和输入流的目标地址，也可以实现标准输出和标准输入之间的重定向。

4. 异常处理：在文件读写过程中出现异常时，如何及时捕获并处理异常。

5. 文件复制、移动、删除：这些操作都是基于文件名或路径的操作方式，不需要考虑底层的文件操作细节，操作起来非常方便。

# 2.核心概念与联系
## 2.1文件名、路径和扩展名
### 2.1.1文件名
文件名（filename）通常指的是文件独有的名称。一个文件的完整名称由两部分组成，即“路径”和“文件名”。路径（path）表示当前文件所在的文件夹位置；文件名（filename）表示当前文件的文件名。比如，"C:\Users\Admin\Desktop\MyFile.txt"的路径是"C:\Users\Admin\Desktop\"，文件名是"MyFile.txt"。
### 2.1.2路径
路径（path），也叫目录路径，是指用来指定某个文件或文件夹所在位置的一系列字符。它以反斜杠(\)或者正斜杠(/)开头，用来区别相对于当前操作系统的根目录的位置。Windows系统中的路径符号是反斜杠(\)，而Linux/Unix系统中的路径符号是正斜杠(/)。
### 2.1.3扩展名
## 2.2读写模式
读写模式（mode）又称为打开模式，是用来指定打开文件的方式。Python文件对象提供了三种基本的读写模式：

1. r模式（read mode）：打开已有文件用于读取内容，不能修改文件。如果试图打开不存在的文件，抛出FileNotFoundError异常。
2. w模式（write mode）：新建文件或打开已有文件，用于写入内容，可以修改文件的内容。如果试图打开已存在的非空文件，则覆盖该文件的内容，即新写入的内容会代替旧的内容。如果试图打开不存在的文件，则创建一个新的文件。
3. a模式（append mode）：打开已有文件用于追加内容，只能在文件末尾添加内容。如果试图打开不存在的文件，则创建一个新的文件。

其中，rb、wb、ab分别对应二进制模式。
## 2.3上下文管理器
上下文管理器（context manager）是一个定义了__enter__()和__exit__()方法的对象，它使得进入该上下文管理器的语句块时，执行__enter__()方法，离开该上下文管理器的语句块时，执行__exit__()方法。Python中的文件对象（file object）就是通过上下文管理器实现文件关闭功能的。
```python
with open('my_file.txt') as file:
    # perform operations with the opened file
   ...
```
当with语句块结束时，执行文件的close()方法，释放资源。
## 2.4文件重定向
文件重定向（redirect）又称流重定向，是指在运行命令时，让命令的输入输出重定向到某一文件或设备上。文件重定向的语法格式如下：

```python
command < input-file > output-file
```
在上述语法中，`<`表示将命令的输入重定向到input-file这个文件，`>`表示将命令的输出重定向到output-file这个文件。如果没有指定input-file，则表示从键盘获取输入；如果没有指定output-file，则表示显示输出结果。一般来说，命令默认使用标准输出作为输出结果，如果希望将输出结果保存到文件，可以使用文件重定向。例如，以下命令将输出结果保存到result.txt文件中：

```python
python script.py > result.txt
```
同时，还可以通过sys模块中的stdin、stdout和stderr属性来获取标准输入、标准输出和标准错误输出流，并通过它们的write()方法将字符串写入到这些流中。例如，以下代码将hello写入到标准输出：

```python
import sys

sys.stdout.write("Hello")
```

此外，还有一种更简便的方法来实现文件重定向，即在命令前加上">"或"|"符号，例如，以下命令将输出结果保存到result.txt文件中：

```python
echo "Output" > result.txt
```

这里，echo命令将"Output"这个字符串作为输入，重定向到了result.txt这个文件中。
## 2.5异常处理
异常处理（exception handling）是指在程序运行时，当检测到一个或多个严重错误时，能够正确处理，从而避免程序崩溃或发生意料之外的行为。在Python中，文件操作存在两种类型的异常：IOError和OSError。

IOError表示一般性I/O错误，例如尝试打开一个不存在的文件，无法连接网络等。OSError表示系统级的I/O错误，例如硬盘空间不足，权限不足等。

为了保证程序的健壮性，在文件读写中最好使用try...except...finally语句来处理异常。下面是一个例子：

```python
try:
    f = open('my_file', 'r')
    contents = f.read()
except IOError:
    print('Could not read from file.')
else:
    print('Read {} bytes.'.format(len(contents)))
    f.close()
finally:
    pass
```

try语句块里的代码可能会引发IOError异常，因此需要使用except子句捕获并处理该异常。否则，程序运行时会报错并终止。在except子句中，使用print函数输出一条消息，告诉用户发生了什么错误。else子句负责执行成功时的处理逻辑，即读取文件内容并打印大小。finally子句负责执行最终清理工作，例如关闭文件。

除此之外，还可以在with语句中使用try...except...as...语句来捕获文件操作过程中的异常：

```python
with open('my_file', 'r') as f:
    try:
        contents = f.read()
    except IOError:
        print('Could not read from file.')
```

在这个示例中，open函数返回一个文件对象f，并通过try...except...as...语句将其保护起来，捕获任何IOException产生的异常。如果异常发生，则可以安全地忽略该异常。