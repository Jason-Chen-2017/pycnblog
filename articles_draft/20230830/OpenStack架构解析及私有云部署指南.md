
作者：禅与计算机程序设计艺术                    

# 1.简介
  

随着云计算和分布式系统架构技术的不断发展，越来越多的企业开始将其应用到自身业务中来，利用公有云服务、私有云服务或者混合云架构实现资源的快速分配和管理。基于OpenStack开源云计算平台作为基础，能够帮助企业降低IT维护成本、提升运维效率、节省资金成本，进而实现云端资源的最大化利用。

2017年4月份由OpenStack基金会发布的OpenStack的基石版本——Icehouse，其目标是在公共云领域里架起一个可靠、稳定的平台支柱，为公共云计算、私有云计算、混合云计算提供了统一的云计算服务模型。随后，OpenStack社区在几个月内陆续发布了多个版本，如Queens版本、Rocky版本、Stein版本等，这些版本都在不断地优化、完善功能和架构，并逐步演变成当前最优秀的开源云计算平台。


然而，了解OpenStack的架构并不是只有看一眼架构图就能明白的，它涉及到众多细枝末节的概念和技术实现，需要对其整体框架有一个清晰的认识和理解，从而更好地实现OpenStack的日益壮大。因此，本文将从OpenStack架构的基础理论、项目组成、核心模块、版本变化以及关键技术点等方面进行全面的分析阐述。


本文适合以下读者：
- 有一定OpenStack架构知识的工程师、管理员、CTO等
- 想要深入理解OpenStack源码及各个组件之间关系的开发人员
- 对云计算、分布式系统架构有兴趣的技术爱好者
- 需要一份系统、完整的开源学习材料的程序员或学生


阅读本文不会影响您阅读其他技术类的文章。如果您想获得更多的OpenStack相关资讯或技术支持，欢迎访问OpenStack官方网站（https://www.openstack.org/）或加入OpenStack官方用户邮件列表（http://lists.openstack.org/cgi-bin/mailman/listinfo/openstack-discuss）。

# 2.OpenStack基本概念和术语
## 2.1 OpenStack基本概念
### 2.1.1 OpenStack简介
OpenStack是一个开源的云计算服务平台，它是按照通用云计算服务模式构建的基础软件，旨在提供一套完整的软件解决方案，允许用户通过Web界面或RESTful API使用各种云服务，包括计算（Nova），网络（Neutron），存储（Swift/Cinder），Orchestration（Heat），虚拟机镜像（Glance），Dashboard（Horizon），Identity（Keystone）等。通过OpenStack，用户可以快速配置、部署和管理公有云或私有云的基础设施，同时享受云计算的高可用性、高伸缩性、低时延性。

### 2.1.2 什么是云计算？
云计算是一种基于网络的计算服务，它利用网络技术为用户提供计算、存储、网络、数据库、应用及相关服务。云计算包括公有云和私有云两种类型，公有云由第三方提供服务器、存储和网络服务，用户只需付费购买所需的资源，但使用时需支付公网流量费用；私有云则是指将自己的硬件资源部署到数据中心，建立数据中心内的私有网络，通过VPN的方式接入公有云，即用户自己购买、部署和管理所有硬件资源和服务，享受公有云服务带来的弹性扩容、灵活价格等优点。

### 2.1.3 什么是OpenStack？
OpenStack是开源的云计算服务平台，目前由基金会OpenStack基金会孵化管理，其定位是一套完整的软件解决方案，允许用户通过Web界面或RESTful API使用各种云服务。通过OpenStack，用户可以快速配置、部署和管理公有云或私有云的基础设施，同时享受云计算的高可用性、高伸缩性、低时延性。

### 2.1.4 OpenStack架构
OpenStack架构由Core、Network、Compute、Storage、Identity四大模块组成，如下图所示。


Core模块主要负责计算、网络、存储、Orchestration和其他基础服务的集成，其中包括：
- Nova(Nova Compute): Nova提供了计算服务，包括VM的生命周期管理、资源调度、性能监控等；
- Neutron(Networking Service): Neutron提供网络服务，包括网络创建、删除、管理、配置、路由等；
- Glance(Image Management): Glance提供镜像服务，包括镜像上传、分发、存储、检索等；
- Heat(Orchestration): Heat提供了编排服务，包括模板化创建复杂的集群环境、自动化机器规模扩张、安全更新等；
- Ceilometer(Monitoring & Logging): Ceilometer提供监控和日志服务，包括性能指标采集、预警通知、故障诊断、容量规划等。


Network模块用于提供外部网络连接能力，包括：
- Neutron L3 Agent: 提供L3路由能力；
- Neutron DHCP Agent: 提供DHCP动态分配能力；
- Neutron Metadata Agent: 提供元数据服务；
- VPNaaS: 提供VPN服务。


Compute模块则包括：
- Swift Object Storage: 提供对象存储服务；
- Cinder Volumes: 提供块设备存储服务；
- Manila File Share: 提供文件共享服务。


Storage模块则包括：
- Ceph Distributed File System: 提供分布式文件系统服务；
- Object Gateway: 提供对象存储网关；
- Block Storage: 提供块设备存储服务；
- Shared File Systems: 提供文件共享服务；
- Image as a Service (IaaS): 提供云上IaaS服务。


Identity模块主要包括账号和权限控制服务，包括：
- Keystone Identity: 提供账号和权限控制服务；
- Horizon Dashboard: 提供Web界面；
- Fernet Token: 提供认证令牌。

## 2.2 OpenStack架构术语
### 2.2.1 服务与组件
OpenStack中的服务和组件是相互独立的。任何一个OpenStack组件都不能单独运行，它必须依托于OpenStack Core组件才能工作。因此，不同类型的服务就被划分为了多个OpenStack组件，如Nova计算、Neutron网络、Swift对象存储、Cinder卷管理等。每种服务都有其特定的角色和职责，例如Nova计算服务就是负责计算资源的分配和管理，它又可以被分解成一个Nova Compute组件、一个Nova Scheduler组件、一个Nova Conductor组件、一个Nova API组件和一个Nova Cert组件等。每种组件都有一个特定的作用，但是不能单独存在，它必须绑定到某个服务中才能工作。如下图所示：

### 2.2.2 版本号与发行周期
OpenStack的版本号由3部分组成，分别代表“主版本号”，“次版本号”和“修订版”。每次发布新版本，都有一定的发行周期，一般来说一个版本迭代周期为6个月左右。OpenStack目前主推的是Liberty版本，它的版本号是“2.2”，“Liberty”表示软件进入了初步开发阶段，此期间还不能保证完全符合生产环境。而对于后续的版本号，一般是在Liberty阶段结束后的6个月时间内给出的，比如Queens版本是“2.21”、Rocky版本是“2.22”、Stein版本是“2.23”。

### 2.2.3 服务类型
OpenStack的服务类型主要包括Identity、Compute、Network、Object Storage、Block Storage、Orchestration等。每种服务的名称都具有一定的含义，例如Nova计算服务就是负责计算资源的分配和管理，他还可以被分解成一个Nova Compute组件、一个Nova Scheduler组件、一个Nova Conductor组件、一个Nova API组件和一个Nova Cert组件。除此之外，还有一些服务是跟踪用户资源的服务，如CEPH的RadosGW服务就是这样的一种服务。因此，在理解OpenStack的架构的时候，不仅要了解每个服务所处的位置，还要了解它们的职责范围和特点。

### 2.2.4 RESTful API
RESTful API（Representational State Transfer）是一种设计风格，它以HTTP协议为基础，规范API接口的结构。该风格将互联网软件架构中网络状态的表示方式与底层系统资源的表现方式分离开来，从而达到互联网的无状态、可扩展的目标。RESTful API提供了一系列的标准方法，允许客户端使用HTTP协议的各种请求方式，通过不同的URL向服务端发送指令，并接收服务端返回的结果。正因如此，RESTful API使得OpenStack成为构建云计算服务的一种标准方法。

### 2.2.5 RPC(Remote Procedure Call)
远程过程调用（RPC）是分布式系统中进程间通信的一种机制。它允许客户程序在另一个地址空间（通常是共享网络的另一台机器上）执行的代码片段。RPC通过调用远程服务，让你能够像调用本地函数一样方便地调用远程服务。OpenStack内部的各个组件之间也采用了RPC机制来实现各自之间的通信。

### 2.2.6 数据模型
数据模型是用来描述各种资源或对象的逻辑结构和联系关系的一门学问。数据模型可以帮助我们更加清楚地了解现实世界的情况，它体现出了一切数据的逻辑、分类及关联。OpenStack的很多服务都会用到数据模型，比如Glance的图像数据模型就规定了如何定义一个图像，Neutron的网络拓扑结构模型就规定了网络中节点的位置关系。

### 2.2.7 存储
存储是把计算机的数据持久化保存的过程。数据持久化意味着数据在断电后仍然能够保持原有的特性，并且可以在任意时间、任意地点读取出来。OpenStack的存储机制主要分为三种：对象存储、块存储和文件共享。对象存储是指存储整个对象的机制，块存储是按固定大小划分和分配存储空间的存储器，文件共享是以文件的形式分享数据存储的一种技术。

### 2.2.8 扩展性
扩展性是指能够满足增长需求、应对不断变化的需求的能力。扩展性是指能够适应不断增加的计算、网络、存储等资源需求，根据需求调整系统结构和组件的数量和分布，以便服务质量得到最大化。OpenStack是通过组件化的架构设计来实现扩展性的。每个服务都可以拆分为多个小组件，这样就可以通过增加新的组件来提升服务的水平扩展性。

### 2.2.9 可靠性
可靠性是指服务的正常运行能力。服务的可靠性是指服务运行过程中出现的问题没有被恶意攻击、崩溃或其它异常情况导致服务不可用。可靠性不仅取决于硬件的可用性、网络的可靠性，而且还取决于服务的自动化程度、服务的冗余机制和服务的升级频率。OpenStack的可靠性体现在它的各个服务之间通过异步消息机制进行通信，通过组件的复制机制来保障服务的高可用性。

### 2.2.10 安全性
安全性是指保护云计算服务中的信息和数据免受恶意攻击、破坏、篡改和泄露的能力。OpenStack通过安全策略、认证机制、加密传输、访问控制等多种方式来保障云计算服务的安全性。

### 2.2.11 弹性
弹性是指能够应对变化的需求，并保持服务的性能的能力。由于资源的限制，服务的弹性是保障云计算服务能力的重要保证。OpenStack的弹性体现在如下几方面：服务的横向扩展，包括利用云的资源快速部署大型的服务集群，通过调度器完成服务的负载均衡；服务的纵向扩展，包括提升计算、网络、存储的性能，引入垂直的可伸缩性架构来减轻物理资源的压力；服务的故障转移，包括将失败的服务实例切换至备用的服务实例，从而实现服务的高可用性。

### 2.2.12 可用性
可用性是指系统或服务一直保持可用的能力。可用性是指云计算服务的正常运行时间比例，可用性越高，对用户的价值就越高。可用性体现在OpenStack的所有服务组件都是无状态的，也就是说它不需要依赖数据库和其他组件的状态保持可用，所以它具备较高的可用性。

### 2.2.13 一致性
一致性是指不同组件的状态或结果保持一致的程度。一致性是指在分布式系统中，当数据发生改变时，数据的值必须是相同的，否则就会导致不一致的状态。一致性体现在OpenStack中服务组件的状态是通过消息队列、数据库、缓存以及共享存储来实现的，所以它具有良好的一致性。

### 2.2.14 弹性
弹性是指能够适应不断变化的需求，并能在不中断服务的情况下完成任务的能力。弹性是指服务的容量可动态扩张或缩减的能力，它是使云计算服务具备优秀可用性、可伸缩性和可靠性的必要条件。