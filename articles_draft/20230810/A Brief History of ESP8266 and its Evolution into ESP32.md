
作者：禅与计算机程序设计艺术                    

# 1.简介
         

ESP8266是一种低功耗的 Wi-Fi SoC 模块,它可广泛应用于各种物联网(IoT)产品中。在十多年前,Espressif Systems推出了第一个基于以太网协议的 Wi-Fi SoC 模块ESP8266。此后,Espressif Systems陆续推出了一系列的Wi-Fi SoC模块,包括ESP32、ESP32-S2等系列,均为兼容以太网或802.11协议的Wi-Fi SoC。本文将从以下几个方面对 ESP8266 和 ESP32进行详细介绍:

1. 功能特性
2. 发展过程
3. 典型应用场景

# 2. 基本概念术语说明
## 2.1 概念
SoC是集成电路（System on a Chip）的缩写。就是把芯片中的多个部件集成到一个芯片上，并统一控制。它能够实现高度集成、高速运行、低功耗等特性。以SoC形式出现的微处理器，称为单片机（Single-Chip Microcomputer）。一般来说，SoC越复杂，性能就越强大，同时也越贵。如今，随着芯片规模的扩大，各种各样的SoC逐渐涌现出来，如ARM、NVIDIA、Microchip、AMD、Qualcomm等等。其中，以国产厂商为主的飞思卡尔半导体公司推出的嵌入式系统，有着巨大的市场份额。嵌入式系统通常都配备有诸如MCU、RAM、ROM等资源，可以方便地集成各种外围设备，为各种应用提供支持。而WiFi SoC则是嵌入式系统的一个重要组成部分。WiFi SoC由CPU（Central Processing Unit）、MAC（Media Access Control）、PHY（Physical Layer）三大层次构成。CPU负责处理数据传输、网络安全、内存管理等任务；MAC负责物理层面的链路通信，也就是与远端设备建立无线信道；PHY则负责负责信号编码、调制解调、射频分配等工作。总之，WiFi SoC提供了一种廉价、便捷的方式来开发各种物联网（IoT）应用，尤其是在联网效率和功耗方面具有显著优势。 

## 2.2 术语
- Wi-Fi: Wireless Fidelity。无线高精密。是 IEEE 802.11 标准定义的一套无线通信技术。目前主要有 802.11b/g/n 三种版本，具体频段范围及最大速率如下图所示：


- MAC: Medium Access Control。媒体访问控制。主要作用是完成信号的收发、路由选择等功能。MAC协议采用CSMA/CA方式工作，即先监听信道是否空闲，若信道空闲则自己占用信道资源，否则等待至信道空闲。

- PHY: Physical Layer。物理层。负责接收、检测、发送数字信号。传输过程中要经过调制、编码等过程，使原始信息转变为数字信号。

- CPU: Central Processing Unit。中心处理单元。可以简单理解为计算机中的运算能力。ESP8266/ESP32都是由不同的CPU来设计的。

- RAM: Random Access Memory。随机存储器。用来暂存需要处理的信息。

- ROM: Read Only Memory。只读存储器。不参与运算，可用于存储程序、固件、系统设置等信息。

- RTOS: Real Time Operating System。实时操作系统。是一个软实时系统，其基本思想是将许多任务交给操作系统去处理，这样就可以让整个系统的实时性更好。目前，最流行的RTOS有RT-Thread、FreeRTOS、TencentOS Tiny等。

- SDK: Software Development Kit。软件开发工具包。包含了硬件接口驱动、网络协议栈、应用程序框架、调试工具等一系列工具和组件。

- IDE: Integrated Development Environment。集成开发环境。一个集成了代码编辑器、编译器、调试器等工具的软件。在不同的IDE之间切换，可以轻松地切换不同的编程语言，进行不同级别的编程调试。

# 3. ESP8266 的基本特性
ESP8266是ESP8266系列芯片中较小型号的一种，主要特性如下表所示：

| 属性         | 值              | 描述                                                         |
| ------------ | --------------- | ------------------------------------------------------------ |
| 架构         | MCU + WiFi 模块 | 在 MCU 中集成了完整的 TCP/IP 协议栈和 Wi-Fi 模块               |
| 工作电压     | 3.0V ~ 3.6V    | 可在 3.0 V ~ 3.6 V 之间充电                                   |
| 处理器       | Xtensa lx106    | 为 32 位 Arm Cortex-M0+ 提供处理速度，最大 80MHz                |
| 片内Flash   | 512KB           | 可以用于固件下载、存储应用程序                             |
| 片内SRAM    | 96KB            | 主要用于存放临时变量和上下文                                 |
| 接口          | UART/SPI        | 支持两种接口：UART 和 SPI，适用于各种应用场景                 |
| Wi-Fi 标准   | 802.11 b/g/n   | 通用的 IEEE 802.11 协议                                       |
| Wi-Fi 连接数 | 1               | 每个 ESP8266 最多只能连接一个 AP                               |
| 待机模式电流 | 1μA             |                                                              |

根据上述特性，可以看出 ESP8266 属于物联网领域中较小规格、资源消耗极低的 SoC 芯片，但却拥有完善的 TCP/IP 协议栈和 Wi-Fi 功能。另外，由于该芯片只有一颗处理器和 Flash，因此可以实现很多功能，比如：网络协议栈、Wi-Fi 功能、本地存储等。

# 4. ESP8266 的发展过程
## 4.1 从第一代 ESP8266 到 ESP8266EX

### 4.1.1 ESP8266 1st Generation
ESP8266 是一款开源的 Wi-Fi SoC 芯片。它的主要特点是：低成本、适合简单物联网应用、非常容易上手。但是，它的 Wi-Fi 性能堪忧，最高速率仅有 80Mbps。因此，ESP8266 系列产生了很多衍生品。最早的 ESP8266 1st Generation，在 Wi-Fi 模块的架构上没有任何改进，仍然是仅有两个 Wi-Fi 模块。但是，它的晶体管数量已经超过 3.000 个，使得它的 Wi-Fi 性能有了明显提升。到了 2016 年，其晶体管数量已超 5.000 个。


ESP8266 1st Generation 对应的 SDK 版本是 SDK v1.3.0 RC2。

### 4.1.2 ESP8266 2nd Generation / D1

为了解决 Wi-Fi 性能限制的问题，ESP8266 团队基于 1st Generation 的设计，开发了 ESP8266 2nd Generation 和 ESP8266 D1 两款芯片。两者的主要区别在于：

- 数量上的区别。D1 增加了 Wi-Fi 模块的数量，从而使得每个芯片的 Wi-Fi 性能都提升到了 2.4 GHz 下的 100Mbps 左右，总计 1.54 dBm 的信号强度。2nd Generation 保持了原有的两个 Wi-Fi 模块。
- 设计上的区别。2nd Generation 更加精简，所有传感器接口均已保留，但灵活度较差，使得 2nd Generation 的可编程性较低。D1 则相反，更加灵活。它移除了 Wi-Fi 模块接口，使用 4-7 排针连接到外部电路板，更方便地扩展传感器和外设接口。


ESP8266 2nd Generation 对应的 SDK 版本是 SDK v1.5.4。

### 4.1.3 ESP8266 3rd Generation / NodeMCU

随着 2nd Generation 越来越受欢迎，ESP8266 团队又推出了第三代的 ESP8266 芯片，即 ESP8266 3rd Generation / NodeMCU。NodeMCU 的主要特征是增加了模块接口类型，并添加了第三个 Wi-Fi 模块，支持高达 802.11ac 的 600Mbps 速率。除此之外，还可以适配更多外围设备接口，比如 I2C、UART、CAN、ADC、DAC。


NodeMCU 对应的 SDK 版本是 SDK v2.0.0-rc1。

## 4.2 从 ESP8266 到 ESP32

随着时间的推移，Espressif Systems 终于决定推出自己的 Wi-Fi SoC 系列。在 2016 年，他们推出了基于 802.11 b/g/n 的 Wi-Fi SoC 芯片 ESP8266EX。该芯片采用两颗 32 位的 Xtensa LX106 处理器，支持最高 80MHz 的 CPU 时钟。它的 Flash 和 SRAM 分别为 4MB 和 80kB，可用作存储空间。据推测，该系列芯片可供生产的数量为 500万颗左右，足以满足当下的需求。

2017 年初，Espressif Systems 技术人员宣布了一个重大消息——他们将会把 ESP8266 的控制权完全移交给以太网协议和 Wi-Fi 协议为基础的 Nordic Semiconductor 智能终端处理器（NCP）。因此，新的 ESP32 Wi-Fi SoC 芯片正式问世。ESP32 独特的架构在很大程度上克服了 ESP8266 的局限性，例如过低的电压和资源占用，并且采用了 NCP 技术，支持全双工、低功耗、低延迟、超高速、高度安全的 Wi-Fi 通信。据官方数据显示，目前主流的 Wi-Fi 协议栈的一些模块，比如 Wi-Fi 网卡、TCP/IP 协议栈等，都已经可以在 ESP32 上跑起来。


ESP32 对应的 SDK 版本是 SDK v1.2.0。

# 5. 典型应用场景

- 物联网
- 无人机
- 智能照明
- 安防监控
- 智能机器人

# 6. ESP8266 未来发展方向

作为 Wi-Fi SoC 芯片中的一种，ESP8266 有很大的市场空间。相比起其他的 Wi-Fi SoC 芯片，它有着良好的拓展性和稳定性。但是，它也存在着一些问题。例如，由于 Flash 和 SRAM 容量的限制，它无法实现全部的功能。另外，由于 Wi-Fi 模块的原因，其信号噪声也比较严重。因此，未来的发展方向主要包含：

1. Wi-Fi 增强版。在 ESP8266 现有的 Wi-Fi 模块架构下，增加一个或者多个 Wi-Fi 模块，通过串口控制它们之间的信道分配机制，可以实现更高的性能。

2. 高性能版。如果 Wi-Fi 模块的性能不能满足当前应用的要求，可以考虑升级到较为昂贵的芯片，比如 ESP32。不过，这可能会带来新的问题，因为这些芯片需要处理那些之前没遇到的技术难题。

3. 芯片组。有些时候，应用的需求需要实现特殊功能。这时候，可以通过外接一个芯片组来实现，比如加入 LoRa 或 NB-IoT 模块。

# 7. 注意事项

- 本文不讨论 ESP8266 的安全性问题。
- 本文介绍的关于 ESP8266 和 ESP32 的信息仅供参考。还有很多细节没有提及，如传感器接口、外围设备接口等。