
作者：禅与计算机程序设计艺术                    

# 1.简介
  

建造者模式（Builder Pattern）是创建型设计模式之一，它可以将一个复杂对象的创建过程分解到多个步骤中，并允许用户自定义哪些步骤需要执行。建造者模式是一步一步创建一个复杂对象，最终返回一个组装完成的对象。建造者模式属于对象创建型模式。建造者模式提供了一种更优雅的方式来创建复杂的对象，它让客户端不必知道复杂对象的构造细节。建造者模式隐藏了创建对象的复杂逻辑，它将复杂对象的创建过程分解成多个步骤，使得创建对象的具体实现变得简单化。建造者模式主要解决两个问题：

1. 产品的构造过程通常非常复杂，但对象的创建却很容易产生大量重复的代码。如果我们将对象的创建过程封装起来，就可以简化对象的创建过程，提高代码的可复用性。

2. 在面向对象系统中，类的职责不仅包括数据的表示和处理，还包括创建和使用该数据的方式。通过引入建造者模式，我们能够将对象的创建和使用过程分离开来，从而简化对象的创建过程、提高系统的灵活性和扩展性。

建造者模式是23种经典的设计模式之一，它非常有用，特别是在创建复杂对象时。本文将详细介绍建造者模式及其相关概念，并使用一个具体实例，演示如何运用建造者模式构建出一个复杂对象。

# 2.模式概述
## 模式定义
建造者模式(Builder Pattern) 又称生成器模式，是对象创建型模式，它可以将一个复杂对象的创建过程分解到多个步骤中，并允许用户自定义哪些步骤需要执行。建造者模式创建了一个builder类用来构造复杂对象，用户只需要指定需要建造的部件即可，建造者负责按顺序一步步构建。建造者模式的优点是将一个复杂对象的创建过程与它的表现分离开来，在保证结构正确性的前提下，可以对创建过程进行优化。建造者模式适用于以下场景：

1. 创建复杂对象，要求构造过程具有稳定性；

2. 创建复杂对象，不同的表示形式，包括但不限于XML、Json等；

3. 当创建复杂对象的算法应该独立于该对象的组成部分以及它们的装配方式时。

## UML图

# 3.模式结构

建造者模式包含如下角色：

1. 抽象建造者（Builder）：创建者接口，声明各个部件的装配方法，并且一般情况下为抽象类。

2. 具体建造者（Concrete Builder）：实现Builder接口，定义并构造最终结果。

3. 导演（Director）：指挥者类，掌握产品的组装过程，指挥具体建造者去构建一个产品。

4. 产品（Product）：由各个部件组成的复杂对象，包含最终的产品。

建造者模式的结构比较简单，但是实际上有一些变体和拓展。比如我们可以通过模板方法模式来进一步提升建造者模式的灵活性，将建造流程分为多个阶段，每个阶段都可以自定义修改，这样就可以根据不同场景快速组装产品。

# 4.实例分析

假设我们要建造一个手机。这个手机包括屏幕、CPU、内存、电池、摄像头等多个部件。现在我们需要一个统一的接口来规定手机应该具备什么样的功能，以及这些功能应该如何配置。为了达到这个目的，我们可以设计如下接口。

```java
public interface Phone {
    public void setScreenSize(); // 设置屏幕大小

    public void setCpu(); // 设置CPU

    public void setMemory(); // 设置内存

    public void setBatteryCapacity(); // 设置电池容量

    public void setCameraType(); // 设置摄像头类型
    
    public Phone build(); // 生成手机
}
```

接着我们可以设计一个具体的建造者，来按照我们指定的部件顺序来创建手机。

```java
public class ConcretePhoneBuilder implements PhoneBuilder {
    private Phone phone = new Phone();

    @Override
    public void setScreenSize() {
        this.phone.setScreenSize("5.5寸");
    }

    @Override
    public void setCpu() {
        this.phone.setCpu("骁龙865");
    }

    @Override
    public void setMemory() {
        this.phone.setMemory("8GB+128GB");
    }

    @Override
    public void setBatteryCapacity() {
        this.phone.setBatteryCapacity("4000mAh");
    }

    @Override
    public void setCameraType() {
        this.phone.setCameraType("双摄像头");
    }

    @Override
    public Phone build() {
        return this.phone;
    }
}
```

最后，我们编写一个导演类，负责指导具体建造者按照部件顺序一步步构建手机。

```java
public class Director {
    private PhoneBuilder builder;

    public Director(PhoneBuilder builder) {
        this.builder = builder;
    }

    public Phone constructPhone() {
        builder.setScreenSize();
        builder.setCpu();
        builder.setMemory();
        builder.setBatteryCapacity();
        builder.setCameraType();

        return builder.build();
    }
}
```

然后，我们可以使用导演类来调用具体的建造者类来创建手机。

```java
public class Client {
    public static void main(String[] args) {
        Director director = new Director(new ConcretePhoneBuilder());
        Phone phone = director.constructPhone();
        
        System.out.println(phone);
    }
}
```

输出结果：

```
<Phone>
{
    "screenSize": "5.5寸",
    "cpu": "骁龙865",
    "memory": "8GB+128GB",
    "batteryCapacity": "4000mAh",
    "cameraType": "双摄像头"
}
</Phone>
```

# 5.模式总结

建造者模式是一个创建型模式，它可以将一个复杂对象的创建过程分解为多个步骤，并允许用户自定义过程中的某些步骤。建造者模式提供了一种更优雅的方式来创建复杂的对象，避免了直接创建对象而导致的问题，它将产品的创建过程与它的表现分离开来，通过提炼类中的装配方法来实现，使得客户端无需了解对象的创建过程。建造者模式也是23种经典的设计模式之一，它可以有效地分离了创建产品的过程和创建该产品的具体方式，同时也简化了对象创建过程。