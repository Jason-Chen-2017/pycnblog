
作者：禅与计算机程序设计艺术                    

# 1.简介
  


查看当前数据库的默认字符集和排序规则是对MySQL数据库管理非常重要的操作之一。这个操作能够帮助开发人员快速了解数据库内部编码方式，并且知道如何正确地配置数据库和应用程序才能满足业务需求。此外，如果采用不合适的编码或排序规则，则可能会导致数据出现乱码、丢失信息等问题，造成巨大的系统故障隐患。因此，了解数据库默认字符集和排序规则的相关信息对于正确使用和维护 MySQL数据库十分重要。本文将详细阐述查看当前数据库的默认字符集和排序规则的过程。

# 2.基本概念

## 2.1 MySQL 数据库概览

MySQL 是一种开放源代码的关系型数据库管理系统（RDBMS），在WEB应用方面有很广泛的应用。它的设计目标是快速、可靠、安全、易于使用。由于其体积小、速度快、总体拥有成本低、开源免费、跨平台移植性强等特点，它已经成为最流行的数据库管理系统。

MySQL 是基于 SQL 的关系型数据库，包括三个主要组件：服务器、数据库、客户端。服务器用于存储数据和提供访问接口；数据库是各种用户数据集合，是一个逻辑概念；客户端即用户访问数据库的方式，如命令行界面、图形化界面或者编程语言。

## 2.2 字符集和排序规则

字符集（Charset）：字符集是描述符词组，用于定义字符串中使用的字符集合及其排序顺序。

排序规则（Collation）：排序规则也称为校对规则，它是用来比较两个字符串之间差异的算法，主要用于确定一个字符串的大小顺序。

MySQL 中，每张表都有一个字符集属性和一个排序规则属性。字符集属性决定了数据的存储和处理方式，而排序规则属性决定了字符串的比较规则。

当我们创建新的数据库时，会指定一个默认的字符集和排序规则，一般情况下，数据库的字符集和排序规则都是相同的。在 MySQL 中，我们可以使用SHOW CHARACTER SET命令来查看系统支持的所有字符集，使用SHOW COLLATION命令来查看系统支持的所有排序规则。

如下面的示例所示：

```
mysql> SHOW CHARACTER SET;
+-------------+-----------+--------+---------------+---------+
| Charset     | Description   | Default collation   | Maxlen  |
+-------------+-----------+--------+---------------+---------+
| big5        | Big5 Traditional Chinese    | big5_chinese_ci      |      2  |
| dec8        | DEC West European            | dec8_swedish_ci       |      1  |
| cp850       | DOS Central Europe           | cp850_general_ci      |      1  |
......
| utf8mb4     | UTF-8 Unicode                | utf8mb4_general_ci    |      4  |
| binary      | Binary pseudo charset        | binary               |      1  |
+-------------+-----------+--------+---------------+---------+
29 rows in set (0.00 sec)

mysql> SHOW COLLATION;
+--------------------+---------+--------------------+---------------------+
| Collation          | Charset | Id                 | Sort len             |
+--------------------+---------+--------------------+---------------------+
| big5_chinese_ci    | big5    |      1             |                    1 |
| dec8_swedish_ci    | dec8    |      1             |                    1 |
| cp850_general_ci   | cp850   |      1             |                    1 |
| hp8_english_ci     | hp8     |      1             |                    1 |
| koi8r_general_ci   | koi8r   |      1             |                    1 |
| latin1_german1_ci  | latin1  |      1             |                    1 |
| latin1_swedish_ci  | latin1  |      1             |                    1 |
| macce_general_ci   | macce   |      1             |                    1 |
| macroman_general_ci| macroman|      1             |                    1 |
......
| utf8mb4_general_ci | utf8mb4 |      46            |                  107 |
+--------------------+---------+--------------------+---------------------+
320 rows in set (0.00 sec)
```

上面的输出显示，MySQL 支持很多字符集和排序规则，其中utf8mb4字符集可以存储emoji字符，utf8mb4_unicode_ci排序规则可以按照 Unicode 编码进行排序，并兼容 MySQL 以前版本的排序规则。

# 3.操作步骤

## 3.1 查看 MySQL 当前设置的字符集和排序规则

1.登录 MySQL 命令行终端，输入以下命令：

   ```
   mysql> show variables like 'character%';
   +------------------------------------------+------------+
   | Variable_name                            | Value      |
   +------------------------------------------+------------+
   | character_set_client                     | utf8mb4    |
   | character_set_connection                 | utf8mb4    |
   | character_set_database                   | utf8mb4    |
   | character_set_filesystem                 | binary     |
   | character_set_results                    | utf8mb4    |
   | character_set_server                     | utf8mb4    |
   | character_set_system                     | utf8       |
   | character_sets_dir                       | /usr/share/mysql/charsets/ |
   +------------------------------------------+------------+
   8 rows in set (0.00 sec)
   ```

   上面的输出结果告诉我们，当前客户端连接到 MySQL 时所用的字符集为 utf8mb4，数据库的默认字符集也是 utf8mb4。

2.如果需要查看特定数据库或表的字符集和排序规则，可以使用如下命令：

   ```
   mysql> SELECT DATABASE() as `Database`, DEFAULT_CHARACTER_SET_NAME AS `Default Character Set`,DEFAULT_COLLATION_NAME AS `Default Collation`; 
   +--------------------+----------------------+-----------------------+
   | Database           | Default Character Set | Default Collation     |
   +--------------------+----------------------+-----------------------+
   | information_schema | utf8                  | utf8_general_ci       |
   | testdb             | utf8mb4               | utf8mb4_general_ci    |
   +--------------------+----------------------+-----------------------+
   2 rows in set (0.00 sec)
   ```

   上面的命令会查询当前数据库的名称、默认字符集和默认排序规则。

## 3.2 修改 MySQL 默认字符集和排序规则

如果需要修改 MySQL 默认字符集和排序规则，可以通过以下两种方式实现：

1.全局修改：通过修改配置文件 my.cnf 来实现全局修改。my.cnf 文件通常位于各个操作系统的默认位置，可以根据实际情况进行修改。

   配置文件中的参数 character-set-server 和 collation-server 指定了 MySQL 服务端的默认字符集和排序规则。

   ```
   # 指定服务端默认字符集为 utf8mb4，排序规则为 utf8mb4_general_ci
   [mysqld]
   character-set-server=utf8mb4
   collation-server=utf8mb4_general_ci
   ```

   更改后重启 MySQL 服务使配置生效。

2.局部修改：通过执行 SET NAMES 命令来临时修改数据库连接的默认字符集和排序规则。

   ```
   SET NAMES 'charset' COLLATE 'collation';
   ```

   如果只修改字符集，可以在 CHARACTER SET 参数之后加上新字符集名。如果同时修改字符集和排序规则，可以在 COLLATE 参数之前加上新排序规则名。

   ```
   SET NAMES 'new_charset' COLLATE 'new_collation';
   ```