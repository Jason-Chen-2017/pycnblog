# 非参数统计方法：秩和检验和卡方检验

## 1. 背景介绍

### 1.1 什么是非参数统计方法?

非参数统计方法是一种不依赖于总体分布假设的统计推断方法。与基于正态分布等参数分布假设的参数统计方法不同,非参数统计方法对总体分布没有特定的假设要求,因此在分析数据时更加灵活和稳健。

### 1.2 非参数统计方法的应用场景

非参数统计方法通常应用于以下情况:

- 总体分布未知或不满足正态等参数分布假设
- 数据为等级、排序或秩次数据
- 数据包含异常值或离群值
- 样本量较小,参数估计不够精确

### 1.3 非参数统计方法的优缺点

优点:

- 不受总体分布假设的限制
- 对异常值不敏感,结果更加稳健
- 适用于等级和排序数据分析

缺点:  

- 效率相对参数方法低
- 对分布形状的假设较弱,信息利用不充分

## 2. 核心概念与联系

### 2.1 秩和检验

秩和检验是一种常用的非参数检验方法,用于比较两个或多个总体位置参数的差异。它基于将所有观测值按大小排序并赋予秩次,然后比较秩和的差异来判断总体位置参数是否相等。

常见的秩和检验包括:

- **Wilcoxon秩和检验**: 用于两个相关总体或两个独立总体的位置参数比较
- **Kruskal-Wallis秩和检验**: 用于多个独立总体的位置参数比较
- **Friedman秩和检验**: 用于多个相关总体的位置参数比较

### 2.2 卡方检验

卡方检验是另一种常用的非参数检验方法,用于检验理论分布与经验分布之间的拟合优度,或检验分类数据的独立性。

常见的卡方检验包括:

- **独立性卡方检验**: 检验两个分类变量是否相互独立
- **goodness-of-fit卡方检验**: 检验一个分类变量的分布与理论分布是否拟合良好
- **同质性卡方检验**: 检验多个总体的分布是否同质

### 2.3 秩和检验与卡方检验的联系

秩和检验和卡方检验都属于非参数统计方法,但有一些区别:

- 秩和检验主要用于比较总体位置参数,卡方检验主要用于分布拟合优度检验和独立性检验
- 秩和检验基于数据的秩次,卡方检验基于分类数据的频数
- 秩和检验的计算过程相对简单,卡方检验需要计算卡方统计量并查表获得p值
- 两者都不需要总体分布的假设,适用范围广泛

## 3. 核心算法原理和具体操作步骤

### 3.1 Wilcoxon秩和检验

#### 3.1.1 原理

Wilcoxon秩和检验用于检验两个总体位置参数是否相等的假设检验。其基本思想是:

1. 将两个总体的所有观测值按大小排序并赋予秩次
2. 分别计算两个总体的秩和
3. 若两个总体的位置参数相等,则秩和应该相近;否则,秩和会有显著差异

#### 3.1.2 具体步骤

1. 提出原假设和备择假设
2. 将所有观测值按大小排序并赋予秩次(若有相等值,取中位秩)
3. 分别计算两个总体的秩和W1和W2
4. 计算检验统计量:
   - 对于独立样本: $U = min(U_1, U_2)$, 其中 $U_1 = W_1 - \frac{n_1(n_1+1)}{2}$, $U_2 = W_2 - \frac{n_2(n_2+1)}{2}$
   - 对于相关样本: $W = min(W_+, W_-)$, 其中$W_+$为正秩和, $W_-$为负秩和
5. 根据U或W的分布查表或使用近似公式获得p值
6. 若p值小于显著性水平,拒绝原假设;否则,接受原假设

#### 3.1.3 例子

已知有两组独立样本数据:
A组: 23, 19, 28, 34, 42
B组: 18, 26, 27, 33, 38

检验A组和B组是否来自相同的总体位置分布。

解:
1. 原假设H0: A组和B组来自相同的总体位置分布
   备择假设H1: A组和B组来自不同的总体位置分布
2. 合并两组数据并排序: 18, 19, 23, 26, 27, 28, 33, 34, 38, 42
   赋予秩次: 1, 2, 3, 4.5, 6, 7, 8.5, 9, 10
3. A组秩和: $W_1 = 3 + 7 + 9 + 10 = 29$
   B组秩和: $W_2 = 1 + 2 + 4.5 + 6 + 8.5 = 22$  
4. $U_1 = 29 - \frac{5(5+1)}{2} = 14$
   $U_2 = 22 - \frac{5(5+1)}{2} = 7$
   $U = min(14, 7) = 7$
5. 对于n1=n2=5, U的临界值为4(α=0.05)
   因为7>4,所以不能拒绝原假设
6. 结论: 在5%的显著性水平下,没有足够证据表明A组和B组来自不同的总体位置分布

### 3.2 Kruskal-Wallis秩和检验  

#### 3.2.1 原理

Kruskal-Wallis秩和检验用于检验k(k>2)个独立总体的位置参数是否相等。其基本思想是:

1. 将所有观测值按大小排序并赋予秩次
2. 计算每个总体的秩和
3. 若所有总体的位置参数相等,则秩和应该相近;否则,秩和会有显著差异

#### 3.2.2 具体步骤  

1. 提出原假设和备择假设
2. 将所有观测值按大小排序并赋予秩次(若有相等值,取中位秩)
3. 计算每个总体的秩和Ri
4. 计算检验统计量: $H = \frac{12}{N(N+1)}\sum_{i=1}^k\frac{R_i^2}{n_i} - 3(N+1)$
   其中N为总样本量,ni为第i个总体的样本量
5. 根据H的分布(近似服从卡方分布,自由度为k-1)查表或计算获得p值  
6. 若p值小于显著性水平,拒绝原假设;否则,接受原假设

#### 3.2.3 例子

已知有3组独立样本数据:
A组: 72, 68, 70, 66, 63
B组: 75, 69, 71, 67  
C组: 73, 65, 64, 62

检验这3组数据是否来自相同的总体位置分布。

解:
1. 原假设H0: 三组数据来自相同的总体位置分布
   备择假设H1: 至少有一组数据来自不同的总体位置分布
2. 合并三组数据并排序: 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 75
   赋予秩次: 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13
3. A组秩和: $R_1 = 2 + 5 + 7 + 9 + 11 = 34$
   B组秩和: $R_2 = 6 + 8 + 10 + 13 = 37$ 
   C组秩和: $R_3 = 1 + 3 + 4 + 12 = 20$
4. $N = 5 + 4 + 4 = 13$
   $H = \frac{12}{13(13+1)}(\frac{34^2}{5}+\frac{37^2}{4}+\frac{20^2}{4}) - 3(13+1) = 6.31$
5. 自由度为3-1=2时,H的5%临界值为5.99
   因为6.31>5.99,所以拒绝原假设
6. 结论: 在5%的显著性水平下,有足够证据表明至少有一组数据来自不同的总体位置分布

### 3.3 卡方检验

#### 3.3.1 独立性卡方检验

##### 3.3.1.1 原理

独立性卡方检验用于检验两个分类变量是否相互独立。其基本思想是:

1. 构造理论分布(两变量相互独立时的联合分布)
2. 计算理论分布与观测分布之间的卡方统计量
3. 若两变量相互独立,则卡方统计量应该较小;否则,卡方统计量会较大

##### 3.3.1.2 具体步骤

1. 提出原假设和备择假设
2. 构造理论分布(两变量相互独立时的联合分布)
3. 计算卡方统计量: $\chi^2 = \sum_{i=1}^r\sum_{j=1}^c\frac{(O_{ij}-E_{ij})^2}{E_{ij}}$
   其中r为行数,c为列数,Oij为观测频数,Eij为理论频数
4. 根据卡方统计量的分布(近似服从自由度为(r-1)(c-1)的卡方分布)查表或计算获得p值
5. 若p值小于显著性水平,拒绝原假设;否则,接受原假设

##### 3.3.1.3 例子

一项调查研究了某公司员工的性别和部门之间的关系,结果如下:

|      | 技术部 | 市场部 | 财务部 |
|------|--------|--------|--------|
| 男性 |    42  |    32  |    18  |  
| 女性 |    33  |    27  |    16  |

在5%的显著性水平下,检验员工的性别和所在部门是否相互独立。

解:
1. 原假设H0: 员工的性别和所在部门相互独立
   备择假设H1: 员工的性别和所在部门不相互独立
2. 构造理论分布:
   总人数 = 42 + 32 + 18 + 33 + 27 + 16 = 168
   男性人数 = 42 + 32 + 18 = 92
   女性人数 = 33 + 27 + 16 = 76
   技术部人数 = 42 + 33 = 75
   市场部人数 = 32 + 27 = 59
   财务部人数 = 18 + 16 = 34
   理论频数:
   男性技术部 = 92*75/168 = 41.07
   男性市场部 = 92*59/168 = 32.38
   男性财务部 = 92*34/168 = 18.57
   女性技术部 = 76*75/168 = 33.93
   女性市场部 = 76*59/168 = 26.62
   女性财务部 = 76*34/168 = 15.43
3. 计算卡方统计量:
   $\chi^2 = \frac{(42-41.07)^2}{41.07}+\frac{(32-32.38)^2}{32.38}+...+\frac{(16-15.43)^2}{15.43} = 3.93$
4. 自由度为(3-1)(2-1)=2,5%临界值为5.99
   因为3.93<5.99,所以不能拒绝原假设
5. 结论: 在5%的显著性水平下,没有足够证据表明员工的性别和所在部门不相互独立

#### 3.3.2 Goodness-of-Fit卡方检验

##### 3.3.2.1 原理 

Goodness-of-Fit卡方检验用于检验一个分类变量的分布与理论分布(如均匀分布、正态分布等)是否拟合良好。其基本思想是:

1. 构造理论分布
2. 计算理论分布与观测分布之间的卡方统计量  
3. 若观测分布与理论分布拟合良好,则卡方统计量应该较小;否则,卡方统计量会较大

##### 3.3.2.2 具体步骤

1. 提出原假设和备择假设
2. 构造理论分布
3. 计算卡方统计量: $\chi^2 = \sum_{i=1}^k\frac{(O_i-E_i)^2}{E_i}$
   其中k为类别数{"msg_type":"generate_answer_finish"}