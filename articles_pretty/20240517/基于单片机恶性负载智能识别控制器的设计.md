# 基于单片机恶性负载智能识别控制器的设计

作者：禅与计算机程序设计艺术

## 1. 背景介绍

### 1.1 恶性负载的危害

在电力系统中,恶性负载是一种严重威胁电网安全稳定运行的负载类型。恶性负载通常表现为非线性、不平衡、谐波含量高等特点,会导致电能质量下降、设备过热损坏、甚至引发大面积停电事故。因此,及时准确地识别和控制恶性负载,对保障电力系统安全经济运行具有重要意义。

### 1.2 传统识别控制方法的局限性

传统的恶性负载识别控制主要采用硬件电路实现,如采用有源电力滤波器(APF)对谐波和无功进行补偿。但是,这种方法存在响应速度慢、可靠性差、造价高等缺点。此外,针对复杂多变的恶性负载特性,传统方法难以实现智能化、自适应的识别和控制。

### 1.3 单片机智能控制的优势

随着微电子和计算机技术的飞速发展,以单片机为核心的嵌入式系统凭借体积小、功耗低、性价比高等优点,在工业控制领域得到广泛应用。将单片机智能控制技术引入恶性负载识别控制,可以实现控制算法的软件化实现,提高系统的灵活性和适应性。通过采集电压电流信号,并运行智能算法,单片机可以快速、准确地识别恶性负载特征,并根据识别结果采取针对性的抑制措施,从而实现恶性负载的智能化控制。

## 2. 核心概念与关联

### 2.1 恶性负载的定义与分类

恶性负载是指对电网产生不利影响的负载,主要包括非线性负载、不平衡负载和冲击性负载三类。非线性负载会产生大量谐波,导致电压畸变;不平衡负载会引起三相不平衡,产生负序电流;冲击性负载会引起电压闪变和暂降。

### 2.2 负载特征量的选取

为实现恶性负载的有效识别,需要选取合适的负载特征量。常用的特征量包括:
- 电流总谐波畸变率(THD)
- 三相电流不平衡度
- 功率因数
- 负载突变率

通过对这些特征量进行提取和分析,可以全面刻画负载的恶性程度。

### 2.3 单片机硬件结构与接口电路

单片机智能识别控制器的硬件核心为单片机,通过模数转换电路(ADC)采集电压电流信号,再通过数字信号处理电路进行特征量计算。同时,控制器需要与其他硬件电路(如可控硅开关)连接,根据识别结果对恶性负载进行抑制控制。

## 3. 核心算法原理与实现步骤

### 3.1 基于傅里叶分析的谐波检测

对于非线性负载引起的谐波问题,可采用基于傅里叶分析的方法进行检测。该方法的基本步骤如下:

1. 采集一个周期的负载电流信号,记为$i(t)$
2. 对$i(t)$进行傅里叶变换,得到频谱$I(f)$:
$$I(f)=\int_{-\infty}^{\infty}i(t)e^{-j2\pi ft}dt$$
3. 找出$I(f)$中幅值最大的频率分量$f_0$(基波分量),计算各次谐波分量$I_n$与基波分量$I_1$的比值,得到各次谐波含量:
$$THD_n=\frac{I_n}{I_1}\times100\%$$
4. 计算总谐波畸变率:
$$THD=\frac{\sqrt{\sum_{n=2}^{\infty}I_n^2}}{I_1}\times100\%$$

若$THD$超过设定阈值,则判定存在谐波污染,控制器发出告警信号。

### 3.2 基于对称分量法的不平衡检测

对于三相不平衡负载,可采用对称分量法进行检测。设三相电流分别为$I_a$,$I_b$,$I_c$,其正序分量为:

$$\begin{aligned}
I_1 &=\frac{1}{3}(I_a+\alpha I_b+\alpha^2I_c)\\
\alpha&=-\frac{1}{2}+j\frac{\sqrt{3}}{2}
\end{aligned}$$

负序分量为:

$$\begin{aligned}
I_2 &=\frac{1}{3}(I_a+\alpha^2I_b+\alpha I_c)
\end{aligned}$$

则三相不平衡度可定义为:

$$\varepsilon=\frac{|I_2|}{|I_1|}\times100\%$$

若$\varepsilon$超过设定阈值,则判定存在不平衡,控制器发出告警信号。

### 3.3 基于卡尔曼滤波的负载突变检测

对于冲击性负载引起的电压闪变问题,可采用卡尔曼滤波算法进行检测。将电压有效值建模为状态变量$x$,观测值为$y$,则状态空间方程为:

$$\begin{aligned}
x(k)&=x(k-1)+w(k)\\
y(k)&=x(k)+v(k)
\end{aligned}$$

其中$w(k)$和$v(k)$分别为过程噪声和观测噪声,服从高斯分布。

卡尔曼滤波算法的递推过程为:

1. 预测:
$$\begin{aligned}
\hat{x}(k|k-1)&=\hat{x}(k-1|k-1)\\
P(k|k-1)&=P(k-1|k-1)+Q
\end{aligned}$$

2. 更新:
$$\begin{aligned}
K(k)&=\frac{P(k|k-1)}{P(k|k-1)+R}\\
\hat{x}(k|k)&=\hat{x}(k|k-1)+K(k)(y(k)-\hat{x}(k|k-1))\\
P(k|k)&=(1-K(k))P(k|k-1)
\end{aligned}$$

式中$Q$和$R$分别为过程噪声和观测噪声的协方差,$P$为估计误差协方差,$K$为卡尔曼增益。

通过卡尔曼滤波可以得到电压有效值的最优估计,若估计值的变化率超过设定阈值,则判定存在冲击负载,控制器发出告警信号。

## 4. 数学模型与公式推导

### 4.1 谐波分析的数学基础

傅里叶级数可将周期信号$x(t)$表示为不同频率正弦信号的叠加:

$$x(t)=\frac{a_0}{2}+\sum_{n=1}^{\infty}(a_n\cos n\omega t+b_n\sin n\omega t)$$

其中$a_0,a_n,b_n$为傅里叶系数:

$$\begin{aligned}
a_0 &=\frac{2}{T}\int_{0}^{T}x(t)dt\\
a_n &=\frac{2}{T}\int_{0}^{T}x(t)\cos n\omega tdt\\
b_n &=\frac{2}{T}\int_{0}^{T}x(t)\sin n\omega tdt
\end{aligned}$$

对于非周期信号,可用傅里叶变换将时域信号$x(t)$转换到频域$X(j\omega)$:

$$X(j\omega)=\int_{-\infty}^{\infty}x(t)e^{-j\omega t}dt$$

根据欧拉公式$e^{j\omega t}=\cos\omega t+j\sin\omega t$,傅里叶变换可将信号分解为不同频率的复指数信号。对$X(j\omega)$求模可得幅频特性。

### 4.2 对称分量法的三相电流模型

对称分量法将三相不平衡电流分解为正序、负序和零序三个对称分量。三相电流与对称分量的关系为:

$$\begin{bmatrix}
I_a\\I_b\\I_c
\end{bmatrix}=
\begin{bmatrix}
1&1&1\\
1&\alpha^2&\alpha\\
1&\alpha&\alpha^2
\end{bmatrix}
\begin{bmatrix}
I_0\\I_1\\I_2
\end{bmatrix}$$

其中$\alpha=e^{j120^\circ}$为旋转算子。由此可得对称分量与三相电流的关系:

$$\begin{bmatrix}
I_0\\I_1\\I_2
\end{bmatrix}=\frac{1}{3}
\begin{bmatrix}
1&1&1\\
1&\alpha&\alpha^2\\
1&\alpha^2&\alpha
\end{bmatrix}
\begin{bmatrix}
I_a\\I_b\\I_c
\end{bmatrix}$$

由对称分量可计算不平衡度,反映三相负载的不平衡程度。

### 4.3 卡尔曼滤波的贝叶斯估计解释

卡尔曼滤波可视为一种贝叶斯估计,即在已知观测数据的条件下,求后验概率最大的状态估计值。设$x(k)$为k时刻状态,$y(1:k)$为k时刻及之前的观测,则后验概率$p(x(k)|y(1:k))$正比于似然$p(y(k)|x(k))$和先验$p(x(k)|y(1:k-1))$的乘积:

$$p(x(k)|y(1:k))\propto p(y(k)|x(k))p(x(k)|y(1:k-1))$$

假设状态服从高斯分布,则先验概率:

$$p(x(k)|y(1:k-1))=N(x(k);\hat{x}(k|k-1),P(k|k-1))$$

似然概率:

$$p(y(k)|x(k))=N(y(k);x(k),R)$$

后验概率:

$$p(x(k)|y(1:k))=N(x(k);\hat{x}(k|k),P(k|k))$$

式中$\hat{x}$和$P$分别为状态估计值和估计误差协方差。

最大化后验概率,可得状态的最优估计,即卡尔曼滤波的结果。从贝叶斯角度看,卡尔曼滤波通过先验信息和新观测不断修正估计,使估计结果逼近真实状态。

## 5. 项目实践:基于STM32的智能识别控制器设计

### 5.1 硬件电路设计

智能识别控制器以STM32单片机为核心,外围电路包括电压电流采样电路、模数转换电路、数字信号处理电路等。其中电压电流采样电路采用LEM电流传感器和电压传感器,可线性隔离变换高压信号。模数转换电路采用逐次逼近型ADC芯片,如ADI公司的AD7606。另外,控制器还包括液晶显示、报警、通信等接口电路。

### 5.2 软件程序设计

智能识别控制器的软件流程可分为信号采集、特征提取、负载识别、控制输出四个部分。其中信号采集通过ADC中断实现,每一个采样周期触发一次中断,并利用DMA将采样值传输到内存。特征提取部分调用DSP库函数,实现FFT、对称分量、均方根等算法。负载识别部分则通过分析各个特征量,给出负载的恶性程度判断。控制输出部分根据识别结果,输出控制信号,如投切电容器组抑制谐波、调整负载配置平衡三相等。

以下是部分关键代码:

```c
// ADC中断服务函数
void ADC_IRQHandler(void) 
{
    if (ADC_GetITStatus(ADC1, ADC_IT_EOC) != RESET) {
        ADC_ClearITPendingBit(ADC1, ADC_IT_EOC);
        // 读取ADC转换结果
        ADC_ConvertedValue = ADC_GetConversionValue(ADC1);
        // 启动下一次转换
        ADC_SoftwareStartConvCmd(ADC1, ENABLE);
    }
}

// 特征量计算函数
void FeatureExtraction(void)
{
    // 计算电流THD
    arm_rfft_fast_f32(&S, I_ADC, I_FFT, 0);
    arm_cmplx_mag_f32(I_FFT, I_MAG, FFT_LENGTH/2);
    I_THD = sqrt(pow(I_MAG[2],2)+pow(I_MAG[3],2)+pow(I_MAG[4],2))/I_MAG[1];
    
    // 计算三相电流不平衡度
    I_pos = (I_A + ALPHA*I_B + ALPHA2*I_C)/3;
    I_neg = (