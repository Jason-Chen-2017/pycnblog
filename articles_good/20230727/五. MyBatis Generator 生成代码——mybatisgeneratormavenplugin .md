
作者：禅与计算机程序设计艺术                    

# 1.简介
         

         ## 一、为什么要用Mybatis Generator？

         在实际开发过程中，经常会遇到这样的问题，既有表结构变化，又需要重新生成代码文件，而手动编写这些代码可谓是耗时费力且容易出错。

         用好 Mybatis Generator（以下简称 MBG）就不再是难题。MBG 可以自动根据数据库表结构生成 MyBatis 的 XML 文件，并可以生成 Entity 对象。它还提供了强大的自定义模板功能，允许用户灵活地配置自己的 Mapper 和 Entity 文件。从此，我们无需关心繁琐的代码生成过程，只需专注于业务逻辑实现。通过简单的配置文件即可快速生成高质量的代码，大幅减少开发时间和避免错误。
         
         ## 二、MyBatis Generator 的优点
         1. 自动生成 Mapper 接口及 SQL 映射文件
         2. 自动生成 Entity 对象
         3. 支持多种数据库产品
         4. 基于模板的自定义生成规则
         5. 提供详细的日志输出，便于跟踪生成过程

         ## 三、MyBatis Generator 的安装与配置

         ### 安装
         #### Windows环境下安装

            1.下载最新版本的 mybatis-generator.jar
                从 Maven 中央仓库中下载：http://search.maven.org/#search%7Cgav%7C1%7Cg%3A%22org.mybatis.generator%22%20AND%20a%3A%22mybatis-generator-core%22
            2.将下载好的 jar 包复制到工程目录下的 lib 目录中
         
            其他方式：
            将依赖添加到pom.xml文件中：
            
            ``` xml
            <dependency>
              <groupId>org.mybatis.generator</groupId>
              <artifactId>mybatis-generator-core</artifactId>
              <version>${mybatis-generator.version}</version>
            </dependency>
            ```

            执行命令：mvn mybatis-generator:generate

         #### Linux/Mac 环境下安装

         通过以下两步完成安装：

         1.下载最新版 mybatis-generator-<version>-bin.zip。
         2.将该压缩包解压到指定位置并配置 $PATH 或类似路径变量指向 bin 目录，例如：

         ``` bash
         export MYBATIS_GENERATOR_HOME=/path/to/mybatis-generator
         PATH=$MYBATIS_GENERATOR_HOME:$PATH
         ```

         配置完成后，在任意目录执行 `mybatis-generaotr` 命令，如果能正常显示帮助信息则安装成功。

         ### 配置
         #### 配置 mybatis generator 插件
           在 pom.xml 文件中增加插件配置：

           ``` xml
           <build>
             <plugins>
               <!-- add the MyBatis Generator plugin -->
               <plugin>
                 <groupId>org.mybatis.generator</groupId>
                 <artifactId>mybatis-generator-maven-plugin</artifactId>
                 <configuration>
                   <verbose>true</verbose>
                   <overwrite>true</overwrite>
                   <configurationFile>
                     ${basedir}/src/main/resources/generatorConfig.xml
                   </configurationFile>
                 </configuration>
                 <dependencies>
                   <!-- add dependencies for running the plugin in maven lifecycle -->
                   <dependency>
                     <groupId>mysql</groupId>
                     <artifactId>mysql-connector-java</artifactId>
                     <version>5.1.44</version>
                   </dependency>
                 </dependencies>
               </plugin>
             </plugins>
           </build>
           ```


           configurationFile：指定 mybatis-generator 的配置文件。

            verbose：是否显示详细的日志信息。

            overwrite：是否覆盖已存在的文件。

         
         #### 创建 mybatis generator 配置文件

         以 mysql 为例，创建一个名为 generatorConfig.xml 的配置文件，其内容如下：

         ``` xml
         <?xml version="1.0" encoding="UTF-8"?>
         <!DOCTYPE generatorConfiguration
         PUBLIC "-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN"
         "http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd">
         <generatorConfiguration>
           <context id="MysqlTables" targetRuntime="MyBatis3">
             <jdbcConnection driverClass="com.mysql.jdbc.Driver"
                             connectionURL="jdbc:mysql://localhost:3306/test"
                             userId="root" password="" />
             <javaTypeResolver >
               <property name="forceBigDecimals" value="false"/>
             </javaTypeResolver>
             <table tableName="%" />
             <generatedKey column="id" sqlStatement="MySql" identity="true"/>
           </context>
         </generatorConfiguration>
         ```

         context 表示一个运行环境，targetRuntime 指定 MyBatis 的版本。

         jdbcConnection 表示连接数据库的信息，driverClass 是 JDBC 驱动类全限定名，connectionURL 是数据库连接 URL，userId 和 password 分别是用户名和密码。

         javaTypeResolver 设置了 BigDecimal 是否转成 String 的策略。默认情况下，MBG 会将 BigDecimal 类型映射到 BigDecimal Java 类；但是，当数据库列的精度超过 Java 浮点型的最大精度时，这种映射就会出现精度丢失或溢出的情况。所以，为了解决这个问题，可以通过 forceBigDecimals 属性设置为 false 来禁止 BigDecimal 类型的转换，转而采用 BigInteger 类型或 Long 类型。

         table 表示匹配的表名，这里使用 % 作为通配符，表示所有表都匹配。

         generatedKey 表示主键自增值生成方式，这里使用 MySql 的自动递增。

         此外，还有一些其他属性可用，这里就不一一介绍了。

         #### 添加模板文件

         如果需要进行更复杂的自定义修改，比如自定义 mapper 中的方法名或者 xml 文件中的命名空间等，则可以添加模板文件。

         先在 src/main/resources 下创建 templates 文件夹，然后按照所使用的模板引擎建立相应文件夹，如 Velocity 或 Freemarker。

         在 templates 文件夹下创建 model.ftl 或 model.vm (Velocity 模板) 文件，内容示例如下：

         ``` xml
         <#assign namespace = "dao">
            <#assign entityPackage = "${package}.entity">
            <#assign mapperPackage = "${package}.mapper">
            <#list tables as table>
               <#assign className = tool.tableNameToClassName(table.name)>
               <#-- entity template -->
               <${entityPackage}.${className}>
                  <#list table.columns as column>
                     <${column.name}></${column.name}>
                  </#list>
               </${entityPackage}.${className}>

               <#-- mapper interface template -->
               <#if!hasMapper>
                  <${namespace}.${className}Dao>
                    <selectByExample>
                       SELECT * FROM ${table.name} WHERE id = #{id}
                    </selectByExample>
                  </${namespace}.${className}Dao>

                  <${mapperPackage}.${className}Dao>
                      <resultMap type="${entityPackage}.${className}" id="${className}_resultMap"></resultMap>
                      <sql id="allColumns">
                        <![CDATA[
                          ${alias}.${column.name},
                        ]]></sql>

                        <select id="selectAll" resultMap="${className}_resultMap">
                            SELECT
                              <include refid="allColumns" />
                            FROM ${table.name} AS ${alias}
                        </select>

                        <insert id="insert">
                            INSERT INTO ${table.name} (${table.identity.columnName}) VALUES(${generatedKeys})
                        </insert>

                        <update id="updateById">
                            UPDATE ${table.name} SET
                                <#list table.columns?size-1..0 as index>
                                    ${table.columns[index].name}=${alias}.${table.columns[index].name},
                                </#list>
                            WHERE ID=#{id}
                        </update>
                  </${mapperPackage}.${className}Dao>
                  <#assign hasMapper = true/>
               </#if>
            </#list>
         </#assign>
         </#assign>
         ```

         上面的例子展示了一个最简单的模板，即创建实体对象和 DAO 方法。模板会根据表的字段动态生成代码，因此对于复杂的项目可能需要编写更多复杂的模板。

         #### 生成代码
         使用 mvn clean package 命令编译代码，会自动执行 mybatis generator 插件，根据配置文件生成相关的代码文件。

         生成的文件默认保存在 target/generated-sources/mybatis-generator/ 目录下，如果需要改动目标目录，可以在 configurationFile 文件中指定。

         ## 四、MyBatis Generator 的局限性

         Mybatis Generator 虽然有很多方便的地方，但也存在一些局限性。主要体现在：

         1. 对索引的支持不够完善：目前只能针对主键生成自动增长的方式，无法自动处理联合唯一键或其他索引。

         2. 没有对数据库视图的支持：生成的代码不包括视图的查询语句。

         3. 语法生成能力有限：无法直接生成一些特定的 SQL 语句，如分页。

         总之，Mybatis Generator 只能满足小型项目的简单需求，对于大型系统来说还是建议自己编写代码。