
ä½œè€…ï¼šç¦…ä¸è®¡ç®—æœºç¨‹åºè®¾è®¡è‰ºæœ¯                    

# 1.èƒŒæ™¯ä»‹ç»


## ä»€ä¹ˆæ˜¯å®¹å™¨ï¼Ÿä¸ºä»€ä¹ˆè¦ç”¨å®¹å™¨ï¼Ÿ
å®¹å™¨ï¼ˆContainerï¼‰æ˜¯ä¸€ç§è½»é‡çº§çš„è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œå…è®¸æˆ‘ä»¬å°†åº”ç”¨ç¨‹åºå’Œå…¶è¿è¡Œç¯å¢ƒæ‰“åŒ…æˆä¸€ä¸ªæ ‡å‡†åŒ–ã€å¯ç§»æ¤çš„å•å…ƒã€‚å®ƒä½¿å¾—åº”ç”¨å¯ä»¥è¢«éƒ¨ç½²åˆ°ä»»ä½•æ”¯æŒå®¹å™¨çš„å¹³å°ä¸Šï¼Œæ— è®ºæ˜¯ç‰©ç†æœºè¿˜æ˜¯äº‘ç«¯ã€ç§æœ‰äº‘æˆ–è€…æ··åˆäº‘ï¼Œæ— è®ºæ˜¯åœ¨ Linux ä¸Šè¿˜æ˜¯ Windows ä¸Šã€‚å› æ­¤å®¹å™¨ä¸ºåº”ç”¨æä¾›äº†ä¸€è‡´çš„å¼€å‘å’Œè¿è¡Œç¯å¢ƒï¼Œè§£å†³äº†åº”ç”¨ä¸åŒç¯å¢ƒé—´çš„å…¼å®¹æ€§é—®é¢˜ï¼Œæé«˜äº†åº”ç”¨çš„æ•æ·æ€§å’ŒèŠ‚çœäº†èµ„æºå¼€é”€ã€‚å®¹å™¨çš„å…¸å‹ç‰¹å¾åŒ…æ‹¬é•œåƒï¼ˆImageï¼‰ã€å®¹å™¨ï¼ˆContainerï¼‰å’Œå­˜å‚¨ï¼ˆStorageï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚


å› æ­¤ï¼Œå®¹å™¨æ˜¯ä¸€ä¸ªé€šç”¨çš„æŠ€æœ¯æ¦‚å¿µï¼ŒåŒ…æ‹¬ä¸‰ä¸ªä¸»è¦åŠŸèƒ½æ¨¡å—ï¼š
1. è™šæ‹ŸåŒ–ï¼šæä¾›å¯¹åº•å±‚ç¡¬ä»¶çš„éš”ç¦»å’Œè™šæ‹ŸåŒ–ï¼Œä½¿å¾—å¤šä¸ªåº”ç”¨å¯ä»¥åœ¨åŒä¸€å°æœºå™¨ä¸ŠåŒæ—¶è¿è¡Œã€‚
2. æ‰“åŒ…ï¼šæŠŠåº”ç”¨çš„ä»£ç ã€ä¾èµ–åº“ã€é…ç½®ç­‰æ–‡ä»¶æ‰“åŒ…åœ¨ä¸€èµ·æˆä¸ºä¸€ä¸ªæ ‡å‡†çš„é•œåƒï¼Œä¾¿äºåˆ†äº«å’Œéƒ¨ç½²ã€‚
3. è¿è¾“ï¼šé€šè¿‡äº‘æœåŠ¡å•†ã€ç½‘ç»œè®¾å¤‡æˆ–å…¶ä»–ä¼ è¾“æ‰‹æ®µï¼Œå°†é•œåƒä»æºç«™ï¼ˆå¦‚å¼€å‘äººå‘˜æœ¬åœ°ä¸»æœºï¼‰ä¼ è¾“è‡³ç›®æ ‡ç«™ï¼ˆå¦‚æœåŠ¡å™¨é›†ç¾¤ï¼‰ï¼Œæœ€ç»ˆéƒ¨ç½²åœ¨å®¿ä¸»æœºä¸Šè¿è¡Œã€‚

å®¹å™¨æŠ€æœ¯å·²ç»é€æ¸æˆä¸ºå®¹å™¨ç¼–æ’é¢†åŸŸçš„ä¸€ä¸ªçƒ­é—¨è¯é¢˜ã€‚åŸºäºå®¹å™¨æŠ€æœ¯ï¼Œç”¨æˆ·å¯ä»¥å¿«é€Ÿåœ°æ­å»ºåˆ†å¸ƒå¼åº”ç”¨ï¼Œå®ç°å¼¹æ€§ä¼¸ç¼©ã€èµ„æºå…±äº«åŠé«˜å¯ç”¨ã€‚å®¹å™¨ç¼–æ’ä¸€èˆ¬åˆ†ä¸ºå››ä¸ªä¸»è¦ç»„ä»¶ï¼šåŸºç¡€è®¾æ–½å³æœåŠ¡ï¼ˆIaaSï¼‰ã€å¹³å°å³æœåŠ¡ï¼ˆPaaSï¼‰ã€è½¯ä»¶å³æœåŠ¡ï¼ˆSaaSï¼‰å’Œé›†ç¾¤ç®¡ç†å™¨ï¼ˆCluster Managerï¼‰ã€‚å…¶ä¸­ï¼ŒKubernetes æ˜¯ç›®å‰æœ€æµè¡Œçš„å®¹å™¨ç¼–æ’å·¥å…·ä¹‹ä¸€ï¼Œè¢«å¤§è§„æ¨¡éƒ¨ç½²åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ã€‚

## ä¸ºä½•è¦åšå®¹å™¨ç¼–æ’ï¼Ÿ
å®¹å™¨ç¼–æ’ï¼ˆContainer Orchestrationï¼‰ä¸»è¦ç”¨äºç®¡ç†å¤æ‚çš„å®¹å™¨é›†ç¾¤ï¼Œç®€åŒ–åº”ç”¨ç¨‹åºéƒ¨ç½²ã€æ‰©ç¼©å®¹ã€ç›‘æ§å’Œæ•…éšœæ’é™¤ç­‰æµç¨‹ã€‚å®¹å™¨ç¼–æ’æœ‰ä»¥ä¸‹å‡ ç§ä½œç”¨ï¼š

1. æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ï¼šå®¹å™¨ç¼–æ’èƒ½å¤Ÿè‡ªåŠ¨è¯†åˆ«å’Œè°ƒåº¦å®¹å™¨é›†ç¾¤ä¸­çš„æœåŠ¡ï¼Œå¹¶å®ç°è´Ÿè½½å‡è¡¡ï¼Œä»è€Œä¿è¯æœåŠ¡çš„å¯ç”¨æ€§ã€‚
2. å¼¹æ€§ä¼¸ç¼©ï¼šå½“åº”ç”¨è®¿é—®é‡å¢é•¿æ—¶ï¼Œå®¹å™¨ç¼–æ’èƒ½å¤ŸåŠ¨æ€è°ƒæ•´åº”ç”¨çš„éƒ¨ç½²æ•°é‡ï¼Œä»è€Œä¿è¯èµ„æºåˆ©ç”¨ç‡çš„æœ€å¤§åŒ–ã€‚
3. æ»šåŠ¨å‘å¸ƒï¼šå®¹å™¨ç¼–ordingèƒ½å¤Ÿé€šè¿‡æ»šåŠ¨æ›´æ–°çš„æ–¹å¼éƒ¨ç½²æ–°ç‰ˆæœ¬åº”ç”¨ï¼Œä¿è¯æœåŠ¡çš„è¿ç»­æ€§ã€‚
4. æœåŠ¡æ—¥å¿—èšåˆï¼šå®¹å™¨ç¼–æ’èƒ½å¤Ÿé›†ä¸­æ”¶é›†å’Œå­˜å‚¨å®¹å™¨é›†ç¾¤ä¸­çš„æ—¥å¿—ä¿¡æ¯ï¼Œæå‡è¿ç»´æ•ˆç‡ã€‚
5. æœåŠ¡å¥åº·æ£€æŸ¥ï¼šå®¹å™¨ç¼–æ’èƒ½å¤Ÿå®šæœŸæ£€æµ‹å®¹å™¨é›†ç¾¤ä¸­çš„æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œï¼Œè¿›è¡Œä¸»åŠ¨æ¢å¤æˆ–è¿ç§»ï¼Œç¡®ä¿åº”ç”¨çš„é«˜å¯ç”¨ã€‚

æ€»ç»“æ¥è¯´ï¼Œå®¹å™¨ç¼–æ’æœ‰åŠ©äºç®€åŒ–åº”ç”¨éƒ¨ç½²å’Œè¿ç»´å·¥ä½œï¼Œæé«˜èµ„æºåˆ©ç”¨ç‡ã€é™ä½æˆæœ¬ã€æå‡æœåŠ¡è´¨é‡ï¼Œæ˜¯å®¹å™¨æŠ€æœ¯å‘å±•çš„å¿…ç„¶è¶‹åŠ¿ã€‚

# 2.æ ¸å¿ƒæ¦‚å¿µä¸è”ç³»
## åŸºæœ¬æœ¯è¯­
**Podï¼š** Pod æ˜¯ Kubernetes ä¸­æœ€å°çš„å¯éƒ¨ç½²å’Œç®¡ç†çš„å•ä½ã€‚åœ¨ Kubernetes ä¸­ï¼Œä¸€ä¸ª Pod å¯ä»¥åŒ…å«å¤šä¸ªå®¹å™¨ï¼Œè¿™äº›å®¹å™¨å…±äº«ç›¸åŒçš„ç½‘ç»œå‘½åç©ºé—´ã€IPC å‘½åç©ºé—´å’Œ UTS å‘½åç©ºé—´ã€‚

**ReplicaSetï¼š** ReplicaSet æ§åˆ¶å™¨ç”¨æ¥ä¿è¯é›†ç¾¤ä¸­æŒ‡å®šæ•°é‡çš„ Pod å‰¯æœ¬å§‹ç»ˆä¿æŒç¨³å®šçš„çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œå½“é›†ç¾¤ä¸­æŸèŠ‚ç‚¹æŒ‚æ‰åï¼ŒReplicaSet ä¼šå¸®åŠ©è‡ªåŠ¨æ‹‰èµ·æ–°çš„ Podã€‚

**Deploymentï¼š** Deployment å¯¹è±¡ç”¨æ¥ç®¡ç† ReplicaSet å’Œç›¸å…³è”çš„ Podã€‚å½“ Deployment ä¸­çš„ Pod æ¨¡æ¿å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒDeployment ä¼šåˆ›å»ºæ–°çš„ ReplicaSet æ¥æ›¿æ¢æ—§çš„ ReplicaSetï¼Œå¹¶ä¸”æŒ‰ç…§æœŸæœ›çŠ¶æ€ä¸€ç›´ç»´æŒå‰¯æœ¬æ•°é‡ã€‚

**Serviceï¼š** Service å¯¹è±¡ç”¨æ¥å®šä¹‰ä¸€ç»„ Pod çš„é€»è¾‘é›†åˆï¼Œæ¯ä¸ª Pod é€šè¿‡å”¯ä¸€çš„ IP åœ°å€æš´éœ²å‡ºä¸€ä¸ªå›ºå®šçš„ç«¯å£ï¼Œé€šå¸¸ç§°ä¹‹ä¸ºæœåŠ¡ (service)ã€‚å¯ä»¥é€šè¿‡ Service å¯¹è±¡æ¥å®ç°æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ã€‚

**Label Selectorï¼š** Label Selector æ˜¯ç”¨æ¥é€‰æ‹©éœ€è¦ç®¡ç†çš„å¯¹è±¡ï¼ˆæ¯”å¦‚ Podï¼‰çš„ä¸€ç»„æ ‡ç­¾ã€‚å®ƒå¯ä»¥æ ¹æ®ä¸€ç»„é”®å€¼å¯¹åŒ¹é…æŒ‡å®šçš„å¯¹è±¡ã€‚

## ä½¿ç”¨åœºæ™¯
**1.ç®€å•åœºæ™¯**ï¼šå•ä½“åº”ç”¨æˆ–å¾®æœåŠ¡ä¸éœ€è¦è€ƒè™‘è´Ÿè½½å‡è¡¡ã€å¼¹æ€§ä¼¸ç¼©ã€å¥åº·æ£€æŸ¥ç­‰ï¼Œåªéœ€è¦æŠŠåº”ç”¨éƒ¨ç½²åœ¨å•ä¸ª Pod ä¸­å³å¯ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œåªéœ€è¦åˆ›å»ºä¸€ä¸ª Deployment å¯¹è±¡å³å¯ï¼Œå¹¶è®¾ç½®å‰¯æœ¬æ•°é‡ä¸º 1ã€‚

```yaml
apiVersion: apps/v1beta1 # for versions before 1.9.0 use extensions/v1beta1
kind: Deployment
metadata:
  name: my-nginx-deployment
spec:
  replicas: 1
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:1.12
```

**2.å¤æ‚åœºæ™¯**ï¼šå¤šç§ç±»å‹çš„åº”ç”¨ï¼Œéœ€è¦è€ƒè™‘æ›´åŠ å¤æ‚çš„éœ€æ±‚ï¼Œæ¯”å¦‚è´Ÿè½½å‡è¡¡ã€å¼¹æ€§ä¼¸ç¼©ã€å¥åº·æ£€æŸ¥ç­‰ã€‚è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨å¤šä¸ª Deployment æ¥ç»„åˆæˆå¤æ‚çš„åº”ç”¨ç³»ç»Ÿã€‚æ¯”å¦‚ä¸€ä¸ªåŒ…å«å‰ç«¯ã€ä¸­é—´ä»¶å’Œæ•°æ®åº“çš„ Web åº”ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸¤ä¸ª Deployment æ¥å®ç°ï¼š

```yaml
---
apiVersion: v1
kind: Service
metadata:
  name: my-web-service
  namespace: default
  labels:
    app: web
spec:
  type: ClusterIP
  ports:
  - port: 80
    targetPort: 8080
  selector:
    app: web
---
apiVersion: apps/v1beta1 # for versions before 1.9.0 use extensions/v1beta1
kind: Deployment
metadata:
  name: frontend
  namespace: default
  labels:
    app: web
spec:
  replicas: 3
  strategy:
    rollingUpdate:
      maxSurge: 25%
      maxUnavailable: 25%
    type: RollingUpdate
  minReadySeconds: 5
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      app: web
      tier: frontend
  template:
    metadata:
      annotations:
        prometheus.io/scrape: "true"
        prometheus.io/path: /metrics
      labels:
        app: web
        tier: frontend
    spec:
      terminationGracePeriodSeconds: 30
      containers:
      - name: nginx
        image: nginx:1.12
        resources:
          limits:
            cpu: 100m
            memory: 256Mi
          requests:
            cpu: 100m
            memory: 256Mi
        readinessProbe:
          httpGet:
            path: /healthz
            port: 80
          initialDelaySeconds: 10
          timeoutSeconds: 5
        livenessProbe:
          httpGet:
            path: /healthz
            port: 80
          initialDelaySeconds: 30
          periodSeconds: 10
        ports:
        - containerPort: 80
          name: http
          protocol: TCP
        volumeMounts:
        - mountPath: "/etc/nginx/conf.d/"
          name: configmap-volume
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
      volumes:
      - name: configmap-volume
        configMap:
          name: frontend-config
---
apiVersion: apps/v1beta1 # for versions before 1.9.0 use extensions/v1beta1
kind: Deployment
metadata:
  name: middleware
  namespace: default
  labels:
    app: web
spec:
  replicas: 2
  strategy:
    rollingUpdate:
      maxSurge: 25%
      maxUnavailable: 25%
    type: RollingUpdate
  minReadySeconds: 5
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      app: web
      tier: middleware
  template:
    metadata:
      annotations:
        prometheus.io/scrape: "true"
        prometheus.io/path: /metrics
      labels:
        app: web
        tier: middleware
    spec:
      terminationGracePeriodSeconds: 30
      containers:
      - name: nodeapp
        image: node:8.9
        args: ["index.js"]
        envFrom:
        - secretRef:
            name: middlewaresecret
        ports:
        - containerPort: 3000
          name: serverport
          protocol: TCP
        readinessProbe:
          tcpSocket:
            port: 3000
          initialDelaySeconds: 10
          timeoutSeconds: 5
        livenessProbe:
          tcpSocket:
            port: 3000
          initialDelaySeconds: 30
          periodSeconds: 10
        resources:
          limits:
            cpu: 500m
            memory: 1Gi
          requests:
            cpu: 50m
            memory: 256Mi
      imagePullSecrets:
      - name: privateregistrykey
      securityContext:
        runAsNonRoot: true
        capabilities:
          drop:
            - ALL
```

# 3.æ ¸å¿ƒç®—æ³•åŸç†å’Œå…·ä½“æ“ä½œæ­¥éª¤ä»¥åŠæ•°å­¦æ¨¡å‹å…¬å¼è¯¦ç»†è®²è§£

**1.Pod:** 

Pod æ˜¯ Kubernete ä¸­çš„æœ€å°çš„å¯éƒ¨ç½²å’Œç®¡ç†çš„å•ä½ã€‚


åœ¨ Kubernetes é›†ç¾¤ä¸­ï¼Œä¸€ä¸ª Pod åŒ…å«å¤šä¸ªå®¹å™¨ï¼Œè¿™äº›å®¹å™¨å…±äº«ç›¸åŒçš„ç½‘ç»œå‘½åç©ºé—´ã€IPC å‘½åç©ºé—´å’Œ UTS å‘½åç©ºé—´ã€‚ Pod å°†å¤šä¸ªå®¹å™¨å°è£…åœ¨ä¸€èµ·ï¼Œæä¾›äº†ä¸€ä¸ªç®€æ´çš„æŠ½è±¡ï¼Œæ–¹ä¾¿ç®¡ç†å’Œä½¿ç”¨ã€‚

å¸¸è§çš„ Pod å‘½ä»¤ï¼š

- `kubectl get pods`ï¼šè·å–å½“å‰é›†ç¾¤ä¸­æ‰€æœ‰ podã€‚
- `kubectl describe pods <POD_NAME>`ï¼šæŸ¥çœ‹æŸä¸ªå…·ä½“çš„ pod çš„è¯¦æƒ…ã€‚
- `kubectl exec <POD_NAME> -- bash`ï¼šè¿›å…¥æŸä¸ªå…·ä½“çš„ pod ä¸­æ‰§è¡Œå‘½ä»¤ã€‚
- `kubectl delete pod <POD_NAME>`ï¼šåˆ é™¤æŸä¸ªå…·ä½“çš„ pod ã€‚

**2.ReplicaSetï¼š**

ReplicaSet æ˜¯ç”¨æ¥ä¿è¯é›†ç¾¤ä¸­æŒ‡å®šæ•°é‡çš„ Pod å‰¯æœ¬å§‹ç»ˆä¿æŒç¨³å®šçš„çŠ¶æ€ã€‚


ReplicaSet æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ API å¯¹è±¡ï¼Œç”¨äºç®¡ç† Pod å‰¯æœ¬ã€‚ å½“åˆ›å»º Deployment æ—¶ï¼ŒDeployment æ§åˆ¶å™¨å°±ä¼šç”Ÿæˆä¸€ä¸ªå¯¹åº”çš„ ReplicaSet æ¥ç®¡ç†è¿™ä¸ª Deployment ä¸‹é¢çš„ Pod å‰¯æœ¬ã€‚

ReplicaSet çš„ä½œç”¨ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç‚¹ï¼š

- **ç¡®ä¿åº”ç”¨éƒ¨ç½²ä¹‹åï¼Œæ€»å…±æ‹¥æœ‰æŒ‡å®šæ•°é‡çš„ Pod å‰¯æœ¬ã€‚** å¦‚æœå½“å‰ Pod å‰¯æœ¬æ•°é‡å°äºæŒ‡å®šæ•°é‡ï¼Œåˆ™ä¼šé€šè¿‡å¤åˆ¶æœºåˆ¶æ–°å¢ Podï¼›å¦‚æœå½“å‰ Pod å‰¯æœ¬æ•°é‡å¤§äºæŒ‡å®šæ•°é‡ï¼Œåˆ™ä¼šé€šè¿‡åƒåœ¾å›æ”¶æœºåˆ¶åˆ é™¤ Podã€‚
- **ç¡®ä¿åº”ç”¨éƒ¨ç½²è¿‡ç¨‹ä¸­ï¼ŒPod ä¸ä¸¢å¤±ä»»ä½•æ•°æ®**ã€‚ ReplicaSet ä¼šé€šè¿‡æ§åˆ¶ Pod çš„é‡å¯ç­–ç•¥ï¼Œç¡®ä¿åº”ç”¨éƒ¨ç½²è¿‡ç¨‹ä¸­ï¼ŒPod ä¸ä¸¢å¤±ä»»ä½•æ•°æ®ã€‚

å¸¸è§çš„ ReplicaSet å‘½ä»¤ï¼š

- `kubectl create replicaset <REPLICASET_NAME> --image=<IMAGE> --replicas=<NUM>`ï¼šåˆ›å»ºæŒ‡å®šæ•°é‡çš„å‰¯æœ¬é›†ã€‚
- `kubectl scale replicaset <REPLICASET_NAME> --replicas=<NUM>`ï¼šä¿®æ”¹å‰¯æœ¬é›†çš„å‰¯æœ¬æ•°é‡ã€‚
- `kubectl get rs`ï¼šè·å–å½“å‰é›†ç¾¤ä¸­æ‰€æœ‰ replica setã€‚
- `kubectl edit rs <REPLICASET_NAME>`ï¼šç¼–è¾‘å‰¯æœ¬é›†ã€‚

**3.Deploymentï¼š**

Deployment æ˜¯ç”¨æ¥ç®¡ç† ReplicaSet å’Œç›¸å…³è”çš„ Podã€‚


Deployment æä¾›å£°æ˜å¼çš„ API å¯¹è±¡ï¼Œç”¨æ¥æè¿°åº”ç”¨çš„æœ€æ–°å¯ç”¨çŠ¶æ€ã€‚ Deployment å¯ä»¥æ ¹æ®æ–°çš„ä¸šåŠ¡éœ€æ±‚æˆ–å‘å¸ƒè®¡åˆ’ï¼ŒåŠ¨æ€æ›´æ–° Pod å‰¯æœ¬æ•°é‡ã€Pod æ¨¡æ¿ç­‰ï¼Œç¡®ä¿åº”ç”¨å§‹ç»ˆå¤„äºé¢„æœŸçŠ¶æ€ã€‚

Deployment çš„ä½œç”¨ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š

- **å®ç°åº”ç”¨çš„æ»šåŠ¨å‡çº§**ã€‚ Deployment é€šè¿‡æ»šåŠ¨å‡çº§ç­–ç•¥ï¼Œé€æ­¥æ›´æ–°åº”ç”¨çš„ç‰ˆæœ¬ï¼Œé¿å…å› ç‰ˆæœ¬å‡çº§å¸¦æ¥çš„é£é™©ã€‚
- **è®°å½•æ¯æ¬¡å‘å¸ƒçš„å†å²è®°å½•**ã€‚ Deployment ä¼šè®°å½•æ¯æ¬¡å‘å¸ƒçš„å†å²è®°å½•ï¼Œæ–¹ä¾¿å›æ»šã€‚
- **æä¾›åº”ç”¨çš„æš‚åœä¸æ¢å¤æœºåˆ¶**ã€‚ Deployment æä¾›æš‚åœä¸æ¢å¤æœºåˆ¶ï¼Œå¯ä»¥ä¸´æ—¶åœæ­¢åº”ç”¨çš„æ›´æ–°ï¼Œé€‚åº”éƒ¨åˆ†çªå‘äº‹ä»¶ã€‚
- **æä¾›åº”ç”¨çš„ç‰ˆæœ¬å›é€€æœºåˆ¶**ã€‚ Deployment æä¾›ç‰ˆæœ¬å›é€€æœºåˆ¶ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å›æ»šåˆ°ä¹‹å‰çš„ç‰ˆæœ¬ã€‚

å¸¸è§çš„ Deployment å‘½ä»¤ï¼š

- `kubectl apply -f <DEPLOYMENT_YAML>`ï¼šåˆ›å»ºæˆ–æ›´æ–° Deploymentã€‚
- `kubectl rollout status deployment/<DEPLOYMENT_NAME>`ï¼šæŸ¥çœ‹ Deployment çŠ¶æ€ã€‚
- `kubectl get deploy`ï¼šè·å–å½“å‰é›†ç¾¤ä¸­æ‰€æœ‰ deploymentã€‚
- `kubectl delete deploy <DEPLOYMENT_NAME>`ï¼šåˆ é™¤ Deploymentã€‚

**4.Serviceï¼š**

Service æ˜¯ Kubernetes ä¸­æä¾›ç»™åº”ç”¨æˆ–å¤–éƒ¨å®¢æˆ·ç«¯ä½¿ç”¨çš„é€»è¾‘é›†åˆã€‚


Service æ ¹æ®æä¾›çš„æœåŠ¡ç±»å‹ã€é€‰æ‹©çš„ Pod åˆ†é…å¯¹åº”çš„è™šæ‹Ÿ IP åœ°å€ï¼Œå¹¶æš´éœ²ç»™å¤–ç•Œä½¿ç”¨ã€‚ Service å¯ä»¥é€šè¿‡ Service Discovery æ¥æŸ¥æ‰¾å¯¹åº”çš„ Podï¼Œç„¶åè´Ÿè½½å‡è¡¡åœ°å°†è¯·æ±‚è½¬å‘åˆ° Pod ä¸Šã€‚

Service çš„ä½œç”¨ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š

- **å±è”½åº•å±‚ Pod å®ä¾‹çš„å˜åŒ–**ã€‚ åœ¨åº”ç”¨å‘ç”Ÿå˜æ›´æ—¶ï¼ŒService ä¼šè‡ªåŠ¨å°†æµé‡é‡æ–°åˆ†é…åˆ° Pod ä¸Šé¢ï¼Œé¿å…å›  Pod å®ä¾‹çš„å¢å‡è€Œå½±å“åº”ç”¨çš„å¯ç”¨æ€§ã€‚
- **å®ç°å®¢æˆ·ç«¯çš„è´Ÿè½½å‡è¡¡**ã€‚ Service æä¾›å®¢æˆ·ç«¯ä¹‹é—´çš„è´Ÿè½½å‡è¡¡ï¼Œæé«˜åº”ç”¨çš„å¯ç”¨æ€§å’Œå“åº”èƒ½åŠ›ã€‚
- **å®ç° Service Discovery**ã€‚ Kubernetes é›†ç¾¤å†…éƒ¨çš„å„ç±»ç»„ä»¶ä¹‹é—´éœ€è¦é€šä¿¡ï¼ŒService å¯ä»¥é€šè¿‡ DNS æˆ– API Server æ¥æŸ¥è¯¢å¯¹åº”çš„ Endpoint å¯¹è±¡ï¼Œæ‰¾åˆ°å¯¹åº”çš„ Podï¼Œç„¶åé€šè¿‡è´Ÿè½½å‡è¡¡æ¥å®ç°æœåŠ¡è°ƒç”¨ã€‚
- **æä¾›åŸŸåæœåŠ¡**ã€‚ Kubernetes æ”¯æŒåŸŸåæœåŠ¡ï¼Œé€šè¿‡ Domain Name System (DNS) æŠŠåŸŸåè§£æä¸º Service çš„ Cluster IPï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡åŸŸåè®¿é—® Service äº†ã€‚

å¸¸è§çš„ Service å‘½ä»¤ï¼š

- `kubectl expose rc/<RC_NAME> --type=NodePort`ï¼šå°† ReplicationController åˆ›å»ºçš„ Pod æš´éœ²ä¸º NodePort ç±»å‹çš„ Serviceã€‚
- `kubectl get svc`ï¼šè·å–å½“å‰é›†ç¾¤ä¸­æ‰€æœ‰ serviceã€‚
- `kubectl delete svc <SERVICE_NAME>`ï¼šåˆ é™¤ Serviceã€‚

**5.Label Selectorï¼š**

Label Selector æ˜¯ Kubernetes ä¸­ç”¨æ¥é€‰æ‹©éœ€è¦ç®¡ç†çš„å¯¹è±¡çš„ä¸€ç»„æ ‡ç­¾ã€‚


Label Selector å¯ä»¥æ ¹æ®ä¸€ç»„é”®å€¼å¯¹åŒ¹é…æŒ‡å®šçš„å¯¹è±¡ã€‚

å¸¸è§çš„ Label Selector å‘½ä»¤ï¼š

- `kubectl label pods <POD_NAME> <KEY>=<VALUE>`ï¼šæ·»åŠ æ ‡ç­¾åˆ° Pod ä¸Šã€‚
- `kubectl get pods --selector=<SELECTOR>`ï¼šæ ¹æ® Label Selector æŸ¥æ‰¾ Podã€‚
- `kubectl label nodes <NODE_NAME> <KEY>-<VALUE>-`ï¼šç§»é™¤èŠ‚ç‚¹ä¸Šçš„æ ‡ç­¾ã€‚

# 4.å…·ä½“ä»£ç å®ä¾‹å’Œè¯¦ç»†è§£é‡Šè¯´æ˜

## å®‰è£… Minikube

å®‰è£… Docker Desktop for Mac/Windows/WSLã€‚


å¯åŠ¨ Minikubeï¼š

```bash
$ minikube start --memory 4096
ğŸ˜„  minikube v1.12.1 on Darwin 10.15.7
âœ¨  Using the virtualbox driver based on user configuration
ğŸ”¥  Creating virtualbox VM (CPUs=2, Memory=4096MB, Disk=20000MB)...
ğŸ³  Preparing Kubernetes v1.20.2 on Docker 20.10.2...
    â–ª Generating certificates and keys...
    â–ª Booting up control plane...
    â–ª Configuring RBAC rules...
ğŸ”  Verifying Kubernetes components...
    â–ª Using image gcr.io/k8s-minikube/storage-provisioner:v4
ğŸŒŸ  Enabled addons: storage-provisioner, default-storageclass
ğŸ„  Done! kubectl is now configured to use "minikube" cluster and "default" namespace by default
```

å®‰è£… kubectl æ’ä»¶ï¼š

```bash
$ brew install kubectl-aliases
==> Installing dependencies for kubectl-aliases: kubernetes-cli
==> Downloading https://homebrew.bintray.com/bottles/kubernetes-cli-1.20.2.big_sur.bottle.tar.gz
######################################################################## 100.0%
==> Pouring kubernetes-cli-1.20.2.big_sur.bottle.tar.gz
==> Caveats
Bash completion has been installed to:
  /usr/local/etc/bash_completion.d
==> Summary
ğŸº  /usr/local/Cellar/kubernetes-cli/1.20.2: 8 files, 11.2MB
==> Installing kubectl-aliases from kubectlapis/tap
==> Downloading https://github.com/kubectlapis/homebrew-tap/raw/master/Formula/kubectl-aliases.rb
==> Installing dependencies for kubectlapis/tap/kubectl-aliases: kubernetes-cli
==> Downloading https://homebrew.bintray.com/bottles/kubernetes-cli-1.20.2.big_sur.bottle.tar.gz
Already downloaded: /Users/liuxiaobo/Library/Caches/Homebrew/downloads/0d7de5c727349bcf76f26aa24ce5ed0eb45fb162dc918ee46bfbbcc8e033cb9b--kubernetes-cli-1.20.2.big_sur.bottle.tar.gz
==> Pouring kubernetes-cli-1.20.2.big_sur.bottle.tar.gz
ğŸº  /usr/local/Cellar/kubernetes-cli/1.20.2: 8 files, 11.2MB
==> Installing kubectl-aliases from kubectlapis/tap
==> Script started on 2021-05-06 15:20:11.946
Installing Homebrew formulas...
Cloning into '/usr/local/Homebrew/Library/Taps/kubectlapis/homebrew-tap'...
remote: Enumerating objects: 3, done.
remote: Counting objects: 100% (3/3), done.
remote: Total 3 (delta 0), reused 0 (delta 0), pack-reused 0
Receiving objects: 100% (3/3), 238 bytes | 238.00 KiB/s, done.
Resolving deltas: 100% (0/0), done.
Tapped 1 formula (39 files, 340KB).
kubectl plugin 'aliases' already installed. Skipping installation. To reinstall it, run 'brew reinstall kubectl-aliases'.
kubectl plugin "aliases" successfully installed & linked. Enjoy ğŸ˜‰!
```

## åˆ›å»ºç¤ºä¾‹ Deployment

ç¼–å†™ example-deployment.yaml æ–‡ä»¶ï¼š

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: example-deploy
  labels:
    app: example-label
spec:
  replicas: 2
  selector:
    matchLabels:
      app: example-label
  template:
    metadata:
      labels:
        app: example-label
    spec:
      containers:
      - name: example-container
        image: busybox
        command: ['sh', '-c', 'echo "hello world" && sleep infinity']
        imagePullPolicy: IfNotPresent
```

åˆ›å»º Deploymentï¼š

```bash
$ kubectl apply -f example-deployment.yaml 
deployment.apps/example-deploy created
```

## è·å– Pod ä¿¡æ¯

è·å–æ‰€æœ‰çš„ Pod åç§°ï¼š

```bash
$ kubectl get pods 
NAME                                 READY   STATUS    RESTARTS   AGE
example-deploy-5ddfd7d7fc-chwgx     1/1     Running   0          10m
example-deploy-5ddfd7d7fc-lhfwt     1/1     Running   0          10m
```

è·å–æŒ‡å®š Pod åç§°çš„ä¿¡æ¯ï¼š

```bash
$ kubectl get pod example-deploy-5ddfd7d7fc-chwgx 
Name:         example-deploy-5ddfd7d7fc-chwgx
Namespace:    default
Priority:     0
Node:         minikube/192.168.99.112
Start Time:   Thu, 06 May 2021 10:56:59 +0800
Labels:       app=example-label
              pod-template-hash=5ddfd7d7fc
Annotations:  <none>
Status:       Running
IP:           172.17.0.4
IPs:
  IP:  172.17.0.4
Controlled By:  ReplicaSet/example-deploy-5ddfd7d7fc
Containers:
  example-container:
    Container ID:   docker://625d308be156a6d5569cf7f95b561dc10c0a6aaea194e4a1f8a160431e01d2b9
    Image:          busybox
    Image ID:       docker-pullable://busybox@sha256:9f10e6bc3973ab18c0db09d47c689b99d4dec6e11a3c7d3bd4153aa9539ec1cd
    Port:           <none>
    Host Port:      <none>
    Command:
      sh
      -c
      echo "hello world" && sleep infinity
    State:          Running
      Started:      Fri, 07 May 2021 10:57:16 +0800
    Last State:     Terminated
      Reason:       Error
      Exit Code:    137
      Started At:    Thu, 06 May 2021 11:07:59 +0800
      Finished At:   Fri, 07 May 2021 10:57:16 +0800
    Ready:          True
    Restart Count:  0
    Environment:    <none>
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-8zrc4 (ro)
Conditions:
  Type              Status
  Initialized       True 
  Ready             True 
  ContainersReady   True 
  PodScheduled      True 
Volumes:
  kube-api-access-8zrc4:
    Type:                    Projected (a volume that contains injected data from multiple sources)
    TokenExpirationSeconds:  3607
    ConfigMapName:           kube-root-ca.crt
    ConfigMapOptional:       <nil>
    DownwardAPI:             true
QoS Class:                   BestEffort
Node-Selectors:              <none>
Tolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
                             node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
Events:                      <none>
```

## åˆ›å»º Service

ç¼–å†™ example-svc.yaml æ–‡ä»¶ï¼š

```yaml
apiVersion: v1
kind: Service
metadata:
  name: example-svc
spec:
  type: LoadBalancer
  ports:
  - port: 80
    targetPort: 8080
  selector:
    app: example-label
```

åˆ›å»º Serviceï¼š

```bash
$ kubectl apply -f example-svc.yaml 
service/example-svc created
```

## æµ‹è¯• Service

æµ‹è¯•é€šè¿‡åŸŸåè®¿é—®æœåŠ¡ï¼š

```bash
$ curl http://example-svc.default.svc.cluster.local
Hello World
```

æµ‹è¯•é€šè¿‡ NodePort è®¿é—®æœåŠ¡ï¼š

```bash
$ kubectl get services
NAME         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE
example-svc  NodePort    10.100.20.92   <none>        80:30665/TCP   4h5m

# æµè§ˆå™¨æ‰“å¼€ http://localhost:30665
Hello World
```