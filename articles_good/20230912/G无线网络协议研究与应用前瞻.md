
作者：禅与计算机程序设计艺术                    

# 1.简介
  

## 一、引言
近年来，随着移动互联网、物联网、云计算的蓬勃发展，5G无线网络的普及率正在逐渐提升。尽管5G无线网络在一定程度上解决了传统电信网络传输效率低下、维护成本高昂等问题，但同时也带来了新的安全威胁、部署复杂、运营成本高等问题。因此，对5G无线网络协议研究具有重要意义。而5G无线网络协议研究涉及到两个方面——网络层和传输层，其中网络层主要研究网络通信的设计、制定、开发、测试、部署等相关规范，而传输层则涉及到用户数据如何在不同网络层协议之间进行封装、传输、解封装等工作。本文将着重研究5G无线网络的网络层协议，即控制单元（CU）和调度单元（DU），以及数据单元（RU）。在此过程中，作者首先会从5G的相关背景知识出发，然后以WLAN的标准分层模型为视角，介绍5G控制单元（CU）和调度单元（DU）的功能、性能指标以及系统架构。之后，详细阐述各模块的通信过程、接口功能及其处理流程。并基于5G的相关技术，如S-MAC、FlexRAN、RRC层、DCI/PDCCH间接层等，分析5G网络架构中各个模块之间的协作机制，以及最重要的网络可靠性保障措施（NRS）。最后，还会探讨5G在边缘计算、车联网、M2M领域的应用前景。
## 二、5G概述
### 1.5G定义
根据欧洲核子中心5G计划管理局(ETSI)发布的白皮书，5G是一种新型的多用途无线网（WLAN）技术，它能够实现全球范围内的高速、高吞吐量的信息传输。其组成部分包括如下几项：

⑴基站（Base Station，BS）：一种小型的移动通信设备，它承担着在无线频段上接收、处理和传输无线电信号的职责，可以安装各种各样的终端设备，如手机、平板电脑、穿戴式终端等；

⑵核心网（Core Network，CN）：由计算机网络、卫星通信网络、运营商网络等各种无线网络构成，提供用户设备间的数据交换服务；

⑶短距离无线通信系统（Wireless Broadband System，WBS）：它是指能够支持高度灵活的电信业务模式的特色技术；

⑷频分复用技术（Frequency-Division Multiplexing，FDM）：一种通信技术，通过分配不同的载波频率，实现资源共享，使得多个终端设备可以同时使用同一个频段；

⑸超高速率编码技术（Ultra-High Speed Codes，UHSC）：一种能够在超高速率下提供可观的码流质量的编码方案，适用于视频、音频、传输、金融等通信需求；

⑹微波信道（Microwave Channel，MC）：一种采用短距微波技术的无线通讯信道，它能够提供高灵敏度的信号；

⑺智能网关（Smart Gateway）：一种由信息技术、机器学习和系统工程三者组成的新型通信网关产品，能够处理存储、识别、安全和控制等核心通信服务；

⑻数字孪生（Digital Twins）：一种技术，利用机器学习方法，模拟真实世界中的现实实体；

⑼虚拟现实（Virtual Reality）：一种新兴技术，它借助计算机图形渲染技术，让用户沉浸于虚拟环境中。

### 2.5G体系结构
5G体系结构是一种五级结构，按照部署的覆盖范围由低到高依次为基站级、核心级、专用级、分布式级和云计算级。按照最大宽带（Mbps）的大小排序，5G体系结构可以分为A、B、C、D和E类。

⑴A类 5G是一个完整的无线通信系统，包括基站、核心网、微波、超高频、小区广播站、演示射频合成器（SSF），以及应用和社会网关。

⑵B类 5G是在A类基础上进一步扩大用户数量和增强连接性，包括基站升级为现代化版本，核心网采用分布式网络，小区广播站数量增加，支持更丰富的应用。

⑶C类 5G作为一种完整的通信系统，尤其是核心网，带来了更多的数据处理能力和应用的创新。包括服务质量保证（QoS）、自动化配置、云计算和边缘计算。

⑷D类 5G可以扩展高速化、增强应用性、降低成本，并且增加经济实惠，但同时也增加了复杂性、安全性风险和管理难度。包括企业、政府、教育、医疗等行业的5G部署。

⑸E类 5G可能成为未来的第六类通信技术，它将通过更好地利用通信技术、提升新能源、让生活更便捷的方式，促进科技和经济的增长。

目前，5G仅有极少数国家或地区达到了A或B级水平，另外一些国家或地区已经达到了C、D或E级水平。在中国，目前只有少部分国家和地区达到了A或B级水直。

### 3.5G硬件和软件层次划分
如上图所示，5G主要分为MAC、PHY、RLC、PDCP、MAC 和 PHY 层，它们分别代表物理层，定义 MAC 信道的信道参数和功能，PHY 层负责接收、调制、载波分配等，RLC 是 MAC 的一个环节，负责流控、编码、解调等；PDCP 把 RLC 的输出封装成 IP 数据报，进行差错检测、错误纠正、重传控制等。另外还有若干其他层次如 HSPA+、eMBB、mMTC 等，这些都是基于目前的技术，需要逐步演进和发展。

### 4.5G的系统架构和性能指标
5G的系统架构如上图所示。

5G中共有七个关键子系统，分别为 MAC、PHY、RLC、PDCP、X2AP、NGAP、ULCL 。

#### （一）MAC子系统
MAC子系统负责提供频谱资源、定义分配规则、分配比例，并按照指定的调度策略把用户请求通过各子系统中发送给相应的子系统去执行。如上图所示，MAC子系统在 CU 和 DU 中都可以存在。

#### （二）PHY子系统
PHY子系统是 MAC、RLC、PDCP、X2AP 四层之上的一层。PHY子系统的作用就是实现 MAC 的各种功能，如基带传输、调制、接入、可编程化和频谱资源分配等。

#### （三）RLC子系统
RLC子系统的作用是实现 RLC 层的功能，包括建立可靠传输信道、生成和接收数据帧、错误检测、重传机制等。在5G中，RLC子系统也称为LC子系统。

#### （四）PDCP子系统
PDCP子系统的作用是实现在 RLC 子系统上运行的 PDCP 层的功能，即 IP 数据报的封装、解封装、编解码、重传控制、拥塞控制等功能。

#### （五）X2AP子系统
X2AP子系统的作用是实现 X2AP 层的功能，包括管理 X2 链接的建立、维护、删除、拓扑变化通知等功能。

#### （六）NGAP子系统
NGAP子系统的作用是实现 NGAP 层的功能，包括 NR 单元的资源管理、SR 单元的配置、上下行链路的建立和断开、RadioBearer建立、配额管理等功能。

#### （七）ULCL子系统
ULCL子系统的作用是实现用户终端的集成化计算。ULCL子系统既包含本地计算，又包含远程计算。

##### 下面介绍每个子系统的功能以及性能指标。

##### (一) MAC子系统
MAC子系统负责在基站、BS上提供了频谱资源、分配规则、分配比例，并按照指定的调度策略把用户请求通过各子系统中发送给相应的子系统去执行。如下表所示：

| 功能                      | 描述                                                         |
| ------------------------ | ------------------------------------------------------------ |
| 分布式频谱资源分配        | 在5G里，可供用户使用的频谱资源被分配给多个频段，分别属于不同的子通道。不同的子通道又被细分为不同的块，比如每块可分配10MHz。这样一来，就可以利用整个频谱资源。在使用某一块频谱时，就可以不必为其他频段等待，而直接进入该频段进行操作。 |
| 时隙资源分配              | 每个子通道都由子通道标识符（CSI）和子通道参数描述符（CPDI）来表示。CSI是子通道标识符，用来标识分配给用户的某一子通道。CPDI是子通道参数描述符，用来描述分配给用户的子通道的相关参数。5G使用FDD模式进行资源分配，所以子通道只能分配在相同的频段。每个子通道最多能同时分配20个子通道块。 |
| 服务质量                  | MAC子系统的目标是降低用户延迟，同时保证服务质量。为此，MAC子系统采用动态资源分配、时隙资源预测、多个先进的服务质量保障方案。MAC子系统具备如下性能指标：最高可用性：5G要求提供全天候、高可用性的系统。为了实现这一目标，MAC子系统在多个子系统中均采用容错设计，以应对节点故障、网络失灵、服务攻击等。其次，MAC子系统具有低时延、高可靠性的特性。为了实现这一目标，MAC子系统在子系统内部采用多个先进的技术，如流控、差错控制、重传机制、部分重传机制、数据聚合、时隙编号分配、滑动窗口机制等。第三，MAC子系统可以通过增大带宽来提升性能。 |
| 防止恶意用户               | 当攻击者采用对抗性攻击手段时，MAC子系统可以在检测到攻击行为时，及时关闭对应子通道，阻止恶意用户使用对应子通道。另外，MAC子系统还可以检测和隔离特定用户，避免他们对系统造成破坏。 |
| 用户身份鉴权             | MAC子系统可以完成用户身份验证，防止非法用户使用资源。另外，它还可以实现用户访问控制，以限制不同用户的资源使用。 |
| 流量整形                 | MAC子系统可以使用智能算法，对用户的访问流量进行自动调整，以减少网络拥堵。它还可以结合多种策略，如随机方式、固定方式、平滑加权方式等，把用户的访问流量平摊到多个子通道。 |
| 定时切换                  | MAC子系统可以设置定时切换的时间，方便用户调度资源，满足用户需求。例如，每天早晨7点，MAC子系统可以切换当前活跃子通道，把功耗降到最低，减少能耗。 |
| 异构性                    | MAC子系统可以针对异构终端用户提供支持。5G通过发射DSSS、OFDM、MIMO等技术，可以发射不同类型的载波，以满足不同类型的终端用户。 |
| 消息确认机制              | MAC子系统采用基于内存的消息确认机制。当5G收到用户发送的消息后，就会将该消息保存在消息队列中，并为这个消息生成一个唯一的标识符，返回给用户。如果用户没有正确接收到回复消息，那么MAC子系统就会根据确认标识符重发消息。 |
| 小区间漫游                | MAC子系统可以实现不同小区间之间的通信，形成小区间漫游网络。在这种网络中，用户可以发送消息到任意距离的地方。 |
| 安全性能                  | MAC子系统采用多个安全技术，以确保系统的安全性。具体包括主动安全机制、反射攻击和侧信道攻击预防机制等。 |
| 可观察性                  | MAC子系统可以使用数据采集、数据分析、数据报告等手段来收集和分析系统的性能指标，并做出决策，进行优化。 |

##### (二) PHY子系统
PHY子系统负责实现 MAC 的各种功能，如基带传输、调制、接入、可编程化和频谱资源分配等。如下表所示：

| 功能                             | 描述                                                         |
| -------------------------------- | ------------------------------------------------------------ |
| 频率偏移                          | 在5G里，不同子通道可分配到相邻的两个干扰元素，使干扰的影响较小。这就产生了一个频率偏移，使基站的双边通信也能正常工作。频率偏移的大小与干扰元素的大小成反比，并随着距离的增加而减小。 |
| 大气层辐射                        | 5G中的基站工作在室外，所以要考虑大气层的辐射影响。根据1.5G-5G的技术路线图，需要增加植入物、整流器、光学平台、模拟放大器等组件。 |
| 多天线                            | 5G需要把用户请求发送到多个频段，由于同一时间可以接收的信号功率有限，所以需要使用多个天线来接收信号。在5G里，使用多个小天线来共同覆盖一个大频段，以提高信号的接收能力。 |
| 小区边界网格                      | 5G的基站覆盖区域可以是小区或小区间。每一个小区边界网格都会有一个相应的媒体访问控制子网（MAC Subnet），用于处理小区内的用户请求。 |
| OFDM 调制                         | 在5G里，采用 OFDM 调制，它可以有效抑制高频噪声，并保持信号的连续性。OFDM 调制的波形类似于频谱图案，因此可以用基带传输的方式进行发送和接收。 |
| SDF                              | SDF（Spectral Flatness Descrimination，频谱平稳判决）是指用波形来标记频谱的函数，可以帮助用户确定自己的位置。SDF通常由特殊的滤波器来实现，滤波器输出的是电平，用户可以接收到不同的频率信号，用不同的电平来标记自己的位置。 |
| 内置放大器                        | 在5G里，不需要外置放大器，因为基站上的大多数元器件都内置了放大器，可以直接使用。 |
| 数据压缩                          | 5G采用数据压缩的方式来进行网络传输，在不改变速率的情况下，减少了网络成本。数据的压缩率取决于用户数据的复杂程度，一般可以达到90%以上。 |
| MIMO 模型                         | 在5G里，采用 MIMO 模型，可以同时接收多个用户的请求，提高系统的吞吐量。 |
| 空间可配置                        | 5G可以允许用户根据需要，改变基站的布局，可以实现空间可配置。 |
| 适应性增强                        | 5G使用先进的协议栈，同时采用不同的算法，可以改善用户体验和系统的适应性。 |
| 频段协调                          | 5G的频率范围比较大，在同一频段上可以接入不同类型的节点，适应不同类型的应用。但是，由于节点类型不一样，可能会产生干扰，因此需要协调频段，使所有节点处于同一状态。 |
| UL/DL 带宽协商                     | 在5G里，基站可以协商用户的上行带宽和下行带宽，以选择合适的比例。 |
| 个性化设计                        | 5G的基站设计需要根据用户的需要，使用特定技术，如不规则能量分散，辅助行走和开关机等，来改善用户体验。 |
| 无线电定位                        | 5G中的基站可以获得准确的位置信息。基站可以通过收集用户的位置信息，利用机器学习的方法，预测用户的路径。 |
| 使用用户数据计划                   | 5G使用用户数据计划来管理用户数据流。用户数据计划由两部分组成，即令牌环路（Token Ring Circuit）和存储循环网络（Storage Loop Network）。令牌环路负责控制数据流的流动。存储循环网络负责存储数据。在5G里，令牌环路和存储循环网络都被集成到了基站。 |
| 故障诊断和容错设计                 | 如果基站出现故障，5G的MAC子系统可以快速检测到故障发生，并对用户请求做出响应。5G的MAC子系统还设计了容错机制，包括数据传输超时、消息丢弃等，来应对节点故障、网络失灵、服务攻击等问题。 |
| 专用交换机                        | 在5G里，基站需要连接至专用交换机，以处理用户的流量。专用交换机是一种高性能的交换机，可以满足通信流量的多样性。 |
| 支持高度灵活的应用                | 5G支持高度灵活的应用，如高清视频、云游戏、VR、AR、金融等。5G还支持大规模机器学习和深度神经网络等应用。 |
| 多服务干扰                        | 5G使用独立的信道来处理服务干扰，可以有效抑制服务干扰的影响。 |
| 丢包和抖动处理                    | 5G在接收用户数据的时候，采用丢包和抖动处理，以减少用户数据的丢失和抖动。 |
| 专用时隙                         | 在5G里，用户的数据流可以被分配到独占的子通道。每一个子通道都是一个时隙，这就保证了用户间的干扰不会相互影响。 |
| 提供临时覆盖                       | 5G的基站还可以提供临时覆盖，以满足用户的临时需求。临时覆盖可以满足用户需求的时间较短，甚至几秒钟。 |
| 网络时钟同步                      | 5G通过在物理层同步时钟，可以保证系统时钟一致，避免时钟漂移导致的问题。 |
| 拓扑优化                         | 5G的基站设计和部署可以满足用户拓扑变化的需求，如城市变迁、停电、雷击、网络分割等。 |
| 无线电噪声抑制                   | 5G采用先进的无线电技术，来抑制无线电噪声，提高系统的鲁棒性。 |
| 安全性                           | 5G的基站可以提供安全性，采用加密算法和数字签名，保护用户数据和网络数据。 |
| 成本和费用估算                     | 5G的基站成本和费用需要根据基站的功能、功耗、覆盖范围、功能、配置等因素来估算。5G还可以提供有关的工具，帮助用户进行估算和投资。 |

##### (三) RLC子系统
RLC子系统的作用是实现 RLC 层的功能，包括建立可靠传输信道、生成和接收数据帧、错误检测、重传机制等。RLC子系统还需要实现流控功能，并提升传输效率。RLC子系统的性能指标如下：

| 性能指标         | 描述                                                         |
| -------------- | ------------------------------------------------------------ |
| 资源利用率       | 由于频率资源受限，需要适当减少资源占用。RLC子系统可以实现资源利用率的优化。对于视频、音频等场景，需要支持丢包重传等机制。 |
| 端到端延迟         | RLC子系统需要支持实时性，以满足用户的需求。对于视频、音频等高速应用，要求最小延迟。RLC子系统需要支持端到端的时延抖动，以保证可靠性。 |
| 时隙长度          | 由于5G使用FDD模式进行资源分配，所以所有的子通道都在相同的频段。每个子通道最多能同时分配20个子通道块，所以时隙长度要足够短。 |
| 缓存长度          | 由于资源利用率的原因，需要对缓存进行优化。RLC子系统可以根据用户的应用情况，调整缓存的大小。 |
| 暂停控制         | RLC子系统需要支持暂停机制，以便更好的管理资源。当用户切换到另一个频道时，需要停止传输，等待资源的释放。 |
| 自适应速率控制    | 由于用户的需求不断变化，RLC子系统需要提供自适应速率控制，以满足用户的需要。 |
| PLC调度算法      | RLC子系统需要使用先进的调度算法，以支持不同的优先级。 |
| 数据聚合         | 由于资源利用率的原因，需要对数据进行聚合。数据聚合可以提高传输效率，提高性能。 |
| 差错控制         | 由于用户数据可能会发生错误，需要采用差错控制来纠正错误。 |
| 多重传输         | 由于多个用户的数据流可能同时发送，RLC子系统需要支持多重传输，提高系统的可靠性。 |
| QoS保证         | RLC子系统应该支持服务质量保证，以保证数据传输的成功率。 |
| 控制面模式切换   | RLC子系统应该支持动态性和弹性，以满足用户的需要。 |
| 混叠传输         | 为了避免频繁的资源分配和调度，RLC子系统可以采用混叠传输。 |
| 适应性调度算法    | RLC子系统可以使用先进的调度算法，来适应用户的变动。 |
| 重传计数         | 根据速率控制机制，RLC子系统需要重传数据。重传计数的大小依赖于速率控制算法，可以控制重传次数。 |
| 流量调配         | RLC子系统需要提供流量调配，以适应用户的动态需求。 |
| 无线电调谐       | RLC子系统需要使用先进的调谐技术，来提升性能。 |
| 流量管理         | 为了避免系统拥塞，RLC子系统需要实时地监测和管理流量，并按照调度策略分配资源。 |
| 流量控制         | 由于多用户同时发送，RLC子系统需要提供流量控制，以避免网络拥塞。 |
| 数据报文传输     | RLC子系统需要支持数据报文传输，以提升系统的效率。 |
| 计费方式         | 5G需要支持有关的计费方式，如时长、数据量、套餐、数据使用量等。 |

##### (四) PDCP子系统
PDCP子系统的作用是实现在 RLC 子系统上运行的 PDCP 层的功能，即 IP 数据报的封装、解封装、编解码、重传控制、拥塞控制等功能。PDCP子系统的性能指标如下：

| 性能指标         | 描述                                                         |
| -------------- | ------------------------------------------------------------ |
| 无线信道利用率   | 由于频率资源受限，需要适当减少资源占用。PDCP子系统可以实现无线信道的优化。PDCP子系统可以采用低功耗的红外线通信技术，以提升性能。 |
| 端到端延迟         | PDCP子系统需要支持实时性，以满足用户的需求。对于视频、音频等高速应用，要求最小延迟。PDCP子系统需要支持端到端的时延抖动，以保证可靠性。 |
| 时隙资源分配      | 由于5G使用FDD模式进行资源分配，所以所有的子通道都在相同的频段。每个子通道最多能同时分配20个子通道块，所以时隙资源分配要足够短。 |
| 数据聚合         | 由于资源利用率的原因，需要对数据进行聚合。数据聚合可以提高传输效率，提高性能。 |
| 错误纠正         | 由于用户数据可能会发生错误，需要采用差错控制来纠正错误。 |
| 重传控制         | 由于用户请求不断变化，PDCP子系统需要提供重传控制，以避免数据丢失。 |
| 暂停控制         | PDCP子系统需要支持暂停机制，以便更好的管理资源。当用户切换到另一个频道时，需要停止传输，等待资源的释放。 |
| QoS保证         | PDCP子系统应该支持服务质量保证，以保证数据传输的成功率。 |
| 多重传输         | 由于多个用户的数据流可能同时发送，PDCP子系统需要支持多重传输，提高系统的可靠性。 |
| 控制面模式切换   | PDCP子系统应该支持动态性和弹性，以满足用户的需要。 |
| 混叠传输         | 为了避免频繁的资源分配和调度，PDCP子系统可以采用混叠传输。 |
| 轮询机制         | PDCP子系统采用轮询机制，来发现故障和更新路由表。 |
| 丢包和抖动处理    | PDCP子系统在接收用户数据的时候，采用丢包和抖动处理，以减少用户数据的丢失和抖动。 |
| 安全机制         | PDCP子系统需要采用安全机制，来保护用户数据和网络数据。 |
| 拓扑优化         | PDCP子系统的部署可以满足用户拓扑变化的需求，如城市变迁、停电、雷击、网络分割等。 |
| 时钟同步         | PDCP子系统通过在物理层同步时钟，可以保证系统时钟一致，避免时钟漂移导致的问题。 |
| 成本和费用估算    | 5G的成本和费用需要根据基站的功能、功耗、覆盖范围、功能、配置等因素来估算。5G还可以提供有关的工具，帮助用户进行估算和投资。 |

##### (五) X2AP子系统
X2AP子系统的作用是实现 X2AP 层的功能，包括管理 X2 链接的建立、维护、删除、拓扑变化通知等功能。X2AP子系统的性能指标如下：

| 性能指标            | 描述                                                         |
| ----------------- | ------------------------------------------------------------ |
| 动态资源分配      | X2AP子系统需要支持动态资源分配，以适应用户的变动。 |
| 时隙资源分配      | 由于5G使用FDD模式进行资源分配，所以所有的子通道都在相同的频段。每个子通道最多能同时分配20个子通道块，所以时隙资源分配要足够短。 |
| 拓扑优化          | X2AP子系统的部署可以满足用户拓扑变化的需求，如城市变迁、停电、雷击、网络分割等。 |
| 连接建立         | X2AP子系统需要支持连接建立，以确保数据传输的成功率。 |
| 链接维护         | X2AP子系统需要支持链接维护，以确保数据传输的顺畅。 |
| 连接删除         | X2AP子系统需要支持连接删除，以便回收资源。 |
| 拓扑变化通知     | X2AP子系统需要支持拓扑变化通知，以适应用户的拓扑变化。 |
| 资源管理         | X2AP子系统需要支持资源管理，以避免资源占用过多。 |
| 安全机制          | X2AP子系统需要采用安全机制，来保护用户数据和网络数据。 |
| 成本和费用估算     | 5G的成本和费用需要根据基站的功能、功耗、覆盖范围、功能、配置等因素来估算。5G还可以提供有关的工具，帮助用户进行估算和投资。 |

##### (六) NGAP子系统
NGAP子系统的作用是实现 NGAP 层的功能，包括 NR 单元的资源管理、SR 单元的配置、上下行链路的建立和断开、RadioBearer建立、配额管理等功能。NGAP子系统的性能指标如下：

| 性能指标           | 描述                                                         |
| --------------- | ------------------------------------------------------------ |
| Radio Bearer    | 通过 Radio Bearer，NR 子系统可以有效地利用空口资源，为用户提供可靠且稳定的服务。 |
| 资源管理         | NR 子系统需要支持资源管理，以便保证稳定性和可靠性。 |
| 配置管理         | SR 子系统需要提供配置管理，以便实时更新用户的配置文件。 |
| 上下行链路建立    | 上下行链路建立是建立连接的过程，需要建立在5G Core网、RNC（Radio Network Controller）和AMF（Access and Mobility Function）之间。 |
| 配额管理         | 由于用户的使用资源和行为随时会变化，需要配额管理，以便实时监控和管理用户的资源使用情况。 |
| 安全管理         | 5G使用安全机制，需要提供安全管理，以确保数据安全。 |
| 成本和费用估算    | 5G的成本和费用需要根据基站的功能、功耗、覆盖范围、功能、配置等因素来估算。5G还可以提供有关的工具，帮助用户进行估算和投资。 |

##### (七) ULCL子系统
ULCL子系统的作用是实现用户终端的集成化计算。ULCL子系统既包含本地计算，又包含远程计算。ULCL子系统的性能指标如下：

| 性能指标           | 描述                                                         |
| --------------- | ------------------------------------------------------------ |
| 本地计算          | 为了提升性能，ULCL子系统可以采用本地计算，以优化用户体验。本地计算可以采用协同的处理技术，在同一时间处理多个任务。 |
| 远程计算          | ULCL子系统还可以使用远程计算，来提升性能和利用率。 |