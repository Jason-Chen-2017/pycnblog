
作者：禅与计算机程序设计艺术                    

# 1.背景介绍


计算几何(Computer Graphics) 是利用计算机生成图形的方式进行工程绘画的学科。它是3D数学的一个分支，应用于图形学、图像处理、虚拟现实等领域。计算几何在近年来有着极大的发展，主要表现在以下三个方面:

1. 近似计算（Approximation）：计算几何中的曲线拟合与精确计算都属于近似计算。即通过对一些简单几何对象进行拟合或预测来获得更加精确的结果。

2. 模型表示（Model Representation）：计算几icht中的很多模型都可以用一些基本的几何体构建出来。如点、直线、曲线、多边形、圆等。

3. 计算代价（Computation Cost）：由于计算几何算法的复杂性，其运行时间往往比较长。但是随着硬件的提升，运算速度也越来越快。另外，还可以通过并行化和分布式计算来提高效率。

本文将从以下三个视角出发，对计算几何进行全面的讲述：

1. 基于代数几何的表示方法（Algebraic Geometry Representations）：从曲线到平面，逐步揭示计算几何中最基本的对象，以及如何用它们来解决实际问题。

2. 算法导论（Introduction to Algorithms for Computer Graphics）：侧重于计算几何相关的算法，包括求交、求线段相交、求角、求面积等。帮助读者理解计算几何的实现过程，以及如何选择适合需求的算法。

3. 应用案例（Real World Applications of Computational Geometry）：探讨计算几何在工程绘画领域的实际应用，以及如何在日常工作中运用到计算几何中。
# 2.核心概念与联系
## 2.1 基本概念
在计算几何中，通常需要用到以下几个基本概念：

1. 点：点(Point)是一个位置或者空间坐标。在二维空间中，一个点由x轴和y轴确定，用(x, y)表示；在三维空间中，一个点由x轴、y轴和z轴确定，用(x, y, z)表示。

2. 曲线：曲线(Curve)是用来表示曲折变化的物体。二维曲线由连接若干个点的曲线段组成，曲线段由两个端点组成；三维曲线则由连接若干个点和两个方向向量的曲面片组成，曲面片由三个参数方程组成。

3. 曲面：曲面(Surface)又叫平面(Plane)，是由曲线演变而来的一个二维区域。曲面由连续多条曲线连接而成，每一条曲线称为面的弧段。曲面上的任一点都对应于其坐标系中某一特定曲线上任一点。

4. 投影：投影(Projection)是指把一个二维曲面沿着某一固定方向投影到一个一维的平面上所得到的二维曲线。常用的投影方式有正交投影、经典投影等。

5. 角度：角度(Angle)指的是在平面直角坐标系下两个向量之间的夹角。角度的定义采用逆时针的方向，即右手定理，也就是向量v=a+b+c，其中a、b、c均为单位矢量，那么其夹角的cos值等于a.b + b.c + c.a，其角度等于acos(cos值)。

6. 平面：平面(Plane)是在一个维度上去掉其他维度后的结果。比如，在三维空间里的水平面就是二维平面。平面一般都是无限远的，不过根据曲面是否可切来分类，可切的平面又可以进一步细分为顶点平面、平行平面和椎体平面等。

7. 法向量：法向量(Normal Vector)也叫法线(Normal)，是指向某一平面的方向向量。法向量的计算有两种形式：一种是对于平面方程的求解，另一种是通过两个邻接面的交点来求得。

8. 射线：射线(Ray)是无穷长度的一条光线，它没有源头和终点，只有一个方向。射线的发出者可以使用激光或雷达，接收者通常是一块表面。

9. 交点：交点(Intersection Point)是两个曲线、曲面或线段等元素的共同点。两个曲线、曲面或线段的交点的个数可能有0、1或2种。当两个对象之间只有一个交点时，该交点称为一点交点；当两个对象之间有多个交点时，它们统称为多点交点。

10. 距离：距离(Distance)是两个点之间的路径长，也可用角度和距离比来表示。

以上这些基本概念构成了计算几何中的重要概念，也是后续的分析依据。
## 2.2 几何变换
几何变换(Geometry Transformation)是计算几何中的关键概念。几何变换是将一个几何体映射到另一个几何体中的过程，几何变换有不同的类型，如旋转、缩放、移动等。几何变换在绘制时扮演着至关重要的角色，它的作用是实现物体的移动、旋转、缩放、剪切、变色等各种视觉效果。

几何变换可以分为内变换(Local Transformations)和外变换(Global Transformations)两种。内变换指的是改变对象内部属性，如旋转、缩放等；外变换指的是改变全局几何环境，如平移、旋转等。

对于内变换，主要分为平移、旋转、缩放、倾斜四种，它们的作用分别是移动、旋转、拉伸、剪切。而对于外变换，主要分为平移、旋转、缩放、投影四种，它们的作用分别是移动、旋转、拉伸、改变视角。
# 3.核心算法原理和具体操作步骤以及数学模型公式详细讲解
本节将详细介绍计算几何中的一些基本算法。
## 3.1 插值算法
插值(Interpolation)是指按照一定的规则计算出一个新的数据点的值。插值算法可以用于插补缺失数据、减少误差、拟合曲线、计算表面法向量等。插值算法主要有线性插值、多项式插值、样条曲线插值、卡尔曼滤波等。
### 3.1.1 线性插值
线性插值(Linear Interpolation)是最简单的插值方法。线性插值是指沿着直线的方向计算新数据点的值，用前一个数据点和后一个数据点之间的权重求和作为插值因子。

设有两个数据点(x1,y1)和(x2,y2)，且不知道中间数据点的值，则有如下插值公式：

yi = (y1 * (x2 - x) + y2 * (x - x1)) / (x2 - x1) 

其中xi是待测数据点的横坐标，yi是插值结果，x是实际的坐标值。例如，已知x1=2,y1=3,x2=5,y2=7,x=3.5，则

yi = ((3)(5-3.5) + (7)(3.5-2))/2.5=4.2 

所以，在横坐标为3.5处，用线性插值法计算出的插值值为4.2。
### 3.1.2 多项式插值
多项式插值(Polynomial Interpolation)是根据给定的n+1个点，构造n次多项式，然后对任意一点x求解。多项式插值具有较好的数值稳定性，能较好地估计函数在局部的第二阶导数和不连续处的梯度。多项式插值算法既可以用来拟合曲线，也可以用来插值曲面上的点。

多项式插值方法可以分为零次插值、一次插值、二次插值、三次插值、四次插值、五次插值、六次插值等，其公式如下：

Pn(x)=Sum((i=0)^n {Ai*x^i}) 

其中P是多项式，Ai为第i个系数，x为待测数据点的横坐标。零次插值时只有常数项，一次插值时有两个系数；三次插值时有四个系数，七次插值时有八个系数。

例如，已知三个数据点(2,3),(3,6),(4,10)，构造一次多项式Pn(x)。令x=3.5，则Pn(3.5)=3.5*6/2+(3)*(3.5)^2/(2)+(10)*(3.5)^3/6=7.057。因此，在横坐标为3.5处，用一次多项式Pn(x)计算出的插值值为7.057。

除了以上的线性插值、多项式插值方法外，还有其他一些插值算法，如样条曲线插值、Catmull-Rom插值、Bezier曲线插值、Hermite插值、Lagrange插值、牛顿插值等。这些插值算法都有各自的优缺点，选择合适的方法时应注意取舍。
## 3.2 求交算法
求交(Intersection)是计算几何中非常重要的操作。求交可以用来判断两条线段是否相交、计算直线与平面的交点、求解空间曲线与平面曲面的交点、判断曲线与曲线之间的相交等。求交算法有几何判别法、射线法、分割法等。
### 3.2.1 几何判别法
几何判别法(Geometric Deduction)是求交的一种基础方法。几何判别法假设由直线和线段所组成的几何图形存在交点，并且各个直线与线段之间无交叉。几何判别法只能适用于简单情况，不能处理复杂情况。

对于两条线段ABCD和EFGH来说，如果存在这样的交点M，则有：

1. AM = BE, BM = CE 
2. ANB = EMN or ENM = MNE 
3. AOE + BPE + CQE + DRE = MOM + FNP + GQP + HSP 
4. QRB < FSD < TUS < XUV < YVW < ZWX 
5. AXA = BYB and AXC = CYD 

其中，AM，BM，ANB，EOE，BPE，CQE，DRE为直线AB，EF，EG，FH的方程，分别表示直线和线段。N为任意一点。

如果所有条件均满足，则称两条线段ABCD与EFGH相交。否则，称两条线段不相交。

几何判别法的时间复杂度为O(1)，缺陷是无法判断直线段内部是否有交点。
### 3.2.2 射线法
射线法(Ray Tracing Algorithm)是求解空间曲线与平面的交点的一种算法。射线法的基本思想是用一条射线与平面垂直，从远处射入并计算垂直线与平面的交点。

对于空间曲线S和平面P来说，在平面上求解某一曲线S与平面的交点的问题可转化为求解垂直于某个平面（一般为曲面所在的空间直角坐标系下的xy平面或zx平面）、射入与平面交汇处的射线与曲线S的交点的问题。即：

Px = a(y-Ly)+Q 

Py = b(z-Lz)+R 

Pz = k 

Sx(t),Sy(t),Sz(t)是曲线S在平面P垂直于某个点的切线，t为参数变量。

将P的方程两边同时乘以相应的切线，带入射线方程：

aSx(t)-Sx(a(y-Ly))+Qx = 0 

bSy(t)-Sy(b(z-Lz))+Ry = 0 

kSz(t)-Sz(k)=-Pz 

则有两条射线：

RaX(-L),RbY(-L),RkZ(-L) 

S1x(u)+SbX(-Lu)+Rx=0 

S1y(u)+ScY(-Lu)+Ry=0 

S1z(u)+SdZ(-Lu)-Rz=0 

求得交点之后，判断交点是垂直于哪条曲线的切线，再利用切线的方向信息求得曲线参数值。

射线法的时间复杂度为O(1)，适用于大部分情况下的求交。
### 3.2.3 分割法
分割法(Partitioning Method)是求解空间曲线与平面的交点的另一种算法。分割法的基本思想是先将平面上均匀的切分成m份，然后遍历每一份与曲线相交的区域。

对于曲线S和平面P，首先将P上切分成m个小格子，记为Mi。对于每一个Mi，用切线Ki与线段Si相交，求得相交点Oi。如果Oi在Mi内部，则说明此处不发生曲线与平面的交点，否则，Oi为曲线与平面的交点。

分割法的时间复杂度为O(m^2)，不太适用于大规模求交。
## 3.3 求交算法
求解多边形与多边形、圆与圆、多边形与圆的交集等问题也有对应的算法。这些算法的目的是判断两个区域的交集是否为空集，并输出交集的范围或中心。
### 3.3.1 求多边形与多边形的交集
求多边形与多边形的交集(Polygon Intersection)是一个经典问题。求解这个问题的算法有分治法和扫描线法。

分治法(Divide and Conquer Method)是求多边形与多边形的交集的一种方法。分治法的基本思路是将一个较大的多边形划分成两个较小的相同的多边形，递归处理，最后合并结果。

扫描线法(Sweep Line Method)是求多边形与多边形的交集的另一种方法。扫描线法的基本思路是使用一根扫过的线将两个多边形分割成不同的区域，并记录每个区间的左右边界。对于每一条扫过的线，枚举所有的相交区域，求交集。

分治法的时间复杂度为O(nlogn)，扫描线法的时间复杂度为O(nm)。
### 3.3.2 求圆与圆的交集
求圆与圆的交集(Circle-Circle Intersection)是求两个圆相交的问题。为了求解两个圆相交的条件，我们可以使用向量方法。两个圆心之间的向量(r1,θ1)和(r2,θ2)分别代表两个圆的半径和位于x轴的方位角，即(r1 cos θ1, r1 sin θ1)和(r2 cos θ2, r2 sin θ2)。

首先，判断两圆是否有重叠部分，如果没有重叠部分则不存在交集。如果存在重叠部分，则需要进行计算。

利用叉积的性质，若C1=(x1,y1),C2=(x2,y2),r1>0,r2>0,则有：

(x2-x1)*[(y1-y2)]-(y2-y1)*[(-x1+x2)] = |[(x2-x1)]^2+(y2-y1)^2|-|[-2(x1-x2)(y1-y2)]| 

其中第一个式子表示两个圆心之间的向量的叉积，第二个式子表示两个圆心之间的向量的模的平方的差。

将第一式子中的括号换成向量叉积公式后，并同时考虑到两个圆的半径：

[[(y1-y2)][r1^2]]-[[(y2-y1)][r2^2]]=[r1^2-r2^2]+2[(x1-x2)[(y1-y2)][r1]][(x2-x1)/(y2-y1)] 

[[(x2-x1)][r1^2]]-[[(x1-x2)][r2^2]]=[r1^2-r2^2]-2[(y1-y2)[(x1-x2)][r1]](y2-y1)/(x2-x1) 

考虑到两圆重叠部分的情况，只需判断四个交点中的一个即可，不需要遍历所有四个交点。

上面求解的只是交集的两个端点的坐标，如果要求交集的周长或面积，还需要做进一步的计算。
### 3.3.3 求多边形与圆的交集
求多边形与圆的交集(Polygon-Circle Intersection)是求解多边形与圆的交集的问题。

为了求解多边形与圆的交集，先计算圆的中心点到多边形每个顶点的向量，然后与多边形的边缘的法向量作向量积。如果积符号相同且夹角小于90度，则说明两者相交。

对于一条边，设与边平行的向量为a=(ax,ay)，边长为l。对于多边形的顶点P，设与P连线与边平行的向量为q=(qx,qy)。设与P连线的法向量为n=(nx,ny)。

对于多边形的顶点，可以求出一条向量l，使得边l的长度为r。考虑到边平行的向量a的模大于等于r，则可以由P出发延长直线l，得到新的点P'。

那么，两点之间的向量可以表示为：

P'-P = l 

P'-a = q-l 

P'-a = [(x'+lx')-ax] = [(lx'+mx')/(rx'+lx')]*(rx'+lx')^(ry'+my')-(y'+ly')^(rx'+lx') 

设圆心为M=(mx',my'),半径为r。有：

(mx'+lx')^2+(my'+ly')^2-rx'^2-ry'^2 = |[(mx'+lx')-px']|(py'+ry')-(y'+ly') 

由叉积定理：

[(mx'+lx')-px'][(my'+ly')-py']-(y'+ly')[(mx'+lx')-px'] = 0 

设q-l=(gx,gy)，则有：

[(mx'+lx')-px'][(my'+ly')-py']-(y'+ly'[g(x'+lx')+h(y'+ly')]) = mx'^2+my'^2-rx'^2-ry'^2-2rx'^2*gx-2ry'^2*gy 

此时，有：

my'^2+mx'^2-rx'^2*mx'-rx'^2*my'>=0 
=> mx'^2+(my'^2+rx'^2)/rx'^2<=rx'^2 
=> my'<sqrt(rx'^2/mx'^2)-mx'/rx^2>=0 
=> P'在侧边界M的右边。

类似地，可以验证得到，P'的另一侧边界的延长直线同样也在侧边界M的左边。

基于上述结论，可以对所有顶点求出可能相交的边，然后求出边的相交的端点，得到交集的端点。